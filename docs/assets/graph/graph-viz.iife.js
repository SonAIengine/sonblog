var Dc=Object.defineProperty;var Rc=(Oe,ve,Ue)=>ve in Oe?Dc(Oe,ve,{enumerable:!0,configurable:!0,writable:!0,value:Ue}):Oe[ve]=Ue;var J=(Oe,ve,Ue)=>Rc(Oe,typeof ve!="symbol"?ve+"":ve,Ue);(function(){"use strict";function Oe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ve={exports:{}},Ue;function Ai(){if(Ue)return ve.exports;Ue=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function(T,D,k){return Function.prototype.apply.call(T,D,k)},n;r&&typeof r.ownKeys=="function"?n=r.ownKeys:Object.getOwnPropertySymbols?n=function(T){return Object.getOwnPropertyNames(T).concat(Object.getOwnPropertySymbols(T))}:n=function(T){return Object.getOwnPropertyNames(T)};function t(m){console&&console.warn&&console.warn(m)}var i=Number.isNaN||function(T){return T!==T};function o(){o.init.call(this)}ve.exports=o,ve.exports.once=_,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(m){if(typeof m!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof m)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(m){if(typeof m!="number"||m<0||i(m))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+m+".");s=m}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(T){if(typeof T!="number"||T<0||i(T))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+T+".");return this._maxListeners=T,this};function u(m){return m._maxListeners===void 0?o.defaultMaxListeners:m._maxListeners}o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(T){for(var D=[],k=1;k<arguments.length;k++)D.push(arguments[k]);var x=T==="error",G=this._events;if(G!==void 0)x=x&&G.error===void 0;else if(!x)return!1;if(x){var z;if(D.length>0&&(z=D[0]),z instanceof Error)throw z;var H=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw H.context=z,H}var $=G[T];if($===void 0)return!1;if(typeof $=="function")e($,this,D);else for(var v=$.length,Y=g($,v),k=0;k<v;++k)e(Y[k],this,D);return!0};function c(m,T,D,k){var x,G,z;if(a(D),G=m._events,G===void 0?(G=m._events=Object.create(null),m._eventsCount=0):(G.newListener!==void 0&&(m.emit("newListener",T,D.listener?D.listener:D),G=m._events),z=G[T]),z===void 0)z=G[T]=D,++m._eventsCount;else if(typeof z=="function"?z=G[T]=k?[D,z]:[z,D]:k?z.unshift(D):z.push(D),x=u(m),x>0&&z.length>x&&!z.warned){z.warned=!0;var H=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(T)+" listeners added. Use emitter.setMaxListeners() to increase limit");H.name="MaxListenersExceededWarning",H.emitter=m,H.type=T,H.count=z.length,t(H)}return m}o.prototype.addListener=function(T,D){return c(this,T,D,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(T,D){return c(this,T,D,!0)};function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(m,T,D){var k={fired:!1,wrapFn:void 0,target:m,type:T,listener:D},x=l.bind(k);return x.listener=D,k.wrapFn=x,x}o.prototype.once=function(T,D){return a(D),this.on(T,d(this,T,D)),this},o.prototype.prependOnceListener=function(T,D){return a(D),this.prependListener(T,d(this,T,D)),this},o.prototype.removeListener=function(T,D){var k,x,G,z,H;if(a(D),x=this._events,x===void 0)return this;if(k=x[T],k===void 0)return this;if(k===D||k.listener===D)--this._eventsCount===0?this._events=Object.create(null):(delete x[T],x.removeListener&&this.emit("removeListener",T,k.listener||D));else if(typeof k!="function"){for(G=-1,z=k.length-1;z>=0;z--)if(k[z]===D||k[z].listener===D){H=k[z].listener,G=z;break}if(G<0)return this;G===0?k.shift():y(k,G),k.length===1&&(x[T]=k[0]),x.removeListener!==void 0&&this.emit("removeListener",T,H||D)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(T){var D,k,x;if(k=this._events,k===void 0)return this;if(k.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):k[T]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete k[T]),this;if(arguments.length===0){var G=Object.keys(k),z;for(x=0;x<G.length;++x)z=G[x],z!=="removeListener"&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(D=k[T],typeof D=="function")this.removeListener(T,D);else if(D!==void 0)for(x=D.length-1;x>=0;x--)this.removeListener(T,D[x]);return this};function f(m,T,D){var k=m._events;if(k===void 0)return[];var x=k[T];return x===void 0?[]:typeof x=="function"?D?[x.listener||x]:[x]:D?p(x):g(x,x.length)}o.prototype.listeners=function(T){return f(this,T,!0)},o.prototype.rawListeners=function(T){return f(this,T,!1)},o.listenerCount=function(m,T){return typeof m.listenerCount=="function"?m.listenerCount(T):h.call(m,T)},o.prototype.listenerCount=h;function h(m){var T=this._events;if(T!==void 0){var D=T[m];if(typeof D=="function")return 1;if(D!==void 0)return D.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function g(m,T){for(var D=new Array(T),k=0;k<T;++k)D[k]=m[k];return D}function y(m,T){for(;T+1<m.length;T++)m[T]=m[T+1];m.pop()}function p(m){for(var T=new Array(m.length),D=0;D<T.length;++D)T[D]=m[D].listener||m[D];return T}function _(m,T){return new Promise(function(D,k){function x(z){m.removeListener(T,G),k(z)}function G(){typeof m.removeListener=="function"&&m.removeListener("error",x),D([].slice.call(arguments))}b(m,T,G,{once:!0}),T!=="error"&&E(m,x,{once:!0})})}function E(m,T,D){typeof m.on=="function"&&b(m,"error",T,D)}function b(m,T,D,k){if(typeof m.on=="function")k.once?m.once(T,D):m.on(T,D);else if(typeof m.addEventListener=="function")m.addEventListener(T,function x(G){k.once&&m.removeEventListener(T,x),D(G)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof m)}return ve.exports}var An=Ai();function Di(){const r=arguments[0];for(let e=1,n=arguments.length;e<n;e++)if(arguments[e])for(const t in arguments[e])r[t]=arguments[e][t];return r}let ae=Di;typeof Object.assign=="function"&&(ae=Object.assign);function be(r,e,n,t){const i=r._nodes.get(e);let o=null;return i&&(t==="mixed"?o=i.out&&i.out[n]||i.undirected&&i.undirected[n]:t==="directed"?o=i.out&&i.out[n]:o=i.undirected&&i.undirected[n]),o}function ue(r){return typeof r=="object"&&r!==null}function Dn(r){let e;for(e in r)return!1;return!0}function we(r,e,n){Object.defineProperty(r,e,{enumerable:!1,configurable:!1,writable:!0,value:n})}function _e(r,e,n){const t={enumerable:!0,configurable:!0};typeof n=="function"?t.get=n:(t.value=n,t.writable=!1),Object.defineProperty(r,e,t)}function Rn(r){return!(!ue(r)||r.attributes&&!Array.isArray(r.attributes))}function Ri(){let r=Math.floor(Math.random()*256)&255;return()=>r++}function Ce(){const r=arguments;let e=null,n=-1;return{[Symbol.iterator](){return this},next(){let t=null;do{if(e===null){if(n++,n>=r.length)return{done:!0};e=r[n][Symbol.iterator]()}if(t=e.next(),t.done){e=null;continue}break}while(!0);return t}}}function je(){return{[Symbol.iterator](){return this},next(){return{done:!0}}}}class Ft extends Error{constructor(e){super(),this.name="GraphError",this.message=e}}class F extends Ft{constructor(e){super(e),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,F.prototype.constructor)}}class O extends Ft{constructor(e){super(e),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,O.prototype.constructor)}}class B extends Ft{constructor(e){super(e),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,B.prototype.constructor)}}function kn(r,e){this.key=r,this.attributes=e,this.clear()}kn.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function Ln(r,e){this.key=r,this.attributes=e,this.clear()}Ln.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function Cn(r,e){this.key=r,this.attributes=e,this.clear()}Cn.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function Ye(r,e,n,t,i){this.key=e,this.attributes=i,this.undirected=r,this.source=n,this.target=t}Ye.prototype.attach=function(){let r="out",e="in";this.undirected&&(r=e="undirected");const n=this.source.key,t=this.target.key;this.source[r][t]=this,!(this.undirected&&n===t)&&(this.target[e][n]=this)},Ye.prototype.attachMulti=function(){let r="out",e="in";const n=this.source.key,t=this.target.key;this.undirected&&(r=e="undirected");const i=this.source[r],o=i[t];if(typeof o>"u"){i[t]=this,this.undirected&&n===t||(this.target[e][n]=this);return}o.previous=this,this.next=o,i[t]=this,this.target[e][n]=this},Ye.prototype.detach=function(){const r=this.source.key,e=this.target.key;let n="out",t="in";this.undirected&&(n=t="undirected"),delete this.source[n][e],delete this.target[t][r]},Ye.prototype.detachMulti=function(){const r=this.source.key,e=this.target.key;let n="out",t="in";this.undirected&&(n=t="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[n][e],delete this.target[t][r]):(this.next.previous=void 0,this.source[n][e]=this.next,this.target[t][r]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const In=0,Nn=1,ki=2,xn=3;function Ie(r,e,n,t,i,o,s){let a,u,c,l;if(t=""+t,n===In){if(a=r._nodes.get(t),!a)throw new O(`Graph.${e}: could not find the "${t}" node in the graph.`);c=i,l=o}else if(n===xn){if(i=""+i,u=r._edges.get(i),!u)throw new O(`Graph.${e}: could not find the "${i}" edge in the graph.`);const d=u.source.key,f=u.target.key;if(t===d)a=u.target;else if(t===f)a=u.source;else throw new O(`Graph.${e}: the "${t}" node is not attached to the "${i}" edge (${d}, ${f}).`);c=o,l=s}else{if(u=r._edges.get(t),!u)throw new O(`Graph.${e}: could not find the "${t}" edge in the graph.`);n===Nn?a=u.source:a=u.target,c=i,l=o}return[a,c,l]}function Li(r,e,n){r.prototype[e]=function(t,i,o){const[s,a]=Ie(this,e,n,t,i,o);return s.attributes[a]}}function Ci(r,e,n){r.prototype[e]=function(t,i){const[o]=Ie(this,e,n,t,i);return o.attributes}}function Ii(r,e,n){r.prototype[e]=function(t,i,o){const[s,a]=Ie(this,e,n,t,i,o);return s.attributes.hasOwnProperty(a)}}function Ni(r,e,n){r.prototype[e]=function(t,i,o,s){const[a,u,c]=Ie(this,e,n,t,i,o,s);return a.attributes[u]=c,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:u}),this}}function xi(r,e,n){r.prototype[e]=function(t,i,o,s){const[a,u,c]=Ie(this,e,n,t,i,o,s);if(typeof c!="function")throw new F(`Graph.${e}: updater should be a function.`);const l=a.attributes,d=c(l[u]);return l[u]=d,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:u}),this}}function Pi(r,e,n){r.prototype[e]=function(t,i,o){const[s,a]=Ie(this,e,n,t,i,o);return delete s.attributes[a],this.emit("nodeAttributesUpdated",{key:s.key,type:"remove",attributes:s.attributes,name:a}),this}}function Oi(r,e,n){r.prototype[e]=function(t,i,o){const[s,a]=Ie(this,e,n,t,i,o);if(!ue(a))throw new F(`Graph.${e}: provided attributes are not a plain object.`);return s.attributes=a,this.emit("nodeAttributesUpdated",{key:s.key,type:"replace",attributes:s.attributes}),this}}function Gi(r,e,n){r.prototype[e]=function(t,i,o){const[s,a]=Ie(this,e,n,t,i,o);if(!ue(a))throw new F(`Graph.${e}: provided attributes are not a plain object.`);return ae(s.attributes,a),this.emit("nodeAttributesUpdated",{key:s.key,type:"merge",attributes:s.attributes,data:a}),this}}function Fi(r,e,n){r.prototype[e]=function(t,i,o){const[s,a]=Ie(this,e,n,t,i,o);if(typeof a!="function")throw new F(`Graph.${e}: provided updater is not a function.`);return s.attributes=a(s.attributes),this.emit("nodeAttributesUpdated",{key:s.key,type:"update",attributes:s.attributes}),this}}const zi=[{name:r=>`get${r}Attribute`,attacher:Li},{name:r=>`get${r}Attributes`,attacher:Ci},{name:r=>`has${r}Attribute`,attacher:Ii},{name:r=>`set${r}Attribute`,attacher:Ni},{name:r=>`update${r}Attribute`,attacher:xi},{name:r=>`remove${r}Attribute`,attacher:Pi},{name:r=>`replace${r}Attributes`,attacher:Oi},{name:r=>`merge${r}Attributes`,attacher:Gi},{name:r=>`update${r}Attributes`,attacher:Fi}];function Mi(r){zi.forEach(function({name:e,attacher:n}){n(r,e("Node"),In),n(r,e("Source"),Nn),n(r,e("Target"),ki),n(r,e("Opposite"),xn)})}function Ui(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new B(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new B(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+t,a=""+i;if(i=arguments[2],o=be(this,s,a,n),!o)throw new O(`Graph.${e}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new B(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new O(`Graph.${e}: could not find the "${t}" edge in the graph.`)}return o.attributes[i]}}function $i(r,e,n){r.prototype[e]=function(t){let i;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new B(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new B(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+t,s=""+arguments[1];if(i=be(this,o,s,n),!i)throw new O(`Graph.${e}: could not find an edge for the given path ("${o}" - "${s}").`)}else{if(n!=="mixed")throw new B(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,i=this._edges.get(t),!i)throw new O(`Graph.${e}: could not find the "${t}" edge in the graph.`)}return i.attributes}}function Bi(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new B(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new B(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+t,a=""+i;if(i=arguments[2],o=be(this,s,a,n),!o)throw new O(`Graph.${e}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new B(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new O(`Graph.${e}: could not find the "${t}" edge in the graph.`)}return o.attributes.hasOwnProperty(i)}}function Wi(r,e,n){r.prototype[e]=function(t,i,o){let s;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new B(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new B(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+t,u=""+i;if(i=arguments[2],o=arguments[3],s=be(this,a,u,n),!s)throw new O(`Graph.${e}: could not find an edge for the given path ("${a}" - "${u}").`)}else{if(n!=="mixed")throw new B(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,s=this._edges.get(t),!s)throw new O(`Graph.${e}: could not find the "${t}" edge in the graph.`)}return s.attributes[i]=o,this.emit("edgeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:i}),this}}function Hi(r,e,n){r.prototype[e]=function(t,i,o){let s;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new B(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new B(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+t,u=""+i;if(i=arguments[2],o=arguments[3],s=be(this,a,u,n),!s)throw new O(`Graph.${e}: could not find an edge for the given path ("${a}" - "${u}").`)}else{if(n!=="mixed")throw new B(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,s=this._edges.get(t),!s)throw new O(`Graph.${e}: could not find the "${t}" edge in the graph.`)}if(typeof o!="function")throw new F(`Graph.${e}: updater should be a function.`);return s.attributes[i]=o(s.attributes[i]),this.emit("edgeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:i}),this}}function Vi(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new B(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new B(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+t,a=""+i;if(i=arguments[2],o=be(this,s,a,n),!o)throw new O(`Graph.${e}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new B(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new O(`Graph.${e}: could not find the "${t}" edge in the graph.`)}return delete o.attributes[i],this.emit("edgeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:i}),this}}function ji(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new B(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new B(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+t,a=""+i;if(i=arguments[2],o=be(this,s,a,n),!o)throw new O(`Graph.${e}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new B(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new O(`Graph.${e}: could not find the "${t}" edge in the graph.`)}if(!ue(i))throw new F(`Graph.${e}: provided attributes are not a plain object.`);return o.attributes=i,this.emit("edgeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function Yi(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new B(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new B(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+t,a=""+i;if(i=arguments[2],o=be(this,s,a,n),!o)throw new O(`Graph.${e}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new B(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new O(`Graph.${e}: could not find the "${t}" edge in the graph.`)}if(!ue(i))throw new F(`Graph.${e}: provided attributes are not a plain object.`);return ae(o.attributes,i),this.emit("edgeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:i}),this}}function Ki(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new B(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new B(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+t,a=""+i;if(i=arguments[2],o=be(this,s,a,n),!o)throw new O(`Graph.${e}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new B(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new O(`Graph.${e}: could not find the "${t}" edge in the graph.`)}if(typeof i!="function")throw new F(`Graph.${e}: provided updater is not a function.`);return o.attributes=i(o.attributes),this.emit("edgeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const qi=[{name:r=>`get${r}Attribute`,attacher:Ui},{name:r=>`get${r}Attributes`,attacher:$i},{name:r=>`has${r}Attribute`,attacher:Bi},{name:r=>`set${r}Attribute`,attacher:Wi},{name:r=>`update${r}Attribute`,attacher:Hi},{name:r=>`remove${r}Attribute`,attacher:Vi},{name:r=>`replace${r}Attributes`,attacher:ji},{name:r=>`merge${r}Attributes`,attacher:Yi},{name:r=>`update${r}Attributes`,attacher:Ki}];function Zi(r){qi.forEach(function({name:e,attacher:n}){n(r,e("Edge"),"mixed"),n(r,e("DirectedEdge"),"directed"),n(r,e("UndirectedEdge"),"undirected")})}const Xi=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function Ji(r,e,n,t){let i=!1;for(const o in e){if(o===t)continue;const s=e[o];if(i=n(s.key,s.attributes,s.source.key,s.target.key,s.source.attributes,s.target.attributes,s.undirected),r&&i)return s.key}}function Qi(r,e,n,t){let i,o,s,a=!1;for(const u in e)if(u!==t){i=e[u];do{if(o=i.source,s=i.target,a=n(i.key,i.attributes,o.key,s.key,o.attributes,s.attributes,i.undirected),r&&a)return i.key;i=i.next}while(i!==void 0)}}function zt(r,e){const n=Object.keys(r),t=n.length;let i,o=0;return{[Symbol.iterator](){return this},next(){do if(i)i=i.next;else{if(o>=t)return{done:!0};const s=n[o++];if(s===e){i=void 0;continue}i=r[s]}while(!i);return{done:!1,value:{edge:i.key,attributes:i.attributes,source:i.source.key,target:i.target.key,sourceAttributes:i.source.attributes,targetAttributes:i.target.attributes,undirected:i.undirected}}}}}function eo(r,e,n,t){const i=e[n];if(!i)return;const o=i.source,s=i.target;if(t(i.key,i.attributes,o.key,s.key,o.attributes,s.attributes,i.undirected)&&r)return i.key}function to(r,e,n,t){let i=e[n];if(!i)return;let o=!1;do{if(o=t(i.key,i.attributes,i.source.key,i.target.key,i.source.attributes,i.target.attributes,i.undirected),r&&o)return i.key;i=i.next}while(i!==void 0)}function Mt(r,e){let n=r[e];if(n.next!==void 0)return{[Symbol.iterator](){return this},next(){if(!n)return{done:!0};const i={edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected};return n=n.next,{done:!1,value:i}}};let t=!1;return{[Symbol.iterator](){return this},next(){return t===!0?{done:!0}:(t=!0,{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}})}}}function no(r,e){if(r.size===0)return[];if(e==="mixed"||e===r.type)return Array.from(r._edges.keys());const n=e==="undirected"?r.undirectedSize:r.directedSize,t=new Array(n),i=e==="undirected",o=r._edges.values();let s=0,a,u;for(;a=o.next(),a.done!==!0;)u=a.value,u.undirected===i&&(t[s++]=u.key);return t}function Pn(r,e,n,t){if(e.size===0)return;const i=n!=="mixed"&&n!==e.type,o=n==="undirected";let s,a,u=!1;const c=e._edges.values();for(;s=c.next(),s.done!==!0;){if(a=s.value,i&&a.undirected!==o)continue;const{key:l,attributes:d,source:f,target:h}=a;if(u=t(l,d,f.key,h.key,f.attributes,h.attributes,a.undirected),r&&u)return l}}function ro(r,e){if(r.size===0)return je();const n=e!=="mixed"&&e!==r.type,t=e==="undirected",i=r._edges.values();return{[Symbol.iterator](){return this},next(){let o,s;for(;;){if(o=i.next(),o.done)return o;if(s=o.value,!(n&&s.undirected!==t))break}return{value:{edge:s.key,attributes:s.attributes,source:s.source.key,target:s.target.key,sourceAttributes:s.source.attributes,targetAttributes:s.target.attributes,undirected:s.undirected},done:!1}}}}function Ut(r,e,n,t,i,o){const s=e?Qi:Ji;let a;if(n!=="undirected"&&(t!=="out"&&(a=s(r,i.in,o),r&&a)||t!=="in"&&(a=s(r,i.out,o,t?void 0:i.key),r&&a))||n!=="directed"&&(a=s(r,i.undirected,o),r&&a))return a}function io(r,e,n,t){const i=[];return Ut(!1,r,e,n,t,function(o){i.push(o)}),i}function oo(r,e,n){let t=je();return r!=="undirected"&&(e!=="out"&&typeof n.in<"u"&&(t=Ce(t,zt(n.in))),e!=="in"&&typeof n.out<"u"&&(t=Ce(t,zt(n.out,e?void 0:n.key)))),r!=="directed"&&typeof n.undirected<"u"&&(t=Ce(t,zt(n.undirected))),t}function $t(r,e,n,t,i,o,s){const a=n?to:eo;let u;if(e!=="undirected"&&(typeof i.in<"u"&&t!=="out"&&(u=a(r,i.in,o,s),r&&u)||typeof i.out<"u"&&t!=="in"&&(t||i.key!==o)&&(u=a(r,i.out,o,s),r&&u))||e!=="directed"&&typeof i.undirected<"u"&&(u=a(r,i.undirected,o,s),r&&u))return u}function so(r,e,n,t,i){const o=[];return $t(!1,r,e,n,t,i,function(s){o.push(s)}),o}function ao(r,e,n,t){let i=je();return r!=="undirected"&&(typeof n.in<"u"&&e!=="out"&&t in n.in&&(i=Ce(i,Mt(n.in,t))),typeof n.out<"u"&&e!=="in"&&t in n.out&&(e||n.key!==t)&&(i=Ce(i,Mt(n.out,t)))),r!=="directed"&&typeof n.undirected<"u"&&t in n.undirected&&(i=Ce(i,Mt(n.undirected,t))),i}function uo(r,e){const{name:n,type:t,direction:i}=e;r.prototype[n]=function(o,s){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return[];if(!arguments.length)return no(this,t);if(arguments.length===1){o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new O(`Graph.${n}: could not find the "${o}" node in the graph.`);return io(this.multi,t==="mixed"?this.type:t,i,a)}if(arguments.length===2){o=""+o,s=""+s;const a=this._nodes.get(o);if(!a)throw new O(`Graph.${n}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(s))throw new O(`Graph.${n}:  could not find the "${s}" target node in the graph.`);return so(t,this.multi,i,a,s)}throw new F(`Graph.${n}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function co(r,e){const{name:n,type:t,direction:i}=e,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);r.prototype[o]=function(c,l,d){if(!(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)){if(arguments.length===1)return d=c,Pn(!1,this,t,d);if(arguments.length===2){c=""+c,d=l;const f=this._nodes.get(c);if(typeof f>"u")throw new O(`Graph.${o}: could not find the "${c}" node in the graph.`);return Ut(!1,this.multi,t==="mixed"?this.type:t,i,f,d)}if(arguments.length===3){c=""+c,l=""+l;const f=this._nodes.get(c);if(!f)throw new O(`Graph.${o}:  could not find the "${c}" source node in the graph.`);if(!this._nodes.has(l))throw new O(`Graph.${o}:  could not find the "${l}" target node in the graph.`);return $t(!1,t,this.multi,i,f,l,d)}throw new F(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const s="map"+n[0].toUpperCase()+n.slice(1);r.prototype[s]=function(){const c=Array.prototype.slice.call(arguments),l=c.pop();let d;if(c.length===0){let f=0;t!=="directed"&&(f+=this.undirectedSize),t!=="undirected"&&(f+=this.directedSize),d=new Array(f);let h=0;c.push((g,y,p,_,E,b,m)=>{d[h++]=l(g,y,p,_,E,b,m)})}else d=[],c.push((f,h,g,y,p,_,E)=>{d.push(l(f,h,g,y,p,_,E))});return this[o].apply(this,c),d};const a="filter"+n[0].toUpperCase()+n.slice(1);r.prototype[a]=function(){const c=Array.prototype.slice.call(arguments),l=c.pop(),d=[];return c.push((f,h,g,y,p,_,E)=>{l(f,h,g,y,p,_,E)&&d.push(f)}),this[o].apply(this,c),d};const u="reduce"+n[0].toUpperCase()+n.slice(1);r.prototype[u]=function(){let c=Array.prototype.slice.call(arguments);if(c.length<2||c.length>4)throw new F(`Graph.${u}: invalid number of arguments (expecting 2, 3 or 4 and got ${c.length}).`);if(typeof c[c.length-1]=="function"&&typeof c[c.length-2]!="function")throw new F(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let l,d;c.length===2?(l=c[0],d=c[1],c=[]):c.length===3?(l=c[1],d=c[2],c=[c[0]]):c.length===4&&(l=c[2],d=c[3],c=[c[0],c[1]]);let f=d;return c.push((h,g,y,p,_,E,b)=>{f=l(f,h,g,y,p,_,E,b)}),this[o].apply(this,c),f}}function lo(r,e){const{name:n,type:t,direction:i}=e,o="find"+n[0].toUpperCase()+n.slice(1,-1);r.prototype[o]=function(u,c,l){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return!1;if(arguments.length===1)return l=u,Pn(!0,this,t,l);if(arguments.length===2){u=""+u,l=c;const d=this._nodes.get(u);if(typeof d>"u")throw new O(`Graph.${o}: could not find the "${u}" node in the graph.`);return Ut(!0,this.multi,t==="mixed"?this.type:t,i,d,l)}if(arguments.length===3){u=""+u,c=""+c;const d=this._nodes.get(u);if(!d)throw new O(`Graph.${o}:  could not find the "${u}" source node in the graph.`);if(!this._nodes.has(c))throw new O(`Graph.${o}:  could not find the "${c}" target node in the graph.`);return $t(!0,t,this.multi,i,d,c,l)}throw new F(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const s="some"+n[0].toUpperCase()+n.slice(1,-1);r.prototype[s]=function(){const u=Array.prototype.slice.call(arguments),c=u.pop();return u.push((d,f,h,g,y,p,_)=>c(d,f,h,g,y,p,_)),!!this[o].apply(this,u)};const a="every"+n[0].toUpperCase()+n.slice(1,-1);r.prototype[a]=function(){const u=Array.prototype.slice.call(arguments),c=u.pop();return u.push((d,f,h,g,y,p,_)=>!c(d,f,h,g,y,p,_)),!this[o].apply(this,u)}}function ho(r,e){const{name:n,type:t,direction:i}=e,o=n.slice(0,-1)+"Entries";r.prototype[o]=function(s,a){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return je();if(!arguments.length)return ro(this,t);if(arguments.length===1){s=""+s;const u=this._nodes.get(s);if(!u)throw new O(`Graph.${o}: could not find the "${s}" node in the graph.`);return oo(t,i,u)}if(arguments.length===2){s=""+s,a=""+a;const u=this._nodes.get(s);if(!u)throw new O(`Graph.${o}:  could not find the "${s}" source node in the graph.`);if(!this._nodes.has(a))throw new O(`Graph.${o}:  could not find the "${a}" target node in the graph.`);return ao(t,i,u,a)}throw new F(`Graph.${o}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function fo(r){Xi.forEach(e=>{uo(r,e),co(r,e),lo(r,e),ho(r,e)})}const go=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function ft(){this.A=null,this.B=null}ft.prototype.wrap=function(r){this.A===null?this.A=r:this.B===null&&(this.B=r)},ft.prototype.has=function(r){return this.A!==null&&r in this.A||this.B!==null&&r in this.B};function rt(r,e,n,t,i){for(const o in t){const s=t[o],a=s.source,u=s.target,c=a===n?u:a;if(e&&e.has(c.key))continue;const l=i(c.key,c.attributes);if(r&&l)return c.key}}function Bt(r,e,n,t,i){if(e!=="mixed"){if(e==="undirected")return rt(r,null,t,t.undirected,i);if(typeof n=="string")return rt(r,null,t,t[n],i)}const o=new ft;let s;if(e!=="undirected"){if(n!=="out"){if(s=rt(r,null,t,t.in,i),r&&s)return s;o.wrap(t.in)}if(n!=="in"){if(s=rt(r,o,t,t.out,i),r&&s)return s;o.wrap(t.out)}}if(e!=="directed"&&(s=rt(r,o,t,t.undirected,i),r&&s))return s}function po(r,e,n){if(r!=="mixed"){if(r==="undirected")return Object.keys(n.undirected);if(typeof e=="string")return Object.keys(n[e])}const t=[];return Bt(!1,r,e,n,function(i){t.push(i)}),t}function it(r,e,n){const t=Object.keys(n),i=t.length;let o=0;return{[Symbol.iterator](){return this},next(){let s=null;do{if(o>=i)return r&&r.wrap(n),{done:!0};const a=n[t[o++]],u=a.source,c=a.target;if(s=u===e?c:u,r&&r.has(s.key)){s=null;continue}}while(s===null);return{done:!1,value:{neighbor:s.key,attributes:s.attributes}}}}}function mo(r,e,n){if(r!=="mixed"){if(r==="undirected")return it(null,n,n.undirected);if(typeof e=="string")return it(null,n,n[e])}let t=je();const i=new ft;return r!=="undirected"&&(e!=="out"&&(t=Ce(t,it(i,n,n.in))),e!=="in"&&(t=Ce(t,it(i,n,n.out)))),r!=="directed"&&(t=Ce(t,it(i,n,n.undirected))),t}function yo(r,e){const{name:n,type:t,direction:i}=e;r.prototype[n]=function(o){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return[];o=""+o;const s=this._nodes.get(o);if(typeof s>"u")throw new O(`Graph.${n}: could not find the "${o}" node in the graph.`);return po(t==="mixed"?this.type:t,i,s)}}function vo(r,e){const{name:n,type:t,direction:i}=e,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);r.prototype[o]=function(c,l){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return;c=""+c;const d=this._nodes.get(c);if(typeof d>"u")throw new O(`Graph.${o}: could not find the "${c}" node in the graph.`);Bt(!1,t==="mixed"?this.type:t,i,d,l)};const s="map"+n[0].toUpperCase()+n.slice(1);r.prototype[s]=function(c,l){const d=[];return this[o](c,(f,h)=>{d.push(l(f,h))}),d};const a="filter"+n[0].toUpperCase()+n.slice(1);r.prototype[a]=function(c,l){const d=[];return this[o](c,(f,h)=>{l(f,h)&&d.push(f)}),d};const u="reduce"+n[0].toUpperCase()+n.slice(1);r.prototype[u]=function(c,l,d){if(arguments.length<3)throw new F(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let f=d;return this[o](c,(h,g)=>{f=l(f,h,g)}),f}}function bo(r,e){const{name:n,type:t,direction:i}=e,o=n[0].toUpperCase()+n.slice(1,-1),s="find"+o;r.prototype[s]=function(c,l){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return;c=""+c;const d=this._nodes.get(c);if(typeof d>"u")throw new O(`Graph.${s}: could not find the "${c}" node in the graph.`);return Bt(!0,t==="mixed"?this.type:t,i,d,l)};const a="some"+o;r.prototype[a]=function(c,l){return!!this[s](c,l)};const u="every"+o;r.prototype[u]=function(c,l){return!this[s](c,(f,h)=>!l(f,h))}}function wo(r,e){const{name:n,type:t,direction:i}=e,o=n.slice(0,-1)+"Entries";r.prototype[o]=function(s){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return je();s=""+s;const a=this._nodes.get(s);if(typeof a>"u")throw new O(`Graph.${o}: could not find the "${s}" node in the graph.`);return mo(t==="mixed"?this.type:t,i,a)}}function Eo(r){go.forEach(e=>{yo(r,e),vo(r,e),bo(r,e),wo(r,e)})}function gt(r,e,n,t,i){const o=t._nodes.values(),s=t.type;let a,u,c,l,d,f;for(;a=o.next(),a.done!==!0;){let h=!1;if(u=a.value,s!=="undirected"){l=u.out;for(c in l){d=l[c];do f=d.target,h=!0,i(u.key,f.key,u.attributes,f.attributes,d.key,d.attributes,d.undirected),d=d.next;while(d)}}if(s!=="directed"){l=u.undirected;for(c in l)if(!(e&&u.key>c)){d=l[c];do f=d.target,f.key!==c&&(f=d.source),h=!0,i(u.key,f.key,u.attributes,f.attributes,d.key,d.attributes,d.undirected),d=d.next;while(d)}}n&&!h&&i(u.key,null,u.attributes,null,null,null,null)}}function So(r,e){const n={key:r};return Dn(e.attributes)||(n.attributes=ae({},e.attributes)),n}function To(r,e,n){const t={key:e,source:n.source.key,target:n.target.key};return Dn(n.attributes)||(t.attributes=ae({},n.attributes)),r==="mixed"&&n.undirected&&(t.undirected=!0),t}function _o(r){if(!ue(r))throw new F('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in r))throw new F("Graph.import: serialized node is missing its key.");if("attributes"in r&&(!ue(r.attributes)||r.attributes===null))throw new F("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function Ao(r){if(!ue(r))throw new F('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in r))throw new F("Graph.import: serialized edge is missing its source.");if(!("target"in r))throw new F("Graph.import: serialized edge is missing its target.");if("attributes"in r&&(!ue(r.attributes)||r.attributes===null))throw new F("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in r&&typeof r.undirected!="boolean")throw new F("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const Do=Ri(),Ro=new Set(["directed","undirected","mixed"]),On=new Set(["domain","_events","_eventsCount","_maxListeners"]),ko=[{name:r=>`${r}Edge`,generateKey:!0},{name:r=>`${r}DirectedEdge`,generateKey:!0,type:"directed"},{name:r=>`${r}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:r=>`${r}EdgeWithKey`},{name:r=>`${r}DirectedEdgeWithKey`,type:"directed"},{name:r=>`${r}UndirectedEdgeWithKey`,type:"undirected"}],Lo={allowSelfLoops:!0,multi:!1,type:"mixed"};function Co(r,e,n){if(n&&!ue(n))throw new F(`Graph.addNode: invalid attributes. Expecting an object but got "${n}"`);if(e=""+e,n=n||{},r._nodes.has(e))throw new B(`Graph.addNode: the "${e}" node already exist in the graph.`);const t=new r.NodeDataClass(e,n);return r._nodes.set(e,t),r.emit("nodeAdded",{key:e,attributes:n}),t}function Gn(r,e,n){const t=new r.NodeDataClass(e,n);return r._nodes.set(e,t),r.emit("nodeAdded",{key:e,attributes:n}),t}function Fn(r,e,n,t,i,o,s,a){if(!t&&r.type==="undirected")throw new B(`Graph.${e}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(t&&r.type==="directed")throw new B(`Graph.${e}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(a&&!ue(a))throw new F(`Graph.${e}: invalid attributes. Expecting an object but got "${a}"`);if(o=""+o,s=""+s,a=a||{},!r.allowSelfLoops&&o===s)throw new B(`Graph.${e}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const u=r._nodes.get(o),c=r._nodes.get(s);if(!u)throw new O(`Graph.${e}: source node "${o}" not found.`);if(!c)throw new O(`Graph.${e}: target node "${s}" not found.`);const l={key:null,undirected:t,source:o,target:s,attributes:a};if(n)i=r._edgeKeyGenerator();else if(i=""+i,r._edges.has(i))throw new B(`Graph.${e}: the "${i}" edge already exists in the graph.`);if(!r.multi&&(t?typeof u.undirected[s]<"u":typeof u.out[s]<"u"))throw new B(`Graph.${e}: an edge linking "${o}" to "${s}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const d=new Ye(t,i,u,c,a);r._edges.set(i,d);const f=o===s;return t?(u.undirectedDegree++,c.undirectedDegree++,f&&(u.undirectedLoops++,r._undirectedSelfLoopCount++)):(u.outDegree++,c.inDegree++,f&&(u.directedLoops++,r._directedSelfLoopCount++)),r.multi?d.attachMulti():d.attach(),t?r._undirectedSize++:r._directedSize++,l.key=i,r.emit("edgeAdded",l),i}function Io(r,e,n,t,i,o,s,a,u){if(!t&&r.type==="undirected")throw new B(`Graph.${e}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(t&&r.type==="directed")throw new B(`Graph.${e}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(a){if(u){if(typeof a!="function")throw new F(`Graph.${e}: invalid updater function. Expecting a function but got "${a}"`)}else if(!ue(a))throw new F(`Graph.${e}: invalid attributes. Expecting an object but got "${a}"`)}o=""+o,s=""+s;let c;if(u&&(c=a,a=void 0),!r.allowSelfLoops&&o===s)throw new B(`Graph.${e}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let l=r._nodes.get(o),d=r._nodes.get(s),f,h;if(!n&&(f=r._edges.get(i),f)){if((f.source.key!==o||f.target.key!==s)&&(!t||f.source.key!==s||f.target.key!==o))throw new B(`Graph.${e}: inconsistency detected when attempting to merge the "${i}" edge with "${o}" source & "${s}" target vs. ("${f.source.key}", "${f.target.key}").`);h=f}if(!h&&!r.multi&&l&&(h=t?l.undirected[s]:l.out[s]),h){const E=[h.key,!1,!1,!1];if(u?!c:!a)return E;if(u){const b=h.attributes;h.attributes=c(b),r.emit("edgeAttributesUpdated",{type:"replace",key:h.key,attributes:h.attributes})}else ae(h.attributes,a),r.emit("edgeAttributesUpdated",{type:"merge",key:h.key,attributes:h.attributes,data:a});return E}a=a||{},u&&c&&(a=c(a));const g={key:null,undirected:t,source:o,target:s,attributes:a};if(n)i=r._edgeKeyGenerator();else if(i=""+i,r._edges.has(i))throw new B(`Graph.${e}: the "${i}" edge already exists in the graph.`);let y=!1,p=!1;l||(l=Gn(r,o,{}),y=!0,o===s&&(d=l,p=!0)),d||(d=Gn(r,s,{}),p=!0),f=new Ye(t,i,l,d,a),r._edges.set(i,f);const _=o===s;return t?(l.undirectedDegree++,d.undirectedDegree++,_&&(l.undirectedLoops++,r._undirectedSelfLoopCount++)):(l.outDegree++,d.inDegree++,_&&(l.directedLoops++,r._directedSelfLoopCount++)),r.multi?f.attachMulti():f.attach(),t?r._undirectedSize++:r._directedSize++,g.key=i,r.emit("edgeAdded",g),[i,!0,y,p]}function Ke(r,e){r._edges.delete(e.key);const{source:n,target:t,attributes:i}=e,o=e.undirected,s=n===t;o?(n.undirectedDegree--,t.undirectedDegree--,s&&(n.undirectedLoops--,r._undirectedSelfLoopCount--)):(n.outDegree--,t.inDegree--,s&&(n.directedLoops--,r._directedSelfLoopCount--)),r.multi?e.detachMulti():e.detach(),o?r._undirectedSize--:r._directedSize--,r.emit("edgeDropped",{key:e.key,attributes:i,source:n.key,target:t.key,undirected:o})}class q extends An.EventEmitter{constructor(e){if(super(),e=ae({},Lo,e),typeof e.multi!="boolean")throw new F(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${e.multi}".`);if(!Ro.has(e.type))throw new F(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${e.type}".`);if(typeof e.allowSelfLoops!="boolean")throw new F(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${e.allowSelfLoops}".`);const n=e.type==="mixed"?kn:e.type==="directed"?Ln:Cn;we(this,"NodeDataClass",n);const t="geid_"+Do()+"_";let i=0;const o=()=>{let s;do s=t+i++;while(this._edges.has(s));return s};we(this,"_attributes",{}),we(this,"_nodes",new Map),we(this,"_edges",new Map),we(this,"_directedSize",0),we(this,"_undirectedSize",0),we(this,"_directedSelfLoopCount",0),we(this,"_undirectedSelfLoopCount",0),we(this,"_edgeKeyGenerator",o),we(this,"_options",e),On.forEach(s=>we(this,s,this[s])),_e(this,"order",()=>this._nodes.size),_e(this,"size",()=>this._edges.size),_e(this,"directedSize",()=>this._directedSize),_e(this,"undirectedSize",()=>this._undirectedSize),_e(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),_e(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),_e(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),_e(this,"multi",this._options.multi),_e(this,"type",this._options.type),_e(this,"allowSelfLoops",this._options.allowSelfLoops),_e(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(e){return this._nodes.has(""+e)}hasDirectedEdge(e,n){if(this.type==="undirected")return!1;if(arguments.length===1){const t=""+e,i=this._edges.get(t);return!!i&&!i.undirected}else if(arguments.length===2){e=""+e,n=""+n;const t=this._nodes.get(e);return t?t.out.hasOwnProperty(n):!1}throw new F(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(e,n){if(this.type==="directed")return!1;if(arguments.length===1){const t=""+e,i=this._edges.get(t);return!!i&&i.undirected}else if(arguments.length===2){e=""+e,n=""+n;const t=this._nodes.get(e);return t?t.undirected.hasOwnProperty(n):!1}throw new F(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(e,n){if(arguments.length===1){const t=""+e;return this._edges.has(t)}else if(arguments.length===2){e=""+e,n=""+n;const t=this._nodes.get(e);return t?typeof t.out<"u"&&t.out.hasOwnProperty(n)||typeof t.undirected<"u"&&t.undirected.hasOwnProperty(n):!1}throw new F(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(e,n){if(this.type==="undirected")return;if(e=""+e,n=""+n,this.multi)throw new B("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const t=this._nodes.get(e);if(!t)throw new O(`Graph.directedEdge: could not find the "${e}" source node in the graph.`);if(!this._nodes.has(n))throw new O(`Graph.directedEdge: could not find the "${n}" target node in the graph.`);const i=t.out&&t.out[n]||void 0;if(i)return i.key}undirectedEdge(e,n){if(this.type==="directed")return;if(e=""+e,n=""+n,this.multi)throw new B("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const t=this._nodes.get(e);if(!t)throw new O(`Graph.undirectedEdge: could not find the "${e}" source node in the graph.`);if(!this._nodes.has(n))throw new O(`Graph.undirectedEdge: could not find the "${n}" target node in the graph.`);const i=t.undirected&&t.undirected[n]||void 0;if(i)return i.key}edge(e,n){if(this.multi)throw new B("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new O(`Graph.edge: could not find the "${e}" source node in the graph.`);if(!this._nodes.has(n))throw new O(`Graph.edge: could not find the "${n}" target node in the graph.`);const i=t.out&&t.out[n]||t.undirected&&t.undirected[n]||void 0;if(i)return i.key}areDirectedNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new O(`Graph.areDirectedNeighbors: could not find the "${e}" node in the graph.`);return this.type==="undirected"?!1:n in t.in||n in t.out}areOutNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new O(`Graph.areOutNeighbors: could not find the "${e}" node in the graph.`);return this.type==="undirected"?!1:n in t.out}areInNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new O(`Graph.areInNeighbors: could not find the "${e}" node in the graph.`);return this.type==="undirected"?!1:n in t.in}areUndirectedNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new O(`Graph.areUndirectedNeighbors: could not find the "${e}" node in the graph.`);return this.type==="directed"?!1:n in t.undirected}areNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new O(`Graph.areNeighbors: could not find the "${e}" node in the graph.`);return this.type!=="undirected"&&(n in t.in||n in t.out)||this.type!=="directed"&&n in t.undirected}areInboundNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new O(`Graph.areInboundNeighbors: could not find the "${e}" node in the graph.`);return this.type!=="undirected"&&n in t.in||this.type!=="directed"&&n in t.undirected}areOutboundNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new O(`Graph.areOutboundNeighbors: could not find the "${e}" node in the graph.`);return this.type!=="undirected"&&n in t.out||this.type!=="directed"&&n in t.undirected}inDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.inDegree: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.inDegree}outDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.outDegree: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.outDegree}directedDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.directedDegree: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree}undirectedDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.undirectedDegree: could not find the "${e}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree}inboundDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.inboundDegree: could not find the "${e}" node in the graph.`);let t=0;return this.type!=="directed"&&(t+=n.undirectedDegree),this.type!=="undirected"&&(t+=n.inDegree),t}outboundDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.outboundDegree: could not find the "${e}" node in the graph.`);let t=0;return this.type!=="directed"&&(t+=n.undirectedDegree),this.type!=="undirected"&&(t+=n.outDegree),t}degree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.degree: could not find the "${e}" node in the graph.`);let t=0;return this.type!=="directed"&&(t+=n.undirectedDegree),this.type!=="undirected"&&(t+=n.inDegree+n.outDegree),t}inDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.inDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.inDegree-n.directedLoops}outDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.outDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.outDegree-n.directedLoops}directedDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.directedDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree-n.directedLoops*2}undirectedDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree-n.undirectedLoops*2}inboundDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);let t=0,i=0;return this.type!=="directed"&&(t+=n.undirectedDegree,i+=n.undirectedLoops*2),this.type!=="undirected"&&(t+=n.inDegree,i+=n.directedLoops),t-i}outboundDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);let t=0,i=0;return this.type!=="directed"&&(t+=n.undirectedDegree,i+=n.undirectedLoops*2),this.type!=="undirected"&&(t+=n.outDegree,i+=n.directedLoops),t-i}degreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.degreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);let t=0,i=0;return this.type!=="directed"&&(t+=n.undirectedDegree,i+=n.undirectedLoops*2),this.type!=="undirected"&&(t+=n.inDegree+n.outDegree,i+=n.directedLoops*2),t-i}source(e){e=""+e;const n=this._edges.get(e);if(!n)throw new O(`Graph.source: could not find the "${e}" edge in the graph.`);return n.source.key}target(e){e=""+e;const n=this._edges.get(e);if(!n)throw new O(`Graph.target: could not find the "${e}" edge in the graph.`);return n.target.key}extremities(e){e=""+e;const n=this._edges.get(e);if(!n)throw new O(`Graph.extremities: could not find the "${e}" edge in the graph.`);return[n.source.key,n.target.key]}opposite(e,n){e=""+e,n=""+n;const t=this._edges.get(n);if(!t)throw new O(`Graph.opposite: could not find the "${n}" edge in the graph.`);const i=t.source.key,o=t.target.key;if(e===i)return o;if(e===o)return i;throw new O(`Graph.opposite: the "${e}" node is not attached to the "${n}" edge (${i}, ${o}).`)}hasExtremity(e,n){e=""+e,n=""+n;const t=this._edges.get(e);if(!t)throw new O(`Graph.hasExtremity: could not find the "${e}" edge in the graph.`);return t.source.key===n||t.target.key===n}isUndirected(e){e=""+e;const n=this._edges.get(e);if(!n)throw new O(`Graph.isUndirected: could not find the "${e}" edge in the graph.`);return n.undirected}isDirected(e){e=""+e;const n=this._edges.get(e);if(!n)throw new O(`Graph.isDirected: could not find the "${e}" edge in the graph.`);return!n.undirected}isSelfLoop(e){e=""+e;const n=this._edges.get(e);if(!n)throw new O(`Graph.isSelfLoop: could not find the "${e}" edge in the graph.`);return n.source===n.target}addNode(e,n){return Co(this,e,n).key}mergeNode(e,n){if(n&&!ue(n))throw new F(`Graph.mergeNode: invalid attributes. Expecting an object but got "${n}"`);e=""+e,n=n||{};let t=this._nodes.get(e);return t?(n&&(ae(t.attributes,n),this.emit("nodeAttributesUpdated",{type:"merge",key:e,attributes:t.attributes,data:n})),[e,!1]):(t=new this.NodeDataClass(e,n),this._nodes.set(e,t),this.emit("nodeAdded",{key:e,attributes:n}),[e,!0])}updateNode(e,n){if(n&&typeof n!="function")throw new F(`Graph.updateNode: invalid updater function. Expecting a function but got "${n}"`);e=""+e;let t=this._nodes.get(e);if(t){if(n){const o=t.attributes;t.attributes=n(o),this.emit("nodeAttributesUpdated",{type:"replace",key:e,attributes:t.attributes})}return[e,!1]}const i=n?n({}):{};return t=new this.NodeDataClass(e,i),this._nodes.set(e,t),this.emit("nodeAdded",{key:e,attributes:i}),[e,!0]}dropNode(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new O(`Graph.dropNode: could not find the "${e}" node in the graph.`);let t;if(this.type!=="undirected"){for(const i in n.out){t=n.out[i];do Ke(this,t),t=t.next;while(t)}for(const i in n.in){t=n.in[i];do Ke(this,t),t=t.next;while(t)}}if(this.type!=="directed")for(const i in n.undirected){t=n.undirected[i];do Ke(this,t),t=t.next;while(t)}this._nodes.delete(e),this.emit("nodeDropped",{key:e,attributes:n.attributes})}dropEdge(e){let n;if(arguments.length>1){const t=""+arguments[0],i=""+arguments[1];if(n=be(this,t,i,this.type),!n)throw new O(`Graph.dropEdge: could not find the "${t}" -> "${i}" edge in the graph.`)}else if(e=""+e,n=this._edges.get(e),!n)throw new O(`Graph.dropEdge: could not find the "${e}" edge in the graph.`);return Ke(this,n),this}dropDirectedEdge(e,n){if(arguments.length<2)throw new B("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new B("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");e=""+e,n=""+n;const t=be(this,e,n,"directed");if(!t)throw new O(`Graph.dropDirectedEdge: could not find a "${e}" -> "${n}" edge in the graph.`);return Ke(this,t),this}dropUndirectedEdge(e,n){if(arguments.length<2)throw new B("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new B("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const t=be(this,e,n,"undirected");if(!t)throw new O(`Graph.dropUndirectedEdge: could not find a "${e}" -> "${n}" edge in the graph.`);return Ke(this,t),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const e=this._nodes.values();let n;for(;n=e.next(),n.done!==!0;)n.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(e){return this._attributes[e]}getAttributes(){return this._attributes}hasAttribute(e){return this._attributes.hasOwnProperty(e)}setAttribute(e,n){return this._attributes[e]=n,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:e}),this}updateAttribute(e,n){if(typeof n!="function")throw new F("Graph.updateAttribute: updater should be a function.");const t=this._attributes[e];return this._attributes[e]=n(t),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:e}),this}removeAttribute(e){return delete this._attributes[e],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:e}),this}replaceAttributes(e){if(!ue(e))throw new F("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=e,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(e){if(!ue(e))throw new F("Graph.mergeAttributes: provided attributes are not a plain object.");return ae(this._attributes,e),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:e}),this}updateAttributes(e){if(typeof e!="function")throw new F("Graph.updateAttributes: provided updater is not a function.");return this._attributes=e(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(e,n){if(typeof e!="function")throw new F("Graph.updateEachNodeAttributes: expecting an updater function.");if(n&&!Rn(n))throw new F("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const t=this._nodes.values();let i,o;for(;i=t.next(),i.done!==!0;)o=i.value,o.attributes=e(o.key,o.attributes);this.emit("eachNodeAttributesUpdated",{hints:n||null})}updateEachEdgeAttributes(e,n){if(typeof e!="function")throw new F("Graph.updateEachEdgeAttributes: expecting an updater function.");if(n&&!Rn(n))throw new F("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const t=this._edges.values();let i,o,s,a;for(;i=t.next(),i.done!==!0;)o=i.value,s=o.source,a=o.target,o.attributes=e(o.key,o.attributes,s.key,a.key,s.attributes,a.attributes,o.undirected);this.emit("eachEdgeAttributesUpdated",{hints:n||null})}forEachAdjacencyEntry(e){if(typeof e!="function")throw new F("Graph.forEachAdjacencyEntry: expecting a callback.");gt(!1,!1,!1,this,e)}forEachAdjacencyEntryWithOrphans(e){if(typeof e!="function")throw new F("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");gt(!1,!1,!0,this,e)}forEachAssymetricAdjacencyEntry(e){if(typeof e!="function")throw new F("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");gt(!1,!0,!1,this,e)}forEachAssymetricAdjacencyEntryWithOrphans(e){if(typeof e!="function")throw new F("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");gt(!1,!0,!0,this,e)}nodes(){return Array.from(this._nodes.keys())}forEachNode(e){if(typeof e!="function")throw new F("Graph.forEachNode: expecting a callback.");const n=this._nodes.values();let t,i;for(;t=n.next(),t.done!==!0;)i=t.value,e(i.key,i.attributes)}findNode(e){if(typeof e!="function")throw new F("Graph.findNode: expecting a callback.");const n=this._nodes.values();let t,i;for(;t=n.next(),t.done!==!0;)if(i=t.value,e(i.key,i.attributes))return i.key}mapNodes(e){if(typeof e!="function")throw new F("Graph.mapNode: expecting a callback.");const n=this._nodes.values();let t,i;const o=new Array(this.order);let s=0;for(;t=n.next(),t.done!==!0;)i=t.value,o[s++]=e(i.key,i.attributes);return o}someNode(e){if(typeof e!="function")throw new F("Graph.someNode: expecting a callback.");const n=this._nodes.values();let t,i;for(;t=n.next(),t.done!==!0;)if(i=t.value,e(i.key,i.attributes))return!0;return!1}everyNode(e){if(typeof e!="function")throw new F("Graph.everyNode: expecting a callback.");const n=this._nodes.values();let t,i;for(;t=n.next(),t.done!==!0;)if(i=t.value,!e(i.key,i.attributes))return!1;return!0}filterNodes(e){if(typeof e!="function")throw new F("Graph.filterNodes: expecting a callback.");const n=this._nodes.values();let t,i;const o=[];for(;t=n.next(),t.done!==!0;)i=t.value,e(i.key,i.attributes)&&o.push(i.key);return o}reduceNodes(e,n){if(typeof e!="function")throw new F("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new F("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let t=n;const i=this._nodes.values();let o,s;for(;o=i.next(),o.done!==!0;)s=o.value,t=e(t,s.key,s.attributes);return t}nodeEntries(){const e=this._nodes.values();return{[Symbol.iterator](){return this},next(){const n=e.next();if(n.done)return n;const t=n.value;return{value:{node:t.key,attributes:t.attributes},done:!1}}}}export(){const e=new Array(this._nodes.size);let n=0;this._nodes.forEach((i,o)=>{e[n++]=So(o,i)});const t=new Array(this._edges.size);return n=0,this._edges.forEach((i,o)=>{t[n++]=To(this.type,o,i)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:e,edges:t}}import(e,n=!1){if(e instanceof q)return e.forEachNode((u,c)=>{n?this.mergeNode(u,c):this.addNode(u,c)}),e.forEachEdge((u,c,l,d,f,h,g)=>{n?g?this.mergeUndirectedEdgeWithKey(u,l,d,c):this.mergeDirectedEdgeWithKey(u,l,d,c):g?this.addUndirectedEdgeWithKey(u,l,d,c):this.addDirectedEdgeWithKey(u,l,d,c)}),this;if(!ue(e))throw new F("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(e.attributes){if(!ue(e.attributes))throw new F("Graph.import: invalid attributes. Expecting a plain object.");n?this.mergeAttributes(e.attributes):this.replaceAttributes(e.attributes)}let t,i,o,s,a;if(e.nodes){if(o=e.nodes,!Array.isArray(o))throw new F("Graph.import: invalid nodes. Expecting an array.");for(t=0,i=o.length;t<i;t++){s=o[t],_o(s);const{key:u,attributes:c}=s;n?this.mergeNode(u,c):this.addNode(u,c)}}if(e.edges){let u=!1;if(this.type==="undirected"&&(u=!0),o=e.edges,!Array.isArray(o))throw new F("Graph.import: invalid edges. Expecting an array.");for(t=0,i=o.length;t<i;t++){a=o[t],Ao(a);const{source:c,target:l,attributes:d,undirected:f=u}=a;let h;"key"in a?(h=n?f?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:f?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,h.call(this,a.key,c,l,d)):(h=n?f?this.mergeUndirectedEdge:this.mergeDirectedEdge:f?this.addUndirectedEdge:this.addDirectedEdge,h.call(this,c,l,d))}}return this}nullCopy(e){const n=new q(ae({},this._options,e));return n.replaceAttributes(ae({},this.getAttributes())),n}emptyCopy(e){const n=this.nullCopy(e);return this._nodes.forEach((t,i)=>{const o=ae({},t.attributes);t=new n.NodeDataClass(i,o),n._nodes.set(i,t)}),n}copy(e){if(e=e||{},typeof e.type=="string"&&e.type!==this.type&&e.type!=="mixed")throw new B(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${e.type}" because this would mean losing information about the current graph.`);if(typeof e.multi=="boolean"&&e.multi!==this.multi&&e.multi!==!0)throw new B("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof e.allowSelfLoops=="boolean"&&e.allowSelfLoops!==this.allowSelfLoops&&e.allowSelfLoops!==!0)throw new B("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const n=this.emptyCopy(e),t=this._edges.values();let i,o;for(;i=t.next(),i.done!==!0;)o=i.value,Fn(n,"copy",!1,o.undirected,o.key,o.source.key,o.target.key,ae({},o.attributes));return n}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const e={};this._nodes.forEach((o,s)=>{e[s]=o.attributes});const n={},t={};this._edges.forEach((o,s)=>{const a=o.undirected?"--":"->";let u="",c=o.source.key,l=o.target.key,d;o.undirected&&c>l&&(d=c,c=l,l=d);const f=`(${c})${a}(${l})`;s.startsWith("geid_")?this.multi&&(typeof t[f]>"u"?t[f]=0:t[f]++,u+=`${t[f]}. `):u+=`[${s}]: `,u+=f,n[u]=o.attributes});const i={};for(const o in this)this.hasOwnProperty(o)&&!On.has(o)&&typeof this[o]!="function"&&typeof o!="symbol"&&(i[o]=this[o]);return i.attributes=this._attributes,i.nodes=e,i.edges=n,we(i,"constructor",this.constructor),i}}typeof Symbol<"u"&&(q.prototype[Symbol.for("nodejs.util.inspect.custom")]=q.prototype.inspect),ko.forEach(r=>{["add","merge","update"].forEach(e=>{const n=r.name(e),t=e==="add"?Fn:Io;r.generateKey?q.prototype[n]=function(i,o,s){return t(this,n,!0,(r.type||this.type)==="undirected",null,i,o,s,e==="update")}:q.prototype[n]=function(i,o,s,a){return t(this,n,!1,(r.type||this.type)==="undirected",i,o,s,a,e==="update")}})}),Mi(q),Zi(q),fo(q),Eo(q);class zn extends q{constructor(e){const n=ae({type:"directed"},e);if("multi"in n&&n.multi!==!1)throw new F("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="directed")throw new F('DirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Mn extends q{constructor(e){const n=ae({type:"undirected"},e);if("multi"in n&&n.multi!==!1)throw new F("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="undirected")throw new F('UndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Un extends q{constructor(e){const n=ae({multi:!0},e);if("multi"in n&&n.multi!==!0)throw new F("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(n)}}class $n extends q{constructor(e){const n=ae({type:"directed",multi:!0},e);if("multi"in n&&n.multi!==!0)throw new F("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="directed")throw new F('MultiDirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Bn extends q{constructor(e){const n=ae({type:"undirected",multi:!0},e);if("multi"in n&&n.multi!==!0)throw new F("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="undirected")throw new F('MultiUndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}function qe(r){r.from=function(e,n){const t=ae({},e.options,n),i=new r(t);return i.import(e),i}}qe(q),qe(zn),qe(Mn),qe(Un),qe($n),qe(Bn),q.Graph=q,q.DirectedGraph=zn,q.UndirectedGraph=Mn,q.MultiGraph=Un,q.MultiDirectedGraph=$n,q.MultiUndirectedGraph=Bn,q.InvalidArgumentsGraphError=F,q.NotFoundGraphError=O,q.UsageGraphError=B;function No(r,e){if(typeof r!="object"||!r)return r;var n=r[Symbol.toPrimitive];if(n!==void 0){var t=n.call(r,e);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function ot(r){var e=No(r,"string");return typeof e=="symbol"?e:e+""}function le(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Wn(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,ot(t.key),t)}}function de(r,e,n){return e&&Wn(r.prototype,e),n&&Wn(r,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function Ze(r){return Ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ze(r)}function Hn(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Hn=function(){return!!r})()}function xo(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Po(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xo(r)}function Ee(r,e,n){return e=Ze(e),Po(r,Hn()?Reflect.construct(e,n||[],Ze(r).constructor):e.apply(r,n))}function Wt(r,e){return Wt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},Wt(r,e)}function Se(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&Wt(r,e)}function Oo(r){if(Array.isArray(r))return r}function Go(r,e){var n=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(n!=null){var t,i,o,s,a=[],u=!0,c=!1;try{if(o=(n=n.call(r)).next,e===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(t=o.call(n)).done)&&(a.push(t.value),a.length!==e);u=!0);}catch(l){c=!0,i=l}finally{try{if(!u&&n.return!=null&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}function Ht(r,e){(e==null||e>r.length)&&(e=r.length);for(var n=0,t=Array(e);n<e;n++)t[n]=r[n];return t}function Vn(r,e){if(r){if(typeof r=="string")return Ht(r,e);var n={}.toString.call(r).slice(8,-1);return n==="Object"&&r.constructor&&(n=r.constructor.name),n==="Map"||n==="Set"?Array.from(r):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ht(r,e):void 0}}function Fo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xe(r,e){return Oo(r)||Go(r,e)||Vn(r,e)||Fo()}var Vt={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"},jn=new Int8Array(4),jt=new Int32Array(jn.buffer,0,1),zo=new Float32Array(jn.buffer,0,1),Mo=/^\s*rgba?\s*\(/,Uo=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function $o(r){var e=0,n=0,t=0,i=1;if(r[0]==="#")r.length===4?(e=parseInt(r.charAt(1)+r.charAt(1),16),n=parseInt(r.charAt(2)+r.charAt(2),16),t=parseInt(r.charAt(3)+r.charAt(3),16)):(e=parseInt(r.charAt(1)+r.charAt(2),16),n=parseInt(r.charAt(3)+r.charAt(4),16),t=parseInt(r.charAt(5)+r.charAt(6),16)),r.length===9&&(i=parseInt(r.charAt(7)+r.charAt(8),16)/255);else if(Mo.test(r)){var o=r.match(Uo);o&&(e=+o[1],n=+o[2],t=+o[3],o[4]&&(i=+o[4]))}return{r:e,g:n,b:t,a:i}}var Je={};for(var pt in Vt)Je[pt]=st(Vt[pt]),Je[Vt[pt]]=Je[pt];function Yn(r,e,n,t,i){return jt[0]=t<<24|n<<16|e<<8|r,jt[0]=jt[0]&4278190079,zo[0]}function st(r){if(r=r.toLowerCase(),typeof Je[r]<"u")return Je[r];var e=$o(r),n=e.r,t=e.g,i=e.b,o=e.a;o=o*255|0;var s=Yn(n,t,i,o);return Je[r]=s,s}var Yt={};function Kn(r){if(typeof Yt[r]<"u")return Yt[r];var e=(r&16711680)>>>16,n=(r&65280)>>>8,t=r&255,i=255,o=Yn(e,n,t,i);return Yt[r]=o,o}function qn(r,e,n,t){return n+(e<<8)+(r<<16)}function Zn(r,e,n,t,i,o){var s=Math.floor(n/o*i),a=Math.floor(r.drawingBufferHeight/o-t/o*i),u=new Uint8Array(4);r.bindFramebuffer(r.FRAMEBUFFER,e),r.readPixels(s,a,1,1,r.RGBA,r.UNSIGNED_BYTE,u);var c=Xe(u,4),l=c[0],d=c[1],f=c[2],h=c[3];return[l,d,f,h]}function C(r,e,n){return(e=ot(e))in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}function Xn(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),n.push.apply(n,t)}return n}function M(r){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Xn(Object(n),!0).forEach(function(t){C(r,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):Xn(Object(n)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(n,t))})}return r}function Bo(r,e){for(;!{}.hasOwnProperty.call(r,e)&&(r=Ze(r))!==null;);return r}function Kt(){return Kt=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,e,n){var t=Bo(r,e);if(t){var i=Object.getOwnPropertyDescriptor(t,e);return i.get?i.get.call(arguments.length<3?r:n):i.value}},Kt.apply(null,arguments)}function Jn(r,e,n,t){var i=Kt(Ze(r.prototype),e,n);return typeof i=="function"?function(o){return i.apply(n,o)}:i}function Wo(r){return r.normalized?1:r.size}function qt(r){var e=0;return r.forEach(function(n){return e+=Wo(n)}),e}function Qn(r,e,n){var t=r==="VERTEX"?e.VERTEX_SHADER:e.FRAGMENT_SHADER,i=e.createShader(t);if(i===null)throw new Error("loadShader: error while creating the shader");e.shaderSource(i,n),e.compileShader(i);var o=e.getShaderParameter(i,e.COMPILE_STATUS);if(!o){var s=e.getShaderInfoLog(i);throw e.deleteShader(i),new Error(`loadShader: error while compiling the shader:
`.concat(s,`
`).concat(n))}return i}function Ho(r,e){return Qn("VERTEX",r,e)}function Vo(r,e){return Qn("FRAGMENT",r,e)}function jo(r,e){var n=r.createProgram();if(n===null)throw new Error("loadProgram: error while creating the program.");var t,i;for(t=0,i=e.length;t<i;t++)r.attachShader(n,e[t]);r.linkProgram(n);var o=r.getProgramParameter(n,r.LINK_STATUS);if(!o)throw r.deleteProgram(n),new Error("loadProgram: error while linking the program.");return n}function er(r){var e=r.gl,n=r.buffer,t=r.program,i=r.vertexShader,o=r.fragmentShader;e.deleteShader(i),e.deleteShader(o),e.deleteProgram(t),e.deleteBuffer(n)}var tr=`#define PICKING_MODE
`,Yo=C(C(C(C(C(C(C(C({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4),nr=(function(){function r(e,n,t){le(this,r),C(this,"array",new Float32Array),C(this,"constantArray",new Float32Array),C(this,"capacity",0),C(this,"verticesCount",0);var i=this.getDefinition();if(this.VERTICES=i.VERTICES,this.VERTEX_SHADER_SOURCE=i.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=i.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=i.UNIFORMS,this.ATTRIBUTES=i.ATTRIBUTES,this.METHOD=i.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in i?i.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in i?i.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in i,this.ATTRIBUTES_ITEMS_COUNT=qt(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=t,this.normalProgram=this.getProgramInfo("normal",e,i.VERTEX_SHADER_SOURCE,i.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=n?this.getProgramInfo("pick",e,tr+i.VERTEX_SHADER_SOURCE,tr+i.FRAGMENT_SHADER_SOURCE,n):null,this.isInstanced){var o=qt(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*o);for(var s=0;s<this.CONSTANT_DATA.length;s++){var a=this.CONSTANT_DATA[s];if(a.length!==o)throw new Error("Program: error while getting constant data (one vector has ".concat(a.length," items instead of ").concat(o,")"));for(var u=0;u<a.length;u++)this.constantArray[s*o+u]=a[u]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return de(r,[{key:"kill",value:function(){er(this.normalProgram),this.pickProgram&&(er(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(n,t,i,o,s){var a=this.getDefinition(),u=t.createBuffer();if(u===null)throw new Error("Program: error while creating the WebGL buffer.");var c=Ho(t,i),l=Vo(t,o),d=jo(t,[c,l]),f={};a.UNIFORMS.forEach(function(y){var p=t.getUniformLocation(d,y);p&&(f[y]=p)});var h={};a.ATTRIBUTES.forEach(function(y){h[y.name]=t.getAttribLocation(d,y.name)});var g;if("CONSTANT_ATTRIBUTES"in a&&(a.CONSTANT_ATTRIBUTES.forEach(function(y){h[y.name]=t.getAttribLocation(d,y.name)}),g=t.createBuffer(),g===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:n,program:d,gl:t,frameBuffer:s,buffer:u,constantBuffer:g||{},uniformLocations:f,attributeLocations:h,isPicking:n==="pick",vertexShader:c,fragmentShader:l}}},{key:"bindProgram",value:function(n){var t=this,i=0,o=n.gl,s=n.buffer;this.isInstanced?(o.bindBuffer(o.ARRAY_BUFFER,n.constantBuffer),i=0,this.CONSTANT_ATTRIBUTES.forEach(function(a){return i+=t.bindAttribute(a,n,i,!1)}),o.bufferData(o.ARRAY_BUFFER,this.constantArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,n.buffer),i=0,this.ATTRIBUTES.forEach(function(a){return i+=t.bindAttribute(a,n,i,!0)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)):(o.bindBuffer(o.ARRAY_BUFFER,s),i=0,this.ATTRIBUTES.forEach(function(a){return i+=t.bindAttribute(a,n,i)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)),o.bindBuffer(o.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(n){var t=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(i){return t.unbindAttribute(i,n,!1)}),this.ATTRIBUTES.forEach(function(i){return t.unbindAttribute(i,n,!0)})):this.ATTRIBUTES.forEach(function(i){return t.unbindAttribute(i,n)})}},{key:"bindAttribute",value:function(n,t,i,o){var s=Yo[n.type];if(typeof s!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(n.type,'"'));var a=t.attributeLocations[n.name],u=t.gl;if(a!==-1){u.enableVertexAttribArray(a);var c=this.isInstanced?(o?this.ATTRIBUTES_ITEMS_COUNT:qt(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(u.vertexAttribPointer(a,n.size,n.type,n.normalized||!1,c,i),this.isInstanced&&o)if(u instanceof WebGL2RenderingContext)u.vertexAttribDivisor(a,1);else{var l=u.getExtension("ANGLE_instanced_arrays");l&&l.vertexAttribDivisorANGLE(a,1)}}return n.size*s}},{key:"unbindAttribute",value:function(n,t,i){var o=t.attributeLocations[n.name],s=t.gl;if(o!==-1&&(s.disableVertexAttribArray(o),this.isInstanced&&i))if(s instanceof WebGL2RenderingContext)s.vertexAttribDivisor(o,0);else{var a=s.getExtension("ANGLE_instanced_arrays");a&&a.vertexAttribDivisorANGLE(o,0)}}},{key:"reallocate",value:function(n){n!==this.capacity&&(this.capacity=n,this.verticesCount=this.VERTICES*n,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(n,t){var i=t.gl,o=t.program;i.enable(i.BLEND),i.useProgram(o),this.setUniforms(n,t),this.drawWebGL(this.METHOD,t)}},{key:"render",value:function(n){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,n.width*n.pixelRatio/n.downSizingRatio,n.height*n.pixelRatio/n.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram(M(M({},n),{},{pixelRatio:n.pixelRatio/n.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,n.width*n.pixelRatio,n.height*n.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(n,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(n,t){var i=t.gl,o=t.frameBuffer;if(i.bindFramebuffer(i.FRAMEBUFFER,o),!this.isInstanced)i.drawArrays(n,0,this.verticesCount);else if(i instanceof WebGL2RenderingContext)i.drawArraysInstanced(n,0,this.VERTICES,this.capacity);else{var s=i.getExtension("ANGLE_instanced_arrays");s&&s.drawArraysInstancedANGLE(n,0,this.VERTICES,this.capacity)}}}])})(),Ko=(function(r){function e(){return le(this,e),Ee(this,e,arguments)}return Se(e,r),de(e,[{key:"kill",value:function(){Jn(e,"kill",this)([])}},{key:"process",value:function(t,i,o){var s=i*this.STRIDE;if(o.hidden){for(var a=s+this.STRIDE;s<a;s++)this.array[s]=0;return}return this.processVisibleItem(Kn(t),s,o)}}])})(nr),Zt=(function(r){function e(){var n;le(this,e);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return n=Ee(this,e,[].concat(i)),C(n,"drawLabel",void 0),n}return Se(e,r),de(e,[{key:"kill",value:function(){Jn(e,"kill",this)([])}},{key:"process",value:function(t,i,o,s,a){var u=i*this.STRIDE;if(a.hidden||o.hidden||s.hidden){for(var c=u+this.STRIDE;u<c;u++)this.array[u]=0;return}return this.processVisibleItem(Kn(t),u,o,s,a)}}])})(nr);function qo(r,e){return(function(){function n(t,i,o){le(this,n),C(this,"drawLabel",e),this.programs=r.map(function(s){return new s(t,i,o)})}return de(n,[{key:"reallocate",value:function(i){this.programs.forEach(function(o){return o.reallocate(i)})}},{key:"process",value:function(i,o,s,a,u){this.programs.forEach(function(c){return c.process(i,o,s,a,u)})}},{key:"render",value:function(i){this.programs.forEach(function(o){return o.render(i)})}},{key:"kill",value:function(){this.programs.forEach(function(i){return i.kill()})}}])})()}function Zo(r,e,n,t,i){var o=i.edgeLabelSize,s=i.edgeLabelFont,a=i.edgeLabelWeight,u=i.edgeLabelColor.attribute?e[i.edgeLabelColor.attribute]||i.edgeLabelColor.color||"#000":i.edgeLabelColor.color,c=e.label;if(c){r.fillStyle=u,r.font="".concat(a," ").concat(o,"px ").concat(s);var l=n.size,d=t.size,f=n.x,h=n.y,g=t.x,y=t.y,p=(f+g)/2,_=(h+y)/2,E=g-f,b=y-h,m=Math.sqrt(E*E+b*b);if(!(m<l+d)){f+=E*l/m,h+=b*l/m,g-=E*d/m,y-=b*d/m,p=(f+g)/2,_=(h+y)/2,E=g-f,b=y-h,m=Math.sqrt(E*E+b*b);var T=r.measureText(c).width;if(T>m){var D="";for(c=c+D,T=r.measureText(c).width;T>m&&c.length>1;)c=c.slice(0,-2)+D,T=r.measureText(c).width;if(c.length<4)return}var k;E>0?b>0?k=Math.acos(E/m):k=Math.asin(b/m):b>0?k=Math.acos(E/m)+Math.PI:k=Math.asin(E/m)+Math.PI/2,r.save(),r.translate(p,_),r.rotate(k),r.fillText(c,-T/2,e.size/2+o),r.restore()}}}function rr(r,e,n){if(e.label){var t=n.labelSize,i=n.labelFont,o=n.labelWeight,s=n.labelColor.attribute?e[n.labelColor.attribute]||n.labelColor.color||"#000":n.labelColor.color;r.fillStyle=s,r.font="".concat(o," ").concat(t,"px ").concat(i),r.fillText(e.label,e.x+e.size+3,e.y+t/3)}}function Xo(r,e,n){var t=n.labelSize,i=n.labelFont,o=n.labelWeight;r.font="".concat(o," ").concat(t,"px ").concat(i),r.fillStyle="#FFF",r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=8,r.shadowColor="#000";var s=2;if(typeof e.label=="string"){var a=r.measureText(e.label).width,u=Math.round(a+5),c=Math.round(t+2*s),l=Math.max(e.size,t/2)+s,d=Math.asin(c/2/l),f=Math.sqrt(Math.abs(Math.pow(l,2)-Math.pow(c/2,2)));r.beginPath(),r.moveTo(e.x+f,e.y+c/2),r.lineTo(e.x+l+u,e.y+c/2),r.lineTo(e.x+l+u,e.y-c/2),r.lineTo(e.x+f,e.y-c/2),r.arc(e.x,e.y,l,d,-d),r.closePath(),r.fill()}else r.beginPath(),r.arc(e.x,e.y,e.size+s,0,Math.PI*2),r.closePath(),r.fill();r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=0,rr(r,e,n)}var Jo=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Qo=Jo,es=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ts=es,ir=WebGLRenderingContext,or=ir.UNSIGNED_BYTE,Xt=ir.FLOAT,ns=["u_sizeRatio","u_correctionRatio","u_matrix"],mt=(function(r){function e(){return le(this,e),Ee(this,e,arguments)}return Se(e,r),de(e,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:ts,FRAGMENT_SHADER_SOURCE:Qo,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:ns,ATTRIBUTES:[{name:"a_position",size:2,type:Xt},{name:"a_size",size:1,type:Xt},{name:"a_color",size:4,type:or,normalized:!0},{name:"a_id",size:4,type:or,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:Xt}],CONSTANT_DATA:[[e.ANGLE_1],[e.ANGLE_2],[e.ANGLE_3]]}}},{key:"processVisibleItem",value:function(t,i,o){var s=this.array,a=st(o.color);s[i++]=o.x,s[i++]=o.y,s[i++]=o.size,s[i++]=a,s[i++]=t}},{key:"setUniforms",value:function(t,i){var o=i.gl,s=i.uniformLocations,a=s.u_sizeRatio,u=s.u_correctionRatio,c=s.u_matrix;o.uniform1f(u,t.correctionRatio),o.uniform1f(a,t.sizeRatio),o.uniformMatrix3fv(c,!1,t.matrix)}}])})(Ko);C(mt,"ANGLE_1",0),C(mt,"ANGLE_2",2*Math.PI/3),C(mt,"ANGLE_3",4*Math.PI/3);var rs=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,is=rs,os=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ss=os,sr=WebGLRenderingContext,ar=sr.UNSIGNED_BYTE,yt=sr.FLOAT,as=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],ur={extremity:"target",lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function cr(r){var e=M(M({},ur),{});return(function(n){function t(){return le(this,t),Ee(this,t,arguments)}return Se(t,n),de(t,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:ss,FRAGMENT_SHADER_SOURCE:is,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:as,ATTRIBUTES:[{name:"a_position",size:2,type:yt},{name:"a_normal",size:2,type:yt},{name:"a_radius",size:1,type:yt},{name:"a_color",size:4,type:ar,normalized:!0},{name:"a_id",size:4,type:ar,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:yt}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(o,s,a,u,c){if(e.extremity==="source"){var l=[u,a];a=l[0],u=l[1]}var d=c.size||1,f=u.size||1,h=a.x,g=a.y,y=u.x,p=u.y,_=st(c.color),E=y-h,b=p-g,m=E*E+b*b,T=0,D=0;m&&(m=1/Math.sqrt(m),T=-b*m*d,D=E*m*d);var k=this.array;k[s++]=y,k[s++]=p,k[s++]=-T,k[s++]=-D,k[s++]=f,k[s++]=_,k[s++]=o}},{key:"setUniforms",value:function(o,s){var a=s.gl,u=s.uniformLocations,c=u.u_matrix,l=u.u_sizeRatio,d=u.u_correctionRatio,f=u.u_minEdgeThickness,h=u.u_lengthToThicknessRatio,g=u.u_widenessToThicknessRatio;a.uniformMatrix3fv(c,!1,o.matrix),a.uniform1f(l,o.sizeRatio),a.uniform1f(d,o.correctionRatio),a.uniform1f(f,o.minEdgeThickness),a.uniform1f(h,e.lengthToThicknessRatio),a.uniform1f(g,e.widenessToThicknessRatio)}}])})(Zt)}cr();var us=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,lr=us,cs=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ls=cs,dr=WebGLRenderingContext,hr=dr.UNSIGNED_BYTE,$e=dr.FLOAT,ds=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],hs={lengthToThicknessRatio:ur.lengthToThicknessRatio};function fr(r){var e=M(M({},hs),{});return(function(n){function t(){return le(this,t),Ee(this,t,arguments)}return Se(t,n),de(t,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ls,FRAGMENT_SHADER_SOURCE:lr,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:ds,ATTRIBUTES:[{name:"a_positionStart",size:2,type:$e},{name:"a_positionEnd",size:2,type:$e},{name:"a_normal",size:2,type:$e},{name:"a_color",size:4,type:hr,normalized:!0},{name:"a_id",size:4,type:hr,normalized:!0},{name:"a_radius",size:1,type:$e}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:$e},{name:"a_normalCoef",size:1,type:$e},{name:"a_radiusCoef",size:1,type:$e}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(o,s,a,u,c){var l=c.size||1,d=a.x,f=a.y,h=u.x,g=u.y,y=st(c.color),p=h-d,_=g-f,E=u.size||1,b=p*p+_*_,m=0,T=0;b&&(b=1/Math.sqrt(b),m=-_*b*l,T=p*b*l);var D=this.array;D[s++]=d,D[s++]=f,D[s++]=h,D[s++]=g,D[s++]=m,D[s++]=T,D[s++]=y,D[s++]=o,D[s++]=E}},{key:"setUniforms",value:function(o,s){var a=s.gl,u=s.uniformLocations,c=u.u_matrix,l=u.u_zoomRatio,d=u.u_feather,f=u.u_pixelRatio,h=u.u_correctionRatio,g=u.u_sizeRatio,y=u.u_minEdgeThickness,p=u.u_lengthToThicknessRatio;a.uniformMatrix3fv(c,!1,o.matrix),a.uniform1f(l,o.zoomRatio),a.uniform1f(g,o.sizeRatio),a.uniform1f(h,o.correctionRatio),a.uniform1f(f,o.pixelRatio),a.uniform1f(d,o.antiAliasingFeather),a.uniform1f(y,o.minEdgeThickness),a.uniform1f(p,e.lengthToThicknessRatio)}}])})(Zt)}fr();function fs(r){return qo([fr(),cr()])}var gs=fs(),ps=gs,ms=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ys=ms,gr=WebGLRenderingContext,pr=gr.UNSIGNED_BYTE,at=gr.FLOAT,vs=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],bs=(function(r){function e(){return le(this,e),Ee(this,e,arguments)}return Se(e,r),de(e,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ys,FRAGMENT_SHADER_SOURCE:lr,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:vs,ATTRIBUTES:[{name:"a_positionStart",size:2,type:at},{name:"a_positionEnd",size:2,type:at},{name:"a_normal",size:2,type:at},{name:"a_color",size:4,type:pr,normalized:!0},{name:"a_id",size:4,type:pr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:at},{name:"a_normalCoef",size:1,type:at}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(t,i,o,s,a){var u=a.size||1,c=o.x,l=o.y,d=s.x,f=s.y,h=st(a.color),g=d-c,y=f-l,p=g*g+y*y,_=0,E=0;p&&(p=1/Math.sqrt(p),_=-y*p*u,E=g*p*u);var b=this.array;b[i++]=c,b[i++]=l,b[i++]=d,b[i++]=f,b[i++]=_,b[i++]=E,b[i++]=h,b[i++]=t}},{key:"setUniforms",value:function(t,i){var o=i.gl,s=i.uniformLocations,a=s.u_matrix,u=s.u_zoomRatio,c=s.u_feather,l=s.u_pixelRatio,d=s.u_correctionRatio,f=s.u_sizeRatio,h=s.u_minEdgeThickness;o.uniformMatrix3fv(a,!1,t.matrix),o.uniform1f(u,t.zoomRatio),o.uniform1f(f,t.sizeRatio),o.uniform1f(d,t.correctionRatio),o.uniform1f(l,t.pixelRatio),o.uniform1f(c,t.antiAliasingFeather),o.uniform1f(h,t.minEdgeThickness)}}])})(Zt),Jt=(function(r){function e(){var n;return le(this,e),n=Ee(this,e),n.rawEmitter=n,n}return Se(e,r),de(e)})(An.EventEmitter),Qt,mr;function yr(){return mr||(mr=1,Qt=function(e){return e!==null&&typeof e=="object"&&typeof e.addUndirectedEdgeWithKey=="function"&&typeof e.dropNode=="function"&&typeof e.multi=="boolean"}),Qt}var ws=yr();const Es=Oe(ws);var Ss=function(e){return e},Ts=function(e){return e*e},_s=function(e){return e*(2-e)},As=function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},Ds=function(e){return e*e*e},Rs=function(e){return--e*e*e+1},ks=function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},Ls={linear:Ss,quadraticIn:Ts,quadraticOut:_s,quadraticInOut:As,cubicIn:Ds,cubicOut:Rs,cubicInOut:ks},Cs={easing:"quadraticInOut",duration:150};function Ae(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function vt(r,e,n){return r[0]=e,r[4]=typeof n=="number"?n:e,r}function vr(r,e){var n=Math.sin(e),t=Math.cos(e);return r[0]=t,r[1]=n,r[3]=-n,r[4]=t,r}function br(r,e,n){return r[6]=e,r[7]=n,r}function Ge(r,e){var n=r[0],t=r[1],i=r[2],o=r[3],s=r[4],a=r[5],u=r[6],c=r[7],l=r[8],d=e[0],f=e[1],h=e[2],g=e[3],y=e[4],p=e[5],_=e[6],E=e[7],b=e[8];return r[0]=d*n+f*o+h*u,r[1]=d*t+f*s+h*c,r[2]=d*i+f*a+h*l,r[3]=g*n+y*o+p*u,r[4]=g*t+y*s+p*c,r[5]=g*i+y*a+p*l,r[6]=_*n+E*o+b*u,r[7]=_*t+E*s+b*c,r[8]=_*i+E*a+b*l,r}function en(r,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,t=r[0],i=r[1],o=r[3],s=r[4],a=r[6],u=r[7],c=e.x,l=e.y;return{x:c*t+l*o+a*n,y:c*i+l*s+u*n}}function Is(r,e){var n=r.height/r.width,t=e.height/e.width;return n<1&&t>1||n>1&&t<1?1:Math.min(Math.max(t,1/t),Math.max(1/n,n))}function ut(r,e,n,t,i){var o=r.angle,s=r.ratio,a=r.x,u=r.y,c=e.width,l=e.height,d=Ae(),f=Math.min(c,l)-2*t,h=Is(e,n);return i?(Ge(d,br(Ae(),a,u)),Ge(d,vt(Ae(),s)),Ge(d,vr(Ae(),o)),Ge(d,vt(Ae(),c/f/2/h,l/f/2/h))):(Ge(d,vt(Ae(),2*(f/c)*h,2*(f/l)*h)),Ge(d,vr(Ae(),-o)),Ge(d,vt(Ae(),1/s)),Ge(d,br(Ae(),-a,-u))),d}function Ns(r,e,n){var t=en(r,{x:Math.cos(e.angle),y:Math.sin(e.angle)},0),i=t.x,o=t.y;return 1/Math.sqrt(Math.pow(i,2)+Math.pow(o,2))/n.width}function xs(r){if(!r.order)return{x:[0,1],y:[0,1]};var e=1/0,n=-1/0,t=1/0,i=-1/0;return r.forEachNode(function(o,s){var a=s.x,u=s.y;a<e&&(e=a),a>n&&(n=a),u<t&&(t=u),u>i&&(i=u)}),{x:[e,n],y:[t,i]}}function Ps(r){if(!Es(r))throw new Error("Sigma: invalid graph instance.");r.forEachNode(function(e,n){if(!Number.isFinite(n.x)||!Number.isFinite(n.y))throw new Error("Sigma: Coordinates of node ".concat(e," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function Os(r,e,n){var t=document.createElement(r);if(e)for(var i in e)t.style[i]=e[i];if(n)for(var o in n)t.setAttribute(o,n[o]);return t}function wr(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function Er(r,e,n){return n.sort(function(t,i){var o=e(t)||0,s=e(i)||0;return o<s?-1:o>s?1:0})}function Sr(r){var e=Xe(r.x,2),n=e[0],t=e[1],i=Xe(r.y,2),o=i[0],s=i[1],a=Math.max(t-n,s-o),u=(t+n)/2,c=(s+o)/2;(a===0||Math.abs(a)===1/0||isNaN(a))&&(a=1),isNaN(u)&&(u=0),isNaN(c)&&(c=0);var l=function(f){return{x:.5+(f.x-u)/a,y:.5+(f.y-c)/a}};return l.applyTo=function(d){d.x=.5+(d.x-u)/a,d.y=.5+(d.y-c)/a},l.inverse=function(d){return{x:u+a*(d.x-.5),y:c+a*(d.y-.5)}},l.ratio=a,l}function tn(r){"@babel/helpers - typeof";return tn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tn(r)}function Tr(r,e){var n=e.size;if(n!==0){var t=r.length;r.length+=n;var i=0;e.forEach(function(o){r[t+i]=o,i++})}}function nn(r){r=r||{};for(var e=0,n=arguments.length<=1?0:arguments.length-1;e<n;e++){var t=e+1<1||arguments.length<=e+1?void 0:arguments[e+1];t&&Object.assign(r,t)}return r}var rn={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:Zo,defaultDrawNodeLabel:rr,defaultDrawNodeHover:Xo,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},Gs={circle:mt},Fs={arrow:ps,line:bs};function on(r){if(typeof r.labelDensity!="number"||r.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var e=r.minCameraRatio,n=r.maxCameraRatio;if(typeof e=="number"&&typeof n=="number"&&n<e)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function zs(r){var e=nn({},rn,r);return e.nodeProgramClasses=nn({},Gs,e.nodeProgramClasses),e.edgeProgramClasses=nn({},Fs,e.edgeProgramClasses),e}var bt=1.5,_r=(function(r){function e(){var n;return le(this,e),n=Ee(this,e),C(n,"x",.5),C(n,"y",.5),C(n,"angle",0),C(n,"ratio",1),C(n,"minRatio",null),C(n,"maxRatio",null),C(n,"enabledZooming",!0),C(n,"enabledPanning",!0),C(n,"enabledRotation",!0),C(n,"clean",null),C(n,"nextFrame",null),C(n,"previousState",null),C(n,"enabled",!0),n.previousState=n.getState(),n}return Se(e,r),de(e,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(t){return this.x===t.x&&this.y===t.y&&this.ratio===t.ratio&&this.angle===t.angle}},{key:"getPreviousState",value:function(){var t=this.previousState;return t?{x:t.x,y:t.y,angle:t.angle,ratio:t.ratio}:null}},{key:"getBoundedRatio",value:function(t){var i=t;return typeof this.minRatio=="number"&&(i=Math.max(i,this.minRatio)),typeof this.maxRatio=="number"&&(i=Math.min(i,this.maxRatio)),i}},{key:"validateState",value:function(t){var i={};return this.enabledPanning&&typeof t.x=="number"&&(i.x=t.x),this.enabledPanning&&typeof t.y=="number"&&(i.y=t.y),this.enabledZooming&&typeof t.ratio=="number"&&(i.ratio=this.getBoundedRatio(t.ratio)),this.enabledRotation&&typeof t.angle=="number"&&(i.angle=t.angle),this.clean?this.clean(M(M({},this.getState()),i)):i}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(t){if(!this.enabled)return this;this.previousState=this.getState();var i=this.validateState(t);return typeof i.x=="number"&&(this.x=i.x),typeof i.y=="number"&&(this.y=i.y),typeof i.ratio=="number"&&(this.ratio=i.ratio),typeof i.angle=="number"&&(this.angle=i.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(t){return this.setState(t(this.getState())),this}},{key:"animate",value:function(t){var i=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;if(!s)return new Promise(function(h){return i.animate(t,o,h)});if(this.enabled){var a=M(M({},Cs),o),u=this.validateState(t),c=typeof a.easing=="function"?a.easing:Ls[a.easing],l=Date.now(),d=this.getState(),f=function(){var g=(Date.now()-l)/a.duration;if(g>=1){i.nextFrame=null,i.setState(u),i.animationCallback&&(i.animationCallback.call(null),i.animationCallback=void 0);return}var y=c(g),p={};typeof u.x=="number"&&(p.x=d.x+(u.x-d.x)*y),typeof u.y=="number"&&(p.y=d.y+(u.y-d.y)*y),i.enabledRotation&&typeof u.angle=="number"&&(p.angle=d.angle+(u.angle-d.angle)*y),typeof u.ratio=="number"&&(p.ratio=d.ratio+(u.ratio-d.ratio)*y),i.setState(p),i.nextFrame=requestAnimationFrame(f)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(f)):f(),this.animationCallback=s}}},{key:"animatedZoom",value:function(t){return t?typeof t=="number"?this.animate({ratio:this.ratio/t}):this.animate({ratio:this.ratio/(t.factor||bt)},t):this.animate({ratio:this.ratio/bt})}},{key:"animatedUnzoom",value:function(t){return t?typeof t=="number"?this.animate({ratio:this.ratio*t}):this.animate({ratio:this.ratio*(t.factor||bt)},t):this.animate({ratio:this.ratio*bt})}},{key:"animatedReset",value:function(t){return this.animate({x:.5,y:.5,ratio:1,angle:0},t)}},{key:"copy",value:function(){return e.from(this.getState())}}],[{key:"from",value:function(t){var i=new e;return i.setState(t)}}])})(Jt);function De(r,e){var n=e.getBoundingClientRect();return{x:r.clientX-n.left,y:r.clientY-n.top}}function Ne(r,e){var n=M(M({},De(r,e)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){n.sigmaDefaultPrevented=!0},original:r});return n}function ct(r){var e="x"in r?r:M(M({},r.touches[0]||r.previousTouches[0]),{},{original:r.original,sigmaDefaultPrevented:r.sigmaDefaultPrevented,preventSigmaDefault:function(){r.sigmaDefaultPrevented=!0,e.sigmaDefaultPrevented=!0}});return e}function Ms(r,e){return M(M({},Ne(r,e)),{},{delta:Ar(r)})}var Us=2;function wt(r){for(var e=[],n=0,t=Math.min(r.length,Us);n<t;n++)e.push(r[n]);return e}function lt(r,e,n){var t={touches:wt(r.touches).map(function(i){return De(i,n)}),previousTouches:e.map(function(i){return De(i,n)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){t.sigmaDefaultPrevented=!0},original:r};return t}function Ar(r){if(typeof r.deltaY<"u")return r.deltaY*-3/360;if(typeof r.detail<"u")return r.detail/-9;throw new Error("Captor: could not extract delta from event.")}var Dr=(function(r){function e(n,t){var i;return le(this,e),i=Ee(this,e),i.container=n,i.renderer=t,i}return Se(e,r),de(e)})(Jt),$s=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],Bs=$s.reduce(function(r,e){return M(M({},r),{},C({},e,rn[e]))},{}),Ws=(function(r){function e(n,t){var i;return le(this,e),i=Ee(this,e,[n,t]),C(i,"enabled",!0),C(i,"draggedEvents",0),C(i,"downStartTime",null),C(i,"lastMouseX",null),C(i,"lastMouseY",null),C(i,"isMouseDown",!1),C(i,"isMoving",!1),C(i,"movingTimeout",null),C(i,"startCameraState",null),C(i,"clicks",0),C(i,"doubleClickTimeout",null),C(i,"currentWheelDirection",0),C(i,"settings",Bs),i.handleClick=i.handleClick.bind(i),i.handleRightClick=i.handleRightClick.bind(i),i.handleDown=i.handleDown.bind(i),i.handleUp=i.handleUp.bind(i),i.handleMove=i.handleMove.bind(i),i.handleWheel=i.handleWheel.bind(i),i.handleLeave=i.handleLeave.bind(i),i.handleEnter=i.handleEnter.bind(i),n.addEventListener("click",i.handleClick,{capture:!1}),n.addEventListener("contextmenu",i.handleRightClick,{capture:!1}),n.addEventListener("mousedown",i.handleDown,{capture:!1}),n.addEventListener("wheel",i.handleWheel,{capture:!1}),n.addEventListener("mouseleave",i.handleLeave,{capture:!1}),n.addEventListener("mouseenter",i.handleEnter,{capture:!1}),document.addEventListener("mousemove",i.handleMove,{capture:!1}),document.addEventListener("mouseup",i.handleUp,{capture:!1}),i}return Se(e,r),de(e,[{key:"kill",value:function(){var t=this.container;t.removeEventListener("click",this.handleClick),t.removeEventListener("contextmenu",this.handleRightClick),t.removeEventListener("mousedown",this.handleDown),t.removeEventListener("wheel",this.handleWheel),t.removeEventListener("mouseleave",this.handleLeave),t.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(t){var i=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(t);setTimeout(function(){i.clicks=0,i.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",Ne(t,this.container))}}},{key:"handleRightClick",value:function(t){this.enabled&&this.emit("rightClick",Ne(t,this.container))}},{key:"handleDoubleClick",value:function(t){if(this.enabled){t.preventDefault(),t.stopPropagation();var i=Ne(t,this.container);if(this.emit("doubleClick",i),!i.sigmaDefaultPrevented){var o=this.renderer.getCamera(),s=o.getBoundedRatio(o.getState().ratio/this.settings.doubleClickZoomingRatio);o.animate(this.renderer.getViewportZoomedState(De(t,this.container),s),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(t){if(this.enabled){if(t.button===0){this.startCameraState=this.renderer.getCamera().getState();var i=De(t,this.container),o=i.x,s=i.y;this.lastMouseX=o,this.lastMouseY=s,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",Ne(t,this.container))}}},{key:"handleUp",value:function(t){var i=this;if(!(!this.enabled||!this.isMouseDown)){var o=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var s=De(t,this.container),a=s.x,u=s.y,c=o.getState(),l=o.getPreviousState()||{x:0,y:0};this.isMoving?o.animate({x:c.x+this.settings.inertiaRatio*(c.x-l.x),y:c.y+this.settings.inertiaRatio*(c.y-l.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==a||this.lastMouseY!==u)&&o.setState({x:c.x,y:c.y}),this.isMoving=!1,setTimeout(function(){var d=i.draggedEvents>0;i.draggedEvents=0,d&&i.renderer.getSetting("hideEdgesOnMove")&&i.renderer.refresh()},0),this.emit("mouseup",Ne(t,this.container))}}},{key:"handleMove",value:function(t){var i=this;if(this.enabled){var o=Ne(t,this.container);if(this.emit("mousemovebody",o),(t.target===this.container||t.composedPath()[0]===this.container)&&this.emit("mousemove",o),!o.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){i.movingTimeout=null,i.isMoving=!1},this.settings.dragTimeout);var s=this.renderer.getCamera(),a=De(t,this.container),u=a.x,c=a.y,l=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),d=this.renderer.viewportToFramedGraph({x:u,y:c}),f=l.x-d.x,h=l.y-d.y,g=s.getState(),y=g.x+f,p=g.y+h;s.setState({x:y,y:p}),this.lastMouseX=u,this.lastMouseY=c,t.preventDefault(),t.stopPropagation()}}}},{key:"handleLeave",value:function(t){this.emit("mouseleave",Ne(t,this.container))}},{key:"handleEnter",value:function(t){this.emit("mouseenter",Ne(t,this.container))}},{key:"handleWheel",value:function(t){var i=this,o=this.renderer.getCamera();if(!(!this.enabled||!o.enabledZooming)){var s=Ar(t);if(s){var a=Ms(t,this.container);if(this.emit("wheel",a),a.sigmaDefaultPrevented){t.preventDefault(),t.stopPropagation();return}var u=o.getState().ratio,c=s>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,l=o.getBoundedRatio(u*c),d=s>0?1:-1,f=Date.now();u!==l&&(t.preventDefault(),t.stopPropagation(),!(this.currentWheelDirection===d&&this.lastWheelTriggerTime&&f-this.lastWheelTriggerTime<this.settings.zoomDuration/5)&&(o.animate(this.renderer.getViewportZoomedState(De(t,this.container),l),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){i.currentWheelDirection=0}),this.currentWheelDirection=d,this.lastWheelTriggerTime=f))}}}},{key:"setSettings",value:function(t){this.settings=t}}])})(Dr),Hs=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],Vs=Hs.reduce(function(r,e){return M(M({},r),{},C({},e,rn[e]))},{}),js=(function(r){function e(n,t){var i;return le(this,e),i=Ee(this,e,[n,t]),C(i,"enabled",!0),C(i,"isMoving",!1),C(i,"hasMoved",!1),C(i,"touchMode",0),C(i,"startTouchesPositions",[]),C(i,"lastTouches",[]),C(i,"lastTap",null),C(i,"settings",Vs),i.handleStart=i.handleStart.bind(i),i.handleLeave=i.handleLeave.bind(i),i.handleMove=i.handleMove.bind(i),n.addEventListener("touchstart",i.handleStart,{capture:!1}),n.addEventListener("touchcancel",i.handleLeave,{capture:!1}),document.addEventListener("touchend",i.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",i.handleMove,{capture:!1,passive:!1}),i}return Se(e,r),de(e,[{key:"kill",value:function(){var t=this.container;t.removeEventListener("touchstart",this.handleStart),t.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(t){var i=this;if(this.enabled){t.preventDefault();var o=wt(t.touches);if(this.touchMode=o.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=o.map(function(h){return De(h,i.container)}),this.touchMode===2){var s=Xe(this.startTouchesPositions,2),a=s[0],u=a.x,c=a.y,l=s[1],d=l.x,f=l.y;this.startTouchesAngle=Math.atan2(f-c,d-u),this.startTouchesDistance=Math.sqrt(Math.pow(d-u,2)+Math.pow(f-c,2))}this.emit("touchdown",lt(t,this.lastTouches,this.container)),this.lastTouches=o,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(t){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(t.cancelable&&t.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(t.touches.length===1){this.handleStart(t),t.preventDefault();break}case 1:if(this.isMoving){var i=this.renderer.getCamera(),o=i.getState(),s=i.getPreviousState()||{x:0,y:0};i.animate({x:o.x+this.settings.inertiaRatio*(o.x-s.x),y:o.y+this.settings.inertiaRatio*(o.y-s.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",lt(t,this.lastTouches,this.container)),!t.touches.length){var a=De(this.lastTouches[0],this.container),u=this.startTouchesPositions[0],c=Math.pow(a.x-u.x,2)+Math.pow(a.y-u.y,2);if(!t.touches.length&&c<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var l=lt(t,this.lastTouches,this.container);if(this.emit("doubletap",l),this.lastTap=null,!l.sigmaDefaultPrevented){var d=this.renderer.getCamera(),f=d.getBoundedRatio(d.getState().ratio/this.settings.doubleClickZoomingRatio);d.animate(this.renderer.getViewportZoomedState(a,f),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var h=lt(t,this.lastTouches,this.container);this.emit("tap",h),this.lastTap={time:Date.now(),position:h.touches[0]||h.previousTouches[0]}}}this.lastTouches=wt(t.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(t){var i=this;if(!(!this.enabled||!this.startTouchesPositions.length)){t.preventDefault();var o=wt(t.touches),s=o.map(function(ie){return De(ie,i.container)}),a=this.lastTouches;this.lastTouches=o,this.lastTouchesPositions=s;var u=lt(t,a,this.container);if(this.emit("touchmove",u),!u.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=s.some(function(ie,re){var U=i.startTouchesPositions[re];return U&&(ie.x!==U.x||ie.y!==U.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){i.isMoving=!1},this.settings.dragTimeout);var c=this.renderer.getCamera(),l=this.startCameraState,d=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var f=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),h=f.x,g=f.y,y=this.renderer.viewportToFramedGraph(s[0]),p=y.x,_=y.y;c.setState({x:l.x+h-p,y:l.y+g-_});break}case 2:{var E={x:.5,y:.5,angle:0,ratio:1},b=s[0],m=b.x,T=b.y,D=s[1],k=D.x,x=D.y,G=Math.atan2(x-T,k-m)-this.startTouchesAngle,z=Math.hypot(x-T,k-m)/this.startTouchesDistance,H=c.getBoundedRatio(l.ratio/z);E.ratio=H,E.angle=l.angle+G;var $=this.getDimensions(),v=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:l}),Y=Math.min($.width,$.height)-2*d,Z=Y/$.width,N=Y/$.height,A=H/Y,V=m-Y/2/Z,K=T-Y/2/N,ne=[V*Math.cos(-E.angle)-K*Math.sin(-E.angle),K*Math.cos(-E.angle)+V*Math.sin(-E.angle)];V=ne[0],K=ne[1],E.x=v.x-V*A,E.y=v.y+K*A,c.setState(E);break}}}}}},{key:"setSettings",value:function(t){this.settings=t}}])})(Dr);function Ys(r){if(Array.isArray(r))return Ht(r)}function Ks(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function qs(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rr(r){return Ys(r)||Ks(r)||Vn(r)||qs()}function Zs(r,e){if(r==null)return{};var n={};for(var t in r)if({}.hasOwnProperty.call(r,t)){if(e.indexOf(t)!==-1)continue;n[t]=r[t]}return n}function sn(r,e){if(r==null)return{};var n,t,i=Zs(r,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(t=0;t<o.length;t++)n=o[t],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(r,n)&&(i[n]=r[n])}return i}var kr=(function(){function r(e,n){le(this,r),this.key=e,this.size=n}return de(r,null,[{key:"compare",value:function(n,t){return n.size>t.size?-1:n.size<t.size||n.key>t.key?1:-1}}])})(),Lr=(function(){function r(){le(this,r),C(this,"width",0),C(this,"height",0),C(this,"cellSize",0),C(this,"columns",0),C(this,"rows",0),C(this,"cells",{})}return de(r,[{key:"resizeAndClear",value:function(n,t){this.width=n.width,this.height=n.height,this.cellSize=t,this.columns=Math.ceil(n.width/t),this.rows=Math.ceil(n.height/t),this.cells={}}},{key:"getIndex",value:function(n){var t=Math.floor(n.x/this.cellSize),i=Math.floor(n.y/this.cellSize);return i*this.columns+t}},{key:"add",value:function(n,t,i){var o=new kr(n,t),s=this.getIndex(i),a=this.cells[s];a||(a=[],this.cells[s]=a),a.push(o)}},{key:"organize",value:function(){for(var n in this.cells){var t=this.cells[n];t.sort(kr.compare)}}},{key:"getLabelsToDisplay",value:function(n,t){var i=this.cellSize*this.cellSize,o=i/n/n,s=o*t/i,a=Math.ceil(s),u=[];for(var c in this.cells)for(var l=this.cells[c],d=0;d<Math.min(a,l.length);d++)u.push(l[d].key);return u}}])})();function Xs(r){var e=r.graph,n=r.hoveredNode,t=r.highlightedNodes,i=r.displayedNodeLabels,o=[];return e.forEachEdge(function(s,a,u,c){(u===n||c===n||t.has(u)||t.has(c)||i.has(u)&&i.has(c))&&o.push(s)}),o}var Cr=150,Ir=50,xe=Object.prototype.hasOwnProperty;function Js(r,e,n){if(!xe.call(n,"x")||!xe.call(n,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(e,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return n.color||(n.color=r.defaultNodeColor),!n.label&&n.label!==""&&(n.label=null),n.label!==void 0&&n.label!==null?n.label=""+n.label:n.label=null,n.size||(n.size=2),xe.call(n,"hidden")||(n.hidden=!1),xe.call(n,"highlighted")||(n.highlighted=!1),xe.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=r.defaultNodeType),n.zIndex||(n.zIndex=0),n}function Qs(r,e,n){return n.color||(n.color=r.defaultEdgeColor),n.label||(n.label=""),n.size||(n.size=.5),xe.call(n,"hidden")||(n.hidden=!1),xe.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=r.defaultEdgeType),n.zIndex||(n.zIndex=0),n}var ea=(function(r){function e(n,t){var i,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(le(this,e),i=Ee(this,e),C(i,"elements",{}),C(i,"canvasContexts",{}),C(i,"webGLContexts",{}),C(i,"pickingLayers",new Set),C(i,"textures",{}),C(i,"frameBuffers",{}),C(i,"activeListeners",{}),C(i,"labelGrid",new Lr),C(i,"nodeDataCache",{}),C(i,"edgeDataCache",{}),C(i,"nodeProgramIndex",{}),C(i,"edgeProgramIndex",{}),C(i,"nodesWithForcedLabels",new Set),C(i,"edgesWithForcedLabels",new Set),C(i,"nodeExtent",{x:[0,1],y:[0,1]}),C(i,"nodeZExtent",[1/0,-1/0]),C(i,"edgeZExtent",[1/0,-1/0]),C(i,"matrix",Ae()),C(i,"invMatrix",Ae()),C(i,"correctionRatio",1),C(i,"customBBox",null),C(i,"normalizationFunction",Sr({x:[0,1],y:[0,1]})),C(i,"graphToViewportRatio",1),C(i,"itemIDsIndex",{}),C(i,"nodeIndices",{}),C(i,"edgeIndices",{}),C(i,"width",0),C(i,"height",0),C(i,"pixelRatio",wr()),C(i,"pickingDownSizingRatio",2*i.pixelRatio),C(i,"displayedNodeLabels",new Set),C(i,"displayedEdgeLabels",new Set),C(i,"highlightedNodes",new Set),C(i,"hoveredNode",null),C(i,"hoveredEdge",null),C(i,"renderFrame",null),C(i,"renderHighlightedNodesFrame",null),C(i,"needToProcess",!1),C(i,"checkEdgesEventsFrame",null),C(i,"nodePrograms",{}),C(i,"nodeHoverPrograms",{}),C(i,"edgePrograms",{}),i.settings=zs(o),on(i.settings),Ps(n),!(t instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");i.graph=n,i.container=t,i.createWebGLContext("edges",{picking:o.enableEdgeEvents}),i.createCanvasContext("edgeLabels"),i.createWebGLContext("nodes",{picking:!0}),i.createCanvasContext("labels"),i.createCanvasContext("hovers"),i.createWebGLContext("hoverNodes"),i.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),i.resize();for(var s in i.settings.nodeProgramClasses)i.registerNodeProgram(s,i.settings.nodeProgramClasses[s],i.settings.nodeHoverProgramClasses[s]);for(var a in i.settings.edgeProgramClasses)i.registerEdgeProgram(a,i.settings.edgeProgramClasses[a]);return i.camera=new _r,i.bindCameraHandlers(),i.mouseCaptor=new Ws(i.elements.mouse,i),i.mouseCaptor.setSettings(i.settings),i.touchCaptor=new js(i.elements.mouse,i),i.touchCaptor.setSettings(i.settings),i.bindEventHandlers(),i.bindGraphHandlers(),i.handleSettingsUpdate(),i.refresh(),i}return Se(e,r),de(e,[{key:"registerNodeProgram",value:function(t,i,o){return this.nodePrograms[t]&&this.nodePrograms[t].kill(),this.nodeHoverPrograms[t]&&this.nodeHoverPrograms[t].kill(),this.nodePrograms[t]=new i(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[t]=new(o||i)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(t,i){return this.edgePrograms[t]&&this.edgePrograms[t].kill(),this.edgePrograms[t]=new i(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(t){if(this.nodePrograms[t]){var i=this.nodePrograms,o=i[t],s=sn(i,[t].map(ot));o.kill(),this.nodePrograms=s}if(this.nodeHoverPrograms[t]){var a=this.nodeHoverPrograms,u=a[t],c=sn(a,[t].map(ot));u.kill(),this.nodePrograms=c}return this}},{key:"unregisterEdgeProgram",value:function(t){if(this.edgePrograms[t]){var i=this.edgePrograms,o=i[t],s=sn(i,[t].map(ot));o.kill(),this.edgePrograms=s}return this}},{key:"resetWebGLTexture",value:function(t){var i=this.webGLContexts[t],o=this.frameBuffers[t],s=this.textures[t];s&&i.deleteTexture(s);var a=i.createTexture();return i.bindFramebuffer(i.FRAMEBUFFER,o),i.bindTexture(i.TEXTURE_2D,a),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a,0),this.textures[t]=a,this}},{key:"bindCameraHandlers",value:function(){var t=this;return this.activeListeners.camera=function(){t.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(t){var i=t.x,o=t.y,s=Zn(this.webGLContexts.nodes,this.frameBuffers.nodes,i,o,this.pixelRatio,this.pickingDownSizingRatio),a=qn.apply(void 0,Rr(s)),u=this.itemIDsIndex[a];return u&&u.type==="node"?u.id:null}},{key:"bindEventHandlers",value:function(){var t=this;this.activeListeners.handleResize=function(){t.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(o){var s=ct(o),a={event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}},u=t.getNodeAtPosition(s);if(u&&t.hoveredNode!==u&&!t.nodeDataCache[u].hidden){t.hoveredNode&&t.emit("leaveNode",M(M({},a),{},{node:t.hoveredNode})),t.hoveredNode=u,t.emit("enterNode",M(M({},a),{},{node:u})),t.scheduleHighlightedNodesRender();return}if(t.hoveredNode&&t.getNodeAtPosition(s)!==t.hoveredNode){var c=t.hoveredNode;t.hoveredNode=null,t.emit("leaveNode",M(M({},a),{},{node:c})),t.scheduleHighlightedNodesRender();return}if(t.settings.enableEdgeEvents){var l=t.hoveredNode?null:t.getEdgeAtPoint(a.event.x,a.event.y);l!==t.hoveredEdge&&(t.hoveredEdge&&t.emit("leaveEdge",M(M({},a),{},{edge:t.hoveredEdge})),l&&t.emit("enterEdge",M(M({},a),{},{edge:l})),t.hoveredEdge=l)}},this.activeListeners.handleMoveBody=function(o){var s=ct(o);t.emit("moveBody",{event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(o){var s=ct(o),a={event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}};t.hoveredNode&&(t.emit("leaveNode",M(M({},a),{},{node:t.hoveredNode})),t.scheduleHighlightedNodesRender()),t.settings.enableEdgeEvents&&t.hoveredEdge&&(t.emit("leaveEdge",M(M({},a),{},{edge:t.hoveredEdge})),t.scheduleHighlightedNodesRender()),t.emit("leaveStage",M({},a))},this.activeListeners.handleEnter=function(o){var s=ct(o),a={event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}};t.emit("enterStage",M({},a))};var i=function(s){return function(a){var u=ct(a),c={event:u,preventSigmaDefault:function(){u.preventSigmaDefault()}},l=t.getNodeAtPosition(u);if(l)return t.emit("".concat(s,"Node"),M(M({},c),{},{node:l}));if(t.settings.enableEdgeEvents){var d=t.getEdgeAtPoint(u.x,u.y);if(d)return t.emit("".concat(s,"Edge"),M(M({},c),{},{edge:d}))}return t.emit("".concat(s,"Stage"),c)}};return this.activeListeners.handleClick=i("click"),this.activeListeners.handleRightClick=i("rightClick"),this.activeListeners.handleDoubleClick=i("doubleClick"),this.activeListeners.handleWheel=i("wheel"),this.activeListeners.handleDown=i("down"),this.activeListeners.handleUp=i("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var t=this,i=this.graph,o=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(s){var a,u=(a=s.hints)===null||a===void 0?void 0:a.attributes;t.graph.forEachNode(function(l){return t.updateNode(l)});var c=!u||u.some(function(l){return o.has(l)});t.refresh({partialGraph:{nodes:i.nodes()},skipIndexation:!c,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(s){var a,u=(a=s.hints)===null||a===void 0?void 0:a.attributes;t.graph.forEachEdge(function(l){return t.updateEdge(l)});var c=u&&["zIndex","type"].some(function(l){return u==null?void 0:u.includes(l)});t.refresh({partialGraph:{edges:i.edges()},skipIndexation:!c,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(s){var a=s.key;t.addNode(a),t.refresh({partialGraph:{nodes:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(s){var a=s.key;t.refresh({partialGraph:{nodes:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(s){var a=s.key;t.removeNode(a),t.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(s){var a=s.key;t.addEdge(a),t.refresh({partialGraph:{edges:[a]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(s){var a=s.key;t.refresh({partialGraph:{edges:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(s){var a=s.key;t.removeEdge(a),t.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){t.clearEdgeState(),t.clearEdgeIndices(),t.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){t.clearEdgeState(),t.clearNodeState(),t.clearEdgeIndices(),t.clearNodeIndices(),t.refresh({schedule:!0})},i.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),i.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),i.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),i.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),i.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),i.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),i.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),i.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),i.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),i.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var t=this.graph;t.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),t.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),t.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),t.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),t.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),t.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),t.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),t.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),t.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),t.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(t,i){var o=Zn(this.webGLContexts.edges,this.frameBuffers.edges,t,i,this.pixelRatio,this.pickingDownSizingRatio),s=qn.apply(void 0,Rr(o)),a=this.itemIDsIndex[s];return a&&a.type==="edge"?a.id:null}},{key:"process",value:function(){var t=this;this.emit("beforeProcess");var i=this.graph,o=this.settings,s=this.getDimensions();if(this.nodeExtent=xs(this.graph),!this.settings.autoRescale){var a=s.width,u=s.height,c=this.nodeExtent,l=c.x,d=c.y;this.nodeExtent={x:[(l[0]+l[1])/2-a/2,(l[0]+l[1])/2+a/2],y:[(d[0]+d[1])/2-u/2,(d[0]+d[1])/2+u/2]}}this.normalizationFunction=Sr(this.customBBox||this.nodeExtent);var f=new _r,h=ut(f.getState(),s,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(s,o.labelGridCellSize);for(var g={},y={},p={},_={},E=1,b=i.nodes(),m=0,T=b.length;m<T;m++){var D=b[m],k=this.nodeDataCache[D],x=i.getNodeAttributes(D);k.x=x.x,k.y=x.y,this.normalizationFunction.applyTo(k),typeof k.label=="string"&&!k.hidden&&this.labelGrid.add(D,k.size,this.framedGraphToViewport(k,{matrix:h})),g[k.type]=(g[k.type]||0)+1}this.labelGrid.organize();for(var G in this.nodePrograms){if(!xe.call(this.nodePrograms,G))throw new Error('Sigma: could not find a suitable program for node type "'.concat(G,'"!'));this.nodePrograms[G].reallocate(g[G]||0),g[G]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(b=Er(this.nodeZExtent,function(ce){return t.nodeDataCache[ce].zIndex},b));for(var z=0,H=b.length;z<H;z++){var $=b[z];y[$]=E,_[y[$]]={type:"node",id:$},E++;var v=this.nodeDataCache[$];this.addNodeToProgram($,y[$],g[v.type]++)}for(var Y={},Z=i.edges(),N=0,A=Z.length;N<A;N++){var V=Z[N],K=this.edgeDataCache[V];Y[K.type]=(Y[K.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(Z=Er(this.edgeZExtent,function(ce){return t.edgeDataCache[ce].zIndex},Z));for(var ne in this.edgePrograms){if(!xe.call(this.edgePrograms,ne))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(ne,'"!'));this.edgePrograms[ne].reallocate(Y[ne]||0),Y[ne]=0}for(var ie=0,re=Z.length;ie<re;ie++){var U=Z[ie];p[U]=E,_[p[U]]={type:"edge",id:U},E++;var ze=this.edgeDataCache[U];this.addEdgeToProgram(U,p[U],Y[ze.type]++)}return this.itemIDsIndex=_,this.nodeIndices=y,this.edgeIndices=p,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(t){var i=this,o=this.settings;if(this.camera.minRatio=o.minCameraRatio,this.camera.maxRatio=o.maxCameraRatio,this.camera.enabledZooming=o.enableCameraZooming,this.camera.enabledPanning=o.enableCameraPanning,this.camera.enabledRotation=o.enableCameraRotation,o.cameraPanBoundaries?this.camera.clean=function(l){return i.cleanCameraState(l,o.cameraPanBoundaries&&tn(o.cameraPanBoundaries)==="object"?o.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),t){if(t.edgeProgramClasses!==o.edgeProgramClasses){for(var s in o.edgeProgramClasses)o.edgeProgramClasses[s]!==t.edgeProgramClasses[s]&&this.registerEdgeProgram(s,o.edgeProgramClasses[s]);for(var a in t.edgeProgramClasses)o.edgeProgramClasses[a]||this.unregisterEdgeProgram(a)}if(t.nodeProgramClasses!==o.nodeProgramClasses||t.nodeHoverProgramClasses!==o.nodeHoverProgramClasses){for(var u in o.nodeProgramClasses)(o.nodeProgramClasses[u]!==t.nodeProgramClasses[u]||o.nodeHoverProgramClasses[u]!==t.nodeHoverProgramClasses[u])&&this.registerNodeProgram(u,o.nodeProgramClasses[u],o.nodeHoverProgramClasses[u]);for(var c in t.nodeProgramClasses)o.nodeProgramClasses[c]||this.unregisterNodeProgram(c)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.tolerance,s=o===void 0?0:o,a=i.boundaries,u=M({},t),c=a||this.nodeExtent,l=Xe(c.x,2),d=l[0],f=l[1],h=Xe(c.y,2),g=h[0],y=h[1],p=[this.graphToViewport({x:d,y:g},{cameraState:t}),this.graphToViewport({x:f,y:g},{cameraState:t}),this.graphToViewport({x:d,y},{cameraState:t}),this.graphToViewport({x:f,y},{cameraState:t})],_=1/0,E=-1/0,b=1/0,m=-1/0;p.forEach(function(Y){var Z=Y.x,N=Y.y;_=Math.min(_,Z),E=Math.max(E,Z),b=Math.min(b,N),m=Math.max(m,N)});var T=E-_,D=m-b,k=this.getDimensions(),x=k.width,G=k.height,z=0,H=0;if(T>=x?E<x-s?z=E-(x-s):_>s&&(z=_-s):E>x+s?z=E-(x+s):_<-s&&(z=_+s),D>=G?m<G-s?H=m-(G-s):b>s&&(H=b-s):m>G+s?H=m-(G+s):b<-s&&(H=b+s),z||H){var $=this.viewportToFramedGraph({x:0,y:0},{cameraState:t}),v=this.viewportToFramedGraph({x:z,y:H},{cameraState:t});z=v.x-$.x,H=v.y-$.y,u.x+=z,u.y+=H}return u}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var t=this.camera.getState(),i=this.labelGrid.getLabelsToDisplay(t.ratio,this.settings.labelDensity);Tr(i,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var o=this.canvasContexts.labels,s=0,a=i.length;s<a;s++){var u=i[s],c=this.nodeDataCache[u];if(!this.displayedNodeLabels.has(u)&&!c.hidden){var l=this.framedGraphToViewport(c),d=l.x,f=l.y,h=this.scaleSize(c.size);if(!(!c.forceLabel&&h<this.settings.labelRenderedSizeThreshold)&&!(d<-Cr||d>this.width+Cr||f<-Ir||f>this.height+Ir)){this.displayedNodeLabels.add(u);var g=this.settings.defaultDrawNodeLabel,y=this.nodePrograms[c.type],p=(y==null?void 0:y.drawLabel)||g;p(o,M(M({key:u},c),{},{size:h,x:d,y:f}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var t=this.canvasContexts.edgeLabels;t.clearRect(0,0,this.width,this.height);var i=Xs({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});Tr(i,this.edgesWithForcedLabels);for(var o=new Set,s=0,a=i.length;s<a;s++){var u=i[s],c=this.graph.extremities(u),l=this.nodeDataCache[c[0]],d=this.nodeDataCache[c[1]],f=this.edgeDataCache[u];if(!o.has(u)&&!(f.hidden||l.hidden||d.hidden)){var h=this.settings.defaultDrawEdgeLabel,g=this.edgePrograms[f.type],y=(g==null?void 0:g.drawLabel)||h;y(t,M(M({key:u},f),{},{size:this.scaleSize(f.size)}),M(M(M({key:c[0]},l),this.framedGraphToViewport(l)),{},{size:this.scaleSize(l.size)}),M(M(M({key:c[1]},d),this.framedGraphToViewport(d)),{},{size:this.scaleSize(d.size)}),this.settings),o.add(u)}}return this.displayedEdgeLabels=o,this}},{key:"renderHighlightedNodes",value:function(){var t=this,i=this.canvasContexts.hovers;i.clearRect(0,0,this.width,this.height);var o=function(h){var g=t.nodeDataCache[h],y=t.framedGraphToViewport(g),p=y.x,_=y.y,E=t.scaleSize(g.size),b=t.settings.defaultDrawNodeHover,m=t.nodePrograms[g.type],T=(m==null?void 0:m.drawHover)||b;T(i,M(M({key:h},g),{},{size:E,x:p,y:_}),t.settings)},s=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&s.push(this.hoveredNode),this.highlightedNodes.forEach(function(f){f!==t.hoveredNode&&s.push(f)}),s.forEach(function(f){return o(f)});var a={};s.forEach(function(f){var h=t.nodeDataCache[f].type;a[h]=(a[h]||0)+1});for(var u in this.nodeHoverPrograms)this.nodeHoverPrograms[u].reallocate(a[u]||0),a[u]=0;s.forEach(function(f){var h=t.nodeDataCache[f];t.nodeHoverPrograms[h.type].process(0,a[h.type]++,h)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var c=this.getRenderParams();for(var l in this.nodeHoverPrograms){var d=this.nodeHoverPrograms[l];d.render(c)}}},{key:"scheduleHighlightedNodesRender",value:function(){var t=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){t.renderHighlightedNodesFrame=null,t.renderHighlightedNodes(),t.renderEdgeLabels()}))}},{key:"render",value:function(){var t=this;this.emit("beforeRender");var i=function(){return t.emit("afterRender"),t};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(p){return t.resetWebGLTexture(p)}),!this.graph.order)return i();var o=this.mouseCaptor,s=this.camera.isAnimated()||o.isMoving||o.draggedEvents||o.currentWheelDirection,a=this.camera.getState(),u=this.getDimensions(),c=this.getGraphDimensions(),l=this.getStagePadding();this.matrix=ut(a,u,c,l),this.invMatrix=ut(a,u,c,l,!0),this.correctionRatio=Ns(this.matrix,a,u),this.graphToViewportRatio=this.getGraphToViewportRatio();var d=this.getRenderParams();for(var f in this.nodePrograms){var h=this.nodePrograms[f];h.render(d)}if(!this.settings.hideEdgesOnMove||!s)for(var g in this.edgePrograms){var y=this.edgePrograms[g];y.render(d)}return this.settings.hideLabelsOnMove&&s||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),i()}},{key:"addNode",value:function(t){var i=Object.assign({},this.graph.getNodeAttributes(t));this.settings.nodeReducer&&(i=this.settings.nodeReducer(t,i));var o=Js(this.settings,t,i);this.nodeDataCache[t]=o,this.nodesWithForcedLabels.delete(t),o.forceLabel&&!o.hidden&&this.nodesWithForcedLabels.add(t),this.highlightedNodes.delete(t),o.highlighted&&!o.hidden&&this.highlightedNodes.add(t),this.settings.zIndex&&(o.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=o.zIndex),o.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=o.zIndex))}},{key:"updateNode",value:function(t){this.addNode(t);var i=this.nodeDataCache[t];this.normalizationFunction.applyTo(i)}},{key:"removeNode",value:function(t){delete this.nodeDataCache[t],delete this.nodeProgramIndex[t],this.highlightedNodes.delete(t),this.hoveredNode===t&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(t)}},{key:"addEdge",value:function(t){var i=Object.assign({},this.graph.getEdgeAttributes(t));this.settings.edgeReducer&&(i=this.settings.edgeReducer(t,i));var o=Qs(this.settings,t,i);this.edgeDataCache[t]=o,this.edgesWithForcedLabels.delete(t),o.forceLabel&&!o.hidden&&this.edgesWithForcedLabels.add(t),this.settings.zIndex&&(o.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=o.zIndex),o.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=o.zIndex))}},{key:"updateEdge",value:function(t){this.addEdge(t)}},{key:"removeEdge",value:function(t){delete this.edgeDataCache[t],delete this.edgeProgramIndex[t],this.hoveredEdge===t&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(t)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new Lr,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0],this.highlightedNodes=new Set}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(t,i,o){var s=this.nodeDataCache[t],a=this.nodePrograms[s.type];if(!a)throw new Error('Sigma: could not find a suitable program for node type "'.concat(s.type,'"!'));a.process(i,o,s),this.nodeProgramIndex[t]=o}},{key:"addEdgeToProgram",value:function(t,i,o){var s=this.edgeDataCache[t],a=this.edgePrograms[s.type];if(!a)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(s.type,'"!'));var u=this.graph.extremities(t),c=this.nodeDataCache[u[0]],l=this.nodeDataCache[u[1]];a.process(i,o,c,l,s),this.edgeProgramIndex[t]=o}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var t=this.settings,i=t.stagePadding,o=t.autoRescale;return o&&i||0}},{key:"createLayer",value:function(t,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.elements[t])throw new Error('Sigma: a layer named "'.concat(t,'" already exists'));var s=Os(i,{position:"absolute"},{class:"sigma-".concat(t)});return o.style&&Object.assign(s.style,o.style),this.elements[t]=s,"beforeLayer"in o&&o.beforeLayer?this.elements[o.beforeLayer].before(s):"afterLayer"in o&&o.afterLayer?this.elements[o.afterLayer].after(s):this.container.appendChild(s),s}},{key:"createCanvas",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.createLayer(t,"canvas",i)}},{key:"createCanvasContext",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.createCanvas(t,i),s={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[t]=o.getContext("2d",s),this}},{key:"createWebGLContext",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=(i==null?void 0:i.canvas)||this.createCanvas(t,i);i.hidden&&o.remove();var s=M({preserveDrawingBuffer:!1,antialias:!1},i),a;a=o.getContext("webgl2",s),a||(a=o.getContext("webgl",s)),a||(a=o.getContext("experimental-webgl",s));var u=a;if(this.webGLContexts[t]=u,u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA),i.picking){this.pickingLayers.add(t);var c=u.createFramebuffer();if(!c)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(t));this.frameBuffers[t]=c}return u}},{key:"killLayer",value:function(t){var i=this.elements[t];if(!i)throw new Error("Sigma: cannot kill layer ".concat(t,", which does not exist"));if(this.webGLContexts[t]){var o,s=this.webGLContexts[t];(o=s.getExtension("WEBGL_lose_context"))===null||o===void 0||o.loseContext(),delete this.webGLContexts[t]}else this.canvasContexts[t]&&delete this.canvasContexts[t];return i.remove(),delete this.elements[t],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(t){this.unbindCameraHandlers(),this.camera=t,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(t){t!==this.graph&&(this.hoveredNode&&!t.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!t.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=t,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var t=this.customBBox||this.nodeExtent;return{width:t.x[1]-t.x[0]||1,height:t.y[1]-t.y[0]||1}}},{key:"getNodeDisplayData",value:function(t){var i=this.nodeDataCache[t];return i?Object.assign({},i):void 0}},{key:"getEdgeDisplayData",value:function(t){var i=this.edgeDataCache[t];return i?Object.assign({},i):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return M({},this.settings)}},{key:"getSetting",value:function(t){return this.settings[t]}},{key:"setSetting",value:function(t,i){var o=M({},this.settings);return this.settings[t]=i,on(this.settings),this.handleSettingsUpdate(o),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(t,i){return this.setSetting(t,i(this.settings[t])),this}},{key:"setSettings",value:function(t){var i=M({},this.settings);return this.settings=M(M({},this.settings),t),on(this.settings),this.handleSettingsUpdate(i),this.scheduleRefresh(),this}},{key:"resize",value:function(t){var i=this.width,o=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=wr(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!t&&i===this.width&&o===this.height)return this;for(var s in this.elements){var a=this.elements[s];a.style.width=this.width+"px",a.style.height=this.height+"px"}for(var u in this.canvasContexts)this.elements[u].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[u].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[u].scale(this.pixelRatio,this.pixelRatio);for(var c in this.webGLContexts){this.elements[c].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[c].setAttribute("height",this.height*this.pixelRatio+"px");var l=this.webGLContexts[c];if(l.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(c)){var d=this.textures[c];d&&l.deleteTexture(d)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(t){var i=this,o=(t==null?void 0:t.skipIndexation)!==void 0?t==null?void 0:t.skipIndexation:!1,s=(t==null?void 0:t.schedule)!==void 0?t.schedule:!1,a=!t||!t.partialGraph;if(a)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(m){return i.addNode(m)}),this.graph.forEachEdge(function(m){return i.addEdge(m)});else{for(var u,c,l=((u=t.partialGraph)===null||u===void 0?void 0:u.nodes)||[],d=0,f=(l==null?void 0:l.length)||0;d<f;d++){var h=l[d];if(this.updateNode(h),o){var g=this.nodeProgramIndex[h];if(g===void 0)throw new Error('Sigma: node "'.concat(h,`" can't be repaint`));this.addNodeToProgram(h,this.nodeIndices[h],g)}}for(var y=(t==null||(c=t.partialGraph)===null||c===void 0?void 0:c.edges)||[],p=0,_=y.length;p<_;p++){var E=y[p];if(this.updateEdge(E),o){var b=this.edgeProgramIndex[E];if(b===void 0)throw new Error('Sigma: edge "'.concat(E,`" can't be repaint`));this.addEdgeToProgram(E,this.edgeIndices[E],b)}}}return(a||!o)&&(this.needToProcess=!0),s?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var t=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){t.render()})),this}},{key:"scheduleRefresh",value:function(t){return this.refresh(M(M({},t),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(t,i){var o=this.camera.getState(),s=o.ratio,a=o.angle,u=o.x,c=o.y,l=this.settings,d=l.minCameraRatio,f=l.maxCameraRatio;typeof f=="number"&&(i=Math.min(i,f)),typeof d=="number"&&(i=Math.max(i,d));var h=i/s,g={x:this.width/2,y:this.height/2},y=this.viewportToFramedGraph(t),p=this.viewportToFramedGraph(g);return{angle:a,x:(y.x-p.x)*(1-h)+u,y:(y.y-p.y)*(1-h)+c,ratio:i}}},{key:"viewRectangle",value:function(){var t=this.viewportToFramedGraph({x:0,y:0}),i=this.viewportToFramedGraph({x:this.width,y:0}),o=this.viewportToFramedGraph({x:0,y:this.height});return{x1:t.x,y1:t.y,x2:i.x,y2:i.y,height:i.y-o.y}}},{key:"framedGraphToViewport",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!i.cameraState||!!i.viewportDimensions||!!i.graphDimensions,s=i.matrix?i.matrix:o?ut(i.cameraState||this.camera.getState(),i.viewportDimensions||this.getDimensions(),i.graphDimensions||this.getGraphDimensions(),i.padding||this.getStagePadding()):this.matrix,a=en(s,t);return{x:(1+a.x)*this.width/2,y:(1-a.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!i.cameraState||!!i.viewportDimensions||!i.graphDimensions,s=i.matrix?i.matrix:o?ut(i.cameraState||this.camera.getState(),i.viewportDimensions||this.getDimensions(),i.graphDimensions||this.getGraphDimensions(),i.padding||this.getStagePadding(),!0):this.invMatrix,a=en(s,{x:t.x/this.width*2-1,y:1-t.y/this.height*2});return isNaN(a.x)&&(a.x=0),isNaN(a.y)&&(a.y=0),a}},{key:"viewportToGraph",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(t,i))}},{key:"graphToViewport",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(t),i)}},{key:"getGraphToViewportRatio",value:function(){var t={x:0,y:0},i={x:1,y:1},o=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=this.graphToViewport(t),a=this.graphToViewport(i),u=Math.sqrt(Math.pow(s.x-a.x,2)+Math.pow(s.y-a.y,2));return u/o}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(t){return this.customBBox=t,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var t=this.container;t.firstChild;)t.removeChild(t.firstChild);for(var i in this.nodePrograms)this.nodePrograms[i].kill();for(var o in this.nodeHoverPrograms)this.nodeHoverPrograms[o].kill();for(var s in this.edgePrograms)this.edgePrograms[s].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var a in this.elements)this.killLayer(a);this.canvasContexts={},this.webGLContexts={},this.elements={}}},{key:"scaleSize",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return t/this.settings.zoomToSizeRatioFunction(i)*(this.getSetting("itemSizesReference")==="positions"?i*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var t={};for(var i in this.elements)this.elements[i]instanceof HTMLCanvasElement&&(t[i]=this.elements[i]);return t}}])})(Jt),ta=ea,dt={},Nr;function na(){if(Nr)return dt;Nr=1;function r(t){return typeof t!="number"||isNaN(t)?1:t}function e(t,i){var o={},s=function(c){return typeof c>"u"?i:c};typeof i=="function"&&(s=i);var a=function(c){return s(c[t])},u=function(){return s(void 0)};return typeof t=="string"?(o.fromAttributes=a,o.fromGraph=function(c,l){return a(c.getNodeAttributes(l))},o.fromEntry=function(c,l){return a(l)}):typeof t=="function"?(o.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},o.fromGraph=function(c,l){return s(t(l,c.getNodeAttributes(l)))},o.fromEntry=function(c,l){return s(t(c,l))}):(o.fromAttributes=u,o.fromGraph=u,o.fromEntry=u),o}function n(t,i){var o={},s=function(c){return typeof c>"u"?i:c};typeof i=="function"&&(s=i);var a=function(c){return s(c[t])},u=function(){return s(void 0)};return typeof t=="string"?(o.fromAttributes=a,o.fromGraph=function(c,l){return a(c.getEdgeAttributes(l))},o.fromEntry=function(c,l){return a(l)},o.fromPartialEntry=o.fromEntry,o.fromMinimalEntry=o.fromEntry):typeof t=="function"?(o.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},o.fromGraph=function(c,l){var d=c.extremities(l);return s(t(l,c.getEdgeAttributes(l),d[0],d[1],c.getNodeAttributes(d[0]),c.getNodeAttributes(d[1]),c.isUndirected(l)))},o.fromEntry=function(c,l,d,f,h,g,y){return s(t(c,l,d,f,h,g,y))},o.fromPartialEntry=function(c,l,d,f){return s(t(c,l,d,f))},o.fromMinimalEntry=function(c,l){return s(t(c,l))}):(o.fromAttributes=u,o.fromGraph=u,o.fromEntry=u,o.fromMinimalEntry=u),o}return dt.createNodeValueGetter=e,dt.createEdgeValueGetter=n,dt.createEdgeWeightGetter=function(t){return n(t,r)},dt}var an,xr;function ra(){if(xr)return an;xr=1;var r=0,e=1,n=2,t=3,i=4,o=5,s=6,a=7,u=8,c=9,l=0,d=1,f=2,h=0,g=1,y=2,p=3,_=4,E=5,b=6,m=7,T=8,D=3,k=10,x=3,G=9,z=10;return an=function($,v,Y){var Z,N,A,V,K,ne,ie,re,U,ze,ce=v.length,We=Y.length,Me=$.adjustSizes,Pt=$.barnesHutTheta*$.barnesHutTheta,He,X,w,R,I,L,P,S=[];for(A=0;A<ce;A+=k)v[A+i]=v[A+n],v[A+o]=v[A+t],v[A+n]=0,v[A+t]=0;if($.outboundAttractionDistribution){for(He=0,A=0;A<ce;A+=k)He+=v[A+s];He/=ce/k}if($.barnesHutOptimize){var te=1/0,oe=-1/0,Q=1/0,ge=-1/0,se,ee,nt;for(A=0;A<ce;A+=k)te=Math.min(te,v[A+r]),oe=Math.max(oe,v[A+r]),Q=Math.min(Q,v[A+e]),ge=Math.max(ge,v[A+e]);var Ve=oe-te,j=ge-Q;for(Ve>j?(Q-=(Ve-j)/2,ge=Q+Ve):(te-=(j-Ve)/2,oe=te+j),S[0+h]=-1,S[0+g]=(te+oe)/2,S[0+y]=(Q+ge)/2,S[0+p]=Math.max(oe-te,ge-Q),S[0+_]=-1,S[0+E]=-1,S[0+b]=0,S[0+m]=0,S[0+T]=0,Z=1,A=0;A<ce;A+=k)for(N=0,nt=D;;)if(S[N+E]>=0){v[A+r]<S[N+g]?v[A+e]<S[N+y]?se=S[N+E]:se=S[N+E]+G:v[A+e]<S[N+y]?se=S[N+E]+G*2:se=S[N+E]+G*3,S[N+m]=(S[N+m]*S[N+b]+v[A+r]*v[A+s])/(S[N+b]+v[A+s]),S[N+T]=(S[N+T]*S[N+b]+v[A+e]*v[A+s])/(S[N+b]+v[A+s]),S[N+b]+=v[A+s],N=se;continue}else if(S[N+h]<0){S[N+h]=A;break}else{if(S[N+E]=Z*G,re=S[N+p]/2,U=S[N+E],S[U+h]=-1,S[U+g]=S[N+g]-re,S[U+y]=S[N+y]-re,S[U+p]=re,S[U+_]=U+G,S[U+E]=-1,S[U+b]=0,S[U+m]=0,S[U+T]=0,U+=G,S[U+h]=-1,S[U+g]=S[N+g]-re,S[U+y]=S[N+y]+re,S[U+p]=re,S[U+_]=U+G,S[U+E]=-1,S[U+b]=0,S[U+m]=0,S[U+T]=0,U+=G,S[U+h]=-1,S[U+g]=S[N+g]+re,S[U+y]=S[N+y]-re,S[U+p]=re,S[U+_]=U+G,S[U+E]=-1,S[U+b]=0,S[U+m]=0,S[U+T]=0,U+=G,S[U+h]=-1,S[U+g]=S[N+g]+re,S[U+y]=S[N+y]+re,S[U+p]=re,S[U+_]=S[N+_],S[U+E]=-1,S[U+b]=0,S[U+m]=0,S[U+T]=0,Z+=4,v[S[N+h]+r]<S[N+g]?v[S[N+h]+e]<S[N+y]?se=S[N+E]:se=S[N+E]+G:v[S[N+h]+e]<S[N+y]?se=S[N+E]+G*2:se=S[N+E]+G*3,S[N+b]=v[S[N+h]+s],S[N+m]=v[S[N+h]+r],S[N+T]=v[S[N+h]+e],S[se+h]=S[N+h],S[N+h]=-1,v[A+r]<S[N+g]?v[A+e]<S[N+y]?ee=S[N+E]:ee=S[N+E]+G:v[A+e]<S[N+y]?ee=S[N+E]+G*2:ee=S[N+E]+G*3,se===ee)if(nt--){N=se;continue}else{nt=D;break}S[ee+h]=A;break}}if($.barnesHutOptimize)for(X=$.scalingRatio,A=0;A<ce;A+=k)for(N=0;;)if(S[N+E]>=0)if(L=Math.pow(v[A+r]-S[N+m],2)+Math.pow(v[A+e]-S[N+T],2),ze=S[N+p],4*ze*ze/L<Pt){if(w=v[A+r]-S[N+m],R=v[A+e]-S[N+T],Me===!0?L>0?(P=X*v[A+s]*S[N+b]/L,v[A+n]+=w*P,v[A+t]+=R*P):L<0&&(P=-X*v[A+s]*S[N+b]/Math.sqrt(L),v[A+n]+=w*P,v[A+t]+=R*P):L>0&&(P=X*v[A+s]*S[N+b]/L,v[A+n]+=w*P,v[A+t]+=R*P),N=S[N+_],N<0)break;continue}else{N=S[N+E];continue}else{if(ne=S[N+h],ne>=0&&ne!==A&&(w=v[A+r]-v[ne+r],R=v[A+e]-v[ne+e],L=w*w+R*R,Me===!0?L>0?(P=X*v[A+s]*v[ne+s]/L,v[A+n]+=w*P,v[A+t]+=R*P):L<0&&(P=-X*v[A+s]*v[ne+s]/Math.sqrt(L),v[A+n]+=w*P,v[A+t]+=R*P):L>0&&(P=X*v[A+s]*v[ne+s]/L,v[A+n]+=w*P,v[A+t]+=R*P)),N=S[N+_],N<0)break;continue}else for(X=$.scalingRatio,V=0;V<ce;V+=k)for(K=0;K<V;K+=k)w=v[V+r]-v[K+r],R=v[V+e]-v[K+e],Me===!0?(L=Math.sqrt(w*w+R*R)-v[V+u]-v[K+u],L>0?(P=X*v[V+s]*v[K+s]/L/L,v[V+n]+=w*P,v[V+t]+=R*P,v[K+n]-=w*P,v[K+t]-=R*P):L<0&&(P=100*X*v[V+s]*v[K+s],v[V+n]+=w*P,v[V+t]+=R*P,v[K+n]-=w*P,v[K+t]-=R*P)):(L=Math.sqrt(w*w+R*R),L>0&&(P=X*v[V+s]*v[K+s]/L/L,v[V+n]+=w*P,v[V+t]+=R*P,v[K+n]-=w*P,v[K+t]-=R*P));for(U=$.gravity/$.scalingRatio,X=$.scalingRatio,A=0;A<ce;A+=k)P=0,w=v[A+r],R=v[A+e],L=Math.sqrt(Math.pow(w,2)+Math.pow(R,2)),$.strongGravityMode?L>0&&(P=X*v[A+s]*U):L>0&&(P=X*v[A+s]*U/L),v[A+n]-=w*P,v[A+t]-=R*P;for(X=1*($.outboundAttractionDistribution?He:1),ie=0;ie<We;ie+=x)V=Y[ie+l],K=Y[ie+d],re=Y[ie+f],I=Math.pow(re,$.edgeWeightInfluence),w=v[V+r]-v[K+r],R=v[V+e]-v[K+e],Me===!0?(L=Math.sqrt(w*w+R*R)-v[V+u]-v[K+u],$.linLogMode?$.outboundAttractionDistribution?L>0&&(P=-X*I*Math.log(1+L)/L/v[V+s]):L>0&&(P=-X*I*Math.log(1+L)/L):$.outboundAttractionDistribution?L>0&&(P=-X*I/v[V+s]):L>0&&(P=-X*I)):(L=Math.sqrt(Math.pow(w,2)+Math.pow(R,2)),$.linLogMode?$.outboundAttractionDistribution?L>0&&(P=-X*I*Math.log(1+L)/L/v[V+s]):L>0&&(P=-X*I*Math.log(1+L)/L):$.outboundAttractionDistribution?(L=1,P=-X*I/v[V+s]):(L=1,P=-X*I)),L>0&&(v[V+n]+=w*P,v[V+t]+=R*P,v[K+n]-=w*P,v[K+t]-=R*P);var fe,Te,pe,Re,Ot,Gt;if(Me===!0)for(A=0;A<ce;A+=k)v[A+c]!==1&&(fe=Math.sqrt(Math.pow(v[A+n],2)+Math.pow(v[A+t],2)),fe>z&&(v[A+n]=v[A+n]*z/fe,v[A+t]=v[A+t]*z/fe),Te=v[A+s]*Math.sqrt((v[A+i]-v[A+n])*(v[A+i]-v[A+n])+(v[A+o]-v[A+t])*(v[A+o]-v[A+t])),pe=Math.sqrt((v[A+i]+v[A+n])*(v[A+i]+v[A+n])+(v[A+o]+v[A+t])*(v[A+o]+v[A+t]))/2,Re=.1*Math.log(1+pe)/(1+Math.sqrt(Te)),Ot=v[A+r]+v[A+n]*(Re/$.slowDown),v[A+r]=Ot,Gt=v[A+e]+v[A+t]*(Re/$.slowDown),v[A+e]=Gt);else for(A=0;A<ce;A+=k)v[A+c]!==1&&(Te=v[A+s]*Math.sqrt((v[A+i]-v[A+n])*(v[A+i]-v[A+n])+(v[A+o]-v[A+t])*(v[A+o]-v[A+t])),pe=Math.sqrt((v[A+i]+v[A+n])*(v[A+i]+v[A+n])+(v[A+o]+v[A+t])*(v[A+o]+v[A+t]))/2,Re=v[A+a]*Math.log(1+pe)/(1+Math.sqrt(Te)),v[A+a]=Math.min(1,Math.sqrt(Re*(Math.pow(v[A+n],2)+Math.pow(v[A+t],2))/(1+Math.sqrt(Te)))),Ot=v[A+r]+v[A+n]*(Re/$.slowDown),v[A+r]=Ot,Gt=v[A+e]+v[A+t]*(Re/$.slowDown),v[A+e]=Gt);return{}},an}var Pe={},Pr;function ia(){if(Pr)return Pe;Pr=1;var r=10,e=3;return Pe.assign=function(n){n=n||{};var t=Array.prototype.slice.call(arguments).slice(1),i,o,s;for(i=0,s=t.length;i<s;i++)if(t[i])for(o in t[i])n[o]=t[i][o];return n},Pe.validateSettings=function(n){return"linLogMode"in n&&typeof n.linLogMode!="boolean"?{message:"the `linLogMode` setting should be a boolean."}:"outboundAttractionDistribution"in n&&typeof n.outboundAttractionDistribution!="boolean"?{message:"the `outboundAttractionDistribution` setting should be a boolean."}:"adjustSizes"in n&&typeof n.adjustSizes!="boolean"?{message:"the `adjustSizes` setting should be a boolean."}:"edgeWeightInfluence"in n&&typeof n.edgeWeightInfluence!="number"?{message:"the `edgeWeightInfluence` setting should be a number."}:"scalingRatio"in n&&!(typeof n.scalingRatio=="number"&&n.scalingRatio>=0)?{message:"the `scalingRatio` setting should be a number >= 0."}:"strongGravityMode"in n&&typeof n.strongGravityMode!="boolean"?{message:"the `strongGravityMode` setting should be a boolean."}:"gravity"in n&&!(typeof n.gravity=="number"&&n.gravity>=0)?{message:"the `gravity` setting should be a number >= 0."}:"slowDown"in n&&!(typeof n.slowDown=="number"||n.slowDown>=0)?{message:"the `slowDown` setting should be a number >= 0."}:"barnesHutOptimize"in n&&typeof n.barnesHutOptimize!="boolean"?{message:"the `barnesHutOptimize` setting should be a boolean."}:"barnesHutTheta"in n&&!(typeof n.barnesHutTheta=="number"&&n.barnesHutTheta>=0)?{message:"the `barnesHutTheta` setting should be a number >= 0."}:null},Pe.graphToByteArrays=function(n,t){var i=n.order,o=n.size,s={},a,u=new Float32Array(i*r),c=new Float32Array(o*e);return a=0,n.forEachNode(function(l,d){s[l]=a,u[a]=d.x,u[a+1]=d.y,u[a+2]=0,u[a+3]=0,u[a+4]=0,u[a+5]=0,u[a+6]=1,u[a+7]=1,u[a+8]=d.size||1,u[a+9]=d.fixed?1:0,a+=r}),a=0,n.forEachEdge(function(l,d,f,h,g,y,p){var _=s[f],E=s[h],b=t(l,d,f,h,g,y,p);u[_+6]+=b,u[E+6]+=b,c[a]=_,c[a+1]=E,c[a+2]=b,a+=e}),{nodes:u,edges:c}},Pe.assignLayoutChanges=function(n,t,i){var o=0;n.updateEachNodeAttributes(function(s,a){return a.x=t[o],a.y=t[o+1],o+=r,i?i(s,a):a})},Pe.readGraphPositions=function(n,t){var i=0;n.forEachNode(function(o,s){t[i]=s.x,t[i+1]=s.y,i+=r})},Pe.collectLayoutChanges=function(n,t,i){for(var o=n.nodes(),s={},a=0,u=0,c=t.length;a<c;a+=r){if(i){var l=Object.assign({},n.getNodeAttributes(o[u]));l.x=t[a],l.y=t[a+1],l=i(o[u],l),s[o[u]]={x:l.x,y:l.y}}else s[o[u]]={x:t[a],y:t[a+1]};u++}return s},Pe.createWorker=function(t){var i=window.URL||window.webkitURL,o=t.toString(),s=i.createObjectURL(new Blob(["("+o+").call(this);"],{type:"text/javascript"})),a=new Worker(s);return i.revokeObjectURL(s),a},Pe}var un,Or;function oa(){return Or||(Or=1,un={linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:1,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5}),un}var cn,Gr;function sa(){if(Gr)return cn;Gr=1;var r=yr(),e=na().createEdgeWeightGetter,n=ra(),t=ia(),i=oa();function o(u,c,l){if(!r(c))throw new Error("graphology-layout-forceatlas2: the given graph is not a valid graphology instance.");typeof l=="number"&&(l={iterations:l});var d=l.iterations;if(typeof d!="number")throw new Error("graphology-layout-forceatlas2: invalid number of iterations.");if(d<=0)throw new Error("graphology-layout-forceatlas2: you should provide a positive number of iterations.");var f=e("getEdgeWeight"in l?l.getEdgeWeight:"weight").fromEntry,h=typeof l.outputReducer=="function"?l.outputReducer:null,g=t.assign({},i,l.settings),y=t.validateSettings(g);if(y)throw new Error("graphology-layout-forceatlas2: "+y.message);var p=t.graphToByteArrays(c,f),_;for(_=0;_<d;_++)n(g,p.nodes,p.edges);if(u){t.assignLayoutChanges(c,p.nodes,h);return}return t.collectLayoutChanges(c,p.nodes)}function s(u){var c=typeof u=="number"?u:u.order;return{barnesHutOptimize:c>2e3,strongGravityMode:!0,gravity:.05,scalingRatio:10,slowDown:1+Math.log(c)}}var a=o.bind(null,!1);return a.assign=o.bind(null,!0),a.inferSettings=s,cn=a,cn}var aa=sa();const ua=Oe(aa),Fr={arabic:"ar",armenian:"am",bulgarian:"bg",czech:"cz",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"},ca={dutch:/[^A-Za-z0-9_'-]+/gim,english:/[^A-Za-z0-9_'-]+/gim,french:/[^a-z0-9-]+/gim,italian:/[^A-Za-z0-9_'-]+/gim,norwegian:/[^a-z0-9_]+/gim,portuguese:/[^a-z0-9--]/gim,russian:/[^a-z0-9--]+/gim,spanish:/[^a-z0-9A-Z--]+/gim,swedish:/[^a-z0-9_-]+/gim,german:/[^a-z0-9A-Z]+/gim,finnish:/[^a-z0-9]+/gim,danish:/[^a-z0-9]+/gim,hungarian:/[^a-z0-9]+/gim,romanian:/[^a-z0-9]+/gim,serbian:/[^a-z0-9]+/gim,turkish:/[^a-z0-9]+/gim,lithuanian:/[^a-z0-9]+/gim,arabic:/[^a-z0-9-]+/gim,nepali:/[^a-z0-9-]+/gim,irish:/[^a-z0-9]+/gim,indian:/[^a-z0-9-]+/gim,armenian:/[^a-z0-9-]+/gim,greek:/[^a-z0-9--]+/gim,indonesian:/[^a-z0-9]+/gim,ukrainian:/[^a-z0-9--]+/gim,slovenian:/[^a-z0-9]+/gim,bulgarian:/[^a-z0-9--]+/gim,tamil:/[^a-z0-9-]+/gim,sanskrit:/[^a-z0-9A-Z]+/gim,czech:/[^A-Z0-9a-z-]+/gim},ln=Object.keys(Fr);function la(r){return r!==void 0&&ln.includes(r)?Fr[r]:void 0}const da=Date.now().toString().slice(5);let ha=0;const zr=BigInt(1e3),Mr=BigInt(1e6),Ur=BigInt(1e9),dn=65535;function $r(r,e){if(e.length<dn)Array.prototype.push.apply(r,e);else{const n=e.length;for(let t=0;t<n;t+=dn)Array.prototype.push.apply(r,e.slice(t,t+dn))}}function fa(r,...e){return r.replace(/%(?:(?<position>\d+)\$)?(?<width>-?\d*\.?\d*)(?<type>[dfs])/g,function(...n){const t=n[n.length-1],{width:i,type:o,position:s}=t,a=s?e[Number.parseInt(s)-1]:e.shift(),u=i===""?0:Number.parseInt(i);switch(o){case"d":return a.toString().padStart(u,"0");case"f":{let c=a;const[l,d]=i.split(".").map(f=>Number.parseFloat(f));return typeof d=="number"&&d>=0&&(c=c.toFixed(d)),typeof l=="number"&&l>=0?c.toString().padStart(u,"0"):c.toString()}case"s":return u<0?a.toString().padEnd(-u," "):a.toString().padStart(u," ");default:return a}})}function ga(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function pa(){return typeof process<"u"&&process.release&&process.release.name==="node"}function Br(){return BigInt(Math.floor(performance.now()*1e6))}function hn(r){return typeof r=="number"&&(r=BigInt(r)),r<zr?`${r}ns`:r<Mr?`${r/zr}s`:r<Ur?`${r/Mr}ms`:`${r/Ur}s`}function Qe(){var r;return ga()?Br():pa()||typeof process<"u"&&typeof((r=process==null?void 0:process.hrtime)==null?void 0:r.bigint)=="function"?process.hrtime.bigint():typeof performance<"u"?Br():BigInt(0)}function Wr(){return`${da}-${ha++}`}function fn(r,e){return Object.hasOwn===void 0?Object.prototype.hasOwnProperty.call(r,e)?r[e]:void 0:Object.hasOwn(r,e)?r[e]:void 0}function Hr(r,e){return e[1]===r[1]?r[0]-e[0]:e[1]-r[1]}function ma(r){if(r.length===0)return[];if(r.length===1)return r[0];for(let n=1;n<r.length;n++)if(r[n].length<r[0].length){const t=r[0];r[0]=r[n],r[n]=t}const e=new Map;for(const n of r[0])e.set(n,1);for(let n=1;n<r.length;n++){let t=0;for(const i of r[n]){const o=e.get(i);o===n&&(e.set(i,o+1),t++)}if(t===0)return[]}return r[0].filter(n=>{const t=e.get(n);return t!==void 0&&e.set(n,0),t===r.length})}function Vr(r,e){const n={},t=e.length;for(let i=0;i<t;i++){const o=e[i],s=o.split(".");let a=r;const u=s.length;for(let c=0;c<u;c++)if(a=a[s[c]],typeof a=="object"){if(a!==null&&"lat"in a&&"lon"in a&&typeof a.lat=="number"&&typeof a.lon=="number"){a=n[o]=a;break}else if(!Array.isArray(a)&&a!==null&&c===u-1){a=void 0;break}}else if((a===null||typeof a!="object")&&c<u-1){a=void 0;break}typeof a<"u"&&(n[o]=a)}return n}function gn(r,e){return Vr(r,[e])[e]}const ya={cm:.01,m:1,km:1e3,ft:.3048,yd:.9144,mi:1609.344};function jr(r,e){const n=ya[e];if(n===void 0)throw new Error(W("INVALID_DISTANCE_SUFFIX",r).message);return r*n}function Yr(r,e){r.hits=r.hits.map(n=>({...n,document:{...n.document,...e.reduce((t,i)=>{const o=i.split("."),s=o.pop();let a=t;for(const u of o)a[u]=a[u]??{},a=a[u];return a[s]=null,t},n.document)}}))}function ke(r){var e;return Array.isArray(r)?r.some(n=>ke(n)):((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="AsyncFunction"}const Kr="intersection"in new Set;function qr(...r){if(r.length===0)return new Set;if(r.length===1)return r[0];if(r.length===2){const t=r[0],i=r[1];if(Kr)return t.intersection(i);const o=new Set,s=t.size<i.size?t:i,a=s===t?i:t;for(const u of s)a.has(u)&&o.add(u);return o}const e={index:0,size:r[0].size};for(let t=1;t<r.length;t++)r[t].size<e.size&&(e.index=t,e.size=r[t].size);if(Kr){let t=r[e.index];for(let i=0;i<r.length;i++)i!==e.index&&(t=t.intersection(r[i]));return t}const n=r[e.index];for(let t=0;t<r.length;t++){if(t===e.index)continue;const i=r[t];for(const o of n)i.has(o)||n.delete(o)}return n}const va="union"in new Set;function Et(r,e){return va?r?r.union(e):e:r?new Set([...r,...e]):new Set(e)}function ba(r,e){const n=new Set;for(const t of r)e.has(t)||n.add(t);return n}const wa={NO_LANGUAGE_WITH_CUSTOM_TOKENIZER:"Do not pass the language option to create when using a custom tokenizer.",LANGUAGE_NOT_SUPPORTED:`Language "%s" is not supported.
Supported languages are:
 - ${ln.join(`
 - `)}`,INVALID_STEMMER_FUNCTION_TYPE:"config.stemmer property must be a function.",MISSING_STEMMER:'As of version 1.0.0 @orama/orama does not ship non English stemmers by default. To solve this, please explicitly import and specify the "%s" stemmer from the package @orama/stemmers. See https://docs.orama.com/docs/orama-js/text-analysis/stemming for more information.',CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY:"Custom stop words array must only contain strings.",UNSUPPORTED_COMPONENT:'Unsupported component "%s".',COMPONENT_MUST_BE_FUNCTION:'The component "%s" must be a function.',COMPONENT_MUST_BE_FUNCTION_OR_ARRAY_FUNCTIONS:'The component "%s" must be a function or an array of functions.',INVALID_SCHEMA_TYPE:'Unsupported schema type "%s" at "%s". Expected "string", "boolean" or "number" or array of them.',DOCUMENT_ID_MUST_BE_STRING:'Document id must be of type "string". Got "%s" instead.',DOCUMENT_ALREADY_EXISTS:'A document with id "%s" already exists.',DOCUMENT_DOES_NOT_EXIST:'A document with id "%s" does not exists.',MISSING_DOCUMENT_PROPERTY:'Missing searchable property "%s".',INVALID_DOCUMENT_PROPERTY:'Invalid document property "%s": expected "%s", got "%s"',UNKNOWN_INDEX:'Invalid property name "%s". Expected a wildcard string ("*") or array containing one of the following properties: %s',INVALID_BOOST_VALUE:"Boost value must be a number greater than, or less than 0.",INVALID_FILTER_OPERATION:"You can only use one operation per filter, you requested %d.",SCHEMA_VALIDATION_FAILURE:'Cannot insert document due schema validation failure on "%s" property.',INVALID_SORT_SCHEMA_TYPE:'Unsupported sort schema type "%s" at "%s". Expected "string" or "number".',CANNOT_SORT_BY_ARRAY:'Cannot configure sort for "%s" because it is an array (%s).',UNABLE_TO_SORT_ON_UNKNOWN_FIELD:'Unable to sort on unknown field "%s". Allowed fields: %s',SORT_DISABLED:"Sort is disabled. Please read the documentation at https://docs.orama.com/docs/orama-js for more information.",UNKNOWN_GROUP_BY_PROPERTY:'Unknown groupBy property "%s".',INVALID_GROUP_BY_PROPERTY:'Invalid groupBy property "%s". Allowed types: "%s", but given "%s".',UNKNOWN_FILTER_PROPERTY:'Unknown filter property "%s".',UNKNOWN_VECTOR_PROPERTY:'Unknown vector property "%s". Make sure the property exists in the schema and is configured as a vector.',INVALID_VECTOR_SIZE:'Vector size must be a number greater than 0. Got "%s" instead.',INVALID_VECTOR_VALUE:'Vector value must be a number greater than 0. Got "%s" instead.',INVALID_INPUT_VECTOR:`Property "%s" was declared as a %s-dimensional vector, but got a %s-dimensional vector instead.
Input vectors must be of the size declared in the schema, as calculating similarity between vectors of different sizes can lead to unexpected results.`,WRONG_SEARCH_PROPERTY_TYPE:'Property "%s" is not searchable. Only "string" properties are searchable.',FACET_NOT_SUPPORTED:`Facet doens't support the type "%s".`,INVALID_DISTANCE_SUFFIX:'Invalid distance suffix "%s". Valid suffixes are: cm, m, km, mi, yd, ft.',INVALID_SEARCH_MODE:'Invalid search mode "%s". Valid modes are: "fulltext", "vector", "hybrid".',MISSING_VECTOR_AND_SECURE_PROXY:"No vector was provided and no secure proxy was configured. Please provide a vector or configure an Orama Secure Proxy to perform hybrid search.",MISSING_TERM:'"term" is a required parameter when performing hybrid search. Please provide a search term.',INVALID_VECTOR_INPUT:'Invalid "vector" property. Expected an object with "value" and "property" properties, but got "%s" instead.',PLUGIN_CRASHED:"A plugin crashed during initialization. Please check the error message for more information:",PLUGIN_SECURE_PROXY_NOT_FOUND:`Could not find '@orama/secure-proxy-plugin' installed in your Orama instance.
Please install it before proceeding with creating an answer session.
Read more at https://docs.orama.com/docs/orama-js/plugins/plugin-secure-proxy#plugin-secure-proxy
`,PLUGIN_SECURE_PROXY_MISSING_CHAT_MODEL:`Could not find a chat model defined in the secure proxy plugin configuration.
Please provide a chat model before proceeding with creating an answer session.
Read more at https://docs.orama.com/docs/orama-js/plugins/plugin-secure-proxy#plugin-secure-proxy
`,ANSWER_SESSION_LAST_MESSAGE_IS_NOT_ASSISTANT:"The last message in the session is not an assistant message. Cannot regenerate non-assistant messages.",PLUGIN_COMPONENT_CONFLICT:'The component "%s" is already defined. The plugin "%s" is trying to redefine it.'};function W(r,...e){const n=new Error(fa(wa[r]??`Unsupported Orama Error code: ${r}`,...e));return n.code=r,"captureStackTrace"in Error.prototype&&Error.captureStackTrace(n),n}function Ea(r){return{raw:Number(r),formatted:hn(r)}}function Sa(r){if(r.id){if(typeof r.id!="string")throw W("DOCUMENT_ID_MUST_BE_STRING",typeof r.id);return r.id}return Wr()}function Zr(r,e){for(const[n,t]of Object.entries(e)){const i=r[n];if(!(typeof i>"u")&&!(t==="geopoint"&&typeof i=="object"&&typeof i.lon=="number"&&typeof i.lat=="number")&&!(t==="enum"&&(typeof i=="string"||typeof i=="number"))){if(t==="enum[]"&&Array.isArray(i)){const o=i.length;for(let s=0;s<o;s++)if(typeof i[s]!="string"&&typeof i[s]!="number")return n+"."+s;continue}if(et(t)){const o=Jr(t);if(!Array.isArray(i)||i.length!==o)throw W("INVALID_INPUT_VECTOR",n,o,i.length);continue}if(St(t)){if(!Array.isArray(i))return n;const o=Xr(t),s=i.length;for(let a=0;a<s;a++)if(typeof i[a]!==o)return n+"."+a;continue}if(typeof t=="object"){if(!i||typeof i!="object")return n;const o=Zr(i,t);if(o)return n+"."+o;continue}if(typeof i!==t)return n}}}const Ta={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},_a={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function Aa(r){return r==="geopoint"}function et(r){return typeof r=="string"&&/^vector\[\d+\]$/.test(r)}function St(r){return typeof r=="string"&&Ta[r]}function Xr(r){return _a[r]}function Jr(r){const e=Number(r.slice(7,-1));switch(!0){case isNaN(e):throw W("INVALID_VECTOR_VALUE",r);case e<=0:throw W("INVALID_VECTOR_SIZE",r);default:return e}}function Da(){return{idToInternalId:new Map,internalIdToId:[],save:Ra,load:ka}}function Ra(r){return{internalIdToId:r.internalIdToId}}function ka(r,e){const{internalIdToId:n}=e;r.internalDocumentIDStore.idToInternalId.clear(),r.internalDocumentIDStore.internalIdToId=[];const t=n.length;for(let i=0;i<t;i++){const o=n[i];r.internalDocumentIDStore.idToInternalId.set(o,i+1),r.internalDocumentIDStore.internalIdToId.push(o)}}function he(r,e){if(typeof e=="string"){const n=r.idToInternalId.get(e);if(n)return n;const t=r.idToInternalId.size+1;return r.idToInternalId.set(e,t),r.internalIdToId.push(e),t}return e>r.internalIdToId.length?he(r,e.toString()):e}function Tt(r,e){if(r.internalIdToId.length<e)throw new Error(`Invalid internalId ${e}`);return r.internalIdToId[e-1]}function La(r,e){return{sharedInternalDocumentStore:e,docs:{},count:0}}function Ca(r,e){const n=he(r.sharedInternalDocumentStore,e);return r.docs[n]}function Ia(r,e){const n=e.length,t=Array.from({length:n});for(let i=0;i<n;i++){const o=he(r.sharedInternalDocumentStore,e[i]);t[i]=r.docs[o]}return t}function Na(r){return r.docs}function xa(r,e,n,t){return typeof r.docs[n]<"u"?!1:(r.docs[n]=t,r.count++,!0)}function Pa(r,e){const n=he(r.sharedInternalDocumentStore,e);return typeof r.docs[n]>"u"?!1:(delete r.docs[n],r.count--,!0)}function Oa(r){return r.count}function Ga(r,e){const n=e;return{docs:n.docs,count:n.count,sharedInternalDocumentStore:r}}function Fa(r){return{docs:r.docs,count:r.count}}function za(){return{create:La,get:Ca,getMultiple:Ia,getAll:Na,store:xa,remove:Pa,count:Oa,load:Ga,save:Fa}}const Ma=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeUpsert","afterUpsert","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeUpsertMultiple","afterUpsertMultiple","beforeLoad","afterLoad","afterCreate"];function Ua(r,e){var i;const n=[],t=(i=r.plugins)==null?void 0:i.length;if(!t)return n;for(let o=0;o<t;o++)try{const s=r.plugins[o];typeof s[e]=="function"&&n.push(s[e])}catch(s){throw console.error("Caught error in getAllPluginsByHook:",s),W("PLUGIN_CRASHED")}return n}const $a=["tokenizer","index","documentsStore","sorter","pinning"],Qr=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];function _t(r,e,n,t){if(r.some(ke))return(async()=>{for(const o of r)await o(e,n,t)})();for(const o of r)o(e,n,t)}function pn(r,e,n,t,i){if(r.some(ke))return(async()=>{for(const s of r)await s(e,n,t,i)})();for(const s of r)s(e,n,t,i)}function mn(r,e,n,t){if(r.some(ke))return(async()=>{for(const o of r)await o(e,n,t)})();for(const o of r)o(e,n,t)}function Ba(r,e){if(r.some(ke))return(async()=>{for(const t of r)await t(e)})();for(const t of r)t(e)}class me{constructor(e,n){J(this,"k");J(this,"v");J(this,"l",null);J(this,"r",null);J(this,"h",1);this.k=e,this.v=new Set(n)}updateHeight(){this.h=Math.max(me.getHeight(this.l),me.getHeight(this.r))+1}static getHeight(e){return e?e.h:0}getBalanceFactor(){return me.getHeight(this.l)-me.getHeight(this.r)}rotateLeft(){const e=this.r;return this.r=e.l,e.l=this,this.updateHeight(),e.updateHeight(),e}rotateRight(){const e=this.l;return this.l=e.r,e.r=this,this.updateHeight(),e.updateHeight(),e}toJSON(){return{k:this.k,v:Array.from(this.v),l:this.l?this.l.toJSON():null,r:this.r?this.r.toJSON():null,h:this.h}}static fromJSON(e){const n=new me(e.k,e.v);return n.l=e.l?me.fromJSON(e.l):null,n.r=e.r?me.fromJSON(e.r):null,n.h=e.h,n}}class At{constructor(e,n){J(this,"root",null);J(this,"insertCount",0);e!==void 0&&n!==void 0&&(this.root=new me(e,n))}insert(e,n,t=1e3){this.root=this.insertNode(this.root,e,n,t)}insertMultiple(e,n,t=1e3){for(const i of n)this.insert(e,i,t)}rebalance(){this.root&&(this.root=this.rebalanceNode(this.root))}toJSON(){return{root:this.root?this.root.toJSON():null,insertCount:this.insertCount}}static fromJSON(e){const n=new At;return n.root=e.root?me.fromJSON(e.root):null,n.insertCount=e.insertCount||0,n}insertNode(e,n,t,i){if(e===null)return new me(n,[t]);const o=[];let s=e,a=null;for(;s!==null;)if(o.push({parent:a,node:s}),n<s.k)if(s.l===null){s.l=new me(n,[t]),o.push({parent:s,node:s.l});break}else a=s,s=s.l;else if(n>s.k)if(s.r===null){s.r=new me(n,[t]),o.push({parent:s,node:s.r});break}else a=s,s=s.r;else return s.v.add(t),e;let u=!1;this.insertCount++%i===0&&(u=!0);for(let c=o.length-1;c>=0;c--){const{parent:l,node:d}=o[c];if(d.updateHeight(),u){const f=this.rebalanceNode(d);l?l.l===d?l.l=f:l.r===d&&(l.r=f):e=f}}return e}rebalanceNode(e){const n=e.getBalanceFactor();if(n>1){if(e.l&&e.l.getBalanceFactor()>=0)return e.rotateRight();if(e.l)return e.l=e.l.rotateLeft(),e.rotateRight()}if(n<-1){if(e.r&&e.r.getBalanceFactor()<=0)return e.rotateLeft();if(e.r)return e.r=e.r.rotateRight(),e.rotateLeft()}return e}find(e){const n=this.findNodeByKey(e);return n?n.v:null}contains(e){return this.find(e)!==null}getSize(){let e=0;const n=[];let t=this.root;for(;t||n.length>0;){for(;t;)n.push(t),t=t.l;t=n.pop(),e++,t=t.r}return e}isBalanced(){if(!this.root)return!0;const e=[this.root];for(;e.length>0;){const n=e.pop(),t=n.getBalanceFactor();if(Math.abs(t)>1)return!1;n.l&&e.push(n.l),n.r&&e.push(n.r)}return!0}remove(e){this.root=this.removeNode(this.root,e)}removeDocument(e,n){const t=this.findNodeByKey(e);t&&(t.v.size===1?this.root=this.removeNode(this.root,e):t.v=new Set([...t.v.values()].filter(i=>i!==n)))}findNodeByKey(e){let n=this.root;for(;n;)if(e<n.k)n=n.l;else if(e>n.k)n=n.r;else return n;return null}removeNode(e,n){if(e===null)return null;const t=[];let i=e;for(;i!==null&&i.k!==n;)t.push(i),n<i.k?i=i.l:i=i.r;if(i===null)return e;if(i.l===null||i.r===null){const o=i.l?i.l:i.r;if(t.length===0)e=o;else{const s=t[t.length-1];s.l===i?s.l=o:s.r=o}}else{let o=i,s=i.r;for(;s.l!==null;)o=s,s=s.l;i.k=s.k,i.v=s.v,o.l===s?o.l=s.r:o.r=s.r,i=o}t.push(i);for(let o=t.length-1;o>=0;o--){const s=t[o];s.updateHeight();const a=this.rebalanceNode(s);if(o>0){const u=t[o-1];u.l===s?u.l=a:u.r===s&&(u.r=a)}else e=a}return e}rangeSearch(e,n){const t=new Set,i=[];let o=this.root;for(;o||i.length>0;){for(;o;)i.push(o),o=o.l;if(o=i.pop(),o.k>=e&&o.k<=n)for(const s of o.v)t.add(s);if(o.k>n)break;o=o.r}return t}greaterThan(e,n=!1){const t=new Set,i=[];let o=this.root;for(;o||i.length>0;){for(;o;)i.push(o),o=o.r;if(o=i.pop(),n&&o.k>=e||!n&&o.k>e)for(const s of o.v)t.add(s);else if(o.k<=e)break;o=o.l}return t}lessThan(e,n=!1){const t=new Set,i=[];let o=this.root;for(;o||i.length>0;){for(;o;)i.push(o),o=o.l;if(o=i.pop(),n&&o.k<=e||!n&&o.k<e)for(const s of o.v)t.add(s);else if(o.k>e)break;o=o.r}return t}}class Dt{constructor(){J(this,"numberToDocumentId");this.numberToDocumentId=new Map}insert(e,n){this.numberToDocumentId.has(e)?this.numberToDocumentId.get(e).add(n):this.numberToDocumentId.set(e,new Set([n]))}find(e){const n=this.numberToDocumentId.get(e);return n?Array.from(n):null}remove(e){this.numberToDocumentId.delete(e)}removeDocument(e,n){const t=this.numberToDocumentId.get(n);t&&(t.delete(e),t.size===0&&this.numberToDocumentId.delete(n))}contains(e){return this.numberToDocumentId.has(e)}getSize(){let e=0;for(const n of this.numberToDocumentId.values())e+=n.size;return e}filter(e){const n=Object.keys(e);if(n.length!==1)throw new Error("Invalid operation");const t=n[0];switch(t){case"eq":{const i=e[t],o=this.numberToDocumentId.get(i);return o?Array.from(o):[]}case"in":{const i=e[t],o=new Set;for(const s of i){const a=this.numberToDocumentId.get(s);if(a)for(const u of a)o.add(u)}return Array.from(o)}case"nin":{const i=new Set(e[t]),o=new Set;for(const[s,a]of this.numberToDocumentId.entries())if(!i.has(s))for(const u of a)o.add(u);return Array.from(o)}default:throw new Error("Invalid operation")}}filterArr(e){const n=Object.keys(e);if(n.length!==1)throw new Error("Invalid operation");const t=n[0];switch(t){case"containsAll":{const o=e[t].map(a=>this.numberToDocumentId.get(a)??new Set);if(o.length===0)return[];const s=o.reduce((a,u)=>new Set([...a].filter(c=>u.has(c))));return Array.from(s)}case"containsAny":{const o=e[t].map(a=>this.numberToDocumentId.get(a)??new Set);if(o.length===0)return[];const s=o.reduce((a,u)=>new Set([...a,...u]));return Array.from(s)}default:throw new Error("Invalid operation")}}static fromJSON(e){if(!e.numberToDocumentId)throw new Error("Invalid Flat Tree JSON");const n=new Dt;for(const[t,i]of e.numberToDocumentId)n.numberToDocumentId.set(t,new Set(i));return n}toJSON(){return{numberToDocumentId:Array.from(this.numberToDocumentId.entries()).map(([e,n])=>[e,Array.from(n)])}}}function Wa(r,e,n){if(n<0)return-1;if(r===e)return 0;const t=r.length,i=e.length;if(t===0)return i<=n?i:-1;if(i===0)return t<=n?t:-1;const o=Math.abs(t-i);if(r.startsWith(e))return o<=n?o:-1;if(e.startsWith(r))return 0;if(o>n)return-1;const s=[];for(let a=0;a<=t;a++){s[a]=[a];for(let u=1;u<=i;u++)s[a][u]=a===0?u:0}for(let a=1;a<=t;a++){let u=1/0;for(let c=1;c<=i;c++)r[a-1]===e[c-1]?s[a][c]=s[a-1][c-1]:s[a][c]=Math.min(s[a-1][c]+1,s[a][c-1]+1,s[a-1][c-1]+1),u=Math.min(u,s[a][c]);if(u>n)return-1}return s[t][i]<=n?s[t][i]:-1}function ei(r,e,n){const t=Wa(r,e,n);return{distance:t,isBounded:t>=0}}class Fe{constructor(e,n,t){J(this,"k");J(this,"s");J(this,"c",new Map);J(this,"d",new Set);J(this,"e");J(this,"w","");this.k=e,this.s=n,this.e=t}updateParent(e){this.w=e.w+this.s}addDocument(e){this.d.add(e)}removeDocument(e){return this.d.delete(e)}findAllWords(e,n,t,i){const o=[this];for(;o.length>0;){const s=o.pop();if(s.e){const{w:a,d:u}=s;if(t&&a!==n)continue;if(fn(e,a)!==null)if(i)if(Math.abs(n.length-a.length)<=i&&ei(n,a,i).isBounded)e[a]=[];else continue;else e[a]=[];if(fn(e,a)!=null&&u.size>0){const c=e[a];for(const l of u)c.includes(l)||c.push(l)}}s.c.size>0&&o.push(...s.c.values())}return e}insert(e,n){let t=this,i=0;const o=e.length;for(;i<o;){const s=e[i],a=t.c.get(s);if(a){const u=a.s,c=u.length;let l=0;for(;l<c&&i+l<o&&u[l]===e[i+l];)l++;if(l===c){if(t=a,i+=l,i===o){a.e||(a.e=!0),a.addDocument(n);return}continue}const d=u.slice(0,l),f=u.slice(l),h=e.slice(i+l),g=new Fe(d[0],d,!1);if(t.c.set(d[0],g),g.updateParent(t),a.s=f,a.k=f[0],g.c.set(f[0],a),a.updateParent(g),h){const y=new Fe(h[0],h,!0);y.addDocument(n),g.c.set(h[0],y),y.updateParent(g)}else g.e=!0,g.addDocument(n);return}else{const u=new Fe(s,e.slice(i),!0);u.addDocument(n),t.c.set(s,u),u.updateParent(t);return}}t.e||(t.e=!0),t.addDocument(n)}_findLevenshtein(e,n,t,i,o){const s=[{node:this,index:n,tolerance:t}];for(;s.length>0;){const{node:a,index:u,tolerance:c}=s.pop();if(a.w.startsWith(e)){a.findAllWords(o,e,!1,0);continue}if(c<0)continue;if(a.e){const{w:d,d:f}=a;if(d&&(ei(e,d,i).isBounded&&(o[d]=[]),fn(o,d)!==void 0&&f.size>0)){const h=new Set(o[d]);for(const g of f)h.add(g);o[d]=Array.from(h)}}if(u>=e.length)continue;const l=e[u];if(a.c.has(l)){const d=a.c.get(l);s.push({node:d,index:u+1,tolerance:c})}s.push({node:a,index:u+1,tolerance:c-1});for(const[d,f]of a.c)s.push({node:f,index:u,tolerance:c-1}),d!==l&&s.push({node:f,index:u+1,tolerance:c-1})}}find(e){const{term:n,exact:t,tolerance:i}=e;if(i&&!t){const o={};return this._findLevenshtein(n,0,i,i,o),o}else{let o=this,s=0;const a=n.length;for(;s<a;){const c=n[s],l=o.c.get(c);if(l){const d=l.s,f=d.length;let h=0;for(;h<f&&s+h<a&&d[h]===n[s+h];)h++;if(h===f)o=l,s+=h;else if(s+h===a)if(h===a-s){if(t)return{};{const g={};return l.findAllWords(g,n,t,i),g}}else return{};else return{}}else return{}}const u={};return o.findAllWords(u,n,t,i),u}}contains(e){let n=this,t=0;const i=e.length;for(;t<i;){const o=e[t],s=n.c.get(o);if(s){const a=s.s,u=a.length;let c=0;for(;c<u&&t+c<i&&a[c]===e[t+c];)c++;if(c<u)return!1;t+=u,n=s}else return!1}return!0}removeWord(e){if(!e)return!1;let n=this;const t=e.length,i=[];for(let o=0;o<t;o++){const s=e[o];if(n.c.has(s)){const a=n.c.get(s);i.push({parent:n,character:s}),o+=a.s.length-1,n=a}else return!1}for(n.d.clear(),n.e=!1;i.length>0&&n.c.size===0&&!n.e&&n.d.size===0;){const{parent:o,character:s}=i.pop();o.c.delete(s),n=o}return!0}removeDocumentByWord(e,n,t=!0){if(!e)return!0;let i=this;const o=e.length;for(let s=0;s<o;s++){const a=e[s];if(i.c.has(a)){const u=i.c.get(a);s+=u.s.length-1,i=u,t&&i.w!==e||i.removeDocument(n)}else return!1}return!0}static getCommonPrefix(e,n){const t=Math.min(e.length,n.length);let i=0;for(;i<t&&e.charCodeAt(i)===n.charCodeAt(i);)i++;return e.slice(0,i)}toJSON(){var e,n;return{w:this.w,s:this.s,e:this.e,k:this.k,d:Array.from(this.d),c:(n=Array.from((e=this.c)==null?void 0:e.entries()))==null?void 0:n.map(([t,i])=>[t,i.toJSON()])}}static fromJSON(e){var t;const n=new Fe(e.k,e.s,e.e);return n.w=e.w,n.d=new Set(e.d),n.c=new Map(((t=e==null?void 0:e.c)==null?void 0:t.map(([i,o])=>[i,Fe.fromJSON(o)]))||[]),n}}class Rt extends Fe{constructor(){super("","",!1)}static fromJSON(e){var t;const n=new Rt;return n.w=e.w,n.s=e.s,n.e=e.e,n.k=e.k,n.d=new Set(e.d),n.c=new Map(((t=e==null?void 0:e.c)==null?void 0:t.map(([i,o])=>[i,Fe.fromJSON(o)]))||[]),n}toJSON(){return super.toJSON()}}const Ha=2,Va=6371e3;class tt{constructor(e,n){J(this,"point");J(this,"docIDs");J(this,"left");J(this,"right");J(this,"parent");this.point=e,this.docIDs=new Set(n),this.left=null,this.right=null,this.parent=null}toJSON(){return{point:this.point,docIDs:Array.from(this.docIDs),left:this.left?this.left.toJSON():null,right:this.right?this.right.toJSON():null}}static fromJSON(e,n=null){const t=new tt(e.point,e.docIDs);return t.parent=n,e.left&&(t.left=tt.fromJSON(e.left,t)),e.right&&(t.right=tt.fromJSON(e.right,t)),t}}class ye{constructor(){J(this,"root");J(this,"nodeMap");this.root=null,this.nodeMap=new Map}getPointKey(e){return`${e.lon},${e.lat}`}insert(e,n){const t=this.getPointKey(e),i=this.nodeMap.get(t);if(i){n.forEach(u=>i.docIDs.add(u));return}const o=new tt(e,n);if(this.nodeMap.set(t,o),this.root==null){this.root=o;return}let s=this.root,a=0;for(;;){if(a%Ha===0)if(e.lon<s.point.lon){if(s.left==null){s.left=o,o.parent=s;return}s=s.left}else{if(s.right==null){s.right=o,o.parent=s;return}s=s.right}else if(e.lat<s.point.lat){if(s.left==null){s.left=o,o.parent=s;return}s=s.left}else{if(s.right==null){s.right=o,o.parent=s;return}s=s.right}a++}}contains(e){const n=this.getPointKey(e);return this.nodeMap.has(n)}getDocIDsByCoordinates(e){const n=this.getPointKey(e),t=this.nodeMap.get(n);return t?Array.from(t.docIDs):null}removeDocByID(e,n){const t=this.getPointKey(e),i=this.nodeMap.get(t);i&&(i.docIDs.delete(n),i.docIDs.size===0&&(this.nodeMap.delete(t),this.deleteNode(i)))}deleteNode(e){const n=e.parent,t=e.left?e.left:e.right;t&&(t.parent=n),n?n.left===e?n.left=t:n.right===e&&(n.right=t):(this.root=t,this.root&&(this.root.parent=null))}searchByRadius(e,n,t=!0,i="asc",o=!1){const s=o?ye.vincentyDistance:ye.haversineDistance,a=[{node:this.root,depth:0}],u=[];for(;a.length>0;){const{node:c,depth:l}=a.pop();if(c==null)continue;const d=s(e,c.point);(t?d<=n:d>n)&&u.push({point:c.point,docIDs:Array.from(c.docIDs)}),c.left!=null&&a.push({node:c.left,depth:l+1}),c.right!=null&&a.push({node:c.right,depth:l+1})}return i&&u.sort((c,l)=>{const d=s(e,c.point),f=s(e,l.point);return i.toLowerCase()==="asc"?d-f:f-d}),u}searchByPolygon(e,n=!0,t=null,i=!1){const o=[{node:this.root,depth:0}],s=[];for(;o.length>0;){const{node:u,depth:c}=o.pop();if(u==null)continue;u.left!=null&&o.push({node:u.left,depth:c+1}),u.right!=null&&o.push({node:u.right,depth:c+1});const l=ye.isPointInPolygon(e,u.point);(l&&n||!l&&!n)&&s.push({point:u.point,docIDs:Array.from(u.docIDs)})}const a=ye.calculatePolygonCentroid(e);if(t){const u=i?ye.vincentyDistance:ye.haversineDistance;s.sort((c,l)=>{const d=u(a,c.point),f=u(a,l.point);return t.toLowerCase()==="asc"?d-f:f-d})}return s}toJSON(){return{root:this.root?this.root.toJSON():null}}static fromJSON(e){const n=new ye;return e.root&&(n.root=tt.fromJSON(e.root),n.buildNodeMap(n.root)),n}buildNodeMap(e){if(e==null)return;const n=this.getPointKey(e.point);this.nodeMap.set(n,e),e.left&&this.buildNodeMap(e.left),e.right&&this.buildNodeMap(e.right)}static calculatePolygonCentroid(e){let n=0,t=0,i=0;const o=e.length;for(let a=0,u=o-1;a<o;u=a++){const c=e[a].lon,l=e[a].lat,d=e[u].lon,f=e[u].lat,h=c*f-d*l;n+=h,t+=(c+d)*h,i+=(l+f)*h}n/=2;const s=6*n;return t/=s,i/=s,{lon:t,lat:i}}static isPointInPolygon(e,n){let t=!1;const i=n.lon,o=n.lat,s=e.length;for(let a=0,u=s-1;a<s;u=a++){const c=e[a].lon,l=e[a].lat,d=e[u].lon,f=e[u].lat;l>o!=f>o&&i<(d-c)*(o-l)/(f-l)+c&&(t=!t)}return t}static haversineDistance(e,n){const t=Math.PI/180,i=e.lat*t,o=n.lat*t,s=(n.lat-e.lat)*t,a=(n.lon-e.lon)*t,u=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i)*Math.cos(o)*Math.sin(a/2)*Math.sin(a/2),c=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return Va*c}static vincentyDistance(e,n){const i=.0033528106647474805,o=(1-i)*6378137,s=Math.PI/180,a=e.lat*s,u=n.lat*s,c=(n.lon-e.lon)*s,l=Math.atan((1-i)*Math.tan(a)),d=Math.atan((1-i)*Math.tan(u)),f=Math.sin(l),h=Math.cos(l),g=Math.sin(d),y=Math.cos(d);let p=c,_,E=1e3,b,m,T,D,k,x;do{const Y=Math.sin(p),Z=Math.cos(p);if(b=Math.sqrt(y*Y*(y*Y)+(h*g-f*y*Z)*(h*g-f*y*Z)),b===0)return 0;m=f*g+h*y*Z,T=Math.atan2(b,m),D=h*y*Y/b,k=1-D*D,x=m-2*f*g/k,isNaN(x)&&(x=0);const N=i/16*k*(4+i*(4-3*k));_=p,p=c+(1-N)*i*D*(T+N*b*(x+N*m*(-1+2*x*x)))}while(Math.abs(p-_)>1e-12&&--E>0);if(E===0)return NaN;const G=k*(6378137*6378137-o*o)/(o*o),z=1+G/16384*(4096+G*(-768+G*(320-175*G))),H=G/1024*(256+G*(-128+G*(74-47*G))),$=H*b*(x+H/4*(m*(-1+2*x*x)-H/6*x*(-3+4*b*b)*(-3+4*x*x)));return o*z*(T-$)}}class kt{constructor(){J(this,"true");J(this,"false");this.true=new Set,this.false=new Set}insert(e,n){n?this.true.add(e):this.false.add(e)}delete(e,n){n?this.true.delete(e):this.false.delete(e)}getSize(){return this.true.size+this.false.size}toJSON(){return{true:Array.from(this.true),false:Array.from(this.false)}}static fromJSON(e){const n=new kt;return n.true=new Set(e.true),n.false=new Set(e.false),n}}function ja(r,e,n,t,i,{k:o,b:s,d:a}){return Math.log(1+(n-e+.5)/(e+.5))*(a+r*(o+1))/(r+o*(1-s+s*t/i))}const Ya=.8;class Lt{constructor(e){J(this,"size");J(this,"vectors",new Map);this.size=e}add(e,n){n instanceof Float32Array||(n=new Float32Array(n));const t=ti(n,this.size);this.vectors.set(e,[t,n])}remove(e){this.vectors.delete(e)}find(e,n,t){return e instanceof Float32Array||(e=new Float32Array(e)),Ka(e,t,this.vectors,this.size,n)}toJSON(){const e=[];for(const[n,[t,i]]of this.vectors)e.push([n,[t,Array.from(i)]]);return{size:this.size,vectors:e}}static fromJSON(e){const n=e,t=new Lt(n.size);for(const[i,[o,s]]of n.vectors)t.vectors.set(i,[o,new Float32Array(s)]);return t}}function ti(r,e){let n=0;for(let t=0;t<e;t++)n+=r[t]*r[t];return Math.sqrt(n)}function Ka(r,e,n,t,i){const o=ti(r,t),s=[],a=e||n.keys();for(const u of a){const c=n.get(u);if(!c)continue;const l=c[0],d=c[1];let f=0;for(let g=0;g<t;g++)f+=r[g]*d[g];const h=f/(o*l);h>=i&&s.push([u,h])}return s}function qa(r,e,n,t,i){const o=he(r.sharedInternalDocumentStore,n);r.avgFieldLength[e]=((r.avgFieldLength[e]??0)*(i-1)+t.length)/i,r.fieldLengths[e][o]=t.length,r.frequencies[e][o]={}}function Za(r,e,n,t,i){let o=0;for(const u of t)u===i&&o++;const s=he(r.sharedInternalDocumentStore,n),a=o/t.length;r.frequencies[e][s][i]=a,i in r.tokenOccurrences[e]||(r.tokenOccurrences[e][i]=0),r.tokenOccurrences[e][i]=(r.tokenOccurrences[e][i]??0)+1}function Xa(r,e,n,t){const i=he(r.sharedInternalDocumentStore,n);t>1?r.avgFieldLength[e]=(r.avgFieldLength[e]*t-r.fieldLengths[e][i])/(t-1):r.avgFieldLength[e]=void 0,r.fieldLengths[e][i]=void 0,r.frequencies[e][i]=void 0}function Ja(r,e,n){r.tokenOccurrences[e][n]--}function ni(r,e,n,t,i=""){t||(t={sharedInternalDocumentStore:e,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}});for(const[o,s]of Object.entries(n)){const a=`${i}${i?".":""}${o}`;if(typeof s=="object"&&!Array.isArray(s)){ni(r,e,s,t,a);continue}if(et(s))t.searchableProperties.push(a),t.searchablePropertiesWithTypes[a]=s,t.vectorIndexes[a]={type:"Vector",node:new Lt(Jr(s)),isArray:!1};else{const u=/\[/.test(s);switch(s){case"boolean":case"boolean[]":t.indexes[a]={type:"Bool",node:new kt,isArray:u};break;case"number":case"number[]":t.indexes[a]={type:"AVL",node:new At(0,[]),isArray:u};break;case"string":case"string[]":t.indexes[a]={type:"Radix",node:new Rt,isArray:u},t.avgFieldLength[a]=0,t.frequencies[a]={},t.tokenOccurrences[a]={},t.fieldLengths[a]={};break;case"enum":case"enum[]":t.indexes[a]={type:"Flat",node:new Dt,isArray:u};break;case"geopoint":t.indexes[a]={type:"BKD",node:new ye,isArray:u};break;default:throw W("INVALID_SCHEMA_TYPE",Array.isArray(s)?"array":s,a)}t.searchableProperties.push(a),t.searchablePropertiesWithTypes[a]=s}}return t}function Qa(r,e,n,t,i,o,s,a){return u=>{const{type:c,node:l}=e.indexes[n];switch(c){case"Bool":{l[u?"true":"false"].add(t);break}case"AVL":{const d=(a==null?void 0:a.avlRebalanceThreshold)??1;l.insert(u,t,d);break}case"Radix":{const d=o.tokenize(u,i,n,!1);r.insertDocumentScoreParameters(e,n,t,d,s);for(const f of d)r.insertTokenScoreParameters(e,n,t,d,f),l.insert(f,t);break}case"Flat":{l.insert(u,t);break}case"BKD":{l.insert(u,[t]);break}}}}function eu(r,e,n,t,i,o,s,a,u,c,l){if(et(s))return tu(e,n,o,t,i);const d=Qa(r,e,n,i,a,u,c,l);if(!St(s))return d(o);const f=o,h=f.length;for(let g=0;g<h;g++)d(f[g])}function tu(r,e,n,t,i){r.vectorIndexes[e].node.add(i,n)}function ri(r,e,n,t,i,o,s,a,u,c){if(et(s))return e.vectorIndexes[n].node.remove(i),!0;const{type:l,node:d}=e.indexes[n];switch(l){case"AVL":return d.removeDocument(o,i),!0;case"Bool":return d[o?"true":"false"].delete(i),!0;case"Radix":{const f=u.tokenize(o,a,n);r.removeDocumentScoreParameters(e,n,t,c);for(const h of f)r.removeTokenScoreParameters(e,n,h),d.removeDocumentByWord(h,i);return!0}case"Flat":return d.removeDocument(i,o),!0;case"BKD":return d.removeDocByID(o,i),!1}}function nu(r,e,n,t,i,o,s,a,u,c){if(!St(s))return ri(r,e,n,t,i,o,s,a,u,c);const l=Xr(s),d=o,f=d.length;for(let h=0;h<f;h++)ri(r,e,n,t,i,d[h],l,a,u,c);return!0}function ii(r,e,n,t,i,o,s,a,u,c){var _;const l=Array.from(t),d=r.avgFieldLength[e],f=r.fieldLengths[e],h=r.tokenOccurrences[e],g=r.frequencies[e],y=typeof h[n]=="number"?h[n]??0:0,p=l.length;for(let E=0;E<p;E++){const b=l[E];if(u&&!u.has(b))continue;c.has(b)||c.set(b,new Map);const m=c.get(b);m.set(e,(m.get(e)||0)+1);const T=((_=g==null?void 0:g[b])==null?void 0:_[n])??0,D=ja(T,y,i,f[b],d,o);s.has(b)?s.set(b,s.get(b)+D*a):s.set(b,D*a)}}function ru(r,e,n,t,i,o,s,a,u,c,l,d=0){const f=n.tokenize(e,t),h=f.length||1,g=new Map,y=new Map,p=new Map;for(const b of i){if(!(b in r.indexes))continue;const m=r.indexes[b],{type:T}=m;if(T!=="Radix")throw W("WRONG_SEARCH_PROPERTY_TYPE",b);const D=a[b]??1;if(D<=0)throw W("INVALID_BOOST_VALUE",D);f.length===0&&!e&&f.push("");const k=f.length;for(let x=0;x<k;x++){const G=f[x],z=m.node.find({term:G,exact:o,tolerance:s}),H=Object.keys(z);H.length>0&&y.set(G,!0);const $=H.length;for(let v=0;v<$;v++){const Y=H[v],Z=z[Y];ii(r,b,Y,Z,c,u,p,D,l,g)}}}const _=Array.from(p.entries()).map(([b,m])=>[b,m]).sort((b,m)=>m[1]-b[1]);if(_.length===0)return[];if(d===1)return _;if(d===0){if(h===1)return _;for(const m of f)if(!y.get(m))return[];return _.filter(([m])=>{const T=g.get(m);return T?Array.from(T.values()).some(D=>D===h):!1})}const E=_.filter(([b])=>{const m=g.get(b);return m?Array.from(m.values()).some(T=>T===h):!1});if(E.length>0){const b=_.filter(([T])=>!E.some(([D])=>D===T)),m=Math.ceil(b.length*d);return[...E,...b.slice(0,m)]}return _}function Ct(r,e,n,t){if("and"in n&&n.and&&Array.isArray(n.and)){const s=n.and;if(s.length===0)return new Set;const a=s.map(u=>Ct(r,e,u,t));return qr(...a)}if("or"in n&&n.or&&Array.isArray(n.or)){const s=n.or;return s.length===0?new Set:s.map(u=>Ct(r,e,u,t)).reduce((u,c)=>Et(u,c),new Set)}if("not"in n&&n.not){const s=n.not,a=new Set,u=r.sharedInternalDocumentStore;for(let l=1;l<=u.internalIdToId.length;l++)a.add(l);const c=Ct(r,e,s,t);return ba(a,c)}const i=Object.keys(n),o=i.reduce((s,a)=>({[a]:new Set,...s}),{});for(const s of i){const a=n[s];if(typeof r.indexes[s]>"u")throw W("UNKNOWN_FILTER_PROPERTY",s);const{node:u,type:c,isArray:l}=r.indexes[s];if(c==="Bool"){const f=u,h=a?f.true:f.false;o[s]=Et(o[s],h);continue}if(c==="BKD"){let f;if("radius"in a)f="radius";else if("polygon"in a)f="polygon";else throw new Error(`Invalid operation ${a}`);if(f==="radius"){const{value:h,coordinates:g,unit:y="m",inside:p=!0,highPrecision:_=!1}=a[f],E=jr(h,y),b=u.searchByRadius(g,E,p,void 0,_);o[s]=oi(o[s],b)}else{const{coordinates:h,inside:g=!0,highPrecision:y=!1}=a[f],p=u.searchByPolygon(h,g,void 0,y);o[s]=oi(o[s],p)}continue}if(c==="Radix"&&(typeof a=="string"||Array.isArray(a))){for(const f of[a].flat()){const h=e.tokenize(f,t,s);for(const g of h){const y=u.find({term:g,exact:!0});o[s]=du(o[s],y)}}continue}const d=Object.keys(a);if(d.length>1)throw W("INVALID_FILTER_OPERATION",d.length);if(c==="Flat"){const f=new Set(l?u.filterArr(a):u.filter(a));o[s]=Et(o[s],f);continue}if(c==="AVL"){const f=d[0],h=a[f];let g;switch(f){case"gt":{g=u.greaterThan(h,!1);break}case"gte":{g=u.greaterThan(h,!0);break}case"lt":{g=u.lessThan(h,!1);break}case"lte":{g=u.lessThan(h,!0);break}case"eq":{g=u.find(h)??new Set;break}case"between":{const[y,p]=h;g=u.rangeSearch(y,p);break}default:throw W("INVALID_FILTER_OPERATION",f)}o[s]=Et(o[s],g)}}return qr(...Object.values(o))}function iu(r){return r.searchableProperties}function ou(r){return r.searchablePropertiesWithTypes}function su(r,e){const{indexes:n,vectorIndexes:t,searchableProperties:i,searchablePropertiesWithTypes:o,frequencies:s,tokenOccurrences:a,avgFieldLength:u,fieldLengths:c}=e,l={},d={};for(const f of Object.keys(n)){const{node:h,type:g,isArray:y}=n[f];switch(g){case"Radix":l[f]={type:"Radix",node:Rt.fromJSON(h),isArray:y};break;case"Flat":l[f]={type:"Flat",node:Dt.fromJSON(h),isArray:y};break;case"AVL":l[f]={type:"AVL",node:At.fromJSON(h),isArray:y};break;case"BKD":l[f]={type:"BKD",node:ye.fromJSON(h),isArray:y};break;case"Bool":l[f]={type:"Bool",node:kt.fromJSON(h),isArray:y};break;default:l[f]=n[f]}}for(const f of Object.keys(t))d[f]={type:"Vector",isArray:!1,node:Lt.fromJSON(t[f])};return{sharedInternalDocumentStore:r,indexes:l,vectorIndexes:d,searchableProperties:i,searchablePropertiesWithTypes:o,frequencies:s,tokenOccurrences:a,avgFieldLength:u,fieldLengths:c}}function au(r){const{indexes:e,vectorIndexes:n,searchableProperties:t,searchablePropertiesWithTypes:i,frequencies:o,tokenOccurrences:s,avgFieldLength:a,fieldLengths:u}=r,c={};for(const d of Object.keys(n))c[d]=n[d].node.toJSON();const l={};for(const d of Object.keys(e)){const{type:f,node:h,isArray:g}=e[d];f==="Flat"||f==="Radix"||f==="AVL"||f==="BKD"||f==="Bool"?l[d]={type:f,node:h.toJSON(),isArray:g}:(l[d]=e[d],l[d].node=l[d].node.toJSON())}return{indexes:l,vectorIndexes:c,searchableProperties:t,searchablePropertiesWithTypes:i,frequencies:o,tokenOccurrences:s,avgFieldLength:a,fieldLengths:u}}function uu(){return{create:ni,insert:eu,remove:nu,insertDocumentScoreParameters:qa,insertTokenScoreParameters:Za,removeDocumentScoreParameters:Xa,removeTokenScoreParameters:Ja,calculateResultScores:ii,search:ru,searchByWhereClause:Ct,getSearchableProperties:iu,getSearchablePropertiesWithTypes:ou,load:su,save:au}}function oi(r,e){r||(r=new Set);const n=e.length;for(let t=0;t<n;t++){const i=e[t].docIDs,o=i.length;for(let s=0;s<o;s++)r.add(i[s])}return r}function si(r,e,n=!1){const t=n?ye.vincentyDistance:ye.haversineDistance,i=[],o=[];for(const{point:u}of r)o.push(t(e,u));const s=Math.max(...o);let a=0;for(const{docIDs:u}of r){const c=o[a],l=s-c+1;for(const d of u)i.push([d,l]);a++}return i.sort((u,c)=>c[1]-u[1]),i}function cu(r,e){const n=Object.keys(r);if(n.length!==1)return{isGeoOnly:!1};const t=n[0],i=r[t];if(typeof e.indexes[t]>"u")return{isGeoOnly:!1};const{type:o}=e.indexes[t];return o==="BKD"&&i&&("radius"in i||"polygon"in i)?{isGeoOnly:!0,geoProperty:t,geoOperation:i}:{isGeoOnly:!1}}function lu(r,e){const n=r,t=cu(e,n);if(!t.isGeoOnly||!t.geoProperty||!t.geoOperation)return null;const{node:i}=n.indexes[t.geoProperty],o=t.geoOperation,s=i;let a;if("radius"in o){const{value:u,coordinates:c,unit:l="m",inside:d=!0,highPrecision:f=!1}=o.radius,h=c,g=jr(u,l);return a=s.searchByRadius(h,g,d,"asc",f),si(a,h,f)}else if("polygon"in o){const{coordinates:u,inside:c=!0,highPrecision:l=!1}=o.polygon;a=s.searchByPolygon(u,c,"asc",l);const d=ye.calculatePolygonCentroid(u);return si(a,d,l)}return null}function du(r,e){r||(r=new Set);const n=Object.keys(e),t=n.length;for(let i=0;i<t;i++){const o=e[n[i]],s=o.length;for(let a=0;a<s;a++)r.add(o[a])}return r}function ai(r,e,n,t,i){const o={language:r.tokenizer.language,sharedInternalDocumentStore:e,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(const[s,a]of Object.entries(n)){const u=`${i}${i?".":""}${s}`;if(!t.includes(u)){if(typeof a=="object"&&!Array.isArray(a)){const c=ai(r,e,a,t,u);$r(o.sortableProperties,c.sortableProperties),o.sorts={...o.sorts,...c.sorts},o.sortablePropertiesWithTypes={...o.sortablePropertiesWithTypes,...c.sortablePropertiesWithTypes};continue}if(!et(a))switch(a){case"boolean":case"number":case"string":o.sortableProperties.push(u),o.sortablePropertiesWithTypes[u]=a,o.sorts[u]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:a};break;case"geopoint":case"enum":continue;case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw W("INVALID_SORT_SCHEMA_TYPE",Array.isArray(a)?"array":a,u)}}}return o}function hu(r,e,n,t){return(t==null?void 0:t.enabled)!==!1?ai(r,e,n,(t||{}).unsortableProperties||[],""):{disabled:!0}}function fu(r,e,n,t){if(!r.enabled)return;r.isSorted=!1;const i=he(r.sharedInternalDocumentStore,n),o=r.sorts[e];o.orderedDocsToRemove.has(i)&&yn(r,e),o.docs.set(i,o.orderedDocs.length),o.orderedDocs.push([i,t])}function ui(r){if(r.isSorted||!r.enabled)return;const e=Object.keys(r.sorts);for(const n of e)yu(r,n);r.isSorted=!0}function gu(r,e,n){return e[1].localeCompare(n[1],la(r))}function pu(r,e){return r[1]-e[1]}function mu(r,e){return e[1]?-1:1}function yu(r,e){const n=r.sorts[e];let t;switch(n.type){case"string":t=gu.bind(null,r.language);break;case"number":t=pu.bind(null);break;case"boolean":t=mu.bind(null);break}n.orderedDocs.sort(t);const i=n.orderedDocs.length;for(let o=0;o<i;o++){const s=n.orderedDocs[o][0];n.docs.set(s,o)}}function vu(r){const e=Object.keys(r.sorts);for(const n of e)yn(r,n)}function yn(r,e){const n=r.sorts[e];n.orderedDocsToRemove.size&&(n.orderedDocs=n.orderedDocs.filter(t=>!n.orderedDocsToRemove.has(t[0])),n.orderedDocsToRemove.clear())}function bu(r,e,n){if(!r.enabled)return;const t=r.sorts[e],i=he(r.sharedInternalDocumentStore,n);t.docs.get(i)&&(t.docs.delete(i),t.orderedDocsToRemove.set(i,!0))}function wu(r,e,n){if(!r.enabled)throw W("SORT_DISABLED");const t=n.property,i=n.order==="DESC",o=r.sorts[t];if(!o)throw W("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",t,r.sortableProperties.join(", "));return yn(r,t),ui(r),e.sort((s,a)=>{const u=o.docs.get(he(r.sharedInternalDocumentStore,s[0])),c=o.docs.get(he(r.sharedInternalDocumentStore,a[0])),l=typeof u<"u",d=typeof c<"u";return!l&&!d?0:l?d?i?c-u:u-c:-1:1}),e}function Eu(r){return r.enabled?r.sortableProperties:[]}function Su(r){return r.enabled?r.sortablePropertiesWithTypes:{}}function Tu(r,e){const n=e;if(!n.enabled)return{enabled:!1};const t=Object.keys(n.sorts).reduce((i,o)=>{const{docs:s,orderedDocs:a,type:u}=n.sorts[o];return i[o]={docs:new Map(Object.entries(s).map(([c,l])=>[+c,l])),orderedDocsToRemove:new Map,orderedDocs:a,type:u},i},{});return{sharedInternalDocumentStore:r,language:n.language,sortableProperties:n.sortableProperties,sortablePropertiesWithTypes:n.sortablePropertiesWithTypes,sorts:t,enabled:!0,isSorted:n.isSorted}}function _u(r){if(!r.enabled)return{enabled:!1};vu(r),ui(r);const e=Object.keys(r.sorts).reduce((n,t)=>{const{docs:i,orderedDocs:o,type:s}=r.sorts[t];return n[t]={docs:Object.fromEntries(i.entries()),orderedDocs:o,type:s},n},{});return{language:r.language,sortableProperties:r.sortableProperties,sortablePropertiesWithTypes:r.sortablePropertiesWithTypes,sorts:e,enabled:r.enabled,isSorted:r.isSorted}}function Au(){return{create:hu,insert:fu,remove:bu,save:_u,load:Tu,sortBy:wu,getSortableProperties:Eu,getSortablePropertiesWithTypes:Su}}const ci=192,Du=383,Ru=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115];function ku(r){return r<ci||r>Du?r:Ru[r-ci]||r}function Lu(r){const e=[];for(let n=0;n<r.length;n++)e[n]=ku(r.charCodeAt(n));return String.fromCharCode(...e)}const Cu={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},Iu={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},Nu="[^aeiou]",It="[aeiouy]",Le=Nu+"[^aeiouy]*",ht=It+"[aeiou]*",vn="^("+Le+")?"+ht+Le,xu="^("+Le+")?"+ht+Le+"("+ht+")?$",Nt="^("+Le+")?"+ht+Le+ht+Le,li="^("+Le+")?"+It;function Pu(r){let e,n,t,i,o,s;if(r.length<3)return r;const a=r.substring(0,1);if(a=="y"&&(r=a.toUpperCase()+r.substring(1)),t=/^(.+?)(ss|i)es$/,i=/^(.+?)([^s])s$/,t.test(r)?r=r.replace(t,"$1$2"):i.test(r)&&(r=r.replace(i,"$1$2")),t=/^(.+?)eed$/,i=/^(.+?)(ed|ing)$/,t.test(r)){const u=t.exec(r);t=new RegExp(vn),t.test(u[1])&&(t=/.$/,r=r.replace(t,""))}else i.test(r)&&(e=i.exec(r)[1],i=new RegExp(li),i.test(e)&&(r=e,i=/(at|bl|iz)$/,o=new RegExp("([^aeiouylsz])\\1$"),s=new RegExp("^"+Le+It+"[^aeiouwxy]$"),i.test(r)?r=r+"e":o.test(r)?(t=/.$/,r=r.replace(t,"")):s.test(r)&&(r=r+"e")));if(t=/^(.+?)y$/,t.test(r)){const u=t.exec(r);e=u==null?void 0:u[1],t=new RegExp(li),e&&t.test(e)&&(r=e+"i")}if(t=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,t.test(r)){const u=t.exec(r);e=u==null?void 0:u[1],n=u==null?void 0:u[2],t=new RegExp(vn),e&&t.test(e)&&(r=e+Cu[n])}if(t=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,t.test(r)){const u=t.exec(r);e=u==null?void 0:u[1],n=u==null?void 0:u[2],t=new RegExp(vn),e&&t.test(e)&&(r=e+Iu[n])}if(t=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,i=/^(.+?)(s|t)(ion)$/,t.test(r)){const u=t.exec(r);e=u==null?void 0:u[1],t=new RegExp(Nt),e&&t.test(e)&&(r=e)}else if(i.test(r)){const u=i.exec(r);e=(u==null?void 0:u[1])??""+(u==null?void 0:u[2])??"",i=new RegExp(Nt),i.test(e)&&(r=e)}if(t=/^(.+?)e$/,t.test(r)){const u=t.exec(r);e=u==null?void 0:u[1],t=new RegExp(Nt),i=new RegExp(xu),o=new RegExp("^"+Le+It+"[^aeiouwxy]$"),e&&(t.test(e)||i.test(e)&&!o.test(e))&&(r=e)}return t=/ll$/,i=new RegExp(Nt),t.test(r)&&i.test(r)&&(t=/.$/,r=r.replace(t,"")),a=="y"&&(r=a.toLowerCase()+r.substring(1)),r}function di(r,e,n=!0){var i;const t=`${this.language}:${r}:${e}`;return n&&this.normalizationCache.has(t)?this.normalizationCache.get(t):(i=this.stopWords)!=null&&i.includes(e)?(n&&this.normalizationCache.set(t,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(r)&&(e=this.stemmer(e)),e=Lu(e),n&&this.normalizationCache.set(t,e),e)}function Ou(r){for(;r[r.length-1]==="";)r.pop();for(;r[0]==="";)r.shift();return r}function hi(r,e,n,t=!0){if(e&&e!==this.language)throw W("LANGUAGE_NOT_SUPPORTED",e);if(typeof r!="string")return[r];const i=this.normalizeToken.bind(this,n??"");let o;if(n&&this.tokenizeSkipProperties.has(n))o=[i(r,t)];else{const a=ca[this.language];o=r.toLowerCase().split(a).map(u=>i(u,t)).filter(Boolean)}const s=Ou(o);return this.allowDuplicates?s:Array.from(new Set(s))}function fi(r={}){if(!r.language)r.language="english";else if(!ln.includes(r.language))throw W("LANGUAGE_NOT_SUPPORTED",r.language);let e;if(r.stemming||r.stemmer&&!("stemming"in r))if(r.stemmer){if(typeof r.stemmer!="function")throw W("INVALID_STEMMER_FUNCTION_TYPE");e=r.stemmer}else if(r.language==="english")e=Pu;else throw W("MISSING_STEMMER",r.language);let n;if(r.stopWords!==!1){if(n=[],Array.isArray(r.stopWords))n=r.stopWords;else if(typeof r.stopWords=="function")n=r.stopWords(n);else if(r.stopWords)throw W("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(n))throw W("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(const i of n)if(typeof i!="string")throw W("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}const t={tokenize:hi,language:r.language,stemmer:e,stemmerSkipProperties:new Set(r.stemmerSkipProperties?[r.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(r.tokenizeSkipProperties?[r.tokenizeSkipProperties].flat():[]),stopWords:n,allowDuplicates:!!r.allowDuplicates,normalizeToken:di,normalizationCache:new Map};return t.tokenize=hi.bind(t),t.normalizeToken=di,t}function Gu(r){return{sharedInternalDocumentStore:r,rules:new Map}}function Fu(r,e){if(r.rules.has(e.id))throw new Error(`PINNING_RULE_ALREADY_EXISTS: A pinning rule with id "${e.id}" already exists. Use updateRule to modify it.`);r.rules.set(e.id,e)}function zu(r,e){if(!r.rules.has(e.id))throw new Error(`PINNING_RULE_NOT_FOUND: Cannot update pinning rule with id "${e.id}" because it does not exist. Use addRule to create it.`);r.rules.set(e.id,e)}function Mu(r,e){return r.rules.delete(e)}function Uu(r,e){return r.rules.get(e)}function $u(r){return Array.from(r.rules.values())}function Bu(r,e){const n=r.toLowerCase().trim(),t=e.pattern.toLowerCase().trim();switch(e.anchoring){case"is":return n===t;case"starts_with":return n.startsWith(t);case"contains":return n.includes(t);default:return!1}}function Wu(r,e){return r?e.conditions.every(n=>Bu(r,n)):!1}function gi(r,e){if(!e)return[];const n=[];for(const t of r.rules.values())Wu(e,t)&&n.push(t);return n}function Hu(r,e){const n=e;return{sharedInternalDocumentStore:r,rules:new Map((n==null?void 0:n.rules)??[])}}function Vu(r){return{rules:Array.from(r.rules.entries())}}function ju(){return{create:Gu,addRule:Fu,updateRule:zu,removeRule:Mu,getRule:Uu,getAllRules:$u,getMatchingRules:gi,load:Hu,save:Vu}}function Yu(r){const e={formatElapsedTime:Ea,getDocumentIndexId:Sa,getDocumentProperties:Vr,validateSchema:Zr};for(const n of Qr){const t=n;if(r[t]){if(typeof r[t]!="function")throw W("COMPONENT_MUST_BE_FUNCTION",t)}else r[t]=e[t]}for(const n of Object.keys(r))if(!$a.includes(n)&&!Qr.includes(n))throw W("UNSUPPORTED_COMPONENT",n)}function Ku({schema:r,sort:e,language:n,components:t,id:i,plugins:o}){t||(t={});for(const E of o??[]){if(!("getComponents"in E)||typeof E.getComponents!="function")continue;const b=E.getComponents(r),m=Object.keys(b);for(const T of m)if(t[T])throw W("PLUGIN_COMPONENT_CONFLICT",T,E.name);t={...t,...b}}i||(i=Wr());let s=t.tokenizer,a=t.index,u=t.documentsStore,c=t.sorter,l=t.pinning;if(s?s.tokenize?s=s:s=fi(s):s=fi({language:n??"english"}),t.tokenizer&&n)throw W("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");const d=Da();a||(a=uu()),c||(c=Au()),u||(u=za()),l||(l=ju()),Yu(t);const{getDocumentProperties:f,getDocumentIndexId:h,validateSchema:g,formatElapsedTime:y}=t,p={data:{},caches:{},schema:r,tokenizer:s,index:a,sorter:c,documentsStore:u,pinning:l,internalDocumentIDStore:d,getDocumentProperties:f,getDocumentIndexId:h,validateSchema:g,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeUpsert:[],afterUpsert:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],beforeUpdateMultiple:[],afterUpdateMultiple:[],beforeUpsertMultiple:[],afterUpsertMultiple:[],afterCreate:[],formatElapsedTime:y,id:i,plugins:o,version:qu()};p.data={index:p.index.create(p,d,r),docs:p.documentsStore.create(p,d),sorting:p.sorter.create(p,d,r,e),pinning:p.pinning.create(d)};for(const E of Ma)p[E]=(p[E]??[]).concat(Ua(p,E));const _=p.afterCreate;return _&&Ba(_,p),p}function qu(){return"{{VERSION}}"}function Zu(r){return r.documentsStore.count(r.data.docs)}function Xu(r,e,n,t,i){const o=r.validateSchema(e,r.schema);if(o)throw W("SCHEMA_VALIDATION_FAILURE",o);return ke(r.beforeInsert)||ke(r.afterInsert)||ke(r.index.beforeInsert)||ke(r.index.insert)||ke(r.index.afterInsert)?ec(r,e,n,t,i):tc(r,e,n,t,i)}const Ju=new Set(["enum","enum[]"]),Qu=new Set(["string","number"]);async function ec(r,e,n,t,i){const{index:o,docs:s}=r.data,a=r.getDocumentIndexId(e);if(typeof a!="string")throw W("DOCUMENT_ID_MUST_BE_STRING",typeof a);const u=he(r.internalDocumentIDStore,a);if(await _t(r.beforeInsert,r,a,e),!r.documentsStore.store(s,a,u,e))throw W("DOCUMENT_ALREADY_EXISTS",a);const c=r.documentsStore.count(s),l=r.index.getSearchableProperties(o),d=r.index.getSearchablePropertiesWithTypes(o),f=r.getDocumentProperties(e,l);for(const[h,g]of Object.entries(f)){if(typeof g>"u")continue;const y=typeof g,p=d[h];pi(y,p,h,g)}return await nc(r,a,l,f,c,n,e,i),await _t(r.afterInsert,r,a,e),a}function tc(r,e,n,t,i){const{index:o,docs:s}=r.data,a=r.getDocumentIndexId(e);if(typeof a!="string")throw W("DOCUMENT_ID_MUST_BE_STRING",typeof a);const u=he(r.internalDocumentIDStore,a);if(_t(r.beforeInsert,r,a,e),!r.documentsStore.store(s,a,u,e))throw W("DOCUMENT_ALREADY_EXISTS",a);const c=r.documentsStore.count(s),l=r.index.getSearchableProperties(o),d=r.index.getSearchablePropertiesWithTypes(o),f=r.getDocumentProperties(e,l);for(const[h,g]of Object.entries(f)){if(typeof g>"u")continue;const y=typeof g,p=d[h];pi(y,p,h,g)}return rc(r,a,l,f,c,n,e,i),_t(r.afterInsert,r,a,e),a}function pi(r,e,n,t){if(!(Aa(e)&&typeof t=="object"&&typeof t.lon=="number"&&typeof t.lat=="number")&&!(et(e)&&Array.isArray(t))&&!(St(e)&&Array.isArray(t))&&!(Ju.has(e)&&Qu.has(r))&&r!==e)throw W("INVALID_DOCUMENT_PROPERTY",n,e,r)}async function nc(r,e,n,t,i,o,s,a){var l,d,f,h;for(const g of n){const y=t[g];if(typeof y>"u")continue;const p=r.index.getSearchablePropertiesWithTypes(r.data.index)[g];await((d=(l=r.index).beforeInsert)==null?void 0:d.call(l,r.data.index,g,e,y,p,o,r.tokenizer,i));const _=r.internalDocumentIDStore.idToInternalId.get(e);await r.index.insert(r.index,r.data.index,g,e,_,y,p,o,r.tokenizer,i,a),await((h=(f=r.index).afterInsert)==null?void 0:h.call(f,r.data.index,g,e,y,p,o,r.tokenizer,i))}const u=r.sorter.getSortableProperties(r.data.sorting),c=r.getDocumentProperties(s,u);for(const g of u){const y=c[g];if(typeof y>"u")continue;const p=r.sorter.getSortablePropertiesWithTypes(r.data.sorting)[g];r.sorter.insert(r.data.sorting,g,e,y,p,o)}}function rc(r,e,n,t,i,o,s,a){var l,d,f,h;for(const g of n){const y=t[g];if(typeof y>"u")continue;const p=r.index.getSearchablePropertiesWithTypes(r.data.index)[g],_=he(r.internalDocumentIDStore,e);(d=(l=r.index).beforeInsert)==null||d.call(l,r.data.index,g,e,y,p,o,r.tokenizer,i),r.index.insert(r.index,r.data.index,g,e,_,y,p,o,r.tokenizer,i,a),(h=(f=r.index).afterInsert)==null||h.call(f,r.data.index,g,e,y,p,o,r.tokenizer,i)}const u=r.sorter.getSortableProperties(r.data.sorting),c=r.getDocumentProperties(s,u);for(const g of u){const y=c[g];if(typeof y>"u")continue;const p=r.sorter.getSortablePropertiesWithTypes(r.data.sorting)[g];r.sorter.insert(r.data.sorting,g,e,y,p,o)}}const mi="fulltext",ic="hybrid",oc="vector";function sc(r,e){return r[1]-e[1]}function ac(r,e){return e[1]-r[1]}function uc(r="desc"){return r.toLowerCase()==="asc"?sc:ac}function bn(r,e,n){const t={},i=e.map(([c])=>c),o=r.documentsStore.getMultiple(r.data.docs,i),s=Object.keys(n),a=r.index.getSearchablePropertiesWithTypes(r.data.index);for(const c of s){let l;if(a[c]==="number"){const{ranges:d}=n[c],f=d.length,h=Array.from({length:f});for(let g=0;g<f;g++){const y=d[g];h[g]=[`${y.from}-${y.to}`,0]}l=Object.fromEntries(h)}t[c]={count:0,values:l??{}}}const u=o.length;for(let c=0;c<u;c++){const l=o[c];for(const d of s){const f=d.includes(".")?gn(l,d):l[d],h=a[d],g=t[d].values;switch(h){case"number":{const y=n[d].ranges;yi(y,g)(f);break}case"number[]":{const y=new Set,p=n[d].ranges,_=yi(p,g,y);for(const E of f)_(E);break}case"boolean":case"enum":case"string":{vi(g,h)(f);break}case"boolean[]":case"enum[]":case"string[]":{const _=vi(g,h==="boolean[]"?"boolean":"string",new Set);for(const E of f)_(E);break}default:throw W("FACET_NOT_SUPPORTED",h)}}}for(const c of s){const l=t[c];if(l.count=Object.keys(l.values).length,a[c]==="string"){const d=n[c],f=uc(d.sort);l.values=Object.fromEntries(Object.entries(l.values).sort(f).slice(d.offset??0,d.limit??10))}}return t}function yi(r,e,n){return t=>{for(const i of r){const o=`${i.from}-${i.to}`;n!=null&&n.has(o)||t>=i.from&&t<=i.to&&(e[o]===void 0?e[o]=1:(e[o]++,n==null||n.add(o)))}}}function vi(r,e,n){const t=e==="boolean"?"false":"";return i=>{const o=(i==null?void 0:i.toString())??t;n!=null&&n.has(o)||(r[o]=(r[o]??0)+1,n==null||n.add(o))}}const cc={reducer:(r,e,n,t)=>(e[t]=n,e),getInitialValue:r=>Array.from({length:r})},bi=["string","number","boolean"];function wn(r,e,n){const t=n.properties,i=t.length,o=r.index.getSearchablePropertiesWithTypes(r.data.index);for(let _=0;_<i;_++){const E=t[_];if(typeof o[E]>"u")throw W("UNKNOWN_GROUP_BY_PROPERTY",E);if(!bi.includes(o[E]))throw W("INVALID_GROUP_BY_PROPERTY",E,bi.join(", "),o[E])}const s=e.map(([_])=>Tt(r.internalDocumentIDStore,_)),a=r.documentsStore.getMultiple(r.data.docs,s),u=a.length,c=n.maxResult||Number.MAX_SAFE_INTEGER,l=[],d={};for(let _=0;_<i;_++){const E=t[_],b={property:E,perValue:{}},m=new Set;for(let T=0;T<u;T++){const D=a[T],k=gn(D,E);if(typeof k>"u")continue;const x=typeof k!="boolean"?k:""+k,G=b.perValue[x]??{indexes:[],count:0};G.count>=c||(G.indexes.push(T),G.count++,b.perValue[x]=G,m.add(k))}l.push(Array.from(m)),d[E]=b}const f=wi(l),h=f.length,g=[];for(let _=0;_<h;_++){const E=f[_],b=E.length,m={values:[],indexes:[]},T=[];for(let D=0;D<b;D++){const k=E[D],x=t[D];T.push(d[x].perValue[typeof k!="boolean"?k:""+k].indexes),m.values.push(k)}m.indexes=ma(T).sort((D,k)=>D-k),m.indexes.length!==0&&g.push(m)}const y=g.length,p=Array.from({length:y});for(let _=0;_<y;_++){const E=g[_],b=n.reduce||cc,m=E.indexes.map(x=>({id:s[x],score:e[x][1],document:a[x]})),T=b.reducer.bind(null,E.values),D=b.getInitialValue(E.indexes.length),k=m.reduce(T,D);p[_]={values:E.values,result:k}}return p}function wi(r,e=0){if(e+1===r.length)return r[e].map(o=>[o]);const n=r[e],t=wi(r,e+1),i=[];for(const o of n)for(const s of t){const a=[o];$r(a,s),i.push(a)}return i}function En(r,e,n,t){const i=gi(e,t);if(i.length===0)return n;const o=i.flatMap(p=>p.consequence.promote);o.sort((p,_)=>p.position-_.position);const s=new Set,a=new Map,u=new Set;for(const p of o){const _=he(r.internalDocumentIDStore,p.doc_id);if(_!==void 0){if(a.has(_)){const E=a.get(_);p.position<E&&a.set(_,p.position);continue}u.has(p.position)||(s.add(_),a.set(_,p.position),u.add(p.position))}}if(a.size===0)return n;const c=n.filter(([p])=>!s.has(p)),l=1e6,d=[];for(const[p,_]of a.entries())n.find(([b])=>b===p)?d.push([p,l-_]):r.documentsStore.get(r.data.docs,p)&&d.push([p,0]);d.sort((p,_)=>{const E=a.get(p[0])??1/0,b=a.get(_[0])??1/0;return E-b});const f=[],h=new Map;for(const p of d){const _=a.get(p[0]);h.set(_,p)}let g=0,y=0;for(;y<c.length+d.length;)if(h.has(y))f.push(h.get(y)),y++;else if(g<c.length)f.push(c[g]),g++,y++;else break;for(const[p,_]of h.entries())p>=f.length&&f.push(_);return f}function Ei(r,e,n){const{term:t,properties:i}=e,o=r.data.index;let s=r.caches.propertiesToSearch;if(!s){const d=r.index.getSearchablePropertiesWithTypes(o);s=r.index.getSearchableProperties(o),s=s.filter(f=>d[f].startsWith("string")),r.caches.propertiesToSearch=s}if(i&&i!=="*"){for(const d of i)if(!s.includes(d))throw W("UNKNOWN_INDEX",d,s.join(", "));s=s.filter(d=>i.includes(d))}const a=Object.keys(e.where??{}).length>0;let u;a&&(u=r.index.searchByWhereClause(o,r.tokenizer,e.where,n));let c;const l=e.threshold!==void 0&&e.threshold!==null?e.threshold:1;if(t||i){const d=Zu(r);if(c=r.index.search(o,t||"",r.tokenizer,n,s,e.exact||!1,e.tolerance||0,e.boost||{},fc(e.relevance),d,u,l),e.exact&&t){const f=t.trim().split(/\s+/);c=c.filter(([h])=>{const g=r.documentsStore.get(r.data.docs,h);if(!g)return!1;for(const y of s){const p=dc(g,y);if(typeof p=="string"&&f.every(E=>new RegExp(`\\b${lc(E)}\\b`).test(p)))return!0}return!1})}}else if(a){const d=lu(o,e.where);d?c=d:c=(u?Array.from(u):[]).map(h=>[+h,0])}else c=Object.keys(r.documentsStore.getAll(r.data.docs)).map(f=>[+f,0]);return c}function lc(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function dc(r,e){const n=e.split(".");let t=r;for(const i of n)if(t&&typeof t=="object"&&i in t)t=t[i];else return;return t}function hc(r,e,n){var a,u;const t=Qe();function i(){const c=Object.keys(r.data.index.vectorIndexes),l=e.facets&&Object.keys(e.facets).length>0,{limit:d=10,offset:f=0,distinctOn:h,includeVectors:g=!1}=e,y=e.preflight===!0;let p=Ei(r,e,n);if(e.sortBy)if(typeof e.sortBy=="function"){const b=p.map(([D])=>D),T=r.documentsStore.getMultiple(r.data.docs,b).map((D,k)=>[p[k][0],p[k][1],D]);T.sort(e.sortBy),p=T.map(([D,k])=>[D,k])}else p=r.sorter.sortBy(r.data.sorting,p,e.sortBy).map(([b,m])=>[he(r.internalDocumentIDStore,b),m]);else p=p.sort(Hr);p=En(r,r.data.pinning,p,e.term);let _;y||(_=h?Sc(r,p,f,d,h):_i(r,p,f,d));const E={elapsed:{formatted:"",raw:0},hits:[],count:p.length};if(typeof _<"u"&&(E.hits=_.filter(Boolean),g||Yr(E,c)),l){const b=bn(r,p,e.facets);E.facets=b}return e.groupBy&&(E.groups=wn(r,p,e.groupBy)),E.elapsed=r.formatElapsedTime(Qe()-t),E}async function o(){r.beforeSearch&&await mn(r.beforeSearch,r,e,n);const c=i();return r.afterSearch&&await pn(r.afterSearch,r,e,n,c),c}return((a=r.beforeSearch)==null?void 0:a.length)||((u=r.afterSearch)==null?void 0:u.length)?o():i()}const Sn={k:1.2,b:.75,d:.5};function fc(r){const e=r??{};return e.k=e.k??Sn.k,e.b=e.b??Sn.b,e.d=e.d??Sn.d,e}function Si(r,e,n){const t=e.vector;if(t&&(!("value"in t)||!("property"in t)))throw W("INVALID_VECTOR_INPUT",Object.keys(t).join(", "));const i=r.data.index.vectorIndexes[t.property];if(!i)throw W("UNKNOWN_VECTOR_PROPERTY",t.property);const o=i.node.size;if((t==null?void 0:t.value.length)!==o)throw(t==null?void 0:t.property)===void 0||(t==null?void 0:t.value.length)===void 0?W("INVALID_INPUT_VECTOR","undefined",o,"undefined"):W("INVALID_INPUT_VECTOR",t.property,o,t.value.length);const s=r.data.index;let a;return Object.keys(e.where??{}).length>0&&(a=r.index.searchByWhereClause(s,r.tokenizer,e.where,n)),i.node.find(t.value,e.similarity??Ya,a)}function gc(r,e,n="english"){var a,u;const t=Qe();function i(){let c=Si(r,e,n).sort(Hr);c=En(r,r.data.pinning,c,void 0);let l=[];e.facets&&Object.keys(e.facets).length>0&&(l=bn(r,c,e.facets));const f=e.vector.property,h=e.includeVectors??!1,g=e.limit??10,y=e.offset??0,p=Array.from({length:g});for(let m=0;m<g;m++){const T=c[m+y];if(!T)break;const D=r.data.docs.docs[T[0]];if(D){h||(D[f]=null);const k={id:Tt(r.internalDocumentIDStore,T[0]),score:T[1],document:D};p[m]=k}}let _=[];e.groupBy&&(_=wn(r,c,e.groupBy));const b=Qe()-t;return{count:c.length,hits:p.filter(Boolean),elapsed:{raw:Number(b),formatted:hn(b)},...l?{facets:l}:{},..._?{groups:_}:{}}}async function o(){r.beforeSearch&&await mn(r.beforeSearch,r,e,n);const c=i();return r.afterSearch&&await pn(r.afterSearch,r,e,n,c),c}return((a=r.beforeSearch)==null?void 0:a.length)||((u=r.afterSearch)==null?void 0:u.length)?o():i()}function pc(r,e,n){const t=yc(Ei(r,e,n)),i=Si(r,e,n),o=e.hybridWeights;return bc(t,i,e.term??"",o)}function mc(r,e,n){var a,u;const t=Qe();function i(){let c=pc(r,e,n);c=En(r,r.data.pinning,c,e.term);let l;e.facets&&Object.keys(e.facets).length>0&&(l=bn(r,c,e.facets));let f;e.groupBy&&(f=wn(r,c,e.groupBy));const h=e.offset??0,g=e.limit??10,y=_i(r,c,h,g).filter(Boolean),p=Qe(),_={count:c.length,elapsed:{raw:Number(p-t),formatted:hn(p-t)},hits:y,...l?{facets:l}:{},...f?{groups:f}:{}};if(!(e.includeVectors??!1)){const b=Object.keys(r.data.index.vectorIndexes);Yr(_,b)}return _}async function o(){r.beforeSearch&&await mn(r.beforeSearch,r,e,n);const c=i();return r.afterSearch&&await pn(r.afterSearch,r,e,n,c),c}return((a=r.beforeSearch)==null?void 0:a.length)||((u=r.afterSearch)==null?void 0:u.length)?o():i()}function Tn(r){return r[1]}function yc(r){const e=Math.max.apply(Math,r.map(Tn));return r.map(([n,t])=>[n,t/e])}function Ti(r,e){return r/e}function vc(r,e){return(n,t)=>n*r+t*e}function bc(r,e,n,t){const i=Math.max.apply(Math,r.map(Tn)),o=Math.max.apply(Math,e.map(Tn)),s=t&&t.text&&t.vector,{text:a,vector:u}=s?t:wc(),c=new Map,l=r.length,d=vc(a,u);for(let h=0;h<l;h++){const[g,y]=r[h],p=Ti(y,i),_=d(p,0);c.set(g,_)}const f=e.length;for(let h=0;h<f;h++){const[g,y]=e[h],p=Ti(y,o),_=c.get(g)??0;c.set(g,_+d(0,p))}return[...c].sort((h,g)=>g[1]-h[1])}function wc(r){return{text:.5,vector:.5}}function Ec(r,e,n){const t=e.mode??mi;if(t===mi)return hc(r,e,n);if(t===oc)return gc(r,e);if(t===ic)return mc(r,e);throw W("INVALID_SEARCH_MODE",t)}function Sc(r,e,n,t,i){const o=r.data.docs,s=new Map,a=[],u=new Set,c=e.length;let l=0;for(let d=0;d<c;d++){const f=e[d];if(typeof f>"u")continue;const[h,g]=f;if(u.has(h))continue;const y=r.documentsStore.get(o,h),p=gn(y,i);if(!(typeof p>"u"||s.has(p))&&(s.set(p,!0),l++,!(l<=n)&&(a.push({id:Tt(r.internalDocumentIDStore,h),score:g,document:y}),u.add(h),l>=n+t)))break}return a}function _i(r,e,n,t){const i=r.data.docs,o=Array.from({length:t}),s=new Set;for(let a=n;a<t+n;a++){const u=e[a];if(typeof u>"u")break;const[c,l]=u;if(!s.has(c)){const d=r.documentsStore.get(i,c);o[a]={id:Tt(r.internalDocumentIDStore,c),score:l,document:d},s.add(c)}}return o}let xt=null,Be=null;function Tc(){return document.documentElement.getAttribute("data-md-color-scheme")==="slate"}function _c(r){const e=r.querySelector(".starfield-canvas");e&&e.remove(),Be&&(cancelAnimationFrame(Be),Be=null);const n=document.createElement("canvas");n.className="starfield-canvas",n.style.cssText=`
    position: absolute; inset: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 0;
  `,r.style.position="relative",r.prepend(n);function t(){n.width=r.offsetWidth||800,n.height=r.offsetHeight||600}t();const i=n.getContext("2d"),o=Array.from({length:200},()=>({x:Math.random()*n.width,y:Math.random()*n.height,r:Math.random()*1.2+.2,alpha:Math.random()*.6+.2,dAlpha:(Math.random()*.005+.001)*(Math.random()<.5?1:-1)}));function s(){i.clearRect(0,0,n.width,n.height),o.forEach(u=>{u.alpha+=u.dAlpha,(u.alpha>.85||u.alpha<.1)&&(u.dAlpha*=-1),i.beginPath(),i.arc(u.x,u.y,u.r,0,Math.PI*2),i.fillStyle=`rgba(180, 200, 255, ${u.alpha})`,i.fill()}),Be=requestAnimationFrame(s)}s();const a=new ResizeObserver(t);a.observe(r),n._ro=a}function Ac(r){var n;Be&&(cancelAnimationFrame(Be),Be=null);const e=r==null?void 0:r.querySelector(".starfield-canvas");e&&((n=e._ro)==null||n.disconnect(),e.remove())}function _n(){var He,X;const r=document.getElementById("sigma-container");if(!r)return;const e=window.__GRAPH_DATA__;if(!e){console.error("graph-viz: __GRAPH_DATA__ not found");return}if(xt){try{xt.kill()}catch{}xt=null}Ac(r),r.innerHTML="";const n=Tc(),t=n?{category:"#a78bfa",subcategory:"#60a5fa",series:"#fb923c",tag:"#34d399",post:"#f472b6"}:{category:"#7C3AED",subcategory:"#2563EB",series:"#EA580C",tag:"#0D9488",post:"#DC2626"},i=n?{inCategory:"rgba(167,139,250,0.5)",inSubcategory:"rgba(96,165,250,0.4)",inSeries:"rgba(251,146,60,0.55)",hasTag:"rgba(52,211,153,0.4)",related:"rgba(192,132,252,0.55)",dependsOn:"rgba(96,165,250,0.6)",tagCooccurs:"rgba(253,224,71,0.3)"}:{inCategory:"#9333ea",inSubcategory:"#3b82f6",inSeries:"#ea580c",hasTag:"#0d9488",related:"#8b5cf6",dependsOn:"#2563eb",tagCooccurs:"#94a3b8"},o=n?"#e2e8f0":"#1a1a2e",s=n?"rgba(7,11,24,0.7)":"rgba(255,255,255,0)",a=n?"rgba(148,163,184,0.25)":"#94a3b8",u={category:!1,subcategory:!1,series:!1,tag:!1,post:!0},c={category:!0,subcategory:!0,series:!0,tag:!0,post:!1},l={hoveredNode:null,selectedNode:null,searchQuery:"",searchMatches:new Set},d={};e.nodes.forEach(w=>{d[w.id]=0}),e.edges.forEach(w=>{d[w.source]!==void 0&&d[w.source]++,d[w.target]!==void 0&&d[w.target]++});function f(w){const R=d[w.id]||0;switch(w.type){case"category":return 28;case"subcategory":return 16+Math.min(R*.3,7);case"tag":return Math.max(7,Math.min(18,6+R*.8));case"series":return Math.max(10,Math.min(22,10+R*.4));case"post":return Math.max(6,Math.min(16,5+R*1.5));default:return 8}}const h=new q({multi:!1,type:"directed"});e.nodes.forEach(w=>{h.addNode(w.id,{label:w.label,size:f(w),color:t[w.type]||"#a78bfa",nodeType:w.type,url:w.url||null,date:w.date||null,series:w.series||null,difficulty:w.difficulty||null,hidden:u[w.type]??!1,x:Math.random()*100,y:Math.random()*100})});const g=new Set;e.edges.forEach(w=>{const R=`${w.source}--${w.target}`,I=`${w.target}--${w.source}`;if(g.has(R)||g.has(I)||!h.hasNode(w.source)||!h.hasNode(w.target)||w.source===w.target)return;g.add(R);const L=w.type==="dependsOn"||w.type==="related";h.addDirectedEdge(w.source,w.target,{edgeType:w.type,weight:w.weight,color:i[w.type]||a,size:w.type==="tagCooccurs"?Math.min(w.weight*.5,2):1.2,type:L?"arrow":"line"})});const y={category:80,subcategory:220,series:280,tag:360,post:300},p=h.nodes().filter(w=>h.getNodeAttribute(w,"nodeType")==="category"),_={};p.forEach((w,R)=>{const I=R/Math.max(p.length,1)*2*Math.PI;_[w]=I,h.setNodeAttribute(w,"x",y.category*Math.cos(I)),h.setNodeAttribute(w,"y",y.category*Math.sin(I))});const E={};h.nodes().filter(w=>h.getNodeAttribute(w,"nodeType")==="subcategory").forEach(w=>{const R=h.neighbors(w).find(P=>h.getNodeAttribute(P,"nodeType")==="category"),I=R?_[R]||0:Math.random()*2*Math.PI,L=(Math.random()-.5)*(Math.PI/Math.max(p.length,1));E[w]=I+L,h.setNodeAttribute(w,"x",y.subcategory*Math.cos(I+L)),h.setNodeAttribute(w,"y",y.subcategory*Math.sin(I+L))}),h.nodes().filter(w=>["series","tag","post"].includes(h.getNodeAttribute(w,"nodeType"))).forEach(w=>{const R=h.getNodeAttribute(w,"nodeType"),I=h.neighbors(w),L=I.find(Q=>h.getNodeAttribute(Q,"nodeType")==="subcategory"),P=I.find(Q=>h.getNodeAttribute(Q,"nodeType")==="category");let S;L&&E[L]!==void 0?S=E[L]:P&&_[P]!==void 0?S=_[P]:S=Math.random()*2*Math.PI;const te=(Math.random()-.5)*(Math.PI*.6),oe=y[R]||300;h.setNodeAttribute(w,"x",oe*Math.cos(S+te)+(Math.random()-.5)*30),h.setNodeAttribute(w,"y",oe*Math.sin(S+te)+(Math.random()-.5)*30)}),ua.assign(h,{iterations:600,settings:{gravity:.3,scalingRatio:55,barnesHutOptimize:!0,barnesHutTheta:.5,strongGravityMode:!1,linLogMode:!0,adjustSizes:!0,slowDown:8}}),n&&_c(r);const b=new ta(h,r,{renderEdgeLabels:!1,enableEdgeClickEvents:!1,enableEdgeWheelEvents:!1,enableEdgeHoverEvents:!1,defaultNodeColor:t.tag,defaultEdgeColor:a,labelFont:"Pretendard, sans-serif",labelSize:12,labelWeight:"600",labelColor:{color:o},labelBackgroundColor:s,labelRenderedSizeThreshold:10,minCameraRatio:.03,maxCameraRatio:8,defaultEdgeType:"line",defaultArrowHeadLength:10,nodeReducer:(w,R)=>{const I={...R},L=l.selectedNode===w,P=l.hoveredNode===w,S=l.hoveredNode?new Set(h.neighbors(l.hoveredNode)):l.selectedNode?new Set(h.neighbors(l.selectedNode)):null,te=R.nodeType;if((te==="post"||te==="tag")&&(I.borderColor=n?te==="post"?"rgba(244,114,182,0.6)":"rgba(52,211,153,0.5)":te==="post"?"rgba(220,38,38,0.5)":"rgba(13,148,136,0.45)",I.borderSize=1.5),l.searchQuery&&l.searchMatches.size>0){if(!l.searchMatches.has(w))return I.color=n?"#1e293b":"#cbd5e1",I.label="",I.size=R.size*.4,I.borderSize=0,I;I.size=R.size*1.3,I.borderColor=n?"#fbbf24":"#d97706",I.borderSize=2.5}if((l.hoveredNode||l.selectedNode)&&!P&&!L){if(!S||!S.has(w))return R.hidden||(I.color=n?"#374151":"#b0bec5",I.label="",I.size=R.size*.7,I.borderSize=0),I;I.size=R.size*1.1}return P&&(I.borderColor=n?"#f8fafc":"#1e293b",I.borderSize=2),L&&(I.size=R.size*1.6,I.zIndex=10,I.borderColor=n?"#fbbf24":"#b45309",I.borderSize=3),I},edgeReducer:(w,R)=>{const I={...R};if(R.hidden)return I;const[L,P]=h.extremities(w),S=l.hoveredNode||l.selectedNode;return S&&(L!==S&&P!==S?(I.color=n?"#1e293b":"#d1d5db",I.size=.3):(I.size=(R.size||1)*2.5,I.color=i[R.edgeType]||a)),l.searchQuery&&l.searchMatches.size>0&&!l.searchMatches.has(L)&&!l.searchMatches.has(P)&&(I.color=n?"#1e293b":"#d1d5db",I.size=.2),I}}),m=document.getElementById("graph-tooltip");function T(w,R,I){if(!m)return;const L={category:"",subcategory:"",series:"",tag:"",post:""}[R.nodeType]||R.nodeType,P=h.degree(w);let S=`<div class="gt-type gt-type--${R.nodeType}">${L}</div>`;S+=`<div class="gt-label">${R.label}</div>`,R.date&&(S+=`<div class="gt-meta">${R.date}</div>`),S+=`<div class="gt-meta"> ${P}</div>`,S+=`<div class="gt-hint">${R.nodeType==="post"?" ":"  "}</div>`,m.innerHTML=S,m.classList.add("is-visible"),k(I)}function D(){m==null||m.classList.remove("is-visible")}function k(w){var te,oe;if(!m||!w)return;const R=r.getBoundingClientRect(),I=(((te=w.original)==null?void 0:te.clientX)??w.clientX??0)-R.left,L=(((oe=w.original)==null?void 0:oe.clientY)??w.clientY??0)-R.top,P=m.offsetWidth||200,S=m.offsetHeight||80;m.style.left=(I+16+P>R.width?I-P-8:I+16)+"px",m.style.top=(L+16+S>R.height?L-S-8:L+12)+"px"}r.addEventListener("mousemove",w=>{l.hoveredNode&&(m!=null&&m.classList.contains("is-visible"))&&k({clientX:w.clientX,clientY:w.clientY})});const x=document.getElementById("graph-info-panel"),G=document.getElementById("graph-panel-body"),z=document.getElementById("graph-panel-close");function H(w,R){var Ve;if(!x||!G)return;l.selectedNode=w;const I={category:"",subcategory:"",series:"",tag:"",post:""}[R.nodeType]||R.nodeType,L=h.neighbors(w),P=L.filter(j=>h.getNodeAttribute(j,"nodeType")==="post").map(j=>({id:j,label:h.getNodeAttribute(j,"label"),url:h.getNodeAttribute(j,"url"),date:h.getNodeAttribute(j,"date")})).sort((j,fe)=>(fe.date||"").localeCompare(j.date||"")),S=L.filter(j=>h.getNodeAttribute(j,"nodeType")!=="post").map(j=>({id:j,label:h.getNodeAttribute(j,"label"),type:h.getNodeAttribute(j,"nodeType")})),te=((Ve=document.querySelector('meta[name="site-url"]'))==null?void 0:Ve.content)||"/",oe=h.degree(w);let Q=`<div class="gp-node-header gp-node-header--${R.nodeType}">`;Q+='<div class="gp-header-row">',Q+=`<div class="gp-type gp-type--${R.nodeType}">${I}</div>`;const ge=[`${oe} `];P.length&&ge.push(`${P.length} `),S.length&&ge.push(`${S.length} `),Q+=`<span class="gp-inline-stats">${ge.join("  ")}</span>`,Q+="</div>",Q+=`<h2 class="gp-title">${R.label}</h2>`;const se=[];if(R.series&&se.push(`<span class="gp-meta-series">${R.series}</span>`),R.date&&se.push(`<span class="gp-meta-date">${R.date}</span>`),R.difficulty){const j={beginner:"",intermediate:"",advanced:""}[R.difficulty]||R.difficulty;se.push(`<span class="gp-meta-diff gp-meta-diff--${R.difficulty}">${j}</span>`)}se.length&&(Q+=`<div class="gp-meta-line">${se.join("")}</div>`),Q+="</div>";let ee='<div class="gp-scroll-body">';if(P.length>0&&(ee+='<div class="gp-section">',ee+=`<div class="gp-section-title"> <span class="gp-section-count">${P.length}</span></div>`,ee+='<ul class="gp-post-list">',P.forEach(j=>{const fe=j.date?`<span class="gp-post-date">${j.date}</span>`:"";ee+='<li class="gp-post-item">',ee+=j.url?`<a href="${te}${j.url}" class="gp-post-link">${j.label}</a>${fe}`:`<span class="gp-post-label">${j.label}</span>${fe}`,ee+="</li>"}),ee+="</ul></div>"),S.length>0){const j=["category","subcategory","series","tag"],fe={category:"",subcategory:"",series:"",tag:""},Te={};S.forEach(pe=>{Te[pe.type]||(Te[pe.type]=[]),Te[pe.type].push(pe)}),ee+='<div class="gp-section">',ee+=`<div class="gp-section-title"> <span class="gp-section-count">${S.length}</span></div>`,j.forEach(pe=>{!Te[pe]||Te[pe].length===0||(ee+='<div class="gp-conn-group">',ee+=`<span class="gp-conn-group-label gp-type--${pe}">${fe[pe]}</span>`,ee+='<div class="gp-tags">',Te[pe].forEach(Re=>{ee+=`<span class="gp-tag gp-tag--${Re.type}" data-node-id="${Re.id}">${Re.label}</span>`}),ee+="</div></div>")}),ee+="</div>"}ee+="</div>";let nt="";R.nodeType==="post"&&R.url&&(nt=`<div class="gp-panel-footer"><a class="gp-open-btn" href="${te}${R.url}"> </a></div>`),G.innerHTML=Q+ee+nt,x.classList.add("is-open"),G.querySelectorAll(".gp-tag[data-node-id]").forEach(j=>{j.addEventListener("click",()=>{const fe=j.dataset.nodeId;h.hasNode(fe)&&(v(fe),H(fe,h.getNodeAttributes(fe)))})}),b.refresh()}function $(){x==null||x.classList.remove("is-open"),l.selectedNode=null,b.refresh()}z==null||z.addEventListener("click",$);function v(w){if(!h.hasNode(w))return;const R=h.getNodeAttribute(w,"x"),I=h.getNodeAttribute(w,"y");if(R==null||I==null)return;const{x:L,y:P}=b.graphToViewport({x:R,y:I});b.getCamera().animate(b.viewportToFramedGraph({x:L,y:P}),{duration:500})}b.on("clickNode",({node:w})=>{D(),H(w,h.getNodeAttributes(w))}),b.on("clickStage",()=>{$(),D(),We()}),b.on("enterNode",({node:w,event:R})=>{l.hoveredNode=w,r.style.cursor="pointer",T(w,h.getNodeAttributes(w),R),b.refresh()}),b.on("leaveNode",()=>{l.hoveredNode=null,r.style.cursor="default",D(),b.refresh()});function Y(){h.nodes().forEach(w=>{h.setNodeAttribute(w,"hidden",!c[h.getNodeAttribute(w,"nodeType")])}),h.edges().forEach(w=>{const[R,I]=h.extremities(w),L=h.getNodeAttribute(R,"hidden")||h.getNodeAttribute(I,"hidden");h.setEdgeAttribute(w,"hidden",L)}),b.refresh()}document.querySelectorAll(".graph-filter-cb").forEach(w=>{const R=w.dataset.type;w.checked=c[R]??!1,w.addEventListener("change",I=>{c[R]=I.target.checked,Y()})}),Y();let Z=null,N=!1;const A={};h.nodes().forEach(w=>{if(h.getNodeAttribute(w,"nodeType")==="post"){const R=h.neighbors(w).filter(I=>h.getNodeAttribute(I,"nodeType")==="tag").map(I=>h.getNodeAttribute(I,"label"));A[w]=R.join(" ")}});const V=((He=document.querySelector('meta[name="site-url"]'))==null?void 0:He.content)||"/sonblog/";function K(w){return w?w.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim():""}(async function(){try{let R={};try{(await(await fetch(V+"search/search_index.json")).json()).docs.forEach(P=>{const S=(P.location||"").split("#")[0];S&&(R[S]||(R[S]=""),R[S]+=" "+K(P.text||""))})}catch(I){console.warn("graph-viz: search_index.json  , label  ",I)}Z=Ku({schema:{nodeId:"string",label:"string",nodeType:"string",content:"string",tags:"string",series:"string"}});for(const I of h.nodes()){const L=h.getNodeAttributes(I);let P="";if(L.nodeType==="post"&&L.url){const S=(L.url||"").replace(/^\//,"").replace(/^sonblog\//,"");P=(R[S]||"").trim().slice(0,2e3)}Xu(Z,{nodeId:I,label:L.label||"",nodeType:L.nodeType||"",content:P,tags:A[I]||"",series:L.series||""})}N=!0,console.log("graph-viz: Orama BM25    ("+h.order+" nodes)")}catch(R){console.error("graph-viz: Orama   ",R)}})();const ne=document.getElementById("graph-search"),ie=document.getElementById("graph-search-clear");function re(w){if(l.searchQuery=w,l.searchMatches.clear(),w&&N&&Z){const R=Ec(Z,{term:w,limit:20,boost:{label:3,tags:2,series:1.5,content:1}});R.hits.forEach(I=>{const L=I.document.nodeId;h.hasNode(L)&&l.searchMatches.add(L)}),ze(R.hits)}else if(w&&!N){const R=w.toLowerCase();h.nodes().forEach(I=>{(h.getNodeAttribute(I,"label")||"").toLowerCase().includes(R)&&l.searchMatches.add(I)}),ze(null)}else We();ie&&(ie.style.display=w?"flex":"none"),b.refresh()}const U={category:"",subcategory:"",series:"",tag:"",post:""};function ze(w){let R=document.getElementById("graph-search-dropdown");if(!R){R=document.createElement("div"),R.id="graph-search-dropdown",R.className="graph-search-dropdown";const I=document.querySelector(".graph-search-wrap");I&&I.appendChild(R)}if(w===null){const I=[...l.searchMatches].slice(0,10);if(I.length===0){R.innerHTML='<div class="gsd-empty"> </div>',R.classList.add("is-visible");return}R.innerHTML=I.map(L=>{const P=h.getNodeAttributes(L);return`<div class="gsd-item" data-node-id="${L}">
          <span class="gsd-type gsd-type--${P.nodeType}">${U[P.nodeType]||P.nodeType}</span>
          <span class="gsd-label">${P.label}</span>
        </div>`}).join(""),R.classList.add("is-visible"),ce(R);return}if(!w||w.length===0){R.innerHTML='<div class="gsd-empty"> </div>',R.classList.add("is-visible");return}R.innerHTML=w.slice(0,10).map(I=>{const L=I.document,P=I.score.toFixed(2),S=h.hasNode(L.nodeId)?h.getNodeAttributes(L.nodeId):{},te=h.hasNode(L.nodeId)?h.degree(L.nodeId):0;let oe="";if(L.nodeType==="post"){const Q=[];if(S.date&&Q.push(S.date),S.series&&Q.push(S.series),Q.length&&(oe+=`<span class="gsd-meta">${Q.join("  ")}</span>`),L.content){const ge=L.content.slice(0,80).replace(/\s+/g," ").trim();oe+=`<span class="gsd-teaser">${ge}${L.content.length>80?"...":""}</span>`}if(L.tags){const ge=L.tags.split(" ").filter(Boolean).slice(0,5);ge.length&&(oe+=`<span class="gsd-tags">${ge.map(se=>`<span class="gsd-tag">${se}</span>`).join("")}</span>`)}}else oe+=`<span class="gsd-meta">${te} </span>`;return`<div class="gsd-item" data-node-id="${L.nodeId}">
        <div class="gsd-item-head">
          <span class="gsd-type gsd-type--${L.nodeType}">${U[L.nodeType]||L.nodeType}</span>
          <span class="gsd-label">${L.label}</span>
          <span class="gsd-score">${P}</span>
        </div>
        ${oe?`<div class="gsd-item-body">${oe}</div>`:""}
      </div>`}).join(""),R.classList.add("is-visible"),ce(R)}function ce(w){w.querySelectorAll(".gsd-item").forEach(R=>{R.addEventListener("click",()=>{const I=R.dataset.nodeId;h.hasNode(I)&&(v(I),H(I,h.getNodeAttributes(I))),We()})})}function We(){const w=document.getElementById("graph-search-dropdown");w&&w.classList.remove("is-visible")}let Me=null;ne==null||ne.addEventListener("input",w=>{clearTimeout(Me);const R=w.target.value.trim();Me=setTimeout(()=>re(R),120)}),ie&&(ie.style.display="none",ie.addEventListener("click",()=>{ne.value="",re(""),We()})),document.addEventListener("click",w=>{w.target.closest(".graph-search-wrap")||We()}),(X=document.getElementById("graph-reset"))==null||X.addEventListener("click",()=>{b.getCamera().animatedReset()});const Pt=document.getElementById("graph-stats");if(Pt){const w=e.metadata||{};Pt.textContent=`${w.total_posts||0} posts  ${w.total_tags||0} tags  ${w.total_categories||0} categories`}xt=b,console.log(`graph-viz: ${h.order} nodes, ${h.size} edges [${n?"dark":"light"}]`)}window.initGraphViz=_n,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_n):_n()})();
