var rh=Object.defineProperty;var ih=(Me,_e,qe)=>_e in Me?rh(Me,_e,{enumerable:!0,configurable:!0,writable:!0,value:qe}):Me[_e]=qe;var ue=(Me,_e,qe)=>ih(Me,typeof _e!="symbol"?_e+"":_e,qe);(function(){"use strict";function Me(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var _e={exports:{}},qe;function Ki(){if(qe)return _e.exports;qe=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function(A,S,D){return Function.prototype.apply.call(A,S,D)},n;r&&typeof r.ownKeys=="function"?n=r.ownKeys:Object.getOwnPropertySymbols?n=function(A){return Object.getOwnPropertyNames(A).concat(Object.getOwnPropertySymbols(A))}:n=function(A){return Object.getOwnPropertyNames(A)};function t(g){console&&console.warn&&console.warn(g)}var i=Number.isNaN||function(A){return A!==A};function o(){o.init.call(this)}_e.exports=o,_e.exports.once=b,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(g){if(typeof g!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof g)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(g){if(typeof g!="number"||g<0||i(g))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+g+".");a=g}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(A){if(typeof A!="number"||A<0||i(A))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+A+".");return this._maxListeners=A,this};function u(g){return g._maxListeners===void 0?o.defaultMaxListeners:g._maxListeners}o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(A){for(var S=[],D=1;D<arguments.length;D++)S.push(arguments[D]);var C=A==="error",I=this._events;if(I!==void 0)C=C&&I.error===void 0;else if(!C)return!1;if(C){var k;if(S.length>0&&(k=S[0]),k instanceof Error)throw k;var U=new Error("Unhandled error."+(k?" ("+k.message+")":""));throw U.context=k,U}var P=I[A];if(P===void 0)return!1;if(typeof P=="function")e(P,this,S);else for(var T=P.length,q=p(P,T),D=0;D<T;++D)e(q[D],this,S);return!0};function c(g,A,S,D){var C,I,k;if(s(S),I=g._events,I===void 0?(I=g._events=Object.create(null),g._eventsCount=0):(I.newListener!==void 0&&(g.emit("newListener",A,S.listener?S.listener:S),I=g._events),k=I[A]),k===void 0)k=I[A]=S,++g._eventsCount;else if(typeof k=="function"?k=I[A]=D?[S,k]:[k,S]:D?k.unshift(S):k.push(S),C=u(g),C>0&&k.length>C&&!k.warned){k.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+k.length+" "+String(A)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=g,U.type=A,U.count=k.length,t(U)}return g}o.prototype.addListener=function(A,S){return c(this,A,S,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(A,S){return c(this,A,S,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(g,A,S){var D={fired:!1,wrapFn:void 0,target:g,type:A,listener:S},C=h.bind(D);return C.listener=S,D.wrapFn=C,C}o.prototype.once=function(A,S){return s(S),this.on(A,l(this,A,S)),this},o.prototype.prependOnceListener=function(A,S){return s(S),this.prependListener(A,l(this,A,S)),this},o.prototype.removeListener=function(A,S){var D,C,I,k,U;if(s(S),C=this._events,C===void 0)return this;if(D=C[A],D===void 0)return this;if(D===S||D.listener===S)--this._eventsCount===0?this._events=Object.create(null):(delete C[A],C.removeListener&&this.emit("removeListener",A,D.listener||S));else if(typeof D!="function"){for(I=-1,k=D.length-1;k>=0;k--)if(D[k]===S||D[k].listener===S){U=D[k].listener,I=k;break}if(I<0)return this;I===0?D.shift():w(D,I),D.length===1&&(C[A]=D[0]),C.removeListener!==void 0&&this.emit("removeListener",A,U||S)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(A){var S,D,C;if(D=this._events,D===void 0)return this;if(D.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):D[A]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete D[A]),this;if(arguments.length===0){var I=Object.keys(D),k;for(C=0;C<I.length;++C)k=I[C],k!=="removeListener"&&this.removeAllListeners(k);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(S=D[A],typeof S=="function")this.removeListener(A,S);else if(S!==void 0)for(C=S.length-1;C>=0;C--)this.removeListener(A,S[C]);return this};function d(g,A,S){var D=g._events;if(D===void 0)return[];var C=D[A];return C===void 0?[]:typeof C=="function"?S?[C.listener||C]:[C]:S?m(C):p(C,C.length)}o.prototype.listeners=function(A){return d(this,A,!0)},o.prototype.rawListeners=function(A){return d(this,A,!1)},o.listenerCount=function(g,A){return typeof g.listenerCount=="function"?g.listenerCount(A):f.call(g,A)},o.prototype.listenerCount=f;function f(g){var A=this._events;if(A!==void 0){var S=A[g];if(typeof S=="function")return 1;if(S!==void 0)return S.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function p(g,A){for(var S=new Array(A),D=0;D<A;++D)S[D]=g[D];return S}function w(g,A){for(;A+1<g.length;A++)g[A]=g[A+1];g.pop()}function m(g){for(var A=new Array(g.length),S=0;S<A.length;++S)A[S]=g[S].listener||g[S];return A}function b(g,A){return new Promise(function(S,D){function C(k){g.removeListener(A,I),D(k)}function I(){typeof g.removeListener=="function"&&g.removeListener("error",C),S([].slice.call(arguments))}v(g,A,I,{once:!0}),A!=="error"&&E(g,C,{once:!0})})}function E(g,A,S){typeof g.on=="function"&&v(g,"error",A,S)}function v(g,A,S,D){if(typeof g.on=="function")D.once?g.once(A,S):g.on(A,S);else if(typeof g.addEventListener=="function")g.addEventListener(A,function C(I){D.once&&g.removeEventListener(A,C),S(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof g)}return _e.exports}var Mn=Ki();function Xi(){const r=arguments[0];for(let e=1,n=arguments.length;e<n;e++)if(arguments[e])for(const t in arguments[e])r[t]=arguments[e][t];return r}let le=Xi;typeof Object.assign=="function"&&(le=Object.assign);function Ae(r,e,n,t){const i=r._nodes.get(e);let o=null;return i&&(t==="mixed"?o=i.out&&i.out[n]||i.undirected&&i.undirected[n]:t==="directed"?o=i.out&&i.out[n]:o=i.undirected&&i.undirected[n]),o}function pe(r){return typeof r=="object"&&r!==null}function zn(r){let e;for(e in r)return!1;return!0}function De(r,e,n){Object.defineProperty(r,e,{enumerable:!1,configurable:!1,writable:!0,value:n})}function Ie(r,e,n){const t={enumerable:!0,configurable:!0};typeof n=="function"?t.get=n:(t.value=n,t.writable=!1),Object.defineProperty(r,e,t)}function Un(r){return!(!pe(r)||r.attributes&&!Array.isArray(r.attributes))}function Zi(){let r=Math.floor(Math.random()*256)&255;return()=>r++}function ze(){const r=arguments;let e=null,n=-1;return{[Symbol.iterator](){return this},next(){let t=null;do{if(e===null){if(n++,n>=r.length)return{done:!0};e=r[n][Symbol.iterator]()}if(t=e.next(),t.done){e=null;continue}break}while(!0);return t}}}function Ze(){return{[Symbol.iterator](){return this},next(){return{done:!0}}}}class Ut extends Error{constructor(e){super(),this.name="GraphError",this.message=e}}class F extends Ut{constructor(e){super(e),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,F.prototype.constructor)}}class G extends Ut{constructor(e){super(e),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,G.prototype.constructor)}}class W extends Ut{constructor(e){super(e),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,W.prototype.constructor)}}function $n(r,e){this.key=r,this.attributes=e,this.clear()}$n.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function Bn(r,e){this.key=r,this.attributes=e,this.clear()}Bn.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function Wn(r,e){this.key=r,this.attributes=e,this.clear()}Wn.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function Je(r,e,n,t,i){this.key=e,this.attributes=i,this.undirected=r,this.source=n,this.target=t}Je.prototype.attach=function(){let r="out",e="in";this.undirected&&(r=e="undirected");const n=this.source.key,t=this.target.key;this.source[r][t]=this,!(this.undirected&&n===t)&&(this.target[e][n]=this)},Je.prototype.attachMulti=function(){let r="out",e="in";const n=this.source.key,t=this.target.key;this.undirected&&(r=e="undirected");const i=this.source[r],o=i[t];if(typeof o>"u"){i[t]=this,this.undirected&&n===t||(this.target[e][n]=this);return}o.previous=this,this.next=o,i[t]=this,this.target[e][n]=this},Je.prototype.detach=function(){const r=this.source.key,e=this.target.key;let n="out",t="in";this.undirected&&(n=t="undirected"),delete this.source[n][e],delete this.target[t][r]},Je.prototype.detachMulti=function(){const r=this.source.key,e=this.target.key;let n="out",t="in";this.undirected&&(n=t="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[n][e],delete this.target[t][r]):(this.next.previous=void 0,this.source[n][e]=this.next,this.target[t][r]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const Hn=0,jn=1,Ji=2,Vn=3;function Ue(r,e,n,t,i,o,a){let s,u,c,h;if(t=""+t,n===Hn){if(s=r._nodes.get(t),!s)throw new G(`Graph.${e}: could not find the "${t}" node in the graph.`);c=i,h=o}else if(n===Vn){if(i=""+i,u=r._edges.get(i),!u)throw new G(`Graph.${e}: could not find the "${i}" edge in the graph.`);const l=u.source.key,d=u.target.key;if(t===l)s=u.target;else if(t===d)s=u.source;else throw new G(`Graph.${e}: the "${t}" node is not attached to the "${i}" edge (${l}, ${d}).`);c=o,h=a}else{if(u=r._edges.get(t),!u)throw new G(`Graph.${e}: could not find the "${t}" edge in the graph.`);n===jn?s=u.source:s=u.target,c=i,h=o}return[s,c,h]}function Qi(r,e,n){r.prototype[e]=function(t,i,o){const[a,s]=Ue(this,e,n,t,i,o);return a.attributes[s]}}function eo(r,e,n){r.prototype[e]=function(t,i){const[o]=Ue(this,e,n,t,i);return o.attributes}}function to(r,e,n){r.prototype[e]=function(t,i,o){const[a,s]=Ue(this,e,n,t,i,o);return a.attributes.hasOwnProperty(s)}}function no(r,e,n){r.prototype[e]=function(t,i,o,a){const[s,u,c]=Ue(this,e,n,t,i,o,a);return s.attributes[u]=c,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function ro(r,e,n){r.prototype[e]=function(t,i,o,a){const[s,u,c]=Ue(this,e,n,t,i,o,a);if(typeof c!="function")throw new F(`Graph.${e}: updater should be a function.`);const h=s.attributes,l=c(h[u]);return h[u]=l,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function io(r,e,n){r.prototype[e]=function(t,i,o){const[a,s]=Ue(this,e,n,t,i,o);return delete a.attributes[s],this.emit("nodeAttributesUpdated",{key:a.key,type:"remove",attributes:a.attributes,name:s}),this}}function oo(r,e,n){r.prototype[e]=function(t,i,o){const[a,s]=Ue(this,e,n,t,i,o);if(!pe(s))throw new F(`Graph.${e}: provided attributes are not a plain object.`);return a.attributes=s,this.emit("nodeAttributesUpdated",{key:a.key,type:"replace",attributes:a.attributes}),this}}function so(r,e,n){r.prototype[e]=function(t,i,o){const[a,s]=Ue(this,e,n,t,i,o);if(!pe(s))throw new F(`Graph.${e}: provided attributes are not a plain object.`);return le(a.attributes,s),this.emit("nodeAttributesUpdated",{key:a.key,type:"merge",attributes:a.attributes,data:s}),this}}function ao(r,e,n){r.prototype[e]=function(t,i,o){const[a,s]=Ue(this,e,n,t,i,o);if(typeof s!="function")throw new F(`Graph.${e}: provided updater is not a function.`);return a.attributes=s(a.attributes),this.emit("nodeAttributesUpdated",{key:a.key,type:"update",attributes:a.attributes}),this}}const uo=[{name:r=>`get${r}Attribute`,attacher:Qi},{name:r=>`get${r}Attributes`,attacher:eo},{name:r=>`has${r}Attribute`,attacher:to},{name:r=>`set${r}Attribute`,attacher:no},{name:r=>`update${r}Attribute`,attacher:ro},{name:r=>`remove${r}Attribute`,attacher:io},{name:r=>`replace${r}Attributes`,attacher:oo},{name:r=>`merge${r}Attributes`,attacher:so},{name:r=>`update${r}Attributes`,attacher:ao}];function co(r){uo.forEach(function({name:e,attacher:n}){n(r,e("Node"),Hn),n(r,e("Source"),jn),n(r,e("Target"),Ji),n(r,e("Opposite"),Vn)})}function ho(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new W(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new W(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+t,s=""+i;if(i=arguments[2],o=Ae(this,a,s,n),!o)throw new G(`Graph.${e}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new W(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new G(`Graph.${e}: could not find the "${t}" edge in the graph.`)}return o.attributes[i]}}function lo(r,e,n){r.prototype[e]=function(t){let i;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new W(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new W(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+t,a=""+arguments[1];if(i=Ae(this,o,a,n),!i)throw new G(`Graph.${e}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(n!=="mixed")throw new W(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,i=this._edges.get(t),!i)throw new G(`Graph.${e}: could not find the "${t}" edge in the graph.`)}return i.attributes}}function fo(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new W(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new W(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+t,s=""+i;if(i=arguments[2],o=Ae(this,a,s,n),!o)throw new G(`Graph.${e}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new W(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new G(`Graph.${e}: could not find the "${t}" edge in the graph.`)}return o.attributes.hasOwnProperty(i)}}function go(r,e,n){r.prototype[e]=function(t,i,o){let a;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new W(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new W(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+t,u=""+i;if(i=arguments[2],o=arguments[3],a=Ae(this,s,u,n),!a)throw new G(`Graph.${e}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(n!=="mixed")throw new W(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,a=this._edges.get(t),!a)throw new G(`Graph.${e}: could not find the "${t}" edge in the graph.`)}return a.attributes[i]=o,this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:i}),this}}function po(r,e,n){r.prototype[e]=function(t,i,o){let a;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new W(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new W(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+t,u=""+i;if(i=arguments[2],o=arguments[3],a=Ae(this,s,u,n),!a)throw new G(`Graph.${e}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(n!=="mixed")throw new W(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,a=this._edges.get(t),!a)throw new G(`Graph.${e}: could not find the "${t}" edge in the graph.`)}if(typeof o!="function")throw new F(`Graph.${e}: updater should be a function.`);return a.attributes[i]=o(a.attributes[i]),this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:i}),this}}function mo(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new W(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new W(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+t,s=""+i;if(i=arguments[2],o=Ae(this,a,s,n),!o)throw new G(`Graph.${e}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new W(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new G(`Graph.${e}: could not find the "${t}" edge in the graph.`)}return delete o.attributes[i],this.emit("edgeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:i}),this}}function vo(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new W(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new W(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+t,s=""+i;if(i=arguments[2],o=Ae(this,a,s,n),!o)throw new G(`Graph.${e}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new W(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new G(`Graph.${e}: could not find the "${t}" edge in the graph.`)}if(!pe(i))throw new F(`Graph.${e}: provided attributes are not a plain object.`);return o.attributes=i,this.emit("edgeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function yo(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new W(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new W(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+t,s=""+i;if(i=arguments[2],o=Ae(this,a,s,n),!o)throw new G(`Graph.${e}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new W(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new G(`Graph.${e}: could not find the "${t}" edge in the graph.`)}if(!pe(i))throw new F(`Graph.${e}: provided attributes are not a plain object.`);return le(o.attributes,i),this.emit("edgeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:i}),this}}function bo(r,e,n){r.prototype[e]=function(t,i){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new W(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new W(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+t,s=""+i;if(i=arguments[2],o=Ae(this,a,s,n),!o)throw new G(`Graph.${e}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new W(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(t=""+t,o=this._edges.get(t),!o)throw new G(`Graph.${e}: could not find the "${t}" edge in the graph.`)}if(typeof i!="function")throw new F(`Graph.${e}: provided updater is not a function.`);return o.attributes=i(o.attributes),this.emit("edgeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const wo=[{name:r=>`get${r}Attribute`,attacher:ho},{name:r=>`get${r}Attributes`,attacher:lo},{name:r=>`has${r}Attribute`,attacher:fo},{name:r=>`set${r}Attribute`,attacher:go},{name:r=>`update${r}Attribute`,attacher:po},{name:r=>`remove${r}Attribute`,attacher:mo},{name:r=>`replace${r}Attributes`,attacher:vo},{name:r=>`merge${r}Attributes`,attacher:yo},{name:r=>`update${r}Attributes`,attacher:bo}];function Eo(r){wo.forEach(function({name:e,attacher:n}){n(r,e("Edge"),"mixed"),n(r,e("DirectedEdge"),"directed"),n(r,e("UndirectedEdge"),"undirected")})}const So=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function To(r,e,n,t){let i=!1;for(const o in e){if(o===t)continue;const a=e[o];if(i=n(a.key,a.attributes,a.source.key,a.target.key,a.source.attributes,a.target.attributes,a.undirected),r&&i)return a.key}}function _o(r,e,n,t){let i,o,a,s=!1;for(const u in e)if(u!==t){i=e[u];do{if(o=i.source,a=i.target,s=n(i.key,i.attributes,o.key,a.key,o.attributes,a.attributes,i.undirected),r&&s)return i.key;i=i.next}while(i!==void 0)}}function $t(r,e){const n=Object.keys(r),t=n.length;let i,o=0;return{[Symbol.iterator](){return this},next(){do if(i)i=i.next;else{if(o>=t)return{done:!0};const a=n[o++];if(a===e){i=void 0;continue}i=r[a]}while(!i);return{done:!1,value:{edge:i.key,attributes:i.attributes,source:i.source.key,target:i.target.key,sourceAttributes:i.source.attributes,targetAttributes:i.target.attributes,undirected:i.undirected}}}}}function Ao(r,e,n,t){const i=e[n];if(!i)return;const o=i.source,a=i.target;if(t(i.key,i.attributes,o.key,a.key,o.attributes,a.attributes,i.undirected)&&r)return i.key}function Do(r,e,n,t){let i=e[n];if(!i)return;let o=!1;do{if(o=t(i.key,i.attributes,i.source.key,i.target.key,i.source.attributes,i.target.attributes,i.undirected),r&&o)return i.key;i=i.next}while(i!==void 0)}function Bt(r,e){let n=r[e];if(n.next!==void 0)return{[Symbol.iterator](){return this},next(){if(!n)return{done:!0};const i={edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected};return n=n.next,{done:!1,value:i}}};let t=!1;return{[Symbol.iterator](){return this},next(){return t===!0?{done:!0}:(t=!0,{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}})}}}function Ro(r,e){if(r.size===0)return[];if(e==="mixed"||e===r.type)return Array.from(r._edges.keys());const n=e==="undirected"?r.undirectedSize:r.directedSize,t=new Array(n),i=e==="undirected",o=r._edges.values();let a=0,s,u;for(;s=o.next(),s.done!==!0;)u=s.value,u.undirected===i&&(t[a++]=u.key);return t}function qn(r,e,n,t){if(e.size===0)return;const i=n!=="mixed"&&n!==e.type,o=n==="undirected";let a,s,u=!1;const c=e._edges.values();for(;a=c.next(),a.done!==!0;){if(s=a.value,i&&s.undirected!==o)continue;const{key:h,attributes:l,source:d,target:f}=s;if(u=t(h,l,d.key,f.key,d.attributes,f.attributes,s.undirected),r&&u)return h}}function Co(r,e){if(r.size===0)return Ze();const n=e!=="mixed"&&e!==r.type,t=e==="undirected",i=r._edges.values();return{[Symbol.iterator](){return this},next(){let o,a;for(;;){if(o=i.next(),o.done)return o;if(a=o.value,!(n&&a.undirected!==t))break}return{value:{edge:a.key,attributes:a.attributes,source:a.source.key,target:a.target.key,sourceAttributes:a.source.attributes,targetAttributes:a.target.attributes,undirected:a.undirected},done:!1}}}}function Wt(r,e,n,t,i,o){const a=e?_o:To;let s;if(n!=="undirected"&&(t!=="out"&&(s=a(r,i.in,o),r&&s)||t!=="in"&&(s=a(r,i.out,o,t?void 0:i.key),r&&s))||n!=="directed"&&(s=a(r,i.undirected,o),r&&s))return s}function Io(r,e,n,t){const i=[];return Wt(!1,r,e,n,t,function(o){i.push(o)}),i}function Lo(r,e,n){let t=Ze();return r!=="undirected"&&(e!=="out"&&typeof n.in<"u"&&(t=ze(t,$t(n.in))),e!=="in"&&typeof n.out<"u"&&(t=ze(t,$t(n.out,e?void 0:n.key)))),r!=="directed"&&typeof n.undirected<"u"&&(t=ze(t,$t(n.undirected))),t}function Ht(r,e,n,t,i,o,a){const s=n?Do:Ao;let u;if(e!=="undirected"&&(typeof i.in<"u"&&t!=="out"&&(u=s(r,i.in,o,a),r&&u)||typeof i.out<"u"&&t!=="in"&&(t||i.key!==o)&&(u=s(r,i.out,o,a),r&&u))||e!=="directed"&&typeof i.undirected<"u"&&(u=s(r,i.undirected,o,a),r&&u))return u}function ko(r,e,n,t,i){const o=[];return Ht(!1,r,e,n,t,i,function(a){o.push(a)}),o}function xo(r,e,n,t){let i=Ze();return r!=="undirected"&&(typeof n.in<"u"&&e!=="out"&&t in n.in&&(i=ze(i,Bt(n.in,t))),typeof n.out<"u"&&e!=="in"&&t in n.out&&(e||n.key!==t)&&(i=ze(i,Bt(n.out,t)))),r!=="directed"&&typeof n.undirected<"u"&&t in n.undirected&&(i=ze(i,Bt(n.undirected,t))),i}function No(r,e){const{name:n,type:t,direction:i}=e;r.prototype[n]=function(o,a){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return[];if(!arguments.length)return Ro(this,t);if(arguments.length===1){o=""+o;const s=this._nodes.get(o);if(typeof s>"u")throw new G(`Graph.${n}: could not find the "${o}" node in the graph.`);return Io(this.multi,t==="mixed"?this.type:t,i,s)}if(arguments.length===2){o=""+o,a=""+a;const s=this._nodes.get(o);if(!s)throw new G(`Graph.${n}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(a))throw new G(`Graph.${n}:  could not find the "${a}" target node in the graph.`);return ko(t,this.multi,i,s,a)}throw new F(`Graph.${n}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Po(r,e){const{name:n,type:t,direction:i}=e,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);r.prototype[o]=function(c,h,l){if(!(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)){if(arguments.length===1)return l=c,qn(!1,this,t,l);if(arguments.length===2){c=""+c,l=h;const d=this._nodes.get(c);if(typeof d>"u")throw new G(`Graph.${o}: could not find the "${c}" node in the graph.`);return Wt(!1,this.multi,t==="mixed"?this.type:t,i,d,l)}if(arguments.length===3){c=""+c,h=""+h;const d=this._nodes.get(c);if(!d)throw new G(`Graph.${o}:  could not find the "${c}" source node in the graph.`);if(!this._nodes.has(h))throw new G(`Graph.${o}:  could not find the "${h}" target node in the graph.`);return Ht(!1,t,this.multi,i,d,h,l)}throw new F(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const a="map"+n[0].toUpperCase()+n.slice(1);r.prototype[a]=function(){const c=Array.prototype.slice.call(arguments),h=c.pop();let l;if(c.length===0){let d=0;t!=="directed"&&(d+=this.undirectedSize),t!=="undirected"&&(d+=this.directedSize),l=new Array(d);let f=0;c.push((p,w,m,b,E,v,g)=>{l[f++]=h(p,w,m,b,E,v,g)})}else l=[],c.push((d,f,p,w,m,b,E)=>{l.push(h(d,f,p,w,m,b,E))});return this[o].apply(this,c),l};const s="filter"+n[0].toUpperCase()+n.slice(1);r.prototype[s]=function(){const c=Array.prototype.slice.call(arguments),h=c.pop(),l=[];return c.push((d,f,p,w,m,b,E)=>{h(d,f,p,w,m,b,E)&&l.push(d)}),this[o].apply(this,c),l};const u="reduce"+n[0].toUpperCase()+n.slice(1);r.prototype[u]=function(){let c=Array.prototype.slice.call(arguments);if(c.length<2||c.length>4)throw new F(`Graph.${u}: invalid number of arguments (expecting 2, 3 or 4 and got ${c.length}).`);if(typeof c[c.length-1]=="function"&&typeof c[c.length-2]!="function")throw new F(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let h,l;c.length===2?(h=c[0],l=c[1],c=[]):c.length===3?(h=c[1],l=c[2],c=[c[0]]):c.length===4&&(h=c[2],l=c[3],c=[c[0],c[1]]);let d=l;return c.push((f,p,w,m,b,E,v)=>{d=h(d,f,p,w,m,b,E,v)}),this[o].apply(this,c),d}}function Oo(r,e){const{name:n,type:t,direction:i}=e,o="find"+n[0].toUpperCase()+n.slice(1,-1);r.prototype[o]=function(u,c,h){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return!1;if(arguments.length===1)return h=u,qn(!0,this,t,h);if(arguments.length===2){u=""+u,h=c;const l=this._nodes.get(u);if(typeof l>"u")throw new G(`Graph.${o}: could not find the "${u}" node in the graph.`);return Wt(!0,this.multi,t==="mixed"?this.type:t,i,l,h)}if(arguments.length===3){u=""+u,c=""+c;const l=this._nodes.get(u);if(!l)throw new G(`Graph.${o}:  could not find the "${u}" source node in the graph.`);if(!this._nodes.has(c))throw new G(`Graph.${o}:  could not find the "${c}" target node in the graph.`);return Ht(!0,t,this.multi,i,l,c,h)}throw new F(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const a="some"+n[0].toUpperCase()+n.slice(1,-1);r.prototype[a]=function(){const u=Array.prototype.slice.call(arguments),c=u.pop();return u.push((l,d,f,p,w,m,b)=>c(l,d,f,p,w,m,b)),!!this[o].apply(this,u)};const s="every"+n[0].toUpperCase()+n.slice(1,-1);r.prototype[s]=function(){const u=Array.prototype.slice.call(arguments),c=u.pop();return u.push((l,d,f,p,w,m,b)=>!c(l,d,f,p,w,m,b)),!this[o].apply(this,u)}}function Go(r,e){const{name:n,type:t,direction:i}=e,o=n.slice(0,-1)+"Entries";r.prototype[o]=function(a,s){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return Ze();if(!arguments.length)return Co(this,t);if(arguments.length===1){a=""+a;const u=this._nodes.get(a);if(!u)throw new G(`Graph.${o}: could not find the "${a}" node in the graph.`);return Lo(t,i,u)}if(arguments.length===2){a=""+a,s=""+s;const u=this._nodes.get(a);if(!u)throw new G(`Graph.${o}:  could not find the "${a}" source node in the graph.`);if(!this._nodes.has(s))throw new G(`Graph.${o}:  could not find the "${s}" target node in the graph.`);return xo(t,i,u,s)}throw new F(`Graph.${o}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Fo(r){So.forEach(e=>{No(r,e),Po(r,e),Oo(r,e),Go(r,e)})}const Mo=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function vt(){this.A=null,this.B=null}vt.prototype.wrap=function(r){this.A===null?this.A=r:this.B===null&&(this.B=r)},vt.prototype.has=function(r){return this.A!==null&&r in this.A||this.B!==null&&r in this.B};function at(r,e,n,t,i){for(const o in t){const a=t[o],s=a.source,u=a.target,c=s===n?u:s;if(e&&e.has(c.key))continue;const h=i(c.key,c.attributes);if(r&&h)return c.key}}function jt(r,e,n,t,i){if(e!=="mixed"){if(e==="undirected")return at(r,null,t,t.undirected,i);if(typeof n=="string")return at(r,null,t,t[n],i)}const o=new vt;let a;if(e!=="undirected"){if(n!=="out"){if(a=at(r,null,t,t.in,i),r&&a)return a;o.wrap(t.in)}if(n!=="in"){if(a=at(r,o,t,t.out,i),r&&a)return a;o.wrap(t.out)}}if(e!=="directed"&&(a=at(r,o,t,t.undirected,i),r&&a))return a}function zo(r,e,n){if(r!=="mixed"){if(r==="undirected")return Object.keys(n.undirected);if(typeof e=="string")return Object.keys(n[e])}const t=[];return jt(!1,r,e,n,function(i){t.push(i)}),t}function ut(r,e,n){const t=Object.keys(n),i=t.length;let o=0;return{[Symbol.iterator](){return this},next(){let a=null;do{if(o>=i)return r&&r.wrap(n),{done:!0};const s=n[t[o++]],u=s.source,c=s.target;if(a=u===e?c:u,r&&r.has(a.key)){a=null;continue}}while(a===null);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}}}}function Uo(r,e,n){if(r!=="mixed"){if(r==="undirected")return ut(null,n,n.undirected);if(typeof e=="string")return ut(null,n,n[e])}let t=Ze();const i=new vt;return r!=="undirected"&&(e!=="out"&&(t=ze(t,ut(i,n,n.in))),e!=="in"&&(t=ze(t,ut(i,n,n.out)))),r!=="directed"&&(t=ze(t,ut(i,n,n.undirected))),t}function $o(r,e){const{name:n,type:t,direction:i}=e;r.prototype[n]=function(o){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return[];o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new G(`Graph.${n}: could not find the "${o}" node in the graph.`);return zo(t==="mixed"?this.type:t,i,a)}}function Bo(r,e){const{name:n,type:t,direction:i}=e,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);r.prototype[o]=function(c,h){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return;c=""+c;const l=this._nodes.get(c);if(typeof l>"u")throw new G(`Graph.${o}: could not find the "${c}" node in the graph.`);jt(!1,t==="mixed"?this.type:t,i,l,h)};const a="map"+n[0].toUpperCase()+n.slice(1);r.prototype[a]=function(c,h){const l=[];return this[o](c,(d,f)=>{l.push(h(d,f))}),l};const s="filter"+n[0].toUpperCase()+n.slice(1);r.prototype[s]=function(c,h){const l=[];return this[o](c,(d,f)=>{h(d,f)&&l.push(d)}),l};const u="reduce"+n[0].toUpperCase()+n.slice(1);r.prototype[u]=function(c,h,l){if(arguments.length<3)throw new F(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let d=l;return this[o](c,(f,p)=>{d=h(d,f,p)}),d}}function Wo(r,e){const{name:n,type:t,direction:i}=e,o=n[0].toUpperCase()+n.slice(1,-1),a="find"+o;r.prototype[a]=function(c,h){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return;c=""+c;const l=this._nodes.get(c);if(typeof l>"u")throw new G(`Graph.${a}: could not find the "${c}" node in the graph.`);return jt(!0,t==="mixed"?this.type:t,i,l,h)};const s="some"+o;r.prototype[s]=function(c,h){return!!this[a](c,h)};const u="every"+o;r.prototype[u]=function(c,h){return!this[a](c,(d,f)=>!h(d,f))}}function Ho(r,e){const{name:n,type:t,direction:i}=e,o=n.slice(0,-1)+"Entries";r.prototype[o]=function(a){if(t!=="mixed"&&this.type!=="mixed"&&t!==this.type)return Ze();a=""+a;const s=this._nodes.get(a);if(typeof s>"u")throw new G(`Graph.${o}: could not find the "${a}" node in the graph.`);return Uo(t==="mixed"?this.type:t,i,s)}}function jo(r){Mo.forEach(e=>{$o(r,e),Bo(r,e),Wo(r,e),Ho(r,e)})}function yt(r,e,n,t,i){const o=t._nodes.values(),a=t.type;let s,u,c,h,l,d;for(;s=o.next(),s.done!==!0;){let f=!1;if(u=s.value,a!=="undirected"){h=u.out;for(c in h){l=h[c];do d=l.target,f=!0,i(u.key,d.key,u.attributes,d.attributes,l.key,l.attributes,l.undirected),l=l.next;while(l)}}if(a!=="directed"){h=u.undirected;for(c in h)if(!(e&&u.key>c)){l=h[c];do d=l.target,d.key!==c&&(d=l.source),f=!0,i(u.key,d.key,u.attributes,d.attributes,l.key,l.attributes,l.undirected),l=l.next;while(l)}}n&&!f&&i(u.key,null,u.attributes,null,null,null,null)}}function Vo(r,e){const n={key:r};return zn(e.attributes)||(n.attributes=le({},e.attributes)),n}function qo(r,e,n){const t={key:e,source:n.source.key,target:n.target.key};return zn(n.attributes)||(t.attributes=le({},n.attributes)),r==="mixed"&&n.undirected&&(t.undirected=!0),t}function Yo(r){if(!pe(r))throw new F('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in r))throw new F("Graph.import: serialized node is missing its key.");if("attributes"in r&&(!pe(r.attributes)||r.attributes===null))throw new F("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function Ko(r){if(!pe(r))throw new F('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in r))throw new F("Graph.import: serialized edge is missing its source.");if(!("target"in r))throw new F("Graph.import: serialized edge is missing its target.");if("attributes"in r&&(!pe(r.attributes)||r.attributes===null))throw new F("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in r&&typeof r.undirected!="boolean")throw new F("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const Xo=Zi(),Zo=new Set(["directed","undirected","mixed"]),Yn=new Set(["domain","_events","_eventsCount","_maxListeners"]),Jo=[{name:r=>`${r}Edge`,generateKey:!0},{name:r=>`${r}DirectedEdge`,generateKey:!0,type:"directed"},{name:r=>`${r}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:r=>`${r}EdgeWithKey`},{name:r=>`${r}DirectedEdgeWithKey`,type:"directed"},{name:r=>`${r}UndirectedEdgeWithKey`,type:"undirected"}],Qo={allowSelfLoops:!0,multi:!1,type:"mixed"};function es(r,e,n){if(n&&!pe(n))throw new F(`Graph.addNode: invalid attributes. Expecting an object but got "${n}"`);if(e=""+e,n=n||{},r._nodes.has(e))throw new W(`Graph.addNode: the "${e}" node already exist in the graph.`);const t=new r.NodeDataClass(e,n);return r._nodes.set(e,t),r.emit("nodeAdded",{key:e,attributes:n}),t}function Kn(r,e,n){const t=new r.NodeDataClass(e,n);return r._nodes.set(e,t),r.emit("nodeAdded",{key:e,attributes:n}),t}function Xn(r,e,n,t,i,o,a,s){if(!t&&r.type==="undirected")throw new W(`Graph.${e}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(t&&r.type==="directed")throw new W(`Graph.${e}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(s&&!pe(s))throw new F(`Graph.${e}: invalid attributes. Expecting an object but got "${s}"`);if(o=""+o,a=""+a,s=s||{},!r.allowSelfLoops&&o===a)throw new W(`Graph.${e}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const u=r._nodes.get(o),c=r._nodes.get(a);if(!u)throw new G(`Graph.${e}: source node "${o}" not found.`);if(!c)throw new G(`Graph.${e}: target node "${a}" not found.`);const h={key:null,undirected:t,source:o,target:a,attributes:s};if(n)i=r._edgeKeyGenerator();else if(i=""+i,r._edges.has(i))throw new W(`Graph.${e}: the "${i}" edge already exists in the graph.`);if(!r.multi&&(t?typeof u.undirected[a]<"u":typeof u.out[a]<"u"))throw new W(`Graph.${e}: an edge linking "${o}" to "${a}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const l=new Je(t,i,u,c,s);r._edges.set(i,l);const d=o===a;return t?(u.undirectedDegree++,c.undirectedDegree++,d&&(u.undirectedLoops++,r._undirectedSelfLoopCount++)):(u.outDegree++,c.inDegree++,d&&(u.directedLoops++,r._directedSelfLoopCount++)),r.multi?l.attachMulti():l.attach(),t?r._undirectedSize++:r._directedSize++,h.key=i,r.emit("edgeAdded",h),i}function ts(r,e,n,t,i,o,a,s,u){if(!t&&r.type==="undirected")throw new W(`Graph.${e}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(t&&r.type==="directed")throw new W(`Graph.${e}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(s){if(u){if(typeof s!="function")throw new F(`Graph.${e}: invalid updater function. Expecting a function but got "${s}"`)}else if(!pe(s))throw new F(`Graph.${e}: invalid attributes. Expecting an object but got "${s}"`)}o=""+o,a=""+a;let c;if(u&&(c=s,s=void 0),!r.allowSelfLoops&&o===a)throw new W(`Graph.${e}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let h=r._nodes.get(o),l=r._nodes.get(a),d,f;if(!n&&(d=r._edges.get(i),d)){if((d.source.key!==o||d.target.key!==a)&&(!t||d.source.key!==a||d.target.key!==o))throw new W(`Graph.${e}: inconsistency detected when attempting to merge the "${i}" edge with "${o}" source & "${a}" target vs. ("${d.source.key}", "${d.target.key}").`);f=d}if(!f&&!r.multi&&h&&(f=t?h.undirected[a]:h.out[a]),f){const E=[f.key,!1,!1,!1];if(u?!c:!s)return E;if(u){const v=f.attributes;f.attributes=c(v),r.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else le(f.attributes,s),r.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:s});return E}s=s||{},u&&c&&(s=c(s));const p={key:null,undirected:t,source:o,target:a,attributes:s};if(n)i=r._edgeKeyGenerator();else if(i=""+i,r._edges.has(i))throw new W(`Graph.${e}: the "${i}" edge already exists in the graph.`);let w=!1,m=!1;h||(h=Kn(r,o,{}),w=!0,o===a&&(l=h,m=!0)),l||(l=Kn(r,a,{}),m=!0),d=new Je(t,i,h,l,s),r._edges.set(i,d);const b=o===a;return t?(h.undirectedDegree++,l.undirectedDegree++,b&&(h.undirectedLoops++,r._undirectedSelfLoopCount++)):(h.outDegree++,l.inDegree++,b&&(h.directedLoops++,r._directedSelfLoopCount++)),r.multi?d.attachMulti():d.attach(),t?r._undirectedSize++:r._directedSize++,p.key=i,r.emit("edgeAdded",p),[i,!0,w,m]}function Qe(r,e){r._edges.delete(e.key);const{source:n,target:t,attributes:i}=e,o=e.undirected,a=n===t;o?(n.undirectedDegree--,t.undirectedDegree--,a&&(n.undirectedLoops--,r._undirectedSelfLoopCount--)):(n.outDegree--,t.inDegree--,a&&(n.directedLoops--,r._directedSelfLoopCount--)),r.multi?e.detachMulti():e.detach(),o?r._undirectedSize--:r._directedSize--,r.emit("edgeDropped",{key:e.key,attributes:i,source:n.key,target:t.key,undirected:o})}class se extends Mn.EventEmitter{constructor(e){if(super(),e=le({},Qo,e),typeof e.multi!="boolean")throw new F(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${e.multi}".`);if(!Zo.has(e.type))throw new F(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${e.type}".`);if(typeof e.allowSelfLoops!="boolean")throw new F(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${e.allowSelfLoops}".`);const n=e.type==="mixed"?$n:e.type==="directed"?Bn:Wn;De(this,"NodeDataClass",n);const t="geid_"+Xo()+"_";let i=0;const o=()=>{let a;do a=t+i++;while(this._edges.has(a));return a};De(this,"_attributes",{}),De(this,"_nodes",new Map),De(this,"_edges",new Map),De(this,"_directedSize",0),De(this,"_undirectedSize",0),De(this,"_directedSelfLoopCount",0),De(this,"_undirectedSelfLoopCount",0),De(this,"_edgeKeyGenerator",o),De(this,"_options",e),Yn.forEach(a=>De(this,a,this[a])),Ie(this,"order",()=>this._nodes.size),Ie(this,"size",()=>this._edges.size),Ie(this,"directedSize",()=>this._directedSize),Ie(this,"undirectedSize",()=>this._undirectedSize),Ie(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),Ie(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),Ie(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),Ie(this,"multi",this._options.multi),Ie(this,"type",this._options.type),Ie(this,"allowSelfLoops",this._options.allowSelfLoops),Ie(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(e){return this._nodes.has(""+e)}hasDirectedEdge(e,n){if(this.type==="undirected")return!1;if(arguments.length===1){const t=""+e,i=this._edges.get(t);return!!i&&!i.undirected}else if(arguments.length===2){e=""+e,n=""+n;const t=this._nodes.get(e);return t?t.out.hasOwnProperty(n):!1}throw new F(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(e,n){if(this.type==="directed")return!1;if(arguments.length===1){const t=""+e,i=this._edges.get(t);return!!i&&i.undirected}else if(arguments.length===2){e=""+e,n=""+n;const t=this._nodes.get(e);return t?t.undirected.hasOwnProperty(n):!1}throw new F(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(e,n){if(arguments.length===1){const t=""+e;return this._edges.has(t)}else if(arguments.length===2){e=""+e,n=""+n;const t=this._nodes.get(e);return t?typeof t.out<"u"&&t.out.hasOwnProperty(n)||typeof t.undirected<"u"&&t.undirected.hasOwnProperty(n):!1}throw new F(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(e,n){if(this.type==="undirected")return;if(e=""+e,n=""+n,this.multi)throw new W("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const t=this._nodes.get(e);if(!t)throw new G(`Graph.directedEdge: could not find the "${e}" source node in the graph.`);if(!this._nodes.has(n))throw new G(`Graph.directedEdge: could not find the "${n}" target node in the graph.`);const i=t.out&&t.out[n]||void 0;if(i)return i.key}undirectedEdge(e,n){if(this.type==="directed")return;if(e=""+e,n=""+n,this.multi)throw new W("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const t=this._nodes.get(e);if(!t)throw new G(`Graph.undirectedEdge: could not find the "${e}" source node in the graph.`);if(!this._nodes.has(n))throw new G(`Graph.undirectedEdge: could not find the "${n}" target node in the graph.`);const i=t.undirected&&t.undirected[n]||void 0;if(i)return i.key}edge(e,n){if(this.multi)throw new W("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new G(`Graph.edge: could not find the "${e}" source node in the graph.`);if(!this._nodes.has(n))throw new G(`Graph.edge: could not find the "${n}" target node in the graph.`);const i=t.out&&t.out[n]||t.undirected&&t.undirected[n]||void 0;if(i)return i.key}areDirectedNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new G(`Graph.areDirectedNeighbors: could not find the "${e}" node in the graph.`);return this.type==="undirected"?!1:n in t.in||n in t.out}areOutNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new G(`Graph.areOutNeighbors: could not find the "${e}" node in the graph.`);return this.type==="undirected"?!1:n in t.out}areInNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new G(`Graph.areInNeighbors: could not find the "${e}" node in the graph.`);return this.type==="undirected"?!1:n in t.in}areUndirectedNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new G(`Graph.areUndirectedNeighbors: could not find the "${e}" node in the graph.`);return this.type==="directed"?!1:n in t.undirected}areNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new G(`Graph.areNeighbors: could not find the "${e}" node in the graph.`);return this.type!=="undirected"&&(n in t.in||n in t.out)||this.type!=="directed"&&n in t.undirected}areInboundNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new G(`Graph.areInboundNeighbors: could not find the "${e}" node in the graph.`);return this.type!=="undirected"&&n in t.in||this.type!=="directed"&&n in t.undirected}areOutboundNeighbors(e,n){e=""+e,n=""+n;const t=this._nodes.get(e);if(!t)throw new G(`Graph.areOutboundNeighbors: could not find the "${e}" node in the graph.`);return this.type!=="undirected"&&n in t.out||this.type!=="directed"&&n in t.undirected}inDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.inDegree: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.inDegree}outDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.outDegree: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.outDegree}directedDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.directedDegree: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree}undirectedDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.undirectedDegree: could not find the "${e}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree}inboundDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.inboundDegree: could not find the "${e}" node in the graph.`);let t=0;return this.type!=="directed"&&(t+=n.undirectedDegree),this.type!=="undirected"&&(t+=n.inDegree),t}outboundDegree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.outboundDegree: could not find the "${e}" node in the graph.`);let t=0;return this.type!=="directed"&&(t+=n.undirectedDegree),this.type!=="undirected"&&(t+=n.outDegree),t}degree(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.degree: could not find the "${e}" node in the graph.`);let t=0;return this.type!=="directed"&&(t+=n.undirectedDegree),this.type!=="undirected"&&(t+=n.inDegree+n.outDegree),t}inDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.inDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.inDegree-n.directedLoops}outDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.outDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.outDegree-n.directedLoops}directedDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.directedDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree-n.directedLoops*2}undirectedDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree-n.undirectedLoops*2}inboundDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);let t=0,i=0;return this.type!=="directed"&&(t+=n.undirectedDegree,i+=n.undirectedLoops*2),this.type!=="undirected"&&(t+=n.inDegree,i+=n.directedLoops),t-i}outboundDegreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);let t=0,i=0;return this.type!=="directed"&&(t+=n.undirectedDegree,i+=n.undirectedLoops*2),this.type!=="undirected"&&(t+=n.outDegree,i+=n.directedLoops),t-i}degreeWithoutSelfLoops(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.degreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);let t=0,i=0;return this.type!=="directed"&&(t+=n.undirectedDegree,i+=n.undirectedLoops*2),this.type!=="undirected"&&(t+=n.inDegree+n.outDegree,i+=n.directedLoops*2),t-i}source(e){e=""+e;const n=this._edges.get(e);if(!n)throw new G(`Graph.source: could not find the "${e}" edge in the graph.`);return n.source.key}target(e){e=""+e;const n=this._edges.get(e);if(!n)throw new G(`Graph.target: could not find the "${e}" edge in the graph.`);return n.target.key}extremities(e){e=""+e;const n=this._edges.get(e);if(!n)throw new G(`Graph.extremities: could not find the "${e}" edge in the graph.`);return[n.source.key,n.target.key]}opposite(e,n){e=""+e,n=""+n;const t=this._edges.get(n);if(!t)throw new G(`Graph.opposite: could not find the "${n}" edge in the graph.`);const i=t.source.key,o=t.target.key;if(e===i)return o;if(e===o)return i;throw new G(`Graph.opposite: the "${e}" node is not attached to the "${n}" edge (${i}, ${o}).`)}hasExtremity(e,n){e=""+e,n=""+n;const t=this._edges.get(e);if(!t)throw new G(`Graph.hasExtremity: could not find the "${e}" edge in the graph.`);return t.source.key===n||t.target.key===n}isUndirected(e){e=""+e;const n=this._edges.get(e);if(!n)throw new G(`Graph.isUndirected: could not find the "${e}" edge in the graph.`);return n.undirected}isDirected(e){e=""+e;const n=this._edges.get(e);if(!n)throw new G(`Graph.isDirected: could not find the "${e}" edge in the graph.`);return!n.undirected}isSelfLoop(e){e=""+e;const n=this._edges.get(e);if(!n)throw new G(`Graph.isSelfLoop: could not find the "${e}" edge in the graph.`);return n.source===n.target}addNode(e,n){return es(this,e,n).key}mergeNode(e,n){if(n&&!pe(n))throw new F(`Graph.mergeNode: invalid attributes. Expecting an object but got "${n}"`);e=""+e,n=n||{};let t=this._nodes.get(e);return t?(n&&(le(t.attributes,n),this.emit("nodeAttributesUpdated",{type:"merge",key:e,attributes:t.attributes,data:n})),[e,!1]):(t=new this.NodeDataClass(e,n),this._nodes.set(e,t),this.emit("nodeAdded",{key:e,attributes:n}),[e,!0])}updateNode(e,n){if(n&&typeof n!="function")throw new F(`Graph.updateNode: invalid updater function. Expecting a function but got "${n}"`);e=""+e;let t=this._nodes.get(e);if(t){if(n){const o=t.attributes;t.attributes=n(o),this.emit("nodeAttributesUpdated",{type:"replace",key:e,attributes:t.attributes})}return[e,!1]}const i=n?n({}):{};return t=new this.NodeDataClass(e,i),this._nodes.set(e,t),this.emit("nodeAdded",{key:e,attributes:i}),[e,!0]}dropNode(e){e=""+e;const n=this._nodes.get(e);if(!n)throw new G(`Graph.dropNode: could not find the "${e}" node in the graph.`);let t;if(this.type!=="undirected"){for(const i in n.out){t=n.out[i];do Qe(this,t),t=t.next;while(t)}for(const i in n.in){t=n.in[i];do Qe(this,t),t=t.next;while(t)}}if(this.type!=="directed")for(const i in n.undirected){t=n.undirected[i];do Qe(this,t),t=t.next;while(t)}this._nodes.delete(e),this.emit("nodeDropped",{key:e,attributes:n.attributes})}dropEdge(e){let n;if(arguments.length>1){const t=""+arguments[0],i=""+arguments[1];if(n=Ae(this,t,i,this.type),!n)throw new G(`Graph.dropEdge: could not find the "${t}" -> "${i}" edge in the graph.`)}else if(e=""+e,n=this._edges.get(e),!n)throw new G(`Graph.dropEdge: could not find the "${e}" edge in the graph.`);return Qe(this,n),this}dropDirectedEdge(e,n){if(arguments.length<2)throw new W("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new W("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");e=""+e,n=""+n;const t=Ae(this,e,n,"directed");if(!t)throw new G(`Graph.dropDirectedEdge: could not find a "${e}" -> "${n}" edge in the graph.`);return Qe(this,t),this}dropUndirectedEdge(e,n){if(arguments.length<2)throw new W("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new W("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const t=Ae(this,e,n,"undirected");if(!t)throw new G(`Graph.dropUndirectedEdge: could not find a "${e}" -> "${n}" edge in the graph.`);return Qe(this,t),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const e=this._nodes.values();let n;for(;n=e.next(),n.done!==!0;)n.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(e){return this._attributes[e]}getAttributes(){return this._attributes}hasAttribute(e){return this._attributes.hasOwnProperty(e)}setAttribute(e,n){return this._attributes[e]=n,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:e}),this}updateAttribute(e,n){if(typeof n!="function")throw new F("Graph.updateAttribute: updater should be a function.");const t=this._attributes[e];return this._attributes[e]=n(t),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:e}),this}removeAttribute(e){return delete this._attributes[e],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:e}),this}replaceAttributes(e){if(!pe(e))throw new F("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=e,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(e){if(!pe(e))throw new F("Graph.mergeAttributes: provided attributes are not a plain object.");return le(this._attributes,e),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:e}),this}updateAttributes(e){if(typeof e!="function")throw new F("Graph.updateAttributes: provided updater is not a function.");return this._attributes=e(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(e,n){if(typeof e!="function")throw new F("Graph.updateEachNodeAttributes: expecting an updater function.");if(n&&!Un(n))throw new F("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const t=this._nodes.values();let i,o;for(;i=t.next(),i.done!==!0;)o=i.value,o.attributes=e(o.key,o.attributes);this.emit("eachNodeAttributesUpdated",{hints:n||null})}updateEachEdgeAttributes(e,n){if(typeof e!="function")throw new F("Graph.updateEachEdgeAttributes: expecting an updater function.");if(n&&!Un(n))throw new F("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const t=this._edges.values();let i,o,a,s;for(;i=t.next(),i.done!==!0;)o=i.value,a=o.source,s=o.target,o.attributes=e(o.key,o.attributes,a.key,s.key,a.attributes,s.attributes,o.undirected);this.emit("eachEdgeAttributesUpdated",{hints:n||null})}forEachAdjacencyEntry(e){if(typeof e!="function")throw new F("Graph.forEachAdjacencyEntry: expecting a callback.");yt(!1,!1,!1,this,e)}forEachAdjacencyEntryWithOrphans(e){if(typeof e!="function")throw new F("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");yt(!1,!1,!0,this,e)}forEachAssymetricAdjacencyEntry(e){if(typeof e!="function")throw new F("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");yt(!1,!0,!1,this,e)}forEachAssymetricAdjacencyEntryWithOrphans(e){if(typeof e!="function")throw new F("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");yt(!1,!0,!0,this,e)}nodes(){return Array.from(this._nodes.keys())}forEachNode(e){if(typeof e!="function")throw new F("Graph.forEachNode: expecting a callback.");const n=this._nodes.values();let t,i;for(;t=n.next(),t.done!==!0;)i=t.value,e(i.key,i.attributes)}findNode(e){if(typeof e!="function")throw new F("Graph.findNode: expecting a callback.");const n=this._nodes.values();let t,i;for(;t=n.next(),t.done!==!0;)if(i=t.value,e(i.key,i.attributes))return i.key}mapNodes(e){if(typeof e!="function")throw new F("Graph.mapNode: expecting a callback.");const n=this._nodes.values();let t,i;const o=new Array(this.order);let a=0;for(;t=n.next(),t.done!==!0;)i=t.value,o[a++]=e(i.key,i.attributes);return o}someNode(e){if(typeof e!="function")throw new F("Graph.someNode: expecting a callback.");const n=this._nodes.values();let t,i;for(;t=n.next(),t.done!==!0;)if(i=t.value,e(i.key,i.attributes))return!0;return!1}everyNode(e){if(typeof e!="function")throw new F("Graph.everyNode: expecting a callback.");const n=this._nodes.values();let t,i;for(;t=n.next(),t.done!==!0;)if(i=t.value,!e(i.key,i.attributes))return!1;return!0}filterNodes(e){if(typeof e!="function")throw new F("Graph.filterNodes: expecting a callback.");const n=this._nodes.values();let t,i;const o=[];for(;t=n.next(),t.done!==!0;)i=t.value,e(i.key,i.attributes)&&o.push(i.key);return o}reduceNodes(e,n){if(typeof e!="function")throw new F("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new F("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let t=n;const i=this._nodes.values();let o,a;for(;o=i.next(),o.done!==!0;)a=o.value,t=e(t,a.key,a.attributes);return t}nodeEntries(){const e=this._nodes.values();return{[Symbol.iterator](){return this},next(){const n=e.next();if(n.done)return n;const t=n.value;return{value:{node:t.key,attributes:t.attributes},done:!1}}}}export(){const e=new Array(this._nodes.size);let n=0;this._nodes.forEach((i,o)=>{e[n++]=Vo(o,i)});const t=new Array(this._edges.size);return n=0,this._edges.forEach((i,o)=>{t[n++]=qo(this.type,o,i)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:e,edges:t}}import(e,n=!1){if(e instanceof se)return e.forEachNode((u,c)=>{n?this.mergeNode(u,c):this.addNode(u,c)}),e.forEachEdge((u,c,h,l,d,f,p)=>{n?p?this.mergeUndirectedEdgeWithKey(u,h,l,c):this.mergeDirectedEdgeWithKey(u,h,l,c):p?this.addUndirectedEdgeWithKey(u,h,l,c):this.addDirectedEdgeWithKey(u,h,l,c)}),this;if(!pe(e))throw new F("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(e.attributes){if(!pe(e.attributes))throw new F("Graph.import: invalid attributes. Expecting a plain object.");n?this.mergeAttributes(e.attributes):this.replaceAttributes(e.attributes)}let t,i,o,a,s;if(e.nodes){if(o=e.nodes,!Array.isArray(o))throw new F("Graph.import: invalid nodes. Expecting an array.");for(t=0,i=o.length;t<i;t++){a=o[t],Yo(a);const{key:u,attributes:c}=a;n?this.mergeNode(u,c):this.addNode(u,c)}}if(e.edges){let u=!1;if(this.type==="undirected"&&(u=!0),o=e.edges,!Array.isArray(o))throw new F("Graph.import: invalid edges. Expecting an array.");for(t=0,i=o.length;t<i;t++){s=o[t],Ko(s);const{source:c,target:h,attributes:l,undirected:d=u}=s;let f;"key"in s?(f=n?d?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:d?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,s.key,c,h,l)):(f=n?d?this.mergeUndirectedEdge:this.mergeDirectedEdge:d?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,c,h,l))}}return this}nullCopy(e){const n=new se(le({},this._options,e));return n.replaceAttributes(le({},this.getAttributes())),n}emptyCopy(e){const n=this.nullCopy(e);return this._nodes.forEach((t,i)=>{const o=le({},t.attributes);t=new n.NodeDataClass(i,o),n._nodes.set(i,t)}),n}copy(e){if(e=e||{},typeof e.type=="string"&&e.type!==this.type&&e.type!=="mixed")throw new W(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${e.type}" because this would mean losing information about the current graph.`);if(typeof e.multi=="boolean"&&e.multi!==this.multi&&e.multi!==!0)throw new W("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof e.allowSelfLoops=="boolean"&&e.allowSelfLoops!==this.allowSelfLoops&&e.allowSelfLoops!==!0)throw new W("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const n=this.emptyCopy(e),t=this._edges.values();let i,o;for(;i=t.next(),i.done!==!0;)o=i.value,Xn(n,"copy",!1,o.undirected,o.key,o.source.key,o.target.key,le({},o.attributes));return n}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const e={};this._nodes.forEach((o,a)=>{e[a]=o.attributes});const n={},t={};this._edges.forEach((o,a)=>{const s=o.undirected?"--":"->";let u="",c=o.source.key,h=o.target.key,l;o.undirected&&c>h&&(l=c,c=h,h=l);const d=`(${c})${s}(${h})`;a.startsWith("geid_")?this.multi&&(typeof t[d]>"u"?t[d]=0:t[d]++,u+=`${t[d]}. `):u+=`[${a}]: `,u+=d,n[u]=o.attributes});const i={};for(const o in this)this.hasOwnProperty(o)&&!Yn.has(o)&&typeof this[o]!="function"&&typeof o!="symbol"&&(i[o]=this[o]);return i.attributes=this._attributes,i.nodes=e,i.edges=n,De(i,"constructor",this.constructor),i}}typeof Symbol<"u"&&(se.prototype[Symbol.for("nodejs.util.inspect.custom")]=se.prototype.inspect),Jo.forEach(r=>{["add","merge","update"].forEach(e=>{const n=r.name(e),t=e==="add"?Xn:ts;r.generateKey?se.prototype[n]=function(i,o,a){return t(this,n,!0,(r.type||this.type)==="undirected",null,i,o,a,e==="update")}:se.prototype[n]=function(i,o,a,s){return t(this,n,!1,(r.type||this.type)==="undirected",i,o,a,s,e==="update")}})}),co(se),Eo(se),Fo(se),jo(se);class Zn extends se{constructor(e){const n=le({type:"directed"},e);if("multi"in n&&n.multi!==!1)throw new F("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="directed")throw new F('DirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Jn extends se{constructor(e){const n=le({type:"undirected"},e);if("multi"in n&&n.multi!==!1)throw new F("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="undirected")throw new F('UndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Qn extends se{constructor(e){const n=le({multi:!0},e);if("multi"in n&&n.multi!==!0)throw new F("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(n)}}class er extends se{constructor(e){const n=le({type:"directed",multi:!0},e);if("multi"in n&&n.multi!==!0)throw new F("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="directed")throw new F('MultiDirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class tr extends se{constructor(e){const n=le({type:"undirected",multi:!0},e);if("multi"in n&&n.multi!==!0)throw new F("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="undirected")throw new F('MultiUndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}function et(r){r.from=function(e,n){const t=le({},e.options,n),i=new r(t);return i.import(e),i}}et(se),et(Zn),et(Jn),et(Qn),et(er),et(tr),se.Graph=se,se.DirectedGraph=Zn,se.UndirectedGraph=Jn,se.MultiGraph=Qn,se.MultiDirectedGraph=er,se.MultiUndirectedGraph=tr,se.InvalidArgumentsGraphError=F,se.NotFoundGraphError=G,se.UsageGraphError=W;function ns(r,e){if(typeof r!="object"||!r)return r;var n=r[Symbol.toPrimitive];if(n!==void 0){var t=n.call(r,e);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function ct(r){var e=ns(r,"string");return typeof e=="symbol"?e:e+""}function ve(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function nr(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,ct(t.key),t)}}function ye(r,e,n){return e&&nr(r.prototype,e),n&&nr(r,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function tt(r){return tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},tt(r)}function rr(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rr=function(){return!!r})()}function rs(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function is(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rs(r)}function Re(r,e,n){return e=tt(e),is(r,rr()?Reflect.construct(e,n||[],tt(r).constructor):e.apply(r,n))}function Vt(r,e){return Vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},Vt(r,e)}function Ce(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&Vt(r,e)}function os(r){if(Array.isArray(r))return r}function ss(r,e){var n=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(n!=null){var t,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(r)).next,e===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(t=o.call(n)).done)&&(s.push(t.value),s.length!==e);u=!0);}catch(h){c=!0,i=h}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}function qt(r,e){(e==null||e>r.length)&&(e=r.length);for(var n=0,t=Array(e);n<e;n++)t[n]=r[n];return t}function ir(r,e){if(r){if(typeof r=="string")return qt(r,e);var n={}.toString.call(r).slice(8,-1);return n==="Object"&&r.constructor&&(n=r.constructor.name),n==="Map"||n==="Set"?Array.from(r):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qt(r,e):void 0}}function as(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nt(r,e){return os(r)||ss(r,e)||ir(r,e)||as()}var Yt={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"},or=new Int8Array(4),Kt=new Int32Array(or.buffer,0,1),us=new Float32Array(or.buffer,0,1),cs=/^\s*rgba?\s*\(/,hs=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function ls(r){var e=0,n=0,t=0,i=1;if(r[0]==="#")r.length===4?(e=parseInt(r.charAt(1)+r.charAt(1),16),n=parseInt(r.charAt(2)+r.charAt(2),16),t=parseInt(r.charAt(3)+r.charAt(3),16)):(e=parseInt(r.charAt(1)+r.charAt(2),16),n=parseInt(r.charAt(3)+r.charAt(4),16),t=parseInt(r.charAt(5)+r.charAt(6),16)),r.length===9&&(i=parseInt(r.charAt(7)+r.charAt(8),16)/255);else if(cs.test(r)){var o=r.match(hs);o&&(e=+o[1],n=+o[2],t=+o[3],o[4]&&(i=+o[4]))}return{r:e,g:n,b:t,a:i}}var rt={};for(var bt in Yt)rt[bt]=ht(Yt[bt]),rt[Yt[bt]]=rt[bt];function sr(r,e,n,t,i){return Kt[0]=t<<24|n<<16|e<<8|r,Kt[0]=Kt[0]&4278190079,us[0]}function ht(r){if(r=r.toLowerCase(),typeof rt[r]<"u")return rt[r];var e=ls(r),n=e.r,t=e.g,i=e.b,o=e.a;o=o*255|0;var a=sr(n,t,i,o);return rt[r]=a,a}var Xt={};function ar(r){if(typeof Xt[r]<"u")return Xt[r];var e=(r&16711680)>>>16,n=(r&65280)>>>8,t=r&255,i=255,o=sr(e,n,t,i);return Xt[r]=o,o}function ur(r,e,n,t){return n+(e<<8)+(r<<16)}function cr(r,e,n,t,i,o){var a=Math.floor(n/o*i),s=Math.floor(r.drawingBufferHeight/o-t/o*i),u=new Uint8Array(4);r.bindFramebuffer(r.FRAMEBUFFER,e),r.readPixels(a,s,1,1,r.RGBA,r.UNSIGNED_BYTE,u);var c=nt(u,4),h=c[0],l=c[1],d=c[2],f=c[3];return[h,l,d,f]}function x(r,e,n){return(e=ct(e))in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}function hr(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),n.push.apply(n,t)}return n}function $(r){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hr(Object(n),!0).forEach(function(t){x(r,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):hr(Object(n)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(n,t))})}return r}function ds(r,e){for(;!{}.hasOwnProperty.call(r,e)&&(r=tt(r))!==null;);return r}function Zt(){return Zt=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,e,n){var t=ds(r,e);if(t){var i=Object.getOwnPropertyDescriptor(t,e);return i.get?i.get.call(arguments.length<3?r:n):i.value}},Zt.apply(null,arguments)}function lr(r,e,n,t){var i=Zt(tt(r.prototype),e,n);return typeof i=="function"?function(o){return i.apply(n,o)}:i}function fs(r){return r.normalized?1:r.size}function Jt(r){var e=0;return r.forEach(function(n){return e+=fs(n)}),e}function dr(r,e,n){var t=r==="VERTEX"?e.VERTEX_SHADER:e.FRAGMENT_SHADER,i=e.createShader(t);if(i===null)throw new Error("loadShader: error while creating the shader");e.shaderSource(i,n),e.compileShader(i);var o=e.getShaderParameter(i,e.COMPILE_STATUS);if(!o){var a=e.getShaderInfoLog(i);throw e.deleteShader(i),new Error(`loadShader: error while compiling the shader:
`.concat(a,`
`).concat(n))}return i}function gs(r,e){return dr("VERTEX",r,e)}function ps(r,e){return dr("FRAGMENT",r,e)}function ms(r,e){var n=r.createProgram();if(n===null)throw new Error("loadProgram: error while creating the program.");var t,i;for(t=0,i=e.length;t<i;t++)r.attachShader(n,e[t]);r.linkProgram(n);var o=r.getProgramParameter(n,r.LINK_STATUS);if(!o)throw r.deleteProgram(n),new Error("loadProgram: error while linking the program.");return n}function fr(r){var e=r.gl,n=r.buffer,t=r.program,i=r.vertexShader,o=r.fragmentShader;e.deleteShader(i),e.deleteShader(o),e.deleteProgram(t),e.deleteBuffer(n)}var gr=`#define PICKING_MODE
`,vs=x(x(x(x(x(x(x(x({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4),pr=(function(){function r(e,n,t){ve(this,r),x(this,"array",new Float32Array),x(this,"constantArray",new Float32Array),x(this,"capacity",0),x(this,"verticesCount",0);var i=this.getDefinition();if(this.VERTICES=i.VERTICES,this.VERTEX_SHADER_SOURCE=i.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=i.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=i.UNIFORMS,this.ATTRIBUTES=i.ATTRIBUTES,this.METHOD=i.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in i?i.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in i?i.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in i,this.ATTRIBUTES_ITEMS_COUNT=Jt(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=t,this.normalProgram=this.getProgramInfo("normal",e,i.VERTEX_SHADER_SOURCE,i.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=n?this.getProgramInfo("pick",e,gr+i.VERTEX_SHADER_SOURCE,gr+i.FRAGMENT_SHADER_SOURCE,n):null,this.isInstanced){var o=Jt(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*o);for(var a=0;a<this.CONSTANT_DATA.length;a++){var s=this.CONSTANT_DATA[a];if(s.length!==o)throw new Error("Program: error while getting constant data (one vector has ".concat(s.length," items instead of ").concat(o,")"));for(var u=0;u<s.length;u++)this.constantArray[a*o+u]=s[u]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return ye(r,[{key:"kill",value:function(){fr(this.normalProgram),this.pickProgram&&(fr(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(n,t,i,o,a){var s=this.getDefinition(),u=t.createBuffer();if(u===null)throw new Error("Program: error while creating the WebGL buffer.");var c=gs(t,i),h=ps(t,o),l=ms(t,[c,h]),d={};s.UNIFORMS.forEach(function(w){var m=t.getUniformLocation(l,w);m&&(d[w]=m)});var f={};s.ATTRIBUTES.forEach(function(w){f[w.name]=t.getAttribLocation(l,w.name)});var p;if("CONSTANT_ATTRIBUTES"in s&&(s.CONSTANT_ATTRIBUTES.forEach(function(w){f[w.name]=t.getAttribLocation(l,w.name)}),p=t.createBuffer(),p===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:n,program:l,gl:t,frameBuffer:a,buffer:u,constantBuffer:p||{},uniformLocations:d,attributeLocations:f,isPicking:n==="pick",vertexShader:c,fragmentShader:h}}},{key:"bindProgram",value:function(n){var t=this,i=0,o=n.gl,a=n.buffer;this.isInstanced?(o.bindBuffer(o.ARRAY_BUFFER,n.constantBuffer),i=0,this.CONSTANT_ATTRIBUTES.forEach(function(s){return i+=t.bindAttribute(s,n,i,!1)}),o.bufferData(o.ARRAY_BUFFER,this.constantArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,n.buffer),i=0,this.ATTRIBUTES.forEach(function(s){return i+=t.bindAttribute(s,n,i,!0)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)):(o.bindBuffer(o.ARRAY_BUFFER,a),i=0,this.ATTRIBUTES.forEach(function(s){return i+=t.bindAttribute(s,n,i)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)),o.bindBuffer(o.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(n){var t=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(i){return t.unbindAttribute(i,n,!1)}),this.ATTRIBUTES.forEach(function(i){return t.unbindAttribute(i,n,!0)})):this.ATTRIBUTES.forEach(function(i){return t.unbindAttribute(i,n)})}},{key:"bindAttribute",value:function(n,t,i,o){var a=vs[n.type];if(typeof a!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(n.type,'"'));var s=t.attributeLocations[n.name],u=t.gl;if(s!==-1){u.enableVertexAttribArray(s);var c=this.isInstanced?(o?this.ATTRIBUTES_ITEMS_COUNT:Jt(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(u.vertexAttribPointer(s,n.size,n.type,n.normalized||!1,c,i),this.isInstanced&&o)if(u instanceof WebGL2RenderingContext)u.vertexAttribDivisor(s,1);else{var h=u.getExtension("ANGLE_instanced_arrays");h&&h.vertexAttribDivisorANGLE(s,1)}}return n.size*a}},{key:"unbindAttribute",value:function(n,t,i){var o=t.attributeLocations[n.name],a=t.gl;if(o!==-1&&(a.disableVertexAttribArray(o),this.isInstanced&&i))if(a instanceof WebGL2RenderingContext)a.vertexAttribDivisor(o,0);else{var s=a.getExtension("ANGLE_instanced_arrays");s&&s.vertexAttribDivisorANGLE(o,0)}}},{key:"reallocate",value:function(n){n!==this.capacity&&(this.capacity=n,this.verticesCount=this.VERTICES*n,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(n,t){var i=t.gl,o=t.program;i.enable(i.BLEND),i.useProgram(o),this.setUniforms(n,t),this.drawWebGL(this.METHOD,t)}},{key:"render",value:function(n){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,n.width*n.pixelRatio/n.downSizingRatio,n.height*n.pixelRatio/n.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram($($({},n),{},{pixelRatio:n.pixelRatio/n.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,n.width*n.pixelRatio,n.height*n.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(n,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(n,t){var i=t.gl,o=t.frameBuffer;if(i.bindFramebuffer(i.FRAMEBUFFER,o),!this.isInstanced)i.drawArrays(n,0,this.verticesCount);else if(i instanceof WebGL2RenderingContext)i.drawArraysInstanced(n,0,this.VERTICES,this.capacity);else{var a=i.getExtension("ANGLE_instanced_arrays");a&&a.drawArraysInstancedANGLE(n,0,this.VERTICES,this.capacity)}}}])})(),ys=(function(r){function e(){return ve(this,e),Re(this,e,arguments)}return Ce(e,r),ye(e,[{key:"kill",value:function(){lr(e,"kill",this)([])}},{key:"process",value:function(t,i,o){var a=i*this.STRIDE;if(o.hidden){for(var s=a+this.STRIDE;a<s;a++)this.array[a]=0;return}return this.processVisibleItem(ar(t),a,o)}}])})(pr),Qt=(function(r){function e(){var n;ve(this,e);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return n=Re(this,e,[].concat(i)),x(n,"drawLabel",void 0),n}return Ce(e,r),ye(e,[{key:"kill",value:function(){lr(e,"kill",this)([])}},{key:"process",value:function(t,i,o,a,s){var u=i*this.STRIDE;if(s.hidden||o.hidden||a.hidden){for(var c=u+this.STRIDE;u<c;u++)this.array[u]=0;return}return this.processVisibleItem(ar(t),u,o,a,s)}}])})(pr);function bs(r,e){return(function(){function n(t,i,o){ve(this,n),x(this,"drawLabel",e),this.programs=r.map(function(a){return new a(t,i,o)})}return ye(n,[{key:"reallocate",value:function(i){this.programs.forEach(function(o){return o.reallocate(i)})}},{key:"process",value:function(i,o,a,s,u){this.programs.forEach(function(c){return c.process(i,o,a,s,u)})}},{key:"render",value:function(i){this.programs.forEach(function(o){return o.render(i)})}},{key:"kill",value:function(){this.programs.forEach(function(i){return i.kill()})}}])})()}function ws(r,e,n,t,i){var o=i.edgeLabelSize,a=i.edgeLabelFont,s=i.edgeLabelWeight,u=i.edgeLabelColor.attribute?e[i.edgeLabelColor.attribute]||i.edgeLabelColor.color||"#000":i.edgeLabelColor.color,c=e.label;if(c){r.fillStyle=u,r.font="".concat(s," ").concat(o,"px ").concat(a);var h=n.size,l=t.size,d=n.x,f=n.y,p=t.x,w=t.y,m=(d+p)/2,b=(f+w)/2,E=p-d,v=w-f,g=Math.sqrt(E*E+v*v);if(!(g<h+l)){d+=E*h/g,f+=v*h/g,p-=E*l/g,w-=v*l/g,m=(d+p)/2,b=(f+w)/2,E=p-d,v=w-f,g=Math.sqrt(E*E+v*v);var A=r.measureText(c).width;if(A>g){var S="";for(c=c+S,A=r.measureText(c).width;A>g&&c.length>1;)c=c.slice(0,-2)+S,A=r.measureText(c).width;if(c.length<4)return}var D;E>0?v>0?D=Math.acos(E/g):D=Math.asin(v/g):v>0?D=Math.acos(E/g)+Math.PI:D=Math.asin(E/g)+Math.PI/2,r.save(),r.translate(m,b),r.rotate(D),r.fillText(c,-A/2,e.size/2+o),r.restore()}}}function mr(r,e,n){if(e.label){var t=n.labelSize,i=n.labelFont,o=n.labelWeight,a=n.labelColor.attribute?e[n.labelColor.attribute]||n.labelColor.color||"#000":n.labelColor.color;r.fillStyle=a,r.font="".concat(o," ").concat(t,"px ").concat(i),r.fillText(e.label,e.x+e.size+3,e.y+t/3)}}function Es(r,e,n){var t=n.labelSize,i=n.labelFont,o=n.labelWeight;r.font="".concat(o," ").concat(t,"px ").concat(i),r.fillStyle="#FFF",r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=8,r.shadowColor="#000";var a=2;if(typeof e.label=="string"){var s=r.measureText(e.label).width,u=Math.round(s+5),c=Math.round(t+2*a),h=Math.max(e.size,t/2)+a,l=Math.asin(c/2/h),d=Math.sqrt(Math.abs(Math.pow(h,2)-Math.pow(c/2,2)));r.beginPath(),r.moveTo(e.x+d,e.y+c/2),r.lineTo(e.x+h+u,e.y+c/2),r.lineTo(e.x+h+u,e.y-c/2),r.lineTo(e.x+d,e.y-c/2),r.arc(e.x,e.y,h,l,-l),r.closePath(),r.fill()}else r.beginPath(),r.arc(e.x,e.y,e.size+a,0,Math.PI*2),r.closePath(),r.fill();r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=0,mr(r,e,n)}var Ss=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Ts=Ss,_s=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,As=_s,vr=WebGLRenderingContext,yr=vr.UNSIGNED_BYTE,en=vr.FLOAT,Ds=["u_sizeRatio","u_correctionRatio","u_matrix"],wt=(function(r){function e(){return ve(this,e),Re(this,e,arguments)}return Ce(e,r),ye(e,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:As,FRAGMENT_SHADER_SOURCE:Ts,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Ds,ATTRIBUTES:[{name:"a_position",size:2,type:en},{name:"a_size",size:1,type:en},{name:"a_color",size:4,type:yr,normalized:!0},{name:"a_id",size:4,type:yr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:en}],CONSTANT_DATA:[[e.ANGLE_1],[e.ANGLE_2],[e.ANGLE_3]]}}},{key:"processVisibleItem",value:function(t,i,o){var a=this.array,s=ht(o.color);a[i++]=o.x,a[i++]=o.y,a[i++]=o.size,a[i++]=s,a[i++]=t}},{key:"setUniforms",value:function(t,i){var o=i.gl,a=i.uniformLocations,s=a.u_sizeRatio,u=a.u_correctionRatio,c=a.u_matrix;o.uniform1f(u,t.correctionRatio),o.uniform1f(s,t.sizeRatio),o.uniformMatrix3fv(c,!1,t.matrix)}}])})(ys);x(wt,"ANGLE_1",0),x(wt,"ANGLE_2",2*Math.PI/3),x(wt,"ANGLE_3",4*Math.PI/3);var Rs=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,Cs=Rs,Is=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Ls=Is,br=WebGLRenderingContext,wr=br.UNSIGNED_BYTE,Et=br.FLOAT,ks=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],Er={extremity:"target",lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function Sr(r){var e=$($({},Er),{});return(function(n){function t(){return ve(this,t),Re(this,t,arguments)}return Ce(t,n),ye(t,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Ls,FRAGMENT_SHADER_SOURCE:Cs,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:ks,ATTRIBUTES:[{name:"a_position",size:2,type:Et},{name:"a_normal",size:2,type:Et},{name:"a_radius",size:1,type:Et},{name:"a_color",size:4,type:wr,normalized:!0},{name:"a_id",size:4,type:wr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:Et}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,c){if(e.extremity==="source"){var h=[u,s];s=h[0],u=h[1]}var l=c.size||1,d=u.size||1,f=s.x,p=s.y,w=u.x,m=u.y,b=ht(c.color),E=w-f,v=m-p,g=E*E+v*v,A=0,S=0;g&&(g=1/Math.sqrt(g),A=-v*g*l,S=E*g*l);var D=this.array;D[a++]=w,D[a++]=m,D[a++]=-A,D[a++]=-S,D[a++]=d,D[a++]=b,D[a++]=o}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,c=u.u_matrix,h=u.u_sizeRatio,l=u.u_correctionRatio,d=u.u_minEdgeThickness,f=u.u_lengthToThicknessRatio,p=u.u_widenessToThicknessRatio;s.uniformMatrix3fv(c,!1,o.matrix),s.uniform1f(h,o.sizeRatio),s.uniform1f(l,o.correctionRatio),s.uniform1f(d,o.minEdgeThickness),s.uniform1f(f,e.lengthToThicknessRatio),s.uniform1f(p,e.widenessToThicknessRatio)}}])})(Qt)}Sr();var xs=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Tr=xs,Ns=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Ps=Ns,_r=WebGLRenderingContext,Ar=_r.UNSIGNED_BYTE,Ye=_r.FLOAT,Os=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],Gs={lengthToThicknessRatio:Er.lengthToThicknessRatio};function Dr(r){var e=$($({},Gs),{});return(function(n){function t(){return ve(this,t),Re(this,t,arguments)}return Ce(t,n),ye(t,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:Ps,FRAGMENT_SHADER_SOURCE:Tr,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Os,ATTRIBUTES:[{name:"a_positionStart",size:2,type:Ye},{name:"a_positionEnd",size:2,type:Ye},{name:"a_normal",size:2,type:Ye},{name:"a_color",size:4,type:Ar,normalized:!0},{name:"a_id",size:4,type:Ar,normalized:!0},{name:"a_radius",size:1,type:Ye}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:Ye},{name:"a_normalCoef",size:1,type:Ye},{name:"a_radiusCoef",size:1,type:Ye}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,c){var h=c.size||1,l=s.x,d=s.y,f=u.x,p=u.y,w=ht(c.color),m=f-l,b=p-d,E=u.size||1,v=m*m+b*b,g=0,A=0;v&&(v=1/Math.sqrt(v),g=-b*v*h,A=m*v*h);var S=this.array;S[a++]=l,S[a++]=d,S[a++]=f,S[a++]=p,S[a++]=g,S[a++]=A,S[a++]=w,S[a++]=o,S[a++]=E}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,c=u.u_matrix,h=u.u_zoomRatio,l=u.u_feather,d=u.u_pixelRatio,f=u.u_correctionRatio,p=u.u_sizeRatio,w=u.u_minEdgeThickness,m=u.u_lengthToThicknessRatio;s.uniformMatrix3fv(c,!1,o.matrix),s.uniform1f(h,o.zoomRatio),s.uniform1f(p,o.sizeRatio),s.uniform1f(f,o.correctionRatio),s.uniform1f(d,o.pixelRatio),s.uniform1f(l,o.antiAliasingFeather),s.uniform1f(w,o.minEdgeThickness),s.uniform1f(m,e.lengthToThicknessRatio)}}])})(Qt)}Dr();function Fs(r){return bs([Dr(),Sr()])}var Ms=Fs(),zs=Ms,Us=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,$s=Us,Rr=WebGLRenderingContext,Cr=Rr.UNSIGNED_BYTE,lt=Rr.FLOAT,Bs=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],Ws=(function(r){function e(){return ve(this,e),Re(this,e,arguments)}return Ce(e,r),ye(e,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:$s,FRAGMENT_SHADER_SOURCE:Tr,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Bs,ATTRIBUTES:[{name:"a_positionStart",size:2,type:lt},{name:"a_positionEnd",size:2,type:lt},{name:"a_normal",size:2,type:lt},{name:"a_color",size:4,type:Cr,normalized:!0},{name:"a_id",size:4,type:Cr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:lt},{name:"a_normalCoef",size:1,type:lt}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(t,i,o,a,s){var u=s.size||1,c=o.x,h=o.y,l=a.x,d=a.y,f=ht(s.color),p=l-c,w=d-h,m=p*p+w*w,b=0,E=0;m&&(m=1/Math.sqrt(m),b=-w*m*u,E=p*m*u);var v=this.array;v[i++]=c,v[i++]=h,v[i++]=l,v[i++]=d,v[i++]=b,v[i++]=E,v[i++]=f,v[i++]=t}},{key:"setUniforms",value:function(t,i){var o=i.gl,a=i.uniformLocations,s=a.u_matrix,u=a.u_zoomRatio,c=a.u_feather,h=a.u_pixelRatio,l=a.u_correctionRatio,d=a.u_sizeRatio,f=a.u_minEdgeThickness;o.uniformMatrix3fv(s,!1,t.matrix),o.uniform1f(u,t.zoomRatio),o.uniform1f(d,t.sizeRatio),o.uniform1f(l,t.correctionRatio),o.uniform1f(h,t.pixelRatio),o.uniform1f(c,t.antiAliasingFeather),o.uniform1f(f,t.minEdgeThickness)}}])})(Qt),tn=(function(r){function e(){var n;return ve(this,e),n=Re(this,e),n.rawEmitter=n,n}return Ce(e,r),ye(e)})(Mn.EventEmitter),nn,Ir;function St(){return Ir||(Ir=1,nn=function(e){return e!==null&&typeof e=="object"&&typeof e.addUndirectedEdgeWithKey=="function"&&typeof e.dropNode=="function"&&typeof e.multi=="boolean"}),nn}var Hs=St();const js=Me(Hs);var Vs=function(e){return e},qs=function(e){return e*e},Ys=function(e){return e*(2-e)},Ks=function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},Xs=function(e){return e*e*e},Zs=function(e){return--e*e*e+1},Js=function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},Qs={linear:Vs,quadraticIn:qs,quadraticOut:Ys,quadraticInOut:Ks,cubicIn:Xs,cubicOut:Zs,cubicInOut:Js},ea={easing:"quadraticInOut",duration:150};function Le(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function Tt(r,e,n){return r[0]=e,r[4]=typeof n=="number"?n:e,r}function Lr(r,e){var n=Math.sin(e),t=Math.cos(e);return r[0]=t,r[1]=n,r[3]=-n,r[4]=t,r}function kr(r,e,n){return r[6]=e,r[7]=n,r}function He(r,e){var n=r[0],t=r[1],i=r[2],o=r[3],a=r[4],s=r[5],u=r[6],c=r[7],h=r[8],l=e[0],d=e[1],f=e[2],p=e[3],w=e[4],m=e[5],b=e[6],E=e[7],v=e[8];return r[0]=l*n+d*o+f*u,r[1]=l*t+d*a+f*c,r[2]=l*i+d*s+f*h,r[3]=p*n+w*o+m*u,r[4]=p*t+w*a+m*c,r[5]=p*i+w*s+m*h,r[6]=b*n+E*o+v*u,r[7]=b*t+E*a+v*c,r[8]=b*i+E*s+v*h,r}function rn(r,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,t=r[0],i=r[1],o=r[3],a=r[4],s=r[6],u=r[7],c=e.x,h=e.y;return{x:c*t+h*o+s*n,y:c*i+h*a+u*n}}function ta(r,e){var n=r.height/r.width,t=e.height/e.width;return n<1&&t>1||n>1&&t<1?1:Math.min(Math.max(t,1/t),Math.max(1/n,n))}function dt(r,e,n,t,i){var o=r.angle,a=r.ratio,s=r.x,u=r.y,c=e.width,h=e.height,l=Le(),d=Math.min(c,h)-2*t,f=ta(e,n);return i?(He(l,kr(Le(),s,u)),He(l,Tt(Le(),a)),He(l,Lr(Le(),o)),He(l,Tt(Le(),c/d/2/f,h/d/2/f))):(He(l,Tt(Le(),2*(d/c)*f,2*(d/h)*f)),He(l,Lr(Le(),-o)),He(l,Tt(Le(),1/a)),He(l,kr(Le(),-s,-u))),l}function na(r,e,n){var t=rn(r,{x:Math.cos(e.angle),y:Math.sin(e.angle)},0),i=t.x,o=t.y;return 1/Math.sqrt(Math.pow(i,2)+Math.pow(o,2))/n.width}function ra(r){if(!r.order)return{x:[0,1],y:[0,1]};var e=1/0,n=-1/0,t=1/0,i=-1/0;return r.forEachNode(function(o,a){var s=a.x,u=a.y;s<e&&(e=s),s>n&&(n=s),u<t&&(t=u),u>i&&(i=u)}),{x:[e,n],y:[t,i]}}function ia(r){if(!js(r))throw new Error("Sigma: invalid graph instance.");r.forEachNode(function(e,n){if(!Number.isFinite(n.x)||!Number.isFinite(n.y))throw new Error("Sigma: Coordinates of node ".concat(e," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function oa(r,e,n){var t=document.createElement(r);if(e)for(var i in e)t.style[i]=e[i];if(n)for(var o in n)t.setAttribute(o,n[o]);return t}function xr(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function Nr(r,e,n){return n.sort(function(t,i){var o=e(t)||0,a=e(i)||0;return o<a?-1:o>a?1:0})}function Pr(r){var e=nt(r.x,2),n=e[0],t=e[1],i=nt(r.y,2),o=i[0],a=i[1],s=Math.max(t-n,a-o),u=(t+n)/2,c=(a+o)/2;(s===0||Math.abs(s)===1/0||isNaN(s))&&(s=1),isNaN(u)&&(u=0),isNaN(c)&&(c=0);var h=function(d){return{x:.5+(d.x-u)/s,y:.5+(d.y-c)/s}};return h.applyTo=function(l){l.x=.5+(l.x-u)/s,l.y=.5+(l.y-c)/s},h.inverse=function(l){return{x:u+s*(l.x-.5),y:c+s*(l.y-.5)}},h.ratio=s,h}function on(r){"@babel/helpers - typeof";return on=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},on(r)}function Or(r,e){var n=e.size;if(n!==0){var t=r.length;r.length+=n;var i=0;e.forEach(function(o){r[t+i]=o,i++})}}function sn(r){r=r||{};for(var e=0,n=arguments.length<=1?0:arguments.length-1;e<n;e++){var t=e+1<1||arguments.length<=e+1?void 0:arguments[e+1];t&&Object.assign(r,t)}return r}var an={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:ws,defaultDrawNodeLabel:mr,defaultDrawNodeHover:Es,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},sa={circle:wt},aa={arrow:zs,line:Ws};function un(r){if(typeof r.labelDensity!="number"||r.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var e=r.minCameraRatio,n=r.maxCameraRatio;if(typeof e=="number"&&typeof n=="number"&&n<e)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function ua(r){var e=sn({},an,r);return e.nodeProgramClasses=sn({},sa,e.nodeProgramClasses),e.edgeProgramClasses=sn({},aa,e.edgeProgramClasses),e}var _t=1.5,Gr=(function(r){function e(){var n;return ve(this,e),n=Re(this,e),x(n,"x",.5),x(n,"y",.5),x(n,"angle",0),x(n,"ratio",1),x(n,"minRatio",null),x(n,"maxRatio",null),x(n,"enabledZooming",!0),x(n,"enabledPanning",!0),x(n,"enabledRotation",!0),x(n,"clean",null),x(n,"nextFrame",null),x(n,"previousState",null),x(n,"enabled",!0),n.previousState=n.getState(),n}return Ce(e,r),ye(e,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(t){return this.x===t.x&&this.y===t.y&&this.ratio===t.ratio&&this.angle===t.angle}},{key:"getPreviousState",value:function(){var t=this.previousState;return t?{x:t.x,y:t.y,angle:t.angle,ratio:t.ratio}:null}},{key:"getBoundedRatio",value:function(t){var i=t;return typeof this.minRatio=="number"&&(i=Math.max(i,this.minRatio)),typeof this.maxRatio=="number"&&(i=Math.min(i,this.maxRatio)),i}},{key:"validateState",value:function(t){var i={};return this.enabledPanning&&typeof t.x=="number"&&(i.x=t.x),this.enabledPanning&&typeof t.y=="number"&&(i.y=t.y),this.enabledZooming&&typeof t.ratio=="number"&&(i.ratio=this.getBoundedRatio(t.ratio)),this.enabledRotation&&typeof t.angle=="number"&&(i.angle=t.angle),this.clean?this.clean($($({},this.getState()),i)):i}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(t){if(!this.enabled)return this;this.previousState=this.getState();var i=this.validateState(t);return typeof i.x=="number"&&(this.x=i.x),typeof i.y=="number"&&(this.y=i.y),typeof i.ratio=="number"&&(this.ratio=i.ratio),typeof i.angle=="number"&&(this.angle=i.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(t){return this.setState(t(this.getState())),this}},{key:"animate",value:function(t){var i=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;if(!a)return new Promise(function(f){return i.animate(t,o,f)});if(this.enabled){var s=$($({},ea),o),u=this.validateState(t),c=typeof s.easing=="function"?s.easing:Qs[s.easing],h=Date.now(),l=this.getState(),d=function(){var p=(Date.now()-h)/s.duration;if(p>=1){i.nextFrame=null,i.setState(u),i.animationCallback&&(i.animationCallback.call(null),i.animationCallback=void 0);return}var w=c(p),m={};typeof u.x=="number"&&(m.x=l.x+(u.x-l.x)*w),typeof u.y=="number"&&(m.y=l.y+(u.y-l.y)*w),i.enabledRotation&&typeof u.angle=="number"&&(m.angle=l.angle+(u.angle-l.angle)*w),typeof u.ratio=="number"&&(m.ratio=l.ratio+(u.ratio-l.ratio)*w),i.setState(m),i.nextFrame=requestAnimationFrame(d)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(d)):d(),this.animationCallback=a}}},{key:"animatedZoom",value:function(t){return t?typeof t=="number"?this.animate({ratio:this.ratio/t}):this.animate({ratio:this.ratio/(t.factor||_t)},t):this.animate({ratio:this.ratio/_t})}},{key:"animatedUnzoom",value:function(t){return t?typeof t=="number"?this.animate({ratio:this.ratio*t}):this.animate({ratio:this.ratio*(t.factor||_t)},t):this.animate({ratio:this.ratio*_t})}},{key:"animatedReset",value:function(t){return this.animate({x:.5,y:.5,ratio:1,angle:0},t)}},{key:"copy",value:function(){return e.from(this.getState())}}],[{key:"from",value:function(t){var i=new e;return i.setState(t)}}])})(tn);function ke(r,e){var n=e.getBoundingClientRect();return{x:r.clientX-n.left,y:r.clientY-n.top}}function $e(r,e){var n=$($({},ke(r,e)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){n.sigmaDefaultPrevented=!0},original:r});return n}function ft(r){var e="x"in r?r:$($({},r.touches[0]||r.previousTouches[0]),{},{original:r.original,sigmaDefaultPrevented:r.sigmaDefaultPrevented,preventSigmaDefault:function(){r.sigmaDefaultPrevented=!0,e.sigmaDefaultPrevented=!0}});return e}function ca(r,e){return $($({},$e(r,e)),{},{delta:Fr(r)})}var ha=2;function At(r){for(var e=[],n=0,t=Math.min(r.length,ha);n<t;n++)e.push(r[n]);return e}function gt(r,e,n){var t={touches:At(r.touches).map(function(i){return ke(i,n)}),previousTouches:e.map(function(i){return ke(i,n)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){t.sigmaDefaultPrevented=!0},original:r};return t}function Fr(r){if(typeof r.deltaY<"u")return r.deltaY*-3/360;if(typeof r.detail<"u")return r.detail/-9;throw new Error("Captor: could not extract delta from event.")}var Mr=(function(r){function e(n,t){var i;return ve(this,e),i=Re(this,e),i.container=n,i.renderer=t,i}return Ce(e,r),ye(e)})(tn),la=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],da=la.reduce(function(r,e){return $($({},r),{},x({},e,an[e]))},{}),fa=(function(r){function e(n,t){var i;return ve(this,e),i=Re(this,e,[n,t]),x(i,"enabled",!0),x(i,"draggedEvents",0),x(i,"downStartTime",null),x(i,"lastMouseX",null),x(i,"lastMouseY",null),x(i,"isMouseDown",!1),x(i,"isMoving",!1),x(i,"movingTimeout",null),x(i,"startCameraState",null),x(i,"clicks",0),x(i,"doubleClickTimeout",null),x(i,"currentWheelDirection",0),x(i,"settings",da),i.handleClick=i.handleClick.bind(i),i.handleRightClick=i.handleRightClick.bind(i),i.handleDown=i.handleDown.bind(i),i.handleUp=i.handleUp.bind(i),i.handleMove=i.handleMove.bind(i),i.handleWheel=i.handleWheel.bind(i),i.handleLeave=i.handleLeave.bind(i),i.handleEnter=i.handleEnter.bind(i),n.addEventListener("click",i.handleClick,{capture:!1}),n.addEventListener("contextmenu",i.handleRightClick,{capture:!1}),n.addEventListener("mousedown",i.handleDown,{capture:!1}),n.addEventListener("wheel",i.handleWheel,{capture:!1}),n.addEventListener("mouseleave",i.handleLeave,{capture:!1}),n.addEventListener("mouseenter",i.handleEnter,{capture:!1}),document.addEventListener("mousemove",i.handleMove,{capture:!1}),document.addEventListener("mouseup",i.handleUp,{capture:!1}),i}return Ce(e,r),ye(e,[{key:"kill",value:function(){var t=this.container;t.removeEventListener("click",this.handleClick),t.removeEventListener("contextmenu",this.handleRightClick),t.removeEventListener("mousedown",this.handleDown),t.removeEventListener("wheel",this.handleWheel),t.removeEventListener("mouseleave",this.handleLeave),t.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(t){var i=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(t);setTimeout(function(){i.clicks=0,i.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",$e(t,this.container))}}},{key:"handleRightClick",value:function(t){this.enabled&&this.emit("rightClick",$e(t,this.container))}},{key:"handleDoubleClick",value:function(t){if(this.enabled){t.preventDefault(),t.stopPropagation();var i=$e(t,this.container);if(this.emit("doubleClick",i),!i.sigmaDefaultPrevented){var o=this.renderer.getCamera(),a=o.getBoundedRatio(o.getState().ratio/this.settings.doubleClickZoomingRatio);o.animate(this.renderer.getViewportZoomedState(ke(t,this.container),a),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(t){if(this.enabled){if(t.button===0){this.startCameraState=this.renderer.getCamera().getState();var i=ke(t,this.container),o=i.x,a=i.y;this.lastMouseX=o,this.lastMouseY=a,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",$e(t,this.container))}}},{key:"handleUp",value:function(t){var i=this;if(!(!this.enabled||!this.isMouseDown)){var o=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var a=ke(t,this.container),s=a.x,u=a.y,c=o.getState(),h=o.getPreviousState()||{x:0,y:0};this.isMoving?o.animate({x:c.x+this.settings.inertiaRatio*(c.x-h.x),y:c.y+this.settings.inertiaRatio*(c.y-h.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==s||this.lastMouseY!==u)&&o.setState({x:c.x,y:c.y}),this.isMoving=!1,setTimeout(function(){var l=i.draggedEvents>0;i.draggedEvents=0,l&&i.renderer.getSetting("hideEdgesOnMove")&&i.renderer.refresh()},0),this.emit("mouseup",$e(t,this.container))}}},{key:"handleMove",value:function(t){var i=this;if(this.enabled){var o=$e(t,this.container);if(this.emit("mousemovebody",o),(t.target===this.container||t.composedPath()[0]===this.container)&&this.emit("mousemove",o),!o.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){i.movingTimeout=null,i.isMoving=!1},this.settings.dragTimeout);var a=this.renderer.getCamera(),s=ke(t,this.container),u=s.x,c=s.y,h=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),l=this.renderer.viewportToFramedGraph({x:u,y:c}),d=h.x-l.x,f=h.y-l.y,p=a.getState(),w=p.x+d,m=p.y+f;a.setState({x:w,y:m}),this.lastMouseX=u,this.lastMouseY=c,t.preventDefault(),t.stopPropagation()}}}},{key:"handleLeave",value:function(t){this.emit("mouseleave",$e(t,this.container))}},{key:"handleEnter",value:function(t){this.emit("mouseenter",$e(t,this.container))}},{key:"handleWheel",value:function(t){var i=this,o=this.renderer.getCamera();if(!(!this.enabled||!o.enabledZooming)){var a=Fr(t);if(a){var s=ca(t,this.container);if(this.emit("wheel",s),s.sigmaDefaultPrevented){t.preventDefault(),t.stopPropagation();return}var u=o.getState().ratio,c=a>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,h=o.getBoundedRatio(u*c),l=a>0?1:-1,d=Date.now();u!==h&&(t.preventDefault(),t.stopPropagation(),!(this.currentWheelDirection===l&&this.lastWheelTriggerTime&&d-this.lastWheelTriggerTime<this.settings.zoomDuration/5)&&(o.animate(this.renderer.getViewportZoomedState(ke(t,this.container),h),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){i.currentWheelDirection=0}),this.currentWheelDirection=l,this.lastWheelTriggerTime=d))}}}},{key:"setSettings",value:function(t){this.settings=t}}])})(Mr),ga=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],pa=ga.reduce(function(r,e){return $($({},r),{},x({},e,an[e]))},{}),ma=(function(r){function e(n,t){var i;return ve(this,e),i=Re(this,e,[n,t]),x(i,"enabled",!0),x(i,"isMoving",!1),x(i,"hasMoved",!1),x(i,"touchMode",0),x(i,"startTouchesPositions",[]),x(i,"lastTouches",[]),x(i,"lastTap",null),x(i,"settings",pa),i.handleStart=i.handleStart.bind(i),i.handleLeave=i.handleLeave.bind(i),i.handleMove=i.handleMove.bind(i),n.addEventListener("touchstart",i.handleStart,{capture:!1}),n.addEventListener("touchcancel",i.handleLeave,{capture:!1}),document.addEventListener("touchend",i.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",i.handleMove,{capture:!1,passive:!1}),i}return Ce(e,r),ye(e,[{key:"kill",value:function(){var t=this.container;t.removeEventListener("touchstart",this.handleStart),t.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(t){var i=this;if(this.enabled){t.preventDefault();var o=At(t.touches);if(this.touchMode=o.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=o.map(function(f){return ke(f,i.container)}),this.touchMode===2){var a=nt(this.startTouchesPositions,2),s=a[0],u=s.x,c=s.y,h=a[1],l=h.x,d=h.y;this.startTouchesAngle=Math.atan2(d-c,l-u),this.startTouchesDistance=Math.sqrt(Math.pow(l-u,2)+Math.pow(d-c,2))}this.emit("touchdown",gt(t,this.lastTouches,this.container)),this.lastTouches=o,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(t){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(t.cancelable&&t.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(t.touches.length===1){this.handleStart(t),t.preventDefault();break}case 1:if(this.isMoving){var i=this.renderer.getCamera(),o=i.getState(),a=i.getPreviousState()||{x:0,y:0};i.animate({x:o.x+this.settings.inertiaRatio*(o.x-a.x),y:o.y+this.settings.inertiaRatio*(o.y-a.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",gt(t,this.lastTouches,this.container)),!t.touches.length){var s=ke(this.lastTouches[0],this.container),u=this.startTouchesPositions[0],c=Math.pow(s.x-u.x,2)+Math.pow(s.y-u.y,2);if(!t.touches.length&&c<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var h=gt(t,this.lastTouches,this.container);if(this.emit("doubletap",h),this.lastTap=null,!h.sigmaDefaultPrevented){var l=this.renderer.getCamera(),d=l.getBoundedRatio(l.getState().ratio/this.settings.doubleClickZoomingRatio);l.animate(this.renderer.getViewportZoomedState(s,d),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var f=gt(t,this.lastTouches,this.container);this.emit("tap",f),this.lastTap={time:Date.now(),position:f.touches[0]||f.previousTouches[0]}}}this.lastTouches=At(t.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(t){var i=this;if(!(!this.enabled||!this.startTouchesPositions.length)){t.preventDefault();var o=At(t.touches),a=o.map(function(Q){return ke(Q,i.container)}),s=this.lastTouches;this.lastTouches=o,this.lastTouchesPositions=a;var u=gt(t,s,this.container);if(this.emit("touchmove",u),!u.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=a.some(function(Q,ne){var O=i.startTouchesPositions[ne];return O&&(Q.x!==O.x||Q.y!==O.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){i.isMoving=!1},this.settings.dragTimeout);var c=this.renderer.getCamera(),h=this.startCameraState,l=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var d=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),f=d.x,p=d.y,w=this.renderer.viewportToFramedGraph(a[0]),m=w.x,b=w.y;c.setState({x:h.x+f-m,y:h.y+p-b});break}case 2:{var E={x:.5,y:.5,angle:0,ratio:1},v=a[0],g=v.x,A=v.y,S=a[1],D=S.x,C=S.y,I=Math.atan2(C-A,D-g)-this.startTouchesAngle,k=Math.hypot(C-A,D-g)/this.startTouchesDistance,U=c.getBoundedRatio(h.ratio/k);E.ratio=U,E.angle=h.angle+I;var P=this.getDimensions(),T=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:h}),q=Math.min(P.width,P.height)-2*l,Z=q/P.width,L=q/P.height,R=U/q,z=g-q/2/Z,j=A-q/2/L,H=[z*Math.cos(-E.angle)-j*Math.sin(-E.angle),j*Math.cos(-E.angle)+z*Math.sin(-E.angle)];z=H[0],j=H[1],E.x=T.x-z*R,E.y=T.y+j*R,c.setState(E);break}}}}}},{key:"setSettings",value:function(t){this.settings=t}}])})(Mr);function va(r){if(Array.isArray(r))return qt(r)}function ya(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function ba(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zr(r){return va(r)||ya(r)||ir(r)||ba()}function wa(r,e){if(r==null)return{};var n={};for(var t in r)if({}.hasOwnProperty.call(r,t)){if(e.indexOf(t)!==-1)continue;n[t]=r[t]}return n}function cn(r,e){if(r==null)return{};var n,t,i=wa(r,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(t=0;t<o.length;t++)n=o[t],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(r,n)&&(i[n]=r[n])}return i}var Ur=(function(){function r(e,n){ve(this,r),this.key=e,this.size=n}return ye(r,null,[{key:"compare",value:function(n,t){return n.size>t.size?-1:n.size<t.size||n.key>t.key?1:-1}}])})(),$r=(function(){function r(){ve(this,r),x(this,"width",0),x(this,"height",0),x(this,"cellSize",0),x(this,"columns",0),x(this,"rows",0),x(this,"cells",{})}return ye(r,[{key:"resizeAndClear",value:function(n,t){this.width=n.width,this.height=n.height,this.cellSize=t,this.columns=Math.ceil(n.width/t),this.rows=Math.ceil(n.height/t),this.cells={}}},{key:"getIndex",value:function(n){var t=Math.floor(n.x/this.cellSize),i=Math.floor(n.y/this.cellSize);return i*this.columns+t}},{key:"add",value:function(n,t,i){var o=new Ur(n,t),a=this.getIndex(i),s=this.cells[a];s||(s=[],this.cells[a]=s),s.push(o)}},{key:"organize",value:function(){for(var n in this.cells){var t=this.cells[n];t.sort(Ur.compare)}}},{key:"getLabelsToDisplay",value:function(n,t){var i=this.cellSize*this.cellSize,o=i/n/n,a=o*t/i,s=Math.ceil(a),u=[];for(var c in this.cells)for(var h=this.cells[c],l=0;l<Math.min(s,h.length);l++)u.push(h[l].key);return u}}])})();function Ea(r){var e=r.graph,n=r.hoveredNode,t=r.highlightedNodes,i=r.displayedNodeLabels,o=[];return e.forEachEdge(function(a,s,u,c){(u===n||c===n||t.has(u)||t.has(c)||i.has(u)&&i.has(c))&&o.push(a)}),o}var Br=150,Wr=50,Be=Object.prototype.hasOwnProperty;function Sa(r,e,n){if(!Be.call(n,"x")||!Be.call(n,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(e,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return n.color||(n.color=r.defaultNodeColor),!n.label&&n.label!==""&&(n.label=null),n.label!==void 0&&n.label!==null?n.label=""+n.label:n.label=null,n.size||(n.size=2),Be.call(n,"hidden")||(n.hidden=!1),Be.call(n,"highlighted")||(n.highlighted=!1),Be.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=r.defaultNodeType),n.zIndex||(n.zIndex=0),n}function Ta(r,e,n){return n.color||(n.color=r.defaultEdgeColor),n.label||(n.label=""),n.size||(n.size=.5),Be.call(n,"hidden")||(n.hidden=!1),Be.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=r.defaultEdgeType),n.zIndex||(n.zIndex=0),n}var _a=(function(r){function e(n,t){var i,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(ve(this,e),i=Re(this,e),x(i,"elements",{}),x(i,"canvasContexts",{}),x(i,"webGLContexts",{}),x(i,"pickingLayers",new Set),x(i,"textures",{}),x(i,"frameBuffers",{}),x(i,"activeListeners",{}),x(i,"labelGrid",new $r),x(i,"nodeDataCache",{}),x(i,"edgeDataCache",{}),x(i,"nodeProgramIndex",{}),x(i,"edgeProgramIndex",{}),x(i,"nodesWithForcedLabels",new Set),x(i,"edgesWithForcedLabels",new Set),x(i,"nodeExtent",{x:[0,1],y:[0,1]}),x(i,"nodeZExtent",[1/0,-1/0]),x(i,"edgeZExtent",[1/0,-1/0]),x(i,"matrix",Le()),x(i,"invMatrix",Le()),x(i,"correctionRatio",1),x(i,"customBBox",null),x(i,"normalizationFunction",Pr({x:[0,1],y:[0,1]})),x(i,"graphToViewportRatio",1),x(i,"itemIDsIndex",{}),x(i,"nodeIndices",{}),x(i,"edgeIndices",{}),x(i,"width",0),x(i,"height",0),x(i,"pixelRatio",xr()),x(i,"pickingDownSizingRatio",2*i.pixelRatio),x(i,"displayedNodeLabels",new Set),x(i,"displayedEdgeLabels",new Set),x(i,"highlightedNodes",new Set),x(i,"hoveredNode",null),x(i,"hoveredEdge",null),x(i,"renderFrame",null),x(i,"renderHighlightedNodesFrame",null),x(i,"needToProcess",!1),x(i,"checkEdgesEventsFrame",null),x(i,"nodePrograms",{}),x(i,"nodeHoverPrograms",{}),x(i,"edgePrograms",{}),i.settings=ua(o),un(i.settings),ia(n),!(t instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");i.graph=n,i.container=t,i.createWebGLContext("edges",{picking:o.enableEdgeEvents}),i.createCanvasContext("edgeLabels"),i.createWebGLContext("nodes",{picking:!0}),i.createCanvasContext("labels"),i.createCanvasContext("hovers"),i.createWebGLContext("hoverNodes"),i.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),i.resize();for(var a in i.settings.nodeProgramClasses)i.registerNodeProgram(a,i.settings.nodeProgramClasses[a],i.settings.nodeHoverProgramClasses[a]);for(var s in i.settings.edgeProgramClasses)i.registerEdgeProgram(s,i.settings.edgeProgramClasses[s]);return i.camera=new Gr,i.bindCameraHandlers(),i.mouseCaptor=new fa(i.elements.mouse,i),i.mouseCaptor.setSettings(i.settings),i.touchCaptor=new ma(i.elements.mouse,i),i.touchCaptor.setSettings(i.settings),i.bindEventHandlers(),i.bindGraphHandlers(),i.handleSettingsUpdate(),i.refresh(),i}return Ce(e,r),ye(e,[{key:"registerNodeProgram",value:function(t,i,o){return this.nodePrograms[t]&&this.nodePrograms[t].kill(),this.nodeHoverPrograms[t]&&this.nodeHoverPrograms[t].kill(),this.nodePrograms[t]=new i(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[t]=new(o||i)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(t,i){return this.edgePrograms[t]&&this.edgePrograms[t].kill(),this.edgePrograms[t]=new i(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(t){if(this.nodePrograms[t]){var i=this.nodePrograms,o=i[t],a=cn(i,[t].map(ct));o.kill(),this.nodePrograms=a}if(this.nodeHoverPrograms[t]){var s=this.nodeHoverPrograms,u=s[t],c=cn(s,[t].map(ct));u.kill(),this.nodePrograms=c}return this}},{key:"unregisterEdgeProgram",value:function(t){if(this.edgePrograms[t]){var i=this.edgePrograms,o=i[t],a=cn(i,[t].map(ct));o.kill(),this.edgePrograms=a}return this}},{key:"resetWebGLTexture",value:function(t){var i=this.webGLContexts[t],o=this.frameBuffers[t],a=this.textures[t];a&&i.deleteTexture(a);var s=i.createTexture();return i.bindFramebuffer(i.FRAMEBUFFER,o),i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,s,0),this.textures[t]=s,this}},{key:"bindCameraHandlers",value:function(){var t=this;return this.activeListeners.camera=function(){t.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(t){var i=t.x,o=t.y,a=cr(this.webGLContexts.nodes,this.frameBuffers.nodes,i,o,this.pixelRatio,this.pickingDownSizingRatio),s=ur.apply(void 0,zr(a)),u=this.itemIDsIndex[s];return u&&u.type==="node"?u.id:null}},{key:"bindEventHandlers",value:function(){var t=this;this.activeListeners.handleResize=function(){t.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(o){var a=ft(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}},u=t.getNodeAtPosition(a);if(u&&t.hoveredNode!==u&&!t.nodeDataCache[u].hidden){t.hoveredNode&&t.emit("leaveNode",$($({},s),{},{node:t.hoveredNode})),t.hoveredNode=u,t.emit("enterNode",$($({},s),{},{node:u})),t.scheduleHighlightedNodesRender();return}if(t.hoveredNode&&t.getNodeAtPosition(a)!==t.hoveredNode){var c=t.hoveredNode;t.hoveredNode=null,t.emit("leaveNode",$($({},s),{},{node:c})),t.scheduleHighlightedNodesRender();return}if(t.settings.enableEdgeEvents){var h=t.hoveredNode?null:t.getEdgeAtPoint(s.event.x,s.event.y);h!==t.hoveredEdge&&(t.hoveredEdge&&t.emit("leaveEdge",$($({},s),{},{edge:t.hoveredEdge})),h&&t.emit("enterEdge",$($({},s),{},{edge:h})),t.hoveredEdge=h)}},this.activeListeners.handleMoveBody=function(o){var a=ft(o);t.emit("moveBody",{event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(o){var a=ft(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};t.hoveredNode&&(t.emit("leaveNode",$($({},s),{},{node:t.hoveredNode})),t.scheduleHighlightedNodesRender()),t.settings.enableEdgeEvents&&t.hoveredEdge&&(t.emit("leaveEdge",$($({},s),{},{edge:t.hoveredEdge})),t.scheduleHighlightedNodesRender()),t.emit("leaveStage",$({},s))},this.activeListeners.handleEnter=function(o){var a=ft(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};t.emit("enterStage",$({},s))};var i=function(a){return function(s){var u=ft(s),c={event:u,preventSigmaDefault:function(){u.preventSigmaDefault()}},h=t.getNodeAtPosition(u);if(h)return t.emit("".concat(a,"Node"),$($({},c),{},{node:h}));if(t.settings.enableEdgeEvents){var l=t.getEdgeAtPoint(u.x,u.y);if(l)return t.emit("".concat(a,"Edge"),$($({},c),{},{edge:l}))}return t.emit("".concat(a,"Stage"),c)}};return this.activeListeners.handleClick=i("click"),this.activeListeners.handleRightClick=i("rightClick"),this.activeListeners.handleDoubleClick=i("doubleClick"),this.activeListeners.handleWheel=i("wheel"),this.activeListeners.handleDown=i("down"),this.activeListeners.handleUp=i("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var t=this,i=this.graph,o=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;t.graph.forEachNode(function(h){return t.updateNode(h)});var c=!u||u.some(function(h){return o.has(h)});t.refresh({partialGraph:{nodes:i.nodes()},skipIndexation:!c,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;t.graph.forEachEdge(function(h){return t.updateEdge(h)});var c=u&&["zIndex","type"].some(function(h){return u==null?void 0:u.includes(h)});t.refresh({partialGraph:{edges:i.edges()},skipIndexation:!c,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(a){var s=a.key;t.addNode(s),t.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(a){var s=a.key;t.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(a){var s=a.key;t.removeNode(s),t.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(a){var s=a.key;t.addEdge(s),t.refresh({partialGraph:{edges:[s]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(a){var s=a.key;t.refresh({partialGraph:{edges:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(a){var s=a.key;t.removeEdge(s),t.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){t.clearEdgeState(),t.clearEdgeIndices(),t.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){t.clearEdgeState(),t.clearNodeState(),t.clearEdgeIndices(),t.clearNodeIndices(),t.refresh({schedule:!0})},i.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),i.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),i.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),i.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),i.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),i.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),i.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),i.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),i.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),i.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var t=this.graph;t.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),t.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),t.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),t.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),t.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),t.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),t.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),t.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),t.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),t.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(t,i){var o=cr(this.webGLContexts.edges,this.frameBuffers.edges,t,i,this.pixelRatio,this.pickingDownSizingRatio),a=ur.apply(void 0,zr(o)),s=this.itemIDsIndex[a];return s&&s.type==="edge"?s.id:null}},{key:"process",value:function(){var t=this;this.emit("beforeProcess");var i=this.graph,o=this.settings,a=this.getDimensions();if(this.nodeExtent=ra(this.graph),!this.settings.autoRescale){var s=a.width,u=a.height,c=this.nodeExtent,h=c.x,l=c.y;this.nodeExtent={x:[(h[0]+h[1])/2-s/2,(h[0]+h[1])/2+s/2],y:[(l[0]+l[1])/2-u/2,(l[0]+l[1])/2+u/2]}}this.normalizationFunction=Pr(this.customBBox||this.nodeExtent);var d=new Gr,f=dt(d.getState(),a,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(a,o.labelGridCellSize);for(var p={},w={},m={},b={},E=1,v=i.nodes(),g=0,A=v.length;g<A;g++){var S=v[g],D=this.nodeDataCache[S],C=i.getNodeAttributes(S);D.x=C.x,D.y=C.y,this.normalizationFunction.applyTo(D),typeof D.label=="string"&&!D.hidden&&this.labelGrid.add(S,D.size,this.framedGraphToViewport(D,{matrix:f})),p[D.type]=(p[D.type]||0)+1}this.labelGrid.organize();for(var I in this.nodePrograms){if(!Be.call(this.nodePrograms,I))throw new Error('Sigma: could not find a suitable program for node type "'.concat(I,'"!'));this.nodePrograms[I].reallocate(p[I]||0),p[I]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(v=Nr(this.nodeZExtent,function(oe){return t.nodeDataCache[oe].zIndex},v));for(var k=0,U=v.length;k<U;k++){var P=v[k];w[P]=E,b[w[P]]={type:"node",id:P},E++;var T=this.nodeDataCache[P];this.addNodeToProgram(P,w[P],p[T.type]++)}for(var q={},Z=i.edges(),L=0,R=Z.length;L<R;L++){var z=Z[L],j=this.edgeDataCache[z];q[j.type]=(q[j.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(Z=Nr(this.edgeZExtent,function(oe){return t.edgeDataCache[oe].zIndex},Z));for(var H in this.edgePrograms){if(!Be.call(this.edgePrograms,H))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(H,'"!'));this.edgePrograms[H].reallocate(q[H]||0),q[H]=0}for(var Q=0,ne=Z.length;Q<ne;Q++){var O=Z[Q];m[O]=E,b[m[O]]={type:"edge",id:O},E++;var ie=this.edgeDataCache[O];this.addEdgeToProgram(O,m[O],q[ie.type]++)}return this.itemIDsIndex=b,this.nodeIndices=w,this.edgeIndices=m,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(t){var i=this,o=this.settings;if(this.camera.minRatio=o.minCameraRatio,this.camera.maxRatio=o.maxCameraRatio,this.camera.enabledZooming=o.enableCameraZooming,this.camera.enabledPanning=o.enableCameraPanning,this.camera.enabledRotation=o.enableCameraRotation,o.cameraPanBoundaries?this.camera.clean=function(h){return i.cleanCameraState(h,o.cameraPanBoundaries&&on(o.cameraPanBoundaries)==="object"?o.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),t){if(t.edgeProgramClasses!==o.edgeProgramClasses){for(var a in o.edgeProgramClasses)o.edgeProgramClasses[a]!==t.edgeProgramClasses[a]&&this.registerEdgeProgram(a,o.edgeProgramClasses[a]);for(var s in t.edgeProgramClasses)o.edgeProgramClasses[s]||this.unregisterEdgeProgram(s)}if(t.nodeProgramClasses!==o.nodeProgramClasses||t.nodeHoverProgramClasses!==o.nodeHoverProgramClasses){for(var u in o.nodeProgramClasses)(o.nodeProgramClasses[u]!==t.nodeProgramClasses[u]||o.nodeHoverProgramClasses[u]!==t.nodeHoverProgramClasses[u])&&this.registerNodeProgram(u,o.nodeProgramClasses[u],o.nodeHoverProgramClasses[u]);for(var c in t.nodeProgramClasses)o.nodeProgramClasses[c]||this.unregisterNodeProgram(c)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.tolerance,a=o===void 0?0:o,s=i.boundaries,u=$({},t),c=s||this.nodeExtent,h=nt(c.x,2),l=h[0],d=h[1],f=nt(c.y,2),p=f[0],w=f[1],m=[this.graphToViewport({x:l,y:p},{cameraState:t}),this.graphToViewport({x:d,y:p},{cameraState:t}),this.graphToViewport({x:l,y:w},{cameraState:t}),this.graphToViewport({x:d,y:w},{cameraState:t})],b=1/0,E=-1/0,v=1/0,g=-1/0;m.forEach(function(q){var Z=q.x,L=q.y;b=Math.min(b,Z),E=Math.max(E,Z),v=Math.min(v,L),g=Math.max(g,L)});var A=E-b,S=g-v,D=this.getDimensions(),C=D.width,I=D.height,k=0,U=0;if(A>=C?E<C-a?k=E-(C-a):b>a&&(k=b-a):E>C+a?k=E-(C+a):b<-a&&(k=b+a),S>=I?g<I-a?U=g-(I-a):v>a&&(U=v-a):g>I+a?U=g-(I+a):v<-a&&(U=v+a),k||U){var P=this.viewportToFramedGraph({x:0,y:0},{cameraState:t}),T=this.viewportToFramedGraph({x:k,y:U},{cameraState:t});k=T.x-P.x,U=T.y-P.y,u.x+=k,u.y+=U}return u}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var t=this.camera.getState(),i=this.labelGrid.getLabelsToDisplay(t.ratio,this.settings.labelDensity);Or(i,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var o=this.canvasContexts.labels,a=0,s=i.length;a<s;a++){var u=i[a],c=this.nodeDataCache[u];if(!this.displayedNodeLabels.has(u)&&!c.hidden){var h=this.framedGraphToViewport(c),l=h.x,d=h.y,f=this.scaleSize(c.size);if(!(!c.forceLabel&&f<this.settings.labelRenderedSizeThreshold)&&!(l<-Br||l>this.width+Br||d<-Wr||d>this.height+Wr)){this.displayedNodeLabels.add(u);var p=this.settings.defaultDrawNodeLabel,w=this.nodePrograms[c.type],m=(w==null?void 0:w.drawLabel)||p;m(o,$($({key:u},c),{},{size:f,x:l,y:d}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var t=this.canvasContexts.edgeLabels;t.clearRect(0,0,this.width,this.height);var i=Ea({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});Or(i,this.edgesWithForcedLabels);for(var o=new Set,a=0,s=i.length;a<s;a++){var u=i[a],c=this.graph.extremities(u),h=this.nodeDataCache[c[0]],l=this.nodeDataCache[c[1]],d=this.edgeDataCache[u];if(!o.has(u)&&!(d.hidden||h.hidden||l.hidden)){var f=this.settings.defaultDrawEdgeLabel,p=this.edgePrograms[d.type],w=(p==null?void 0:p.drawLabel)||f;w(t,$($({key:u},d),{},{size:this.scaleSize(d.size)}),$($($({key:c[0]},h),this.framedGraphToViewport(h)),{},{size:this.scaleSize(h.size)}),$($($({key:c[1]},l),this.framedGraphToViewport(l)),{},{size:this.scaleSize(l.size)}),this.settings),o.add(u)}}return this.displayedEdgeLabels=o,this}},{key:"renderHighlightedNodes",value:function(){var t=this,i=this.canvasContexts.hovers;i.clearRect(0,0,this.width,this.height);var o=function(f){var p=t.nodeDataCache[f],w=t.framedGraphToViewport(p),m=w.x,b=w.y,E=t.scaleSize(p.size),v=t.settings.defaultDrawNodeHover,g=t.nodePrograms[p.type],A=(g==null?void 0:g.drawHover)||v;A(i,$($({key:f},p),{},{size:E,x:m,y:b}),t.settings)},a=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&a.push(this.hoveredNode),this.highlightedNodes.forEach(function(d){d!==t.hoveredNode&&a.push(d)}),a.forEach(function(d){return o(d)});var s={};a.forEach(function(d){var f=t.nodeDataCache[d].type;s[f]=(s[f]||0)+1});for(var u in this.nodeHoverPrograms)this.nodeHoverPrograms[u].reallocate(s[u]||0),s[u]=0;a.forEach(function(d){var f=t.nodeDataCache[d];t.nodeHoverPrograms[f.type].process(0,s[f.type]++,f)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var c=this.getRenderParams();for(var h in this.nodeHoverPrograms){var l=this.nodeHoverPrograms[h];l.render(c)}}},{key:"scheduleHighlightedNodesRender",value:function(){var t=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){t.renderHighlightedNodesFrame=null,t.renderHighlightedNodes(),t.renderEdgeLabels()}))}},{key:"render",value:function(){var t=this;this.emit("beforeRender");var i=function(){return t.emit("afterRender"),t};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(m){return t.resetWebGLTexture(m)}),!this.graph.order)return i();var o=this.mouseCaptor,a=this.camera.isAnimated()||o.isMoving||o.draggedEvents||o.currentWheelDirection,s=this.camera.getState(),u=this.getDimensions(),c=this.getGraphDimensions(),h=this.getStagePadding();this.matrix=dt(s,u,c,h),this.invMatrix=dt(s,u,c,h,!0),this.correctionRatio=na(this.matrix,s,u),this.graphToViewportRatio=this.getGraphToViewportRatio();var l=this.getRenderParams();for(var d in this.nodePrograms){var f=this.nodePrograms[d];f.render(l)}if(!this.settings.hideEdgesOnMove||!a)for(var p in this.edgePrograms){var w=this.edgePrograms[p];w.render(l)}return this.settings.hideLabelsOnMove&&a||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),i()}},{key:"addNode",value:function(t){var i=Object.assign({},this.graph.getNodeAttributes(t));this.settings.nodeReducer&&(i=this.settings.nodeReducer(t,i));var o=Sa(this.settings,t,i);this.nodeDataCache[t]=o,this.nodesWithForcedLabels.delete(t),o.forceLabel&&!o.hidden&&this.nodesWithForcedLabels.add(t),this.highlightedNodes.delete(t),o.highlighted&&!o.hidden&&this.highlightedNodes.add(t),this.settings.zIndex&&(o.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=o.zIndex),o.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=o.zIndex))}},{key:"updateNode",value:function(t){this.addNode(t);var i=this.nodeDataCache[t];this.normalizationFunction.applyTo(i)}},{key:"removeNode",value:function(t){delete this.nodeDataCache[t],delete this.nodeProgramIndex[t],this.highlightedNodes.delete(t),this.hoveredNode===t&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(t)}},{key:"addEdge",value:function(t){var i=Object.assign({},this.graph.getEdgeAttributes(t));this.settings.edgeReducer&&(i=this.settings.edgeReducer(t,i));var o=Ta(this.settings,t,i);this.edgeDataCache[t]=o,this.edgesWithForcedLabels.delete(t),o.forceLabel&&!o.hidden&&this.edgesWithForcedLabels.add(t),this.settings.zIndex&&(o.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=o.zIndex),o.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=o.zIndex))}},{key:"updateEdge",value:function(t){this.addEdge(t)}},{key:"removeEdge",value:function(t){delete this.edgeDataCache[t],delete this.edgeProgramIndex[t],this.hoveredEdge===t&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(t)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new $r,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0],this.highlightedNodes=new Set}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(t,i,o){var a=this.nodeDataCache[t],s=this.nodePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for node type "'.concat(a.type,'"!'));s.process(i,o,a),this.nodeProgramIndex[t]=o}},{key:"addEdgeToProgram",value:function(t,i,o){var a=this.edgeDataCache[t],s=this.edgePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(a.type,'"!'));var u=this.graph.extremities(t),c=this.nodeDataCache[u[0]],h=this.nodeDataCache[u[1]];s.process(i,o,c,h,a),this.edgeProgramIndex[t]=o}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var t=this.settings,i=t.stagePadding,o=t.autoRescale;return o&&i||0}},{key:"createLayer",value:function(t,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.elements[t])throw new Error('Sigma: a layer named "'.concat(t,'" already exists'));var a=oa(i,{position:"absolute"},{class:"sigma-".concat(t)});return o.style&&Object.assign(a.style,o.style),this.elements[t]=a,"beforeLayer"in o&&o.beforeLayer?this.elements[o.beforeLayer].before(a):"afterLayer"in o&&o.afterLayer?this.elements[o.afterLayer].after(a):this.container.appendChild(a),a}},{key:"createCanvas",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.createLayer(t,"canvas",i)}},{key:"createCanvasContext",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.createCanvas(t,i),a={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[t]=o.getContext("2d",a),this}},{key:"createWebGLContext",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=(i==null?void 0:i.canvas)||this.createCanvas(t,i);i.hidden&&o.remove();var a=$({preserveDrawingBuffer:!1,antialias:!1},i),s;s=o.getContext("webgl2",a),s||(s=o.getContext("webgl",a)),s||(s=o.getContext("experimental-webgl",a));var u=s;if(this.webGLContexts[t]=u,u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA),i.picking){this.pickingLayers.add(t);var c=u.createFramebuffer();if(!c)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(t));this.frameBuffers[t]=c}return u}},{key:"killLayer",value:function(t){var i=this.elements[t];if(!i)throw new Error("Sigma: cannot kill layer ".concat(t,", which does not exist"));if(this.webGLContexts[t]){var o,a=this.webGLContexts[t];(o=a.getExtension("WEBGL_lose_context"))===null||o===void 0||o.loseContext(),delete this.webGLContexts[t]}else this.canvasContexts[t]&&delete this.canvasContexts[t];return i.remove(),delete this.elements[t],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(t){this.unbindCameraHandlers(),this.camera=t,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(t){t!==this.graph&&(this.hoveredNode&&!t.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!t.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=t,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var t=this.customBBox||this.nodeExtent;return{width:t.x[1]-t.x[0]||1,height:t.y[1]-t.y[0]||1}}},{key:"getNodeDisplayData",value:function(t){var i=this.nodeDataCache[t];return i?Object.assign({},i):void 0}},{key:"getEdgeDisplayData",value:function(t){var i=this.edgeDataCache[t];return i?Object.assign({},i):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return $({},this.settings)}},{key:"getSetting",value:function(t){return this.settings[t]}},{key:"setSetting",value:function(t,i){var o=$({},this.settings);return this.settings[t]=i,un(this.settings),this.handleSettingsUpdate(o),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(t,i){return this.setSetting(t,i(this.settings[t])),this}},{key:"setSettings",value:function(t){var i=$({},this.settings);return this.settings=$($({},this.settings),t),un(this.settings),this.handleSettingsUpdate(i),this.scheduleRefresh(),this}},{key:"resize",value:function(t){var i=this.width,o=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=xr(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!t&&i===this.width&&o===this.height)return this;for(var a in this.elements){var s=this.elements[a];s.style.width=this.width+"px",s.style.height=this.height+"px"}for(var u in this.canvasContexts)this.elements[u].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[u].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[u].scale(this.pixelRatio,this.pixelRatio);for(var c in this.webGLContexts){this.elements[c].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[c].setAttribute("height",this.height*this.pixelRatio+"px");var h=this.webGLContexts[c];if(h.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(c)){var l=this.textures[c];l&&h.deleteTexture(l)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(t){var i=this,o=(t==null?void 0:t.skipIndexation)!==void 0?t==null?void 0:t.skipIndexation:!1,a=(t==null?void 0:t.schedule)!==void 0?t.schedule:!1,s=!t||!t.partialGraph;if(s)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(g){return i.addNode(g)}),this.graph.forEachEdge(function(g){return i.addEdge(g)});else{for(var u,c,h=((u=t.partialGraph)===null||u===void 0?void 0:u.nodes)||[],l=0,d=(h==null?void 0:h.length)||0;l<d;l++){var f=h[l];if(this.updateNode(f),o){var p=this.nodeProgramIndex[f];if(p===void 0)throw new Error('Sigma: node "'.concat(f,`" can't be repaint`));this.addNodeToProgram(f,this.nodeIndices[f],p)}}for(var w=(t==null||(c=t.partialGraph)===null||c===void 0?void 0:c.edges)||[],m=0,b=w.length;m<b;m++){var E=w[m];if(this.updateEdge(E),o){var v=this.edgeProgramIndex[E];if(v===void 0)throw new Error('Sigma: edge "'.concat(E,`" can't be repaint`));this.addEdgeToProgram(E,this.edgeIndices[E],v)}}}return(s||!o)&&(this.needToProcess=!0),a?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var t=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){t.render()})),this}},{key:"scheduleRefresh",value:function(t){return this.refresh($($({},t),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(t,i){var o=this.camera.getState(),a=o.ratio,s=o.angle,u=o.x,c=o.y,h=this.settings,l=h.minCameraRatio,d=h.maxCameraRatio;typeof d=="number"&&(i=Math.min(i,d)),typeof l=="number"&&(i=Math.max(i,l));var f=i/a,p={x:this.width/2,y:this.height/2},w=this.viewportToFramedGraph(t),m=this.viewportToFramedGraph(p);return{angle:s,x:(w.x-m.x)*(1-f)+u,y:(w.y-m.y)*(1-f)+c,ratio:i}}},{key:"viewRectangle",value:function(){var t=this.viewportToFramedGraph({x:0,y:0}),i=this.viewportToFramedGraph({x:this.width,y:0}),o=this.viewportToFramedGraph({x:0,y:this.height});return{x1:t.x,y1:t.y,x2:i.x,y2:i.y,height:i.y-o.y}}},{key:"framedGraphToViewport",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!i.cameraState||!!i.viewportDimensions||!!i.graphDimensions,a=i.matrix?i.matrix:o?dt(i.cameraState||this.camera.getState(),i.viewportDimensions||this.getDimensions(),i.graphDimensions||this.getGraphDimensions(),i.padding||this.getStagePadding()):this.matrix,s=rn(a,t);return{x:(1+s.x)*this.width/2,y:(1-s.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!i.cameraState||!!i.viewportDimensions||!i.graphDimensions,a=i.matrix?i.matrix:o?dt(i.cameraState||this.camera.getState(),i.viewportDimensions||this.getDimensions(),i.graphDimensions||this.getGraphDimensions(),i.padding||this.getStagePadding(),!0):this.invMatrix,s=rn(a,{x:t.x/this.width*2-1,y:1-t.y/this.height*2});return isNaN(s.x)&&(s.x=0),isNaN(s.y)&&(s.y=0),s}},{key:"viewportToGraph",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(t,i))}},{key:"graphToViewport",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(t),i)}},{key:"getGraphToViewportRatio",value:function(){var t={x:0,y:0},i={x:1,y:1},o=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),a=this.graphToViewport(t),s=this.graphToViewport(i),u=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2));return u/o}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(t){return this.customBBox=t,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var t=this.container;t.firstChild;)t.removeChild(t.firstChild);for(var i in this.nodePrograms)this.nodePrograms[i].kill();for(var o in this.nodeHoverPrograms)this.nodeHoverPrograms[o].kill();for(var a in this.edgePrograms)this.edgePrograms[a].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var s in this.elements)this.killLayer(s);this.canvasContexts={},this.webGLContexts={},this.elements={}}},{key:"scaleSize",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return t/this.settings.zoomToSizeRatioFunction(i)*(this.getSetting("itemSizesReference")==="positions"?i*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var t={};for(var i in this.elements)this.elements[i]instanceof HTMLCanvasElement&&(t[i]=this.elements[i]);return t}}])})(tn),Aa=_a,pt={},Hr;function jr(){if(Hr)return pt;Hr=1;function r(t){return typeof t!="number"||isNaN(t)?1:t}function e(t,i){var o={},a=function(c){return typeof c>"u"?i:c};typeof i=="function"&&(a=i);var s=function(c){return a(c[t])},u=function(){return a(void 0)};return typeof t=="string"?(o.fromAttributes=s,o.fromGraph=function(c,h){return s(c.getNodeAttributes(h))},o.fromEntry=function(c,h){return s(h)}):typeof t=="function"?(o.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},o.fromGraph=function(c,h){return a(t(h,c.getNodeAttributes(h)))},o.fromEntry=function(c,h){return a(t(c,h))}):(o.fromAttributes=u,o.fromGraph=u,o.fromEntry=u),o}function n(t,i){var o={},a=function(c){return typeof c>"u"?i:c};typeof i=="function"&&(a=i);var s=function(c){return a(c[t])},u=function(){return a(void 0)};return typeof t=="string"?(o.fromAttributes=s,o.fromGraph=function(c,h){return s(c.getEdgeAttributes(h))},o.fromEntry=function(c,h){return s(h)},o.fromPartialEntry=o.fromEntry,o.fromMinimalEntry=o.fromEntry):typeof t=="function"?(o.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},o.fromGraph=function(c,h){var l=c.extremities(h);return a(t(h,c.getEdgeAttributes(h),l[0],l[1],c.getNodeAttributes(l[0]),c.getNodeAttributes(l[1]),c.isUndirected(h)))},o.fromEntry=function(c,h,l,d,f,p,w){return a(t(c,h,l,d,f,p,w))},o.fromPartialEntry=function(c,h,l,d){return a(t(c,h,l,d))},o.fromMinimalEntry=function(c,h){return a(t(c,h))}):(o.fromAttributes=u,o.fromGraph=u,o.fromEntry=u,o.fromMinimalEntry=u),o}return pt.createNodeValueGetter=e,pt.createEdgeValueGetter=n,pt.createEdgeWeightGetter=function(t){return n(t,r)},pt}var hn,Vr;function Da(){if(Vr)return hn;Vr=1;var r=0,e=1,n=2,t=3,i=4,o=5,a=6,s=7,u=8,c=9,h=0,l=1,d=2,f=0,p=1,w=2,m=3,b=4,E=5,v=6,g=7,A=8,S=3,D=10,C=3,I=9,k=10;return hn=function(P,T,q){var Z,L,R,z,j,H,Q,ne,O,ie,oe=T.length,ae=q.length,he=P.adjustSizes,Te=P.barnesHutTheta*P.barnesHutTheta,fe,te,Y,ee,we,B,_,y=[];for(R=0;R<oe;R+=D)T[R+i]=T[R+n],T[R+o]=T[R+t],T[R+n]=0,T[R+t]=0;if(P.outboundAttractionDistribution){for(fe=0,R=0;R<oe;R+=D)fe+=T[R+a];fe/=oe/D}if(P.barnesHutOptimize){var N=1/0,M=-1/0,V=1/0,X=-1/0,re,de,me;for(R=0;R<oe;R+=D)N=Math.min(N,T[R+r]),M=Math.max(M,T[R+r]),V=Math.min(V,T[R+e]),X=Math.max(X,T[R+e]);var Oe=M-N,Ge=X-V;for(Oe>Ge?(V-=(Oe-Ge)/2,X=V+Oe):(N-=(Ge-Oe)/2,M=N+Ge),y[0+f]=-1,y[0+p]=(N+M)/2,y[0+w]=(V+X)/2,y[0+m]=Math.max(M-N,X-V),y[0+b]=-1,y[0+E]=-1,y[0+v]=0,y[0+g]=0,y[0+A]=0,Z=1,R=0;R<oe;R+=D)for(L=0,me=S;;)if(y[L+E]>=0){T[R+r]<y[L+p]?T[R+e]<y[L+w]?re=y[L+E]:re=y[L+E]+I:T[R+e]<y[L+w]?re=y[L+E]+I*2:re=y[L+E]+I*3,y[L+g]=(y[L+g]*y[L+v]+T[R+r]*T[R+a])/(y[L+v]+T[R+a]),y[L+A]=(y[L+A]*y[L+v]+T[R+e]*T[R+a])/(y[L+v]+T[R+a]),y[L+v]+=T[R+a],L=re;continue}else if(y[L+f]<0){y[L+f]=R;break}else{if(y[L+E]=Z*I,ne=y[L+m]/2,O=y[L+E],y[O+f]=-1,y[O+p]=y[L+p]-ne,y[O+w]=y[L+w]-ne,y[O+m]=ne,y[O+b]=O+I,y[O+E]=-1,y[O+v]=0,y[O+g]=0,y[O+A]=0,O+=I,y[O+f]=-1,y[O+p]=y[L+p]-ne,y[O+w]=y[L+w]+ne,y[O+m]=ne,y[O+b]=O+I,y[O+E]=-1,y[O+v]=0,y[O+g]=0,y[O+A]=0,O+=I,y[O+f]=-1,y[O+p]=y[L+p]+ne,y[O+w]=y[L+w]-ne,y[O+m]=ne,y[O+b]=O+I,y[O+E]=-1,y[O+v]=0,y[O+g]=0,y[O+A]=0,O+=I,y[O+f]=-1,y[O+p]=y[L+p]+ne,y[O+w]=y[L+w]+ne,y[O+m]=ne,y[O+b]=y[L+b],y[O+E]=-1,y[O+v]=0,y[O+g]=0,y[O+A]=0,Z+=4,T[y[L+f]+r]<y[L+p]?T[y[L+f]+e]<y[L+w]?re=y[L+E]:re=y[L+E]+I:T[y[L+f]+e]<y[L+w]?re=y[L+E]+I*2:re=y[L+E]+I*3,y[L+v]=T[y[L+f]+a],y[L+g]=T[y[L+f]+r],y[L+A]=T[y[L+f]+e],y[re+f]=y[L+f],y[L+f]=-1,T[R+r]<y[L+p]?T[R+e]<y[L+w]?de=y[L+E]:de=y[L+E]+I:T[R+e]<y[L+w]?de=y[L+E]+I*2:de=y[L+E]+I*3,re===de)if(me--){L=re;continue}else{me=S;break}y[de+f]=R;break}}if(P.barnesHutOptimize)for(te=P.scalingRatio,R=0;R<oe;R+=D)for(L=0;;)if(y[L+E]>=0)if(B=Math.pow(T[R+r]-y[L+g],2)+Math.pow(T[R+e]-y[L+A],2),ie=y[L+m],4*ie*ie/B<Te){if(Y=T[R+r]-y[L+g],ee=T[R+e]-y[L+A],he===!0?B>0?(_=te*T[R+a]*y[L+v]/B,T[R+n]+=Y*_,T[R+t]+=ee*_):B<0&&(_=-te*T[R+a]*y[L+v]/Math.sqrt(B),T[R+n]+=Y*_,T[R+t]+=ee*_):B>0&&(_=te*T[R+a]*y[L+v]/B,T[R+n]+=Y*_,T[R+t]+=ee*_),L=y[L+b],L<0)break;continue}else{L=y[L+E];continue}else{if(H=y[L+f],H>=0&&H!==R&&(Y=T[R+r]-T[H+r],ee=T[R+e]-T[H+e],B=Y*Y+ee*ee,he===!0?B>0?(_=te*T[R+a]*T[H+a]/B,T[R+n]+=Y*_,T[R+t]+=ee*_):B<0&&(_=-te*T[R+a]*T[H+a]/Math.sqrt(B),T[R+n]+=Y*_,T[R+t]+=ee*_):B>0&&(_=te*T[R+a]*T[H+a]/B,T[R+n]+=Y*_,T[R+t]+=ee*_)),L=y[L+b],L<0)break;continue}else for(te=P.scalingRatio,z=0;z<oe;z+=D)for(j=0;j<z;j+=D)Y=T[z+r]-T[j+r],ee=T[z+e]-T[j+e],he===!0?(B=Math.sqrt(Y*Y+ee*ee)-T[z+u]-T[j+u],B>0?(_=te*T[z+a]*T[j+a]/B/B,T[z+n]+=Y*_,T[z+t]+=ee*_,T[j+n]-=Y*_,T[j+t]-=ee*_):B<0&&(_=100*te*T[z+a]*T[j+a],T[z+n]+=Y*_,T[z+t]+=ee*_,T[j+n]-=Y*_,T[j+t]-=ee*_)):(B=Math.sqrt(Y*Y+ee*ee),B>0&&(_=te*T[z+a]*T[j+a]/B/B,T[z+n]+=Y*_,T[z+t]+=ee*_,T[j+n]-=Y*_,T[j+t]-=ee*_));for(O=P.gravity/P.scalingRatio,te=P.scalingRatio,R=0;R<oe;R+=D)_=0,Y=T[R+r],ee=T[R+e],B=Math.sqrt(Math.pow(Y,2)+Math.pow(ee,2)),P.strongGravityMode?B>0&&(_=te*T[R+a]*O):B>0&&(_=te*T[R+a]*O/B),T[R+n]-=Y*_,T[R+t]-=ee*_;for(te=1*(P.outboundAttractionDistribution?fe:1),Q=0;Q<ae;Q+=C)z=q[Q+h],j=q[Q+l],ne=q[Q+d],we=Math.pow(ne,P.edgeWeightInfluence),Y=T[z+r]-T[j+r],ee=T[z+e]-T[j+e],he===!0?(B=Math.sqrt(Y*Y+ee*ee)-T[z+u]-T[j+u],P.linLogMode?P.outboundAttractionDistribution?B>0&&(_=-te*we*Math.log(1+B)/B/T[z+a]):B>0&&(_=-te*we*Math.log(1+B)/B):P.outboundAttractionDistribution?B>0&&(_=-te*we/T[z+a]):B>0&&(_=-te*we)):(B=Math.sqrt(Math.pow(Y,2)+Math.pow(ee,2)),P.linLogMode?P.outboundAttractionDistribution?B>0&&(_=-te*we*Math.log(1+B)/B/T[z+a]):B>0&&(_=-te*we*Math.log(1+B)/B):P.outboundAttractionDistribution?(B=1,_=-te*we/T[z+a]):(B=1,_=-te*we)),B>0&&(T[z+n]+=Y*_,T[z+t]+=ee*_,T[j+n]-=Y*_,T[j+t]-=ee*_);var ce,Ve,Xe,J,ge,xe;if(he===!0)for(R=0;R<oe;R+=D)T[R+c]!==1&&(ce=Math.sqrt(Math.pow(T[R+n],2)+Math.pow(T[R+t],2)),ce>k&&(T[R+n]=T[R+n]*k/ce,T[R+t]=T[R+t]*k/ce),Ve=T[R+a]*Math.sqrt((T[R+i]-T[R+n])*(T[R+i]-T[R+n])+(T[R+o]-T[R+t])*(T[R+o]-T[R+t])),Xe=Math.sqrt((T[R+i]+T[R+n])*(T[R+i]+T[R+n])+(T[R+o]+T[R+t])*(T[R+o]+T[R+t]))/2,J=.1*Math.log(1+Xe)/(1+Math.sqrt(Ve)),ge=T[R+r]+T[R+n]*(J/P.slowDown),T[R+r]=ge,xe=T[R+e]+T[R+t]*(J/P.slowDown),T[R+e]=xe);else for(R=0;R<oe;R+=D)T[R+c]!==1&&(Ve=T[R+a]*Math.sqrt((T[R+i]-T[R+n])*(T[R+i]-T[R+n])+(T[R+o]-T[R+t])*(T[R+o]-T[R+t])),Xe=Math.sqrt((T[R+i]+T[R+n])*(T[R+i]+T[R+n])+(T[R+o]+T[R+t])*(T[R+o]+T[R+t]))/2,J=T[R+s]*Math.log(1+Xe)/(1+Math.sqrt(Ve)),T[R+s]=Math.min(1,Math.sqrt(J*(Math.pow(T[R+n],2)+Math.pow(T[R+t],2))/(1+Math.sqrt(Ve)))),ge=T[R+r]+T[R+n]*(J/P.slowDown),T[R+r]=ge,xe=T[R+e]+T[R+t]*(J/P.slowDown),T[R+e]=xe);return{}},hn}var We={},qr;function Ra(){if(qr)return We;qr=1;var r=10,e=3;return We.assign=function(n){n=n||{};var t=Array.prototype.slice.call(arguments).slice(1),i,o,a;for(i=0,a=t.length;i<a;i++)if(t[i])for(o in t[i])n[o]=t[i][o];return n},We.validateSettings=function(n){return"linLogMode"in n&&typeof n.linLogMode!="boolean"?{message:"the `linLogMode` setting should be a boolean."}:"outboundAttractionDistribution"in n&&typeof n.outboundAttractionDistribution!="boolean"?{message:"the `outboundAttractionDistribution` setting should be a boolean."}:"adjustSizes"in n&&typeof n.adjustSizes!="boolean"?{message:"the `adjustSizes` setting should be a boolean."}:"edgeWeightInfluence"in n&&typeof n.edgeWeightInfluence!="number"?{message:"the `edgeWeightInfluence` setting should be a number."}:"scalingRatio"in n&&!(typeof n.scalingRatio=="number"&&n.scalingRatio>=0)?{message:"the `scalingRatio` setting should be a number >= 0."}:"strongGravityMode"in n&&typeof n.strongGravityMode!="boolean"?{message:"the `strongGravityMode` setting should be a boolean."}:"gravity"in n&&!(typeof n.gravity=="number"&&n.gravity>=0)?{message:"the `gravity` setting should be a number >= 0."}:"slowDown"in n&&!(typeof n.slowDown=="number"||n.slowDown>=0)?{message:"the `slowDown` setting should be a number >= 0."}:"barnesHutOptimize"in n&&typeof n.barnesHutOptimize!="boolean"?{message:"the `barnesHutOptimize` setting should be a boolean."}:"barnesHutTheta"in n&&!(typeof n.barnesHutTheta=="number"&&n.barnesHutTheta>=0)?{message:"the `barnesHutTheta` setting should be a number >= 0."}:null},We.graphToByteArrays=function(n,t){var i=n.order,o=n.size,a={},s,u=new Float32Array(i*r),c=new Float32Array(o*e);return s=0,n.forEachNode(function(h,l){a[h]=s,u[s]=l.x,u[s+1]=l.y,u[s+2]=0,u[s+3]=0,u[s+4]=0,u[s+5]=0,u[s+6]=1,u[s+7]=1,u[s+8]=l.size||1,u[s+9]=l.fixed?1:0,s+=r}),s=0,n.forEachEdge(function(h,l,d,f,p,w,m){var b=a[d],E=a[f],v=t(h,l,d,f,p,w,m);u[b+6]+=v,u[E+6]+=v,c[s]=b,c[s+1]=E,c[s+2]=v,s+=e}),{nodes:u,edges:c}},We.assignLayoutChanges=function(n,t,i){var o=0;n.updateEachNodeAttributes(function(a,s){return s.x=t[o],s.y=t[o+1],o+=r,i?i(a,s):s})},We.readGraphPositions=function(n,t){var i=0;n.forEachNode(function(o,a){t[i]=a.x,t[i+1]=a.y,i+=r})},We.collectLayoutChanges=function(n,t,i){for(var o=n.nodes(),a={},s=0,u=0,c=t.length;s<c;s+=r){if(i){var h=Object.assign({},n.getNodeAttributes(o[u]));h.x=t[s],h.y=t[s+1],h=i(o[u],h),a[o[u]]={x:h.x,y:h.y}}else a[o[u]]={x:t[s],y:t[s+1]};u++}return a},We.createWorker=function(t){var i=window.URL||window.webkitURL,o=t.toString(),a=i.createObjectURL(new Blob(["("+o+").call(this);"],{type:"text/javascript"})),s=new Worker(a);return i.revokeObjectURL(a),s},We}var ln,Yr;function Ca(){return Yr||(Yr=1,ln={linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:1,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5}),ln}var dn,Kr;function Ia(){if(Kr)return dn;Kr=1;var r=St(),e=jr().createEdgeWeightGetter,n=Da(),t=Ra(),i=Ca();function o(u,c,h){if(!r(c))throw new Error("graphology-layout-forceatlas2: the given graph is not a valid graphology instance.");typeof h=="number"&&(h={iterations:h});var l=h.iterations;if(typeof l!="number")throw new Error("graphology-layout-forceatlas2: invalid number of iterations.");if(l<=0)throw new Error("graphology-layout-forceatlas2: you should provide a positive number of iterations.");var d=e("getEdgeWeight"in h?h.getEdgeWeight:"weight").fromEntry,f=typeof h.outputReducer=="function"?h.outputReducer:null,p=t.assign({},i,h.settings),w=t.validateSettings(p);if(w)throw new Error("graphology-layout-forceatlas2: "+w.message);var m=t.graphToByteArrays(c,d),b;for(b=0;b<l;b++)n(p,m.nodes,m.edges);if(u){t.assignLayoutChanges(c,m.nodes,f);return}return t.collectLayoutChanges(c,m.nodes)}function a(u){var c=typeof u=="number"?u:u.order;return{barnesHutOptimize:c>2e3,strongGravityMode:!0,gravity:.05,scalingRatio:10,slowDown:1+Math.log(c)}}var s=o.bind(null,!1);return s.assign=o.bind(null,!0),s.inferSettings=a,dn=s,dn}var La=Ia();const ka=Me(La);var fn,Xr;function Zr(){if(Xr)return fn;Xr=1;function r(n){return!n||typeof n!="object"||typeof n=="function"||Array.isArray(n)||n instanceof Set||n instanceof Map||n instanceof RegExp||n instanceof Date}function e(n,t){n=n||{};var i={};for(var o in t){var a=n[o],s=t[o];if(!r(s)){i[o]=e(a,s);continue}a===void 0?i[o]=s:i[o]=a}return i}return fn=e,fn}var gn,Jr;function xa(){if(Jr)return gn;Jr=1;var r=St();return gn=function(n){if(!r(n))throw new Error("graphology-utils/infer-type: expecting a valid graphology instance.");var t=n.type;return t!=="mixed"?t:n.directedSize===0&&n.undirectedSize===0||n.directedSize>0&&n.undirectedSize>0?"mixed":n.directedSize>0?"directed":"undirected"},gn}var pn,Qr;function ei(){if(Qr)return pn;Qr=1;function r(e){if(typeof e!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=e}return typeof Symbol<"u"&&(r.prototype[Symbol.iterator]=function(){return this}),r.of=function(){var e=arguments,n=e.length,t=0;return new r(function(){return t>=n?{done:!0}:{done:!1,value:e[t++]}})},r.empty=function(){var e=new r(function(){return{done:!0}});return e},r.fromSequence=function(e){var n=0,t=e.length;return new r(function(){return n>=t?{done:!0}:{done:!1,value:e[n++]}})},r.is=function(e){return e instanceof r?!0:typeof e=="object"&&e!==null&&typeof e.next=="function"},pn=r,pn}var mn={},ti;function vn(){return ti||(ti=1,(function(r){var e=Math.pow(2,8)-1,n=Math.pow(2,16)-1,t=Math.pow(2,32)-1,i=Math.pow(2,7)-1,o=Math.pow(2,15)-1,a=Math.pow(2,31)-1;r.getPointerArray=function(u){var c=u-1;if(c<=e)return Uint8Array;if(c<=n)return Uint16Array;if(c<=t)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},r.getSignedPointerArray=function(u){var c=u-1;return c<=i?Int8Array:c<=o?Int16Array:c<=a?Int32Array:Float64Array},r.getNumberType=function(u){return u===(u|0)?Math.sign(u)===-1?u<=127&&u>=-128?Int8Array:u<=32767&&u>=-32768?Int16Array:Int32Array:u<=255?Uint8Array:u<=65535?Uint16Array:Uint32Array:Float64Array};var s={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};r.getMinimalRepresentation=function(u,c){var h=null,l=0,d,f,p,w,m;for(w=0,m=u.length;w<m;w++)p=c?c(u[w]):u[w],f=r.getNumberType(p),d=s[f.name],d>l&&(l=d,h=f);return h},r.isTypedArray=function(u){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(u)},r.concat=function(){var u=0,c,h,l;for(c=0,l=arguments.length;c<l;c++)u+=arguments[c].length;var d=new arguments[0].constructor(u);for(c=0,h=0;c<l;c++)d.set(arguments[c],h),h+=arguments[c].length;return d},r.indices=function(u){for(var c=r.getPointerArray(u),h=new c(u),l=0;l<u;l++)h[l]=l;return h}})(mn)),mn}var yn,ni;function Na(){if(ni)return yn;ni=1;var r=ei(),e=vn().getPointerArray;function n(t,i){arguments.length<2&&(i=t,t=Array);var o=e(i);this.size=0,this.length=i,this.dense=new o(i),this.sparse=new o(i),this.vals=new t(i)}return n.prototype.clear=function(){this.size=0},n.prototype.has=function(t){var i=this.sparse[t];return i<this.size&&this.dense[i]===t},n.prototype.get=function(t){var i=this.sparse[t];if(i<this.size&&this.dense[i]===t)return this.vals[i]},n.prototype.set=function(t,i){var o=this.sparse[t];return o<this.size&&this.dense[o]===t?(this.vals[o]=i,this):(this.dense[this.size]=t,this.sparse[t]=this.size,this.vals[this.size]=i,this.size++,this)},n.prototype.delete=function(t){var i=this.sparse[t];return i>=this.size||this.dense[i]!==t?!1:(i=this.dense[this.size-1],this.dense[this.sparse[t]]=i,this.sparse[i]=this.sparse[t],this.size--,!0)},n.prototype.forEach=function(t,i){i=arguments.length>1?i:this;for(var o=0;o<this.size;o++)t.call(i,this.vals[o],this.dense[o])},n.prototype.keys=function(){var t=this.size,i=this.dense,o=0;return new r(function(){if(o<t){var a=i[o];return o++,{value:a}}return{done:!0}})},n.prototype.values=function(){var t=this.size,i=this.vals,o=0;return new r(function(){if(o<t){var a=i[o];return o++,{value:a}}return{done:!0}})},n.prototype.entries=function(){var t=this.size,i=this.dense,o=this.vals,a=0;return new r(function(){if(a<t){var s=[i[a],o[a]];return a++,{value:s}}return{done:!0}})},typeof Symbol<"u"&&(n.prototype[Symbol.iterator]=n.prototype.entries),n.prototype.inspect=function(){for(var t=new Map,i=0;i<this.size;i++)t.set(this.dense[i],this.vals[i]);return Object.defineProperty(t,"constructor",{value:n,enumerable:!1}),t.length=this.length,this.vals.constructor!==Array&&(t.type=this.vals.constructor.name),t},typeof Symbol<"u"&&(n.prototype[Symbol.for("nodejs.util.inspect.custom")]=n.prototype.inspect),yn=n,yn}var bn,ri;function Pa(){if(ri)return bn;ri=1;var r=ei(),e=vn().getPointerArray;function n(t){var i=e(t);this.start=0,this.size=0,this.capacity=t,this.dense=new i(t),this.sparse=new i(t)}return n.prototype.clear=function(){this.start=0,this.size=0},n.prototype.has=function(t){if(this.size===0)return!1;var i=this.sparse[t],o=i<this.capacity&&i>=this.start&&i<this.start+this.size||i<(this.start+this.size)%this.capacity;return o&&this.dense[i]===t},n.prototype.enqueue=function(t){var i=this.sparse[t];if(this.size!==0){var o=i<this.capacity&&i>=this.start&&i<this.start+this.size||i<(this.start+this.size)%this.capacity;if(o&&this.dense[i]===t)return this}return i=(this.start+this.size)%this.capacity,this.dense[i]=t,this.sparse[t]=i,this.size++,this},n.prototype.dequeue=function(){if(this.size!==0){var t=this.start;this.size--,this.start++,this.start===this.capacity&&(this.start=0);var i=this.dense[t];return this.sparse[i]=this.capacity,i}},n.prototype.forEach=function(t,i){i=arguments.length>1?i:this;for(var o=this.capacity,a=this.size,s=this.start,u=0;u<a;)t.call(i,this.dense[s],u,this),s++,u++,s===o&&(s=0)},n.prototype.values=function(){var t=this.dense,i=this.capacity,o=this.size,a=this.start,s=0;return new r(function(){if(s>=o)return{done:!0};var u=t[a];return a++,s++,a===i&&(a=0),{value:u,done:!1}})},typeof Symbol<"u"&&(n.prototype[Symbol.iterator]=n.prototype.values),n.prototype.inspect=function(){var t=[];return this.forEach(function(i){t.push(i)}),Object.defineProperty(t,"constructor",{value:n,enumerable:!1}),t.capacity=this.capacity,t},typeof Symbol<"u"&&(n.prototype[Symbol.for("nodejs.util.inspect.custom")]=n.prototype.inspect),bn=n,bn}var wn,ii;function Oa(){if(ii)return wn;ii=1;function r(n){return function(t){return typeof t!="number"&&(t=t.length),Math.floor(n()*t)}}var e=r(Math.random);return e.createRandomIndex=r,wn=e,wn}var Dt={},oi;function Ga(){if(oi)return Dt;oi=1;var r=vn(),e=Zr(),n=jr().createEdgeWeightGetter,t=Symbol.for("nodejs.util.inspect.custom"),i={getEdgeWeight:"weight",keepDendrogram:!1,resolution:1};function o(s,u){u=e(u,i);var c=u.resolution,h=n(u.getEdgeWeight).fromEntry,l=(s.size-s.selfLoopCount)*2,d=r.getPointerArray(l),f=r.getPointerArray(s.order+1),p=u.getEdgeWeight?Float64Array:r.getPointerArray(s.size*2);this.C=s.order,this.M=0,this.E=l,this.U=0,this.resolution=c,this.level=0,this.graph=s,this.nodes=new Array(s.order),this.keepDendrogram=u.keepDendrogram,this.neighborhood=new f(l),this.weights=new p(l),this.loops=new p(s.order),this.starts=new d(s.order+1),this.belongings=new f(s.order),this.dendrogram=[],this.mapping=null,this.counts=new f(s.order),this.unused=new f(s.order),this.totalWeights=new p(s.order);var w={},m,b=0,E=0,v=this;s.forEachNode(function(g){v.nodes[b]=g,w[g]=b,E+=s.undirectedDegreeWithoutSelfLoops(g),v.starts[b]=E,v.belongings[b]=b,v.counts[b]=1,b++}),s.forEachEdge(function(g,A,S,D,C,I,k){if(m=h(g,A,S,D,C,I,k),S=w[S],D=w[D],v.M+=m,S===D)v.totalWeights[S]+=m*2,v.loops[S]=m*2;else{v.totalWeights[S]+=m,v.totalWeights[D]+=m;var U=--v.starts[S],P=--v.starts[D];v.neighborhood[U]=D,v.neighborhood[P]=S,v.weights[U]=m,v.weights[P]=m}}),this.starts[b]=this.E,this.keepDendrogram?this.dendrogram.push(this.belongings.slice()):this.mapping=this.belongings.slice()}o.prototype.isolate=function(s,u){var c=this.belongings[s];if(this.counts[c]===1)return c;var h=this.unused[--this.U],l=this.loops[s];return this.totalWeights[c]-=u+l,this.totalWeights[h]+=u+l,this.belongings[s]=h,this.counts[c]--,this.counts[h]++,h},o.prototype.move=function(s,u,c){var h=this.belongings[s],l=this.loops[s];this.totalWeights[h]-=u+l,this.totalWeights[c]+=u+l,this.belongings[s]=c;var d=this.counts[h]--===1;this.counts[c]++,d&&(this.unused[this.U++]=h)},o.prototype.computeNodeDegree=function(s){var u,c,h,l=0;for(u=this.starts[s],c=this.starts[s+1];u<c;u++)h=this.weights[u],l+=h;return l},o.prototype.expensiveIsolate=function(s){var u=this.computeNodeDegree(s);return this.isolate(s,u)},o.prototype.expensiveMove=function(s,u){var c=this.computeNodeDegree(s);this.move(s,c,u)},o.prototype.zoomOut=function(){var s=new Array(this.C-this.U),u={},c=this.nodes.length,h=0,l=0,d,f,p,w,m,b,E,v,g;for(d=0,p=this.C;d<p;d++)b=this.belongings[d],b in u||(u[b]=h,s[h]={adj:{},totalWeights:this.totalWeights[b],internalWeights:0},h++),this.belongings[d]=u[b];var A,S;if(this.keepDendrogram){for(A=this.dendrogram[this.level],S=new(r.getPointerArray(h))(c),d=0;d<c;d++)S[d]=this.belongings[A[d]];this.dendrogram.push(S)}else for(d=0;d<c;d++)this.mapping[d]=this.belongings[this.mapping[d]];for(d=0,p=this.C;d<p;d++)for(b=this.belongings[d],v=s[b],g=v.adj,v.internalWeights+=this.loops[d],f=this.starts[d],w=this.starts[d+1];f<w;f++){if(m=this.neighborhood[f],E=this.belongings[m],b===E){v.internalWeights+=this.weights[f];continue}E in g||(g[E]=0),g[E]+=this.weights[f]}for(this.C=h,m=0,b=0;b<h;b++){v=s[b],g=v.adj,b=+b,this.totalWeights[b]=v.totalWeights,this.loops[b]=v.internalWeights,this.counts[b]=1,this.starts[b]=m,this.belongings[b]=b;for(E in g)this.neighborhood[m]=+E,this.weights[m]=g[E],l++,m++}return this.starts[h]=l,this.E=l,this.U=0,this.level++,u},o.prototype.modularity=function(){var s,u,c,h,l,d=0,f=this.M*2,p=new Float64Array(this.C);for(c=0;c<this.C;c++)for(s=this.belongings[c],p[s]+=this.loops[c],h=this.starts[c],l=this.starts[c+1];h<l;h++)u=this.belongings[this.neighborhood[h]],s===u&&(p[s]+=this.weights[h]);for(c=0;c<this.C;c++)d+=p[c]/f-Math.pow(this.totalWeights[c]/f,2)*this.resolution;return d},o.prototype.delta=function(s,u,c,h){var l=this.M,d=this.totalWeights[h];return u+=this.loops[s],c/l-d*u*this.resolution/(2*l*l)},o.prototype.deltaWithOwnCommunity=function(s,u,c,h){var l=this.M,d=this.totalWeights[h];return u+=this.loops[s],c/l-(d-u)*u*this.resolution/(2*l*l)},o.prototype.fastDelta=function(s,u,c,h){var l=this.M,d=this.totalWeights[h];return u+=this.loops[s],c-u*d*this.resolution/(2*l)},o.prototype.fastDeltaWithOwnCommunity=function(s,u,c,h){var l=this.M,d=this.totalWeights[h];return u+=this.loops[s],c-u*(d-u)*this.resolution/(2*l)},o.prototype.bounds=function(s){return[this.starts[s],this.starts[s+1]]},o.prototype.project=function(){var s=this,u={};return s.nodes.slice(0,this.C).forEach(function(c,h){u[c]=Array.from(s.neighborhood.slice(s.starts[h],s.starts[h+1])).map(function(l){return s.nodes[l]})}),u},o.prototype.collect=function(s){arguments.length<1&&(s=this.level);var u={},c=this.keepDendrogram?this.dendrogram[s]:this.mapping,h,l;for(h=0,l=c.length;h<l;h++)u[this.nodes[h]]=c[h];return u},o.prototype.assign=function(s,u){arguments.length<2&&(u=this.level);var c=this.keepDendrogram?this.dendrogram[u]:this.mapping,h,l;for(h=0,l=c.length;h<l;h++)this.graph.setNodeAttribute(this.nodes[h],s,c[h])},o.prototype[t]=function(){var s={};Object.defineProperty(s,"constructor",{value:o,enumerable:!1}),s.C=this.C,s.M=this.M,s.E=this.E,s.U=this.U,s.resolution=this.resolution,s.level=this.level,s.nodes=this.nodes,s.starts=this.starts.slice(0,s.C+1);var u=["neighborhood","weights"],c=["counts","loops","belongings","totalWeights"],h=this;return u.forEach(function(l){s[l]=h[l].slice(0,s.E)}),c.forEach(function(l){s[l]=h[l].slice(0,s.C)}),s.unused=this.unused.slice(0,this.U),this.keepDendrogram?s.dendrogram=this.dendrogram:s.mapping=this.mapping,s};function a(s,u){u=e(u,i);var c=u.resolution,h=n(u.getEdgeWeight).fromEntry,l=(s.size-s.selfLoopCount)*2,d=r.getPointerArray(l),f=r.getPointerArray(s.order+1),p=u.getEdgeWeight?Float64Array:r.getPointerArray(s.size*2);this.C=s.order,this.M=0,this.E=l,this.U=0,this.resolution=c,this.level=0,this.graph=s,this.nodes=new Array(s.order),this.keepDendrogram=u.keepDendrogram,this.neighborhood=new f(l),this.weights=new p(l),this.loops=new p(s.order),this.starts=new d(s.order+1),this.offsets=new d(s.order),this.belongings=new f(s.order),this.dendrogram=[],this.counts=new f(s.order),this.unused=new f(s.order),this.totalInWeights=new p(s.order),this.totalOutWeights=new p(s.order);var w={},m,b=0,E=0,v=this;s.forEachNode(function(g){v.nodes[b]=g,w[g]=b,E+=s.outDegreeWithoutSelfLoops(g),v.starts[b]=E,E+=s.inDegreeWithoutSelfLoops(g),v.offsets[b]=E,v.belongings[b]=b,v.counts[b]=1,b++}),s.forEachEdge(function(g,A,S,D,C,I,k){if(m=h(g,A,S,D,C,I,k),S=w[S],D=w[D],v.M+=m,S===D)v.loops[S]+=m,v.totalInWeights[S]+=m,v.totalOutWeights[S]+=m;else{v.totalOutWeights[S]+=m,v.totalInWeights[D]+=m;var U=--v.starts[S],P=--v.offsets[D];v.neighborhood[U]=D,v.neighborhood[P]=S,v.weights[U]=m,v.weights[P]=m}}),this.starts[b]=this.E,this.keepDendrogram?this.dendrogram.push(this.belongings.slice()):this.mapping=this.belongings.slice()}return a.prototype.bounds=o.prototype.bounds,a.prototype.inBounds=function(s){return[this.offsets[s],this.starts[s+1]]},a.prototype.outBounds=function(s){return[this.starts[s],this.offsets[s]]},a.prototype.project=o.prototype.project,a.prototype.projectIn=function(){var s=this,u={};return s.nodes.slice(0,this.C).forEach(function(c,h){u[c]=Array.from(s.neighborhood.slice(s.offsets[h],s.starts[h+1])).map(function(l){return s.nodes[l]})}),u},a.prototype.projectOut=function(){var s=this,u={};return s.nodes.slice(0,this.C).forEach(function(c,h){u[c]=Array.from(s.neighborhood.slice(s.starts[h],s.offsets[h])).map(function(l){return s.nodes[l]})}),u},a.prototype.isolate=function(s,u,c){var h=this.belongings[s];if(this.counts[h]===1)return h;var l=this.unused[--this.U],d=this.loops[s];return this.totalInWeights[h]-=u+d,this.totalInWeights[l]+=u+d,this.totalOutWeights[h]-=c+d,this.totalOutWeights[l]+=c+d,this.belongings[s]=l,this.counts[h]--,this.counts[l]++,l},a.prototype.move=function(s,u,c,h){var l=this.belongings[s],d=this.loops[s];this.totalInWeights[l]-=u+d,this.totalInWeights[h]+=u+d,this.totalOutWeights[l]-=c+d,this.totalOutWeights[h]+=c+d,this.belongings[s]=h;var f=this.counts[l]--===1;this.counts[h]++,f&&(this.unused[this.U++]=l)},a.prototype.computeNodeInDegree=function(s){var u,c,h,l=0;for(u=this.offsets[s],c=this.starts[s+1];u<c;u++)h=this.weights[u],l+=h;return l},a.prototype.computeNodeOutDegree=function(s){var u,c,h,l=0;for(u=this.starts[s],c=this.offsets[s];u<c;u++)h=this.weights[u],l+=h;return l},a.prototype.expensiveMove=function(s,u){var c=this.computeNodeInDegree(s),h=this.computeNodeOutDegree(s);this.move(s,c,h,u)},a.prototype.zoomOut=function(){var s=new Array(this.C-this.U),u={},c=this.nodes.length,h=0,l=0,d,f,p,w,m,b,E,v,g,A,S,D,C;for(d=0,p=this.C;d<p;d++)b=this.belongings[d],b in u||(u[b]=h,s[h]={inAdj:{},outAdj:{},totalInWeights:this.totalInWeights[b],totalOutWeights:this.totalOutWeights[b],internalWeights:0},h++),this.belongings[d]=u[b];var I,k;if(this.keepDendrogram){for(I=this.dendrogram[this.level],k=new(r.getPointerArray(h))(c),d=0;d<c;d++)k[d]=this.belongings[I[d]];this.dendrogram.push(k)}else for(d=0;d<c;d++)this.mapping[d]=this.belongings[this.mapping[d]];for(d=0,p=this.C;d<p;d++)for(b=this.belongings[d],g=this.offsets[d],v=s[b],D=v.inAdj,C=v.outAdj,v.internalWeights+=this.loops[d],f=this.starts[d],w=this.starts[d+1];f<w;f++){if(m=this.neighborhood[f],E=this.belongings[m],A=f<g,S=A?C:D,b===E){A&&(v.internalWeights+=this.weights[f]);continue}E in S||(S[E]=0),S[E]+=this.weights[f]}for(this.C=h,m=0,b=0;b<h;b++){v=s[b],D=v.inAdj,C=v.outAdj,b=+b,this.totalInWeights[b]=v.totalInWeights,this.totalOutWeights[b]=v.totalOutWeights,this.loops[b]=v.internalWeights,this.counts[b]=1,this.starts[b]=m,this.belongings[b]=b;for(E in C)this.neighborhood[m]=+E,this.weights[m]=C[E],l++,m++;this.offsets[b]=m;for(E in D)this.neighborhood[m]=+E,this.weights[m]=D[E],l++,m++}return this.starts[h]=l,this.E=l,this.U=0,this.level++,u},a.prototype.modularity=function(){var s,u,c,h,l,d=0,f=this.M,p=new Float64Array(this.C);for(c=0;c<this.C;c++)for(s=this.belongings[c],p[s]+=this.loops[c],h=this.starts[c],l=this.offsets[c];h<l;h++)u=this.belongings[this.neighborhood[h]],s===u&&(p[s]+=this.weights[h]);for(c=0;c<this.C;c++)d+=p[c]/f-this.totalInWeights[c]*this.totalOutWeights[c]/Math.pow(f,2)*this.resolution;return d},a.prototype.delta=function(s,u,c,h,l){var d=this.M,f=this.totalInWeights[l],p=this.totalOutWeights[l],w=this.loops[s];return u+=w,c+=w,h/d-(c*f+u*p)*this.resolution/(d*d)},a.prototype.deltaWithOwnCommunity=function(s,u,c,h,l){var d=this.M,f=this.totalInWeights[l],p=this.totalOutWeights[l],w=this.loops[s];return u+=w,c+=w,h/d-(c*(f-u)+u*(p-c))*this.resolution/(d*d)},a.prototype.collect=o.prototype.collect,a.prototype.assign=o.prototype.assign,a.prototype[t]=function(){var s={};Object.defineProperty(s,"constructor",{value:a,enumerable:!1}),s.C=this.C,s.M=this.M,s.E=this.E,s.U=this.U,s.resolution=this.resolution,s.level=this.level,s.nodes=this.nodes,s.starts=this.starts.slice(0,s.C+1);var u=["neighborhood","weights"],c=["counts","offsets","loops","belongings","totalInWeights","totalOutWeights"],h=this;return u.forEach(function(l){s[l]=h[l].slice(0,s.E)}),c.forEach(function(l){s[l]=h[l].slice(0,s.C)}),s.unused=this.unused.slice(0,this.U),this.keepDendrogram?s.dendrogram=this.dendrogram:s.mapping=this.mapping,s},Dt.UndirectedLouvainIndex=o,Dt.DirectedLouvainIndex=a,Dt}var En,si;function Fa(){if(si)return En;si=1;var r=Zr(),e=St(),n=xa(),t=Na(),i=Pa(),o=Oa().createRandomIndex,a=Ga(),s=a.UndirectedLouvainIndex,u=a.DirectedLouvainIndex,c={nodeCommunityAttribute:"community",getEdgeWeight:"weight",fastLocalMoves:!0,randomWalk:!0,resolution:1,rng:Math.random};function h(b,E,v){var g=b.get(E);typeof g>"u"&&(g=0),g+=v,b.set(E,g)}var l=1e-10;function d(b,E,v,g,A){return Math.abs(g-A)<l?b===E?!1:v>b:g>A}function f(b,E,v){var g=new s(E,{getEdgeWeight:v.getEdgeWeight,keepDendrogram:b,resolution:v.resolution}),A=o(v.rng),S=!0,D=!0,C,I,k=new t(Float64Array,g.C),U,P,T,q,Z,L,R,z,j,H,Q,ne,O,ie,oe,ae,he=0,Te=0,fe=[],te,Y;for(v.fastLocalMoves&&(U=new i(g.C));S;){if(H=g.C,S=!1,D=!0,v.fastLocalMoves){for(Y=0,L=v.randomWalk?A(H):0,R=0;R<H;R++,L++)z=L%H,U.enqueue(z);for(;U.size!==0;){for(z=U.dequeue(),Te++,Q=0,k.clear(),C=g.belongings[z],P=g.starts[z],T=g.starts[z+1];P<T;P++)j=g.neighborhood[P],q=g.weights[P],I=g.belongings[j],Q+=q,h(k,I,q);for(ie=g.fastDeltaWithOwnCommunity(z,Q,k.get(C)||0,C),O=C,Z=0;Z<k.size;Z++)I=k.dense[Z],I!==C&&(ne=k.vals[Z],he++,ae=g.fastDelta(z,Q,ne,I),oe=d(O,C,I,ae,ie),oe&&(ie=ae,O=I));if(ie<0){if(O=g.isolate(z,Q),O===C)continue}else{if(O===C)continue;g.move(z,Q,O)}for(S=!0,Y++,P=g.starts[z],T=g.starts[z+1];P<T;P++)j=g.neighborhood[P],I=g.belongings[j],I!==O&&U.enqueue(j)}fe.push(Y)}else for(te=[],fe.push(te);D;){for(D=!1,Y=0,L=v.randomWalk?A(H):0,R=0;R<H;R++,L++){for(z=L%H,Te++,Q=0,k.clear(),C=g.belongings[z],P=g.starts[z],T=g.starts[z+1];P<T;P++)j=g.neighborhood[P],q=g.weights[P],I=g.belongings[j],Q+=q,h(k,I,q);for(ie=g.fastDeltaWithOwnCommunity(z,Q,k.get(C)||0,C),O=C,Z=0;Z<k.size;Z++)I=k.dense[Z],I!==C&&(ne=k.vals[Z],he++,ae=g.fastDelta(z,Q,ne,I),oe=d(O,C,I,ae,ie),oe&&(ie=ae,O=I));if(ie<0){if(O=g.isolate(z,Q),O===C)continue}else{if(O===C)continue;g.move(z,Q,O)}D=!0,Y++}te.push(Y),S=D||S}S&&g.zoomOut()}var ee={index:g,deltaComputations:he,nodesVisited:Te,moves:fe};return ee}function p(b,E,v){var g=new u(E,{getEdgeWeight:v.getEdgeWeight,keepDendrogram:b,resolution:v.resolution}),A=o(v.rng),S=!0,D=!0,C,I,k=new t(Float64Array,g.C),U,P,T,q,Z,L,R,z,j,H,Q,ne,O,ie,oe,ae,he,Te,fe,te=0,Y=0,ee=[],we,B;for(v.fastLocalMoves&&(U=new i(g.C));S;){if(ne=g.C,S=!1,D=!0,v.fastLocalMoves){for(B=0,z=v.randomWalk?A(ne):0,j=0;j<ne;j++,z++)H=z%ne,U.enqueue(H);for(;U.size!==0;){for(H=U.dequeue(),Y++,O=0,ie=0,k.clear(),C=g.belongings[H],P=g.starts[H],T=g.starts[H+1],q=g.offsets[H];P<T;P++)Z=P<q,Q=g.neighborhood[P],L=g.weights[P],I=g.belongings[Q],Z?ie+=L:O+=L,h(k,I,L);for(he=g.deltaWithOwnCommunity(H,O,ie,k.get(C)||0,C),ae=C,R=0;R<k.size;R++)I=k.dense[R],I!==C&&(oe=k.vals[R],te++,fe=g.delta(H,O,ie,oe,I),Te=d(ae,C,I,fe,he),Te&&(he=fe,ae=I));if(he<0){if(ae=g.isolate(H,O,ie),ae===C)continue}else{if(ae===C)continue;g.move(H,O,ie,ae)}for(S=!0,B++,P=g.starts[H],T=g.starts[H+1];P<T;P++)Q=g.neighborhood[P],I=g.belongings[Q],I!==ae&&U.enqueue(Q)}ee.push(B)}else for(we=[],ee.push(we);D;){for(D=!1,B=0,z=v.randomWalk?A(ne):0,j=0;j<ne;j++,z++){for(H=z%ne,Y++,O=0,ie=0,k.clear(),C=g.belongings[H],P=g.starts[H],T=g.starts[H+1],q=g.offsets[H];P<T;P++)Z=P<q,Q=g.neighborhood[P],L=g.weights[P],I=g.belongings[Q],Z?ie+=L:O+=L,h(k,I,L);for(he=g.deltaWithOwnCommunity(H,O,ie,k.get(C)||0,C),ae=C,R=0;R<k.size;R++)I=k.dense[R],I!==C&&(oe=k.vals[R],te++,fe=g.delta(H,O,ie,oe,I),Te=d(ae,C,I,fe,he),Te&&(he=fe,ae=I));if(he<0){if(ae=g.isolate(H,O,ie),ae===C)continue}else{if(ae===C)continue;g.move(H,O,ie,ae)}D=!0,B++}we.push(B),S=D||S}S&&g.zoomOut()}var _={index:g,deltaComputations:te,nodesVisited:Y,moves:ee};return _}function w(b,E,v,g){if(!e(v))throw new Error("graphology-communities-louvain: the given graph is not a valid graphology instance.");var A=n(v);if(A==="mixed")throw new Error("graphology-communities-louvain: cannot run the algorithm on a true mixed graph.");g=r(g,c);var S=0;if(v.size===0){if(b){v.forEachNode(function(P){v.setNodeAttribute(P,g.nodeCommunityAttribute,S++)});return}var D={};return v.forEachNode(function(P){D[P]=S++}),E?{communities:D,count:v.order,deltaComputations:0,dendrogram:null,level:0,modularity:NaN,moves:null,nodesVisited:0,resolution:g.resolution}:D}var C=A==="undirected"?f:p,I=C(E,v,g),k=I.index;if(!E){if(b){k.assign(g.nodeCommunityAttribute);return}return k.collect()}var U={count:k.C,deltaComputations:I.deltaComputations,dendrogram:k.dendrogram,level:k.level,modularity:k.modularity(),moves:I.moves,nodesVisited:I.nodesVisited,resolution:g.resolution};return b?(k.assign(g.nodeCommunityAttribute),U):(U.communities=k.collect(),U)}var m=w.bind(null,!1,!1);return m.assign=w.bind(null,!0,!1),m.detailed=w.bind(null,!1,!0),m.defaults=c,En=m,En}var Ma=Fa();const za=Me(Ma),ai={arabic:"ar",armenian:"am",bulgarian:"bg",czech:"cz",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"},Ua={dutch:/[^A-Za-z0-9_'-]+/gim,english:/[^A-Za-z0-9_'-]+/gim,french:/[^a-z0-9-]+/gim,italian:/[^A-Za-z0-9_'-]+/gim,norwegian:/[^a-z0-9_]+/gim,portuguese:/[^a-z0-9--]/gim,russian:/[^a-z0-9--]+/gim,spanish:/[^a-z0-9A-Z--]+/gim,swedish:/[^a-z0-9_-]+/gim,german:/[^a-z0-9A-Z]+/gim,finnish:/[^a-z0-9]+/gim,danish:/[^a-z0-9]+/gim,hungarian:/[^a-z0-9]+/gim,romanian:/[^a-z0-9]+/gim,serbian:/[^a-z0-9]+/gim,turkish:/[^a-z0-9]+/gim,lithuanian:/[^a-z0-9]+/gim,arabic:/[^a-z0-9-]+/gim,nepali:/[^a-z0-9-]+/gim,irish:/[^a-z0-9]+/gim,indian:/[^a-z0-9-]+/gim,armenian:/[^a-z0-9-]+/gim,greek:/[^a-z0-9--]+/gim,indonesian:/[^a-z0-9]+/gim,ukrainian:/[^a-z0-9--]+/gim,slovenian:/[^a-z0-9]+/gim,bulgarian:/[^a-z0-9--]+/gim,tamil:/[^a-z0-9-]+/gim,sanskrit:/[^a-z0-9A-Z]+/gim,czech:/[^A-Z0-9a-z-]+/gim},Sn=Object.keys(ai);function $a(r){return r!==void 0&&Sn.includes(r)?ai[r]:void 0}const Ba=Date.now().toString().slice(5);let Wa=0;const ui=BigInt(1e3),ci=BigInt(1e6),hi=BigInt(1e9),Tn=65535;function li(r,e){if(e.length<Tn)Array.prototype.push.apply(r,e);else{const n=e.length;for(let t=0;t<n;t+=Tn)Array.prototype.push.apply(r,e.slice(t,t+Tn))}}function Ha(r,...e){return r.replace(/%(?:(?<position>\d+)\$)?(?<width>-?\d*\.?\d*)(?<type>[dfs])/g,function(...n){const t=n[n.length-1],{width:i,type:o,position:a}=t,s=a?e[Number.parseInt(a)-1]:e.shift(),u=i===""?0:Number.parseInt(i);switch(o){case"d":return s.toString().padStart(u,"0");case"f":{let c=s;const[h,l]=i.split(".").map(d=>Number.parseFloat(d));return typeof l=="number"&&l>=0&&(c=c.toFixed(l)),typeof h=="number"&&h>=0?c.toString().padStart(u,"0"):c.toString()}case"s":return u<0?s.toString().padEnd(-u," "):s.toString().padStart(u," ");default:return s}})}function ja(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function Va(){return typeof process<"u"&&process.release&&process.release.name==="node"}function di(){return BigInt(Math.floor(performance.now()*1e6))}function _n(r){return typeof r=="number"&&(r=BigInt(r)),r<ui?`${r}ns`:r<ci?`${r/ui}s`:r<hi?`${r/ci}ms`:`${r/hi}s`}function it(){var r;return ja()?di():Va()||typeof process<"u"&&typeof((r=process==null?void 0:process.hrtime)==null?void 0:r.bigint)=="function"?process.hrtime.bigint():typeof performance<"u"?di():BigInt(0)}function fi(){return`${Ba}-${Wa++}`}function An(r,e){return Object.hasOwn===void 0?Object.prototype.hasOwnProperty.call(r,e)?r[e]:void 0:Object.hasOwn(r,e)?r[e]:void 0}function gi(r,e){return e[1]===r[1]?r[0]-e[0]:e[1]-r[1]}function qa(r){if(r.length===0)return[];if(r.length===1)return r[0];for(let n=1;n<r.length;n++)if(r[n].length<r[0].length){const t=r[0];r[0]=r[n],r[n]=t}const e=new Map;for(const n of r[0])e.set(n,1);for(let n=1;n<r.length;n++){let t=0;for(const i of r[n]){const o=e.get(i);o===n&&(e.set(i,o+1),t++)}if(t===0)return[]}return r[0].filter(n=>{const t=e.get(n);return t!==void 0&&e.set(n,0),t===r.length})}function pi(r,e){const n={},t=e.length;for(let i=0;i<t;i++){const o=e[i],a=o.split(".");let s=r;const u=a.length;for(let c=0;c<u;c++)if(s=s[a[c]],typeof s=="object"){if(s!==null&&"lat"in s&&"lon"in s&&typeof s.lat=="number"&&typeof s.lon=="number"){s=n[o]=s;break}else if(!Array.isArray(s)&&s!==null&&c===u-1){s=void 0;break}}else if((s===null||typeof s!="object")&&c<u-1){s=void 0;break}typeof s<"u"&&(n[o]=s)}return n}function Dn(r,e){return pi(r,[e])[e]}const Ya={cm:.01,m:1,km:1e3,ft:.3048,yd:.9144,mi:1609.344};function mi(r,e){const n=Ya[e];if(n===void 0)throw new Error(K("INVALID_DISTANCE_SUFFIX",r).message);return r*n}function vi(r,e){r.hits=r.hits.map(n=>({...n,document:{...n.document,...e.reduce((t,i)=>{const o=i.split("."),a=o.pop();let s=t;for(const u of o)s[u]=s[u]??{},s=s[u];return s[a]=null,t},n.document)}}))}function Ne(r){var e;return Array.isArray(r)?r.some(n=>Ne(n)):((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="AsyncFunction"}const yi="intersection"in new Set;function bi(...r){if(r.length===0)return new Set;if(r.length===1)return r[0];if(r.length===2){const t=r[0],i=r[1];if(yi)return t.intersection(i);const o=new Set,a=t.size<i.size?t:i,s=a===t?i:t;for(const u of a)s.has(u)&&o.add(u);return o}const e={index:0,size:r[0].size};for(let t=1;t<r.length;t++)r[t].size<e.size&&(e.index=t,e.size=r[t].size);if(yi){let t=r[e.index];for(let i=0;i<r.length;i++)i!==e.index&&(t=t.intersection(r[i]));return t}const n=r[e.index];for(let t=0;t<r.length;t++){if(t===e.index)continue;const i=r[t];for(const o of n)i.has(o)||n.delete(o)}return n}const Ka="union"in new Set;function Rt(r,e){return Ka?r?r.union(e):e:r?new Set([...r,...e]):new Set(e)}function Xa(r,e){const n=new Set;for(const t of r)e.has(t)||n.add(t);return n}const Za={NO_LANGUAGE_WITH_CUSTOM_TOKENIZER:"Do not pass the language option to create when using a custom tokenizer.",LANGUAGE_NOT_SUPPORTED:`Language "%s" is not supported.
Supported languages are:
 - ${Sn.join(`
 - `)}`,INVALID_STEMMER_FUNCTION_TYPE:"config.stemmer property must be a function.",MISSING_STEMMER:'As of version 1.0.0 @orama/orama does not ship non English stemmers by default. To solve this, please explicitly import and specify the "%s" stemmer from the package @orama/stemmers. See https://docs.orama.com/docs/orama-js/text-analysis/stemming for more information.',CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY:"Custom stop words array must only contain strings.",UNSUPPORTED_COMPONENT:'Unsupported component "%s".',COMPONENT_MUST_BE_FUNCTION:'The component "%s" must be a function.',COMPONENT_MUST_BE_FUNCTION_OR_ARRAY_FUNCTIONS:'The component "%s" must be a function or an array of functions.',INVALID_SCHEMA_TYPE:'Unsupported schema type "%s" at "%s". Expected "string", "boolean" or "number" or array of them.',DOCUMENT_ID_MUST_BE_STRING:'Document id must be of type "string". Got "%s" instead.',DOCUMENT_ALREADY_EXISTS:'A document with id "%s" already exists.',DOCUMENT_DOES_NOT_EXIST:'A document with id "%s" does not exists.',MISSING_DOCUMENT_PROPERTY:'Missing searchable property "%s".',INVALID_DOCUMENT_PROPERTY:'Invalid document property "%s": expected "%s", got "%s"',UNKNOWN_INDEX:'Invalid property name "%s". Expected a wildcard string ("*") or array containing one of the following properties: %s',INVALID_BOOST_VALUE:"Boost value must be a number greater than, or less than 0.",INVALID_FILTER_OPERATION:"You can only use one operation per filter, you requested %d.",SCHEMA_VALIDATION_FAILURE:'Cannot insert document due schema validation failure on "%s" property.',INVALID_SORT_SCHEMA_TYPE:'Unsupported sort schema type "%s" at "%s". Expected "string" or "number".',CANNOT_SORT_BY_ARRAY:'Cannot configure sort for "%s" because it is an array (%s).',UNABLE_TO_SORT_ON_UNKNOWN_FIELD:'Unable to sort on unknown field "%s". Allowed fields: %s',SORT_DISABLED:"Sort is disabled. Please read the documentation at https://docs.orama.com/docs/orama-js for more information.",UNKNOWN_GROUP_BY_PROPERTY:'Unknown groupBy property "%s".',INVALID_GROUP_BY_PROPERTY:'Invalid groupBy property "%s". Allowed types: "%s", but given "%s".',UNKNOWN_FILTER_PROPERTY:'Unknown filter property "%s".',UNKNOWN_VECTOR_PROPERTY:'Unknown vector property "%s". Make sure the property exists in the schema and is configured as a vector.',INVALID_VECTOR_SIZE:'Vector size must be a number greater than 0. Got "%s" instead.',INVALID_VECTOR_VALUE:'Vector value must be a number greater than 0. Got "%s" instead.',INVALID_INPUT_VECTOR:`Property "%s" was declared as a %s-dimensional vector, but got a %s-dimensional vector instead.
Input vectors must be of the size declared in the schema, as calculating similarity between vectors of different sizes can lead to unexpected results.`,WRONG_SEARCH_PROPERTY_TYPE:'Property "%s" is not searchable. Only "string" properties are searchable.',FACET_NOT_SUPPORTED:`Facet doens't support the type "%s".`,INVALID_DISTANCE_SUFFIX:'Invalid distance suffix "%s". Valid suffixes are: cm, m, km, mi, yd, ft.',INVALID_SEARCH_MODE:'Invalid search mode "%s". Valid modes are: "fulltext", "vector", "hybrid".',MISSING_VECTOR_AND_SECURE_PROXY:"No vector was provided and no secure proxy was configured. Please provide a vector or configure an Orama Secure Proxy to perform hybrid search.",MISSING_TERM:'"term" is a required parameter when performing hybrid search. Please provide a search term.',INVALID_VECTOR_INPUT:'Invalid "vector" property. Expected an object with "value" and "property" properties, but got "%s" instead.',PLUGIN_CRASHED:"A plugin crashed during initialization. Please check the error message for more information:",PLUGIN_SECURE_PROXY_NOT_FOUND:`Could not find '@orama/secure-proxy-plugin' installed in your Orama instance.
Please install it before proceeding with creating an answer session.
Read more at https://docs.orama.com/docs/orama-js/plugins/plugin-secure-proxy#plugin-secure-proxy
`,PLUGIN_SECURE_PROXY_MISSING_CHAT_MODEL:`Could not find a chat model defined in the secure proxy plugin configuration.
Please provide a chat model before proceeding with creating an answer session.
Read more at https://docs.orama.com/docs/orama-js/plugins/plugin-secure-proxy#plugin-secure-proxy
`,ANSWER_SESSION_LAST_MESSAGE_IS_NOT_ASSISTANT:"The last message in the session is not an assistant message. Cannot regenerate non-assistant messages.",PLUGIN_COMPONENT_CONFLICT:'The component "%s" is already defined. The plugin "%s" is trying to redefine it.'};function K(r,...e){const n=new Error(Ha(Za[r]??`Unsupported Orama Error code: ${r}`,...e));return n.code=r,"captureStackTrace"in Error.prototype&&Error.captureStackTrace(n),n}function Ja(r){return{raw:Number(r),formatted:_n(r)}}function Qa(r){if(r.id){if(typeof r.id!="string")throw K("DOCUMENT_ID_MUST_BE_STRING",typeof r.id);return r.id}return fi()}function wi(r,e){for(const[n,t]of Object.entries(e)){const i=r[n];if(!(typeof i>"u")&&!(t==="geopoint"&&typeof i=="object"&&typeof i.lon=="number"&&typeof i.lat=="number")&&!(t==="enum"&&(typeof i=="string"||typeof i=="number"))){if(t==="enum[]"&&Array.isArray(i)){const o=i.length;for(let a=0;a<o;a++)if(typeof i[a]!="string"&&typeof i[a]!="number")return n+"."+a;continue}if(ot(t)){const o=Si(t);if(!Array.isArray(i)||i.length!==o)throw K("INVALID_INPUT_VECTOR",n,o,i.length);continue}if(Ct(t)){if(!Array.isArray(i))return n;const o=Ei(t),a=i.length;for(let s=0;s<a;s++)if(typeof i[s]!==o)return n+"."+s;continue}if(typeof t=="object"){if(!i||typeof i!="object")return n;const o=wi(i,t);if(o)return n+"."+o;continue}if(typeof i!==t)return n}}}const eu={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},tu={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function nu(r){return r==="geopoint"}function ot(r){return typeof r=="string"&&/^vector\[\d+\]$/.test(r)}function Ct(r){return typeof r=="string"&&eu[r]}function Ei(r){return tu[r]}function Si(r){const e=Number(r.slice(7,-1));switch(!0){case isNaN(e):throw K("INVALID_VECTOR_VALUE",r);case e<=0:throw K("INVALID_VECTOR_SIZE",r);default:return e}}function ru(){return{idToInternalId:new Map,internalIdToId:[],save:iu,load:ou}}function iu(r){return{internalIdToId:r.internalIdToId}}function ou(r,e){const{internalIdToId:n}=e;r.internalDocumentIDStore.idToInternalId.clear(),r.internalDocumentIDStore.internalIdToId=[];const t=n.length;for(let i=0;i<t;i++){const o=n[i];r.internalDocumentIDStore.idToInternalId.set(o,i+1),r.internalDocumentIDStore.internalIdToId.push(o)}}function be(r,e){if(typeof e=="string"){const n=r.idToInternalId.get(e);if(n)return n;const t=r.idToInternalId.size+1;return r.idToInternalId.set(e,t),r.internalIdToId.push(e),t}return e>r.internalIdToId.length?be(r,e.toString()):e}function It(r,e){if(r.internalIdToId.length<e)throw new Error(`Invalid internalId ${e}`);return r.internalIdToId[e-1]}function su(r,e){return{sharedInternalDocumentStore:e,docs:{},count:0}}function au(r,e){const n=be(r.sharedInternalDocumentStore,e);return r.docs[n]}function uu(r,e){const n=e.length,t=Array.from({length:n});for(let i=0;i<n;i++){const o=be(r.sharedInternalDocumentStore,e[i]);t[i]=r.docs[o]}return t}function cu(r){return r.docs}function hu(r,e,n,t){return typeof r.docs[n]<"u"?!1:(r.docs[n]=t,r.count++,!0)}function lu(r,e){const n=be(r.sharedInternalDocumentStore,e);return typeof r.docs[n]>"u"?!1:(delete r.docs[n],r.count--,!0)}function du(r){return r.count}function fu(r,e){const n=e;return{docs:n.docs,count:n.count,sharedInternalDocumentStore:r}}function gu(r){return{docs:r.docs,count:r.count}}function pu(){return{create:su,get:au,getMultiple:uu,getAll:cu,store:hu,remove:lu,count:du,load:fu,save:gu}}const mu=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeUpsert","afterUpsert","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeUpsertMultiple","afterUpsertMultiple","beforeLoad","afterLoad","afterCreate"];function vu(r,e){var i;const n=[],t=(i=r.plugins)==null?void 0:i.length;if(!t)return n;for(let o=0;o<t;o++)try{const a=r.plugins[o];typeof a[e]=="function"&&n.push(a[e])}catch(a){throw console.error("Caught error in getAllPluginsByHook:",a),K("PLUGIN_CRASHED")}return n}const yu=["tokenizer","index","documentsStore","sorter","pinning"],Ti=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];function Lt(r,e,n,t){if(r.some(Ne))return(async()=>{for(const o of r)await o(e,n,t)})();for(const o of r)o(e,n,t)}function Rn(r,e,n,t,i){if(r.some(Ne))return(async()=>{for(const a of r)await a(e,n,t,i)})();for(const a of r)a(e,n,t,i)}function Cn(r,e,n,t){if(r.some(Ne))return(async()=>{for(const o of r)await o(e,n,t)})();for(const o of r)o(e,n,t)}function bu(r,e){if(r.some(Ne))return(async()=>{for(const t of r)await t(e)})();for(const t of r)t(e)}class Ee{constructor(e,n){ue(this,"k");ue(this,"v");ue(this,"l",null);ue(this,"r",null);ue(this,"h",1);this.k=e,this.v=new Set(n)}updateHeight(){this.h=Math.max(Ee.getHeight(this.l),Ee.getHeight(this.r))+1}static getHeight(e){return e?e.h:0}getBalanceFactor(){return Ee.getHeight(this.l)-Ee.getHeight(this.r)}rotateLeft(){const e=this.r;return this.r=e.l,e.l=this,this.updateHeight(),e.updateHeight(),e}rotateRight(){const e=this.l;return this.l=e.r,e.r=this,this.updateHeight(),e.updateHeight(),e}toJSON(){return{k:this.k,v:Array.from(this.v),l:this.l?this.l.toJSON():null,r:this.r?this.r.toJSON():null,h:this.h}}static fromJSON(e){const n=new Ee(e.k,e.v);return n.l=e.l?Ee.fromJSON(e.l):null,n.r=e.r?Ee.fromJSON(e.r):null,n.h=e.h,n}}class kt{constructor(e,n){ue(this,"root",null);ue(this,"insertCount",0);e!==void 0&&n!==void 0&&(this.root=new Ee(e,n))}insert(e,n,t=1e3){this.root=this.insertNode(this.root,e,n,t)}insertMultiple(e,n,t=1e3){for(const i of n)this.insert(e,i,t)}rebalance(){this.root&&(this.root=this.rebalanceNode(this.root))}toJSON(){return{root:this.root?this.root.toJSON():null,insertCount:this.insertCount}}static fromJSON(e){const n=new kt;return n.root=e.root?Ee.fromJSON(e.root):null,n.insertCount=e.insertCount||0,n}insertNode(e,n,t,i){if(e===null)return new Ee(n,[t]);const o=[];let a=e,s=null;for(;a!==null;)if(o.push({parent:s,node:a}),n<a.k)if(a.l===null){a.l=new Ee(n,[t]),o.push({parent:a,node:a.l});break}else s=a,a=a.l;else if(n>a.k)if(a.r===null){a.r=new Ee(n,[t]),o.push({parent:a,node:a.r});break}else s=a,a=a.r;else return a.v.add(t),e;let u=!1;this.insertCount++%i===0&&(u=!0);for(let c=o.length-1;c>=0;c--){const{parent:h,node:l}=o[c];if(l.updateHeight(),u){const d=this.rebalanceNode(l);h?h.l===l?h.l=d:h.r===l&&(h.r=d):e=d}}return e}rebalanceNode(e){const n=e.getBalanceFactor();if(n>1){if(e.l&&e.l.getBalanceFactor()>=0)return e.rotateRight();if(e.l)return e.l=e.l.rotateLeft(),e.rotateRight()}if(n<-1){if(e.r&&e.r.getBalanceFactor()<=0)return e.rotateLeft();if(e.r)return e.r=e.r.rotateRight(),e.rotateLeft()}return e}find(e){const n=this.findNodeByKey(e);return n?n.v:null}contains(e){return this.find(e)!==null}getSize(){let e=0;const n=[];let t=this.root;for(;t||n.length>0;){for(;t;)n.push(t),t=t.l;t=n.pop(),e++,t=t.r}return e}isBalanced(){if(!this.root)return!0;const e=[this.root];for(;e.length>0;){const n=e.pop(),t=n.getBalanceFactor();if(Math.abs(t)>1)return!1;n.l&&e.push(n.l),n.r&&e.push(n.r)}return!0}remove(e){this.root=this.removeNode(this.root,e)}removeDocument(e,n){const t=this.findNodeByKey(e);t&&(t.v.size===1?this.root=this.removeNode(this.root,e):t.v=new Set([...t.v.values()].filter(i=>i!==n)))}findNodeByKey(e){let n=this.root;for(;n;)if(e<n.k)n=n.l;else if(e>n.k)n=n.r;else return n;return null}removeNode(e,n){if(e===null)return null;const t=[];let i=e;for(;i!==null&&i.k!==n;)t.push(i),n<i.k?i=i.l:i=i.r;if(i===null)return e;if(i.l===null||i.r===null){const o=i.l?i.l:i.r;if(t.length===0)e=o;else{const a=t[t.length-1];a.l===i?a.l=o:a.r=o}}else{let o=i,a=i.r;for(;a.l!==null;)o=a,a=a.l;i.k=a.k,i.v=a.v,o.l===a?o.l=a.r:o.r=a.r,i=o}t.push(i);for(let o=t.length-1;o>=0;o--){const a=t[o];a.updateHeight();const s=this.rebalanceNode(a);if(o>0){const u=t[o-1];u.l===a?u.l=s:u.r===a&&(u.r=s)}else e=s}return e}rangeSearch(e,n){const t=new Set,i=[];let o=this.root;for(;o||i.length>0;){for(;o;)i.push(o),o=o.l;if(o=i.pop(),o.k>=e&&o.k<=n)for(const a of o.v)t.add(a);if(o.k>n)break;o=o.r}return t}greaterThan(e,n=!1){const t=new Set,i=[];let o=this.root;for(;o||i.length>0;){for(;o;)i.push(o),o=o.r;if(o=i.pop(),n&&o.k>=e||!n&&o.k>e)for(const a of o.v)t.add(a);else if(o.k<=e)break;o=o.l}return t}lessThan(e,n=!1){const t=new Set,i=[];let o=this.root;for(;o||i.length>0;){for(;o;)i.push(o),o=o.l;if(o=i.pop(),n&&o.k<=e||!n&&o.k<e)for(const a of o.v)t.add(a);else if(o.k>e)break;o=o.r}return t}}class xt{constructor(){ue(this,"numberToDocumentId");this.numberToDocumentId=new Map}insert(e,n){this.numberToDocumentId.has(e)?this.numberToDocumentId.get(e).add(n):this.numberToDocumentId.set(e,new Set([n]))}find(e){const n=this.numberToDocumentId.get(e);return n?Array.from(n):null}remove(e){this.numberToDocumentId.delete(e)}removeDocument(e,n){const t=this.numberToDocumentId.get(n);t&&(t.delete(e),t.size===0&&this.numberToDocumentId.delete(n))}contains(e){return this.numberToDocumentId.has(e)}getSize(){let e=0;for(const n of this.numberToDocumentId.values())e+=n.size;return e}filter(e){const n=Object.keys(e);if(n.length!==1)throw new Error("Invalid operation");const t=n[0];switch(t){case"eq":{const i=e[t],o=this.numberToDocumentId.get(i);return o?Array.from(o):[]}case"in":{const i=e[t],o=new Set;for(const a of i){const s=this.numberToDocumentId.get(a);if(s)for(const u of s)o.add(u)}return Array.from(o)}case"nin":{const i=new Set(e[t]),o=new Set;for(const[a,s]of this.numberToDocumentId.entries())if(!i.has(a))for(const u of s)o.add(u);return Array.from(o)}default:throw new Error("Invalid operation")}}filterArr(e){const n=Object.keys(e);if(n.length!==1)throw new Error("Invalid operation");const t=n[0];switch(t){case"containsAll":{const o=e[t].map(s=>this.numberToDocumentId.get(s)??new Set);if(o.length===0)return[];const a=o.reduce((s,u)=>new Set([...s].filter(c=>u.has(c))));return Array.from(a)}case"containsAny":{const o=e[t].map(s=>this.numberToDocumentId.get(s)??new Set);if(o.length===0)return[];const a=o.reduce((s,u)=>new Set([...s,...u]));return Array.from(a)}default:throw new Error("Invalid operation")}}static fromJSON(e){if(!e.numberToDocumentId)throw new Error("Invalid Flat Tree JSON");const n=new xt;for(const[t,i]of e.numberToDocumentId)n.numberToDocumentId.set(t,new Set(i));return n}toJSON(){return{numberToDocumentId:Array.from(this.numberToDocumentId.entries()).map(([e,n])=>[e,Array.from(n)])}}}function wu(r,e,n){if(n<0)return-1;if(r===e)return 0;const t=r.length,i=e.length;if(t===0)return i<=n?i:-1;if(i===0)return t<=n?t:-1;const o=Math.abs(t-i);if(r.startsWith(e))return o<=n?o:-1;if(e.startsWith(r))return 0;if(o>n)return-1;const a=[];for(let s=0;s<=t;s++){a[s]=[s];for(let u=1;u<=i;u++)a[s][u]=s===0?u:0}for(let s=1;s<=t;s++){let u=1/0;for(let c=1;c<=i;c++)r[s-1]===e[c-1]?a[s][c]=a[s-1][c-1]:a[s][c]=Math.min(a[s-1][c]+1,a[s][c-1]+1,a[s-1][c-1]+1),u=Math.min(u,a[s][c]);if(u>n)return-1}return a[t][i]<=n?a[t][i]:-1}function _i(r,e,n){const t=wu(r,e,n);return{distance:t,isBounded:t>=0}}class je{constructor(e,n,t){ue(this,"k");ue(this,"s");ue(this,"c",new Map);ue(this,"d",new Set);ue(this,"e");ue(this,"w","");this.k=e,this.s=n,this.e=t}updateParent(e){this.w=e.w+this.s}addDocument(e){this.d.add(e)}removeDocument(e){return this.d.delete(e)}findAllWords(e,n,t,i){const o=[this];for(;o.length>0;){const a=o.pop();if(a.e){const{w:s,d:u}=a;if(t&&s!==n)continue;if(An(e,s)!==null)if(i)if(Math.abs(n.length-s.length)<=i&&_i(n,s,i).isBounded)e[s]=[];else continue;else e[s]=[];if(An(e,s)!=null&&u.size>0){const c=e[s];for(const h of u)c.includes(h)||c.push(h)}}a.c.size>0&&o.push(...a.c.values())}return e}insert(e,n){let t=this,i=0;const o=e.length;for(;i<o;){const a=e[i],s=t.c.get(a);if(s){const u=s.s,c=u.length;let h=0;for(;h<c&&i+h<o&&u[h]===e[i+h];)h++;if(h===c){if(t=s,i+=h,i===o){s.e||(s.e=!0),s.addDocument(n);return}continue}const l=u.slice(0,h),d=u.slice(h),f=e.slice(i+h),p=new je(l[0],l,!1);if(t.c.set(l[0],p),p.updateParent(t),s.s=d,s.k=d[0],p.c.set(d[0],s),s.updateParent(p),f){const w=new je(f[0],f,!0);w.addDocument(n),p.c.set(f[0],w),w.updateParent(p)}else p.e=!0,p.addDocument(n);return}else{const u=new je(a,e.slice(i),!0);u.addDocument(n),t.c.set(a,u),u.updateParent(t);return}}t.e||(t.e=!0),t.addDocument(n)}_findLevenshtein(e,n,t,i,o){const a=[{node:this,index:n,tolerance:t}];for(;a.length>0;){const{node:s,index:u,tolerance:c}=a.pop();if(s.w.startsWith(e)){s.findAllWords(o,e,!1,0);continue}if(c<0)continue;if(s.e){const{w:l,d}=s;if(l&&(_i(e,l,i).isBounded&&(o[l]=[]),An(o,l)!==void 0&&d.size>0)){const f=new Set(o[l]);for(const p of d)f.add(p);o[l]=Array.from(f)}}if(u>=e.length)continue;const h=e[u];if(s.c.has(h)){const l=s.c.get(h);a.push({node:l,index:u+1,tolerance:c})}a.push({node:s,index:u+1,tolerance:c-1});for(const[l,d]of s.c)a.push({node:d,index:u,tolerance:c-1}),l!==h&&a.push({node:d,index:u+1,tolerance:c-1})}}find(e){const{term:n,exact:t,tolerance:i}=e;if(i&&!t){const o={};return this._findLevenshtein(n,0,i,i,o),o}else{let o=this,a=0;const s=n.length;for(;a<s;){const c=n[a],h=o.c.get(c);if(h){const l=h.s,d=l.length;let f=0;for(;f<d&&a+f<s&&l[f]===n[a+f];)f++;if(f===d)o=h,a+=f;else if(a+f===s)if(f===s-a){if(t)return{};{const p={};return h.findAllWords(p,n,t,i),p}}else return{};else return{}}else return{}}const u={};return o.findAllWords(u,n,t,i),u}}contains(e){let n=this,t=0;const i=e.length;for(;t<i;){const o=e[t],a=n.c.get(o);if(a){const s=a.s,u=s.length;let c=0;for(;c<u&&t+c<i&&s[c]===e[t+c];)c++;if(c<u)return!1;t+=u,n=a}else return!1}return!0}removeWord(e){if(!e)return!1;let n=this;const t=e.length,i=[];for(let o=0;o<t;o++){const a=e[o];if(n.c.has(a)){const s=n.c.get(a);i.push({parent:n,character:a}),o+=s.s.length-1,n=s}else return!1}for(n.d.clear(),n.e=!1;i.length>0&&n.c.size===0&&!n.e&&n.d.size===0;){const{parent:o,character:a}=i.pop();o.c.delete(a),n=o}return!0}removeDocumentByWord(e,n,t=!0){if(!e)return!0;let i=this;const o=e.length;for(let a=0;a<o;a++){const s=e[a];if(i.c.has(s)){const u=i.c.get(s);a+=u.s.length-1,i=u,t&&i.w!==e||i.removeDocument(n)}else return!1}return!0}static getCommonPrefix(e,n){const t=Math.min(e.length,n.length);let i=0;for(;i<t&&e.charCodeAt(i)===n.charCodeAt(i);)i++;return e.slice(0,i)}toJSON(){var e,n;return{w:this.w,s:this.s,e:this.e,k:this.k,d:Array.from(this.d),c:(n=Array.from((e=this.c)==null?void 0:e.entries()))==null?void 0:n.map(([t,i])=>[t,i.toJSON()])}}static fromJSON(e){var t;const n=new je(e.k,e.s,e.e);return n.w=e.w,n.d=new Set(e.d),n.c=new Map(((t=e==null?void 0:e.c)==null?void 0:t.map(([i,o])=>[i,je.fromJSON(o)]))||[]),n}}class Nt extends je{constructor(){super("","",!1)}static fromJSON(e){var t;const n=new Nt;return n.w=e.w,n.s=e.s,n.e=e.e,n.k=e.k,n.d=new Set(e.d),n.c=new Map(((t=e==null?void 0:e.c)==null?void 0:t.map(([i,o])=>[i,je.fromJSON(o)]))||[]),n}toJSON(){return super.toJSON()}}const Eu=2,Su=6371e3;class st{constructor(e,n){ue(this,"point");ue(this,"docIDs");ue(this,"left");ue(this,"right");ue(this,"parent");this.point=e,this.docIDs=new Set(n),this.left=null,this.right=null,this.parent=null}toJSON(){return{point:this.point,docIDs:Array.from(this.docIDs),left:this.left?this.left.toJSON():null,right:this.right?this.right.toJSON():null}}static fromJSON(e,n=null){const t=new st(e.point,e.docIDs);return t.parent=n,e.left&&(t.left=st.fromJSON(e.left,t)),e.right&&(t.right=st.fromJSON(e.right,t)),t}}class Se{constructor(){ue(this,"root");ue(this,"nodeMap");this.root=null,this.nodeMap=new Map}getPointKey(e){return`${e.lon},${e.lat}`}insert(e,n){const t=this.getPointKey(e),i=this.nodeMap.get(t);if(i){n.forEach(u=>i.docIDs.add(u));return}const o=new st(e,n);if(this.nodeMap.set(t,o),this.root==null){this.root=o;return}let a=this.root,s=0;for(;;){if(s%Eu===0)if(e.lon<a.point.lon){if(a.left==null){a.left=o,o.parent=a;return}a=a.left}else{if(a.right==null){a.right=o,o.parent=a;return}a=a.right}else if(e.lat<a.point.lat){if(a.left==null){a.left=o,o.parent=a;return}a=a.left}else{if(a.right==null){a.right=o,o.parent=a;return}a=a.right}s++}}contains(e){const n=this.getPointKey(e);return this.nodeMap.has(n)}getDocIDsByCoordinates(e){const n=this.getPointKey(e),t=this.nodeMap.get(n);return t?Array.from(t.docIDs):null}removeDocByID(e,n){const t=this.getPointKey(e),i=this.nodeMap.get(t);i&&(i.docIDs.delete(n),i.docIDs.size===0&&(this.nodeMap.delete(t),this.deleteNode(i)))}deleteNode(e){const n=e.parent,t=e.left?e.left:e.right;t&&(t.parent=n),n?n.left===e?n.left=t:n.right===e&&(n.right=t):(this.root=t,this.root&&(this.root.parent=null))}searchByRadius(e,n,t=!0,i="asc",o=!1){const a=o?Se.vincentyDistance:Se.haversineDistance,s=[{node:this.root,depth:0}],u=[];for(;s.length>0;){const{node:c,depth:h}=s.pop();if(c==null)continue;const l=a(e,c.point);(t?l<=n:l>n)&&u.push({point:c.point,docIDs:Array.from(c.docIDs)}),c.left!=null&&s.push({node:c.left,depth:h+1}),c.right!=null&&s.push({node:c.right,depth:h+1})}return i&&u.sort((c,h)=>{const l=a(e,c.point),d=a(e,h.point);return i.toLowerCase()==="asc"?l-d:d-l}),u}searchByPolygon(e,n=!0,t=null,i=!1){const o=[{node:this.root,depth:0}],a=[];for(;o.length>0;){const{node:u,depth:c}=o.pop();if(u==null)continue;u.left!=null&&o.push({node:u.left,depth:c+1}),u.right!=null&&o.push({node:u.right,depth:c+1});const h=Se.isPointInPolygon(e,u.point);(h&&n||!h&&!n)&&a.push({point:u.point,docIDs:Array.from(u.docIDs)})}const s=Se.calculatePolygonCentroid(e);if(t){const u=i?Se.vincentyDistance:Se.haversineDistance;a.sort((c,h)=>{const l=u(s,c.point),d=u(s,h.point);return t.toLowerCase()==="asc"?l-d:d-l})}return a}toJSON(){return{root:this.root?this.root.toJSON():null}}static fromJSON(e){const n=new Se;return e.root&&(n.root=st.fromJSON(e.root),n.buildNodeMap(n.root)),n}buildNodeMap(e){if(e==null)return;const n=this.getPointKey(e.point);this.nodeMap.set(n,e),e.left&&this.buildNodeMap(e.left),e.right&&this.buildNodeMap(e.right)}static calculatePolygonCentroid(e){let n=0,t=0,i=0;const o=e.length;for(let s=0,u=o-1;s<o;u=s++){const c=e[s].lon,h=e[s].lat,l=e[u].lon,d=e[u].lat,f=c*d-l*h;n+=f,t+=(c+l)*f,i+=(h+d)*f}n/=2;const a=6*n;return t/=a,i/=a,{lon:t,lat:i}}static isPointInPolygon(e,n){let t=!1;const i=n.lon,o=n.lat,a=e.length;for(let s=0,u=a-1;s<a;u=s++){const c=e[s].lon,h=e[s].lat,l=e[u].lon,d=e[u].lat;h>o!=d>o&&i<(l-c)*(o-h)/(d-h)+c&&(t=!t)}return t}static haversineDistance(e,n){const t=Math.PI/180,i=e.lat*t,o=n.lat*t,a=(n.lat-e.lat)*t,s=(n.lon-e.lon)*t,u=Math.sin(a/2)*Math.sin(a/2)+Math.cos(i)*Math.cos(o)*Math.sin(s/2)*Math.sin(s/2),c=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return Su*c}static vincentyDistance(e,n){const i=.0033528106647474805,o=(1-i)*6378137,a=Math.PI/180,s=e.lat*a,u=n.lat*a,c=(n.lon-e.lon)*a,h=Math.atan((1-i)*Math.tan(s)),l=Math.atan((1-i)*Math.tan(u)),d=Math.sin(h),f=Math.cos(h),p=Math.sin(l),w=Math.cos(l);let m=c,b,E=1e3,v,g,A,S,D,C;do{const q=Math.sin(m),Z=Math.cos(m);if(v=Math.sqrt(w*q*(w*q)+(f*p-d*w*Z)*(f*p-d*w*Z)),v===0)return 0;g=d*p+f*w*Z,A=Math.atan2(v,g),S=f*w*q/v,D=1-S*S,C=g-2*d*p/D,isNaN(C)&&(C=0);const L=i/16*D*(4+i*(4-3*D));b=m,m=c+(1-L)*i*S*(A+L*v*(C+L*g*(-1+2*C*C)))}while(Math.abs(m-b)>1e-12&&--E>0);if(E===0)return NaN;const I=D*(6378137*6378137-o*o)/(o*o),k=1+I/16384*(4096+I*(-768+I*(320-175*I))),U=I/1024*(256+I*(-128+I*(74-47*I))),P=U*v*(C+U/4*(g*(-1+2*C*C)-U/6*C*(-3+4*v*v)*(-3+4*C*C)));return o*k*(A-P)}}class Pt{constructor(){ue(this,"true");ue(this,"false");this.true=new Set,this.false=new Set}insert(e,n){n?this.true.add(e):this.false.add(e)}delete(e,n){n?this.true.delete(e):this.false.delete(e)}getSize(){return this.true.size+this.false.size}toJSON(){return{true:Array.from(this.true),false:Array.from(this.false)}}static fromJSON(e){const n=new Pt;return n.true=new Set(e.true),n.false=new Set(e.false),n}}function Tu(r,e,n,t,i,{k:o,b:a,d:s}){return Math.log(1+(n-e+.5)/(e+.5))*(s+r*(o+1))/(r+o*(1-a+a*t/i))}const _u=.8;class Ot{constructor(e){ue(this,"size");ue(this,"vectors",new Map);this.size=e}add(e,n){n instanceof Float32Array||(n=new Float32Array(n));const t=Ai(n,this.size);this.vectors.set(e,[t,n])}remove(e){this.vectors.delete(e)}find(e,n,t){return e instanceof Float32Array||(e=new Float32Array(e)),Au(e,t,this.vectors,this.size,n)}toJSON(){const e=[];for(const[n,[t,i]]of this.vectors)e.push([n,[t,Array.from(i)]]);return{size:this.size,vectors:e}}static fromJSON(e){const n=e,t=new Ot(n.size);for(const[i,[o,a]]of n.vectors)t.vectors.set(i,[o,new Float32Array(a)]);return t}}function Ai(r,e){let n=0;for(let t=0;t<e;t++)n+=r[t]*r[t];return Math.sqrt(n)}function Au(r,e,n,t,i){const o=Ai(r,t),a=[],s=e||n.keys();for(const u of s){const c=n.get(u);if(!c)continue;const h=c[0],l=c[1];let d=0;for(let p=0;p<t;p++)d+=r[p]*l[p];const f=d/(o*h);f>=i&&a.push([u,f])}return a}function Du(r,e,n,t,i){const o=be(r.sharedInternalDocumentStore,n);r.avgFieldLength[e]=((r.avgFieldLength[e]??0)*(i-1)+t.length)/i,r.fieldLengths[e][o]=t.length,r.frequencies[e][o]={}}function Ru(r,e,n,t,i){let o=0;for(const u of t)u===i&&o++;const a=be(r.sharedInternalDocumentStore,n),s=o/t.length;r.frequencies[e][a][i]=s,i in r.tokenOccurrences[e]||(r.tokenOccurrences[e][i]=0),r.tokenOccurrences[e][i]=(r.tokenOccurrences[e][i]??0)+1}function Cu(r,e,n,t){const i=be(r.sharedInternalDocumentStore,n);t>1?r.avgFieldLength[e]=(r.avgFieldLength[e]*t-r.fieldLengths[e][i])/(t-1):r.avgFieldLength[e]=void 0,r.fieldLengths[e][i]=void 0,r.frequencies[e][i]=void 0}function Iu(r,e,n){r.tokenOccurrences[e][n]--}function Di(r,e,n,t,i=""){t||(t={sharedInternalDocumentStore:e,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}});for(const[o,a]of Object.entries(n)){const s=`${i}${i?".":""}${o}`;if(typeof a=="object"&&!Array.isArray(a)){Di(r,e,a,t,s);continue}if(ot(a))t.searchableProperties.push(s),t.searchablePropertiesWithTypes[s]=a,t.vectorIndexes[s]={type:"Vector",node:new Ot(Si(a)),isArray:!1};else{const u=/\[/.test(a);switch(a){case"boolean":case"boolean[]":t.indexes[s]={type:"Bool",node:new Pt,isArray:u};break;case"number":case"number[]":t.indexes[s]={type:"AVL",node:new kt(0,[]),isArray:u};break;case"string":case"string[]":t.indexes[s]={type:"Radix",node:new Nt,isArray:u},t.avgFieldLength[s]=0,t.frequencies[s]={},t.tokenOccurrences[s]={},t.fieldLengths[s]={};break;case"enum":case"enum[]":t.indexes[s]={type:"Flat",node:new xt,isArray:u};break;case"geopoint":t.indexes[s]={type:"BKD",node:new Se,isArray:u};break;default:throw K("INVALID_SCHEMA_TYPE",Array.isArray(a)?"array":a,s)}t.searchableProperties.push(s),t.searchablePropertiesWithTypes[s]=a}}return t}function Lu(r,e,n,t,i,o,a,s){return u=>{const{type:c,node:h}=e.indexes[n];switch(c){case"Bool":{h[u?"true":"false"].add(t);break}case"AVL":{const l=(s==null?void 0:s.avlRebalanceThreshold)??1;h.insert(u,t,l);break}case"Radix":{const l=o.tokenize(u,i,n,!1);r.insertDocumentScoreParameters(e,n,t,l,a);for(const d of l)r.insertTokenScoreParameters(e,n,t,l,d),h.insert(d,t);break}case"Flat":{h.insert(u,t);break}case"BKD":{h.insert(u,[t]);break}}}}function ku(r,e,n,t,i,o,a,s,u,c,h){if(ot(a))return xu(e,n,o,t,i);const l=Lu(r,e,n,i,s,u,c,h);if(!Ct(a))return l(o);const d=o,f=d.length;for(let p=0;p<f;p++)l(d[p])}function xu(r,e,n,t,i){r.vectorIndexes[e].node.add(i,n)}function Ri(r,e,n,t,i,o,a,s,u,c){if(ot(a))return e.vectorIndexes[n].node.remove(i),!0;const{type:h,node:l}=e.indexes[n];switch(h){case"AVL":return l.removeDocument(o,i),!0;case"Bool":return l[o?"true":"false"].delete(i),!0;case"Radix":{const d=u.tokenize(o,s,n);r.removeDocumentScoreParameters(e,n,t,c);for(const f of d)r.removeTokenScoreParameters(e,n,f),l.removeDocumentByWord(f,i);return!0}case"Flat":return l.removeDocument(i,o),!0;case"BKD":return l.removeDocByID(o,i),!1}}function Nu(r,e,n,t,i,o,a,s,u,c){if(!Ct(a))return Ri(r,e,n,t,i,o,a,s,u,c);const h=Ei(a),l=o,d=l.length;for(let f=0;f<d;f++)Ri(r,e,n,t,i,l[f],h,s,u,c);return!0}function Ci(r,e,n,t,i,o,a,s,u,c){var b;const h=Array.from(t),l=r.avgFieldLength[e],d=r.fieldLengths[e],f=r.tokenOccurrences[e],p=r.frequencies[e],w=typeof f[n]=="number"?f[n]??0:0,m=h.length;for(let E=0;E<m;E++){const v=h[E];if(u&&!u.has(v))continue;c.has(v)||c.set(v,new Map);const g=c.get(v);g.set(e,(g.get(e)||0)+1);const A=((b=p==null?void 0:p[v])==null?void 0:b[n])??0,S=Tu(A,w,i,d[v],l,o);a.has(v)?a.set(v,a.get(v)+S*s):a.set(v,S*s)}}function Pu(r,e,n,t,i,o,a,s,u,c,h,l=0){const d=n.tokenize(e,t),f=d.length||1,p=new Map,w=new Map,m=new Map;for(const v of i){if(!(v in r.indexes))continue;const g=r.indexes[v],{type:A}=g;if(A!=="Radix")throw K("WRONG_SEARCH_PROPERTY_TYPE",v);const S=s[v]??1;if(S<=0)throw K("INVALID_BOOST_VALUE",S);d.length===0&&!e&&d.push("");const D=d.length;for(let C=0;C<D;C++){const I=d[C],k=g.node.find({term:I,exact:o,tolerance:a}),U=Object.keys(k);U.length>0&&w.set(I,!0);const P=U.length;for(let T=0;T<P;T++){const q=U[T],Z=k[q];Ci(r,v,q,Z,c,u,m,S,h,p)}}}const b=Array.from(m.entries()).map(([v,g])=>[v,g]).sort((v,g)=>g[1]-v[1]);if(b.length===0)return[];if(l===1)return b;if(l===0){if(f===1)return b;for(const g of d)if(!w.get(g))return[];return b.filter(([g])=>{const A=p.get(g);return A?Array.from(A.values()).some(S=>S===f):!1})}const E=b.filter(([v])=>{const g=p.get(v);return g?Array.from(g.values()).some(A=>A===f):!1});if(E.length>0){const v=b.filter(([A])=>!E.some(([S])=>S===A)),g=Math.ceil(v.length*l);return[...E,...v.slice(0,g)]}return b}function Gt(r,e,n,t){if("and"in n&&n.and&&Array.isArray(n.and)){const a=n.and;if(a.length===0)return new Set;const s=a.map(u=>Gt(r,e,u,t));return bi(...s)}if("or"in n&&n.or&&Array.isArray(n.or)){const a=n.or;return a.length===0?new Set:a.map(u=>Gt(r,e,u,t)).reduce((u,c)=>Rt(u,c),new Set)}if("not"in n&&n.not){const a=n.not,s=new Set,u=r.sharedInternalDocumentStore;for(let h=1;h<=u.internalIdToId.length;h++)s.add(h);const c=Gt(r,e,a,t);return Xa(s,c)}const i=Object.keys(n),o=i.reduce((a,s)=>({[s]:new Set,...a}),{});for(const a of i){const s=n[a];if(typeof r.indexes[a]>"u")throw K("UNKNOWN_FILTER_PROPERTY",a);const{node:u,type:c,isArray:h}=r.indexes[a];if(c==="Bool"){const d=u,f=s?d.true:d.false;o[a]=Rt(o[a],f);continue}if(c==="BKD"){let d;if("radius"in s)d="radius";else if("polygon"in s)d="polygon";else throw new Error(`Invalid operation ${s}`);if(d==="radius"){const{value:f,coordinates:p,unit:w="m",inside:m=!0,highPrecision:b=!1}=s[d],E=mi(f,w),v=u.searchByRadius(p,E,m,void 0,b);o[a]=Ii(o[a],v)}else{const{coordinates:f,inside:p=!0,highPrecision:w=!1}=s[d],m=u.searchByPolygon(f,p,void 0,w);o[a]=Ii(o[a],m)}continue}if(c==="Radix"&&(typeof s=="string"||Array.isArray(s))){for(const d of[s].flat()){const f=e.tokenize(d,t,a);for(const p of f){const w=u.find({term:p,exact:!0});o[a]=Bu(o[a],w)}}continue}const l=Object.keys(s);if(l.length>1)throw K("INVALID_FILTER_OPERATION",l.length);if(c==="Flat"){const d=new Set(h?u.filterArr(s):u.filter(s));o[a]=Rt(o[a],d);continue}if(c==="AVL"){const d=l[0],f=s[d];let p;switch(d){case"gt":{p=u.greaterThan(f,!1);break}case"gte":{p=u.greaterThan(f,!0);break}case"lt":{p=u.lessThan(f,!1);break}case"lte":{p=u.lessThan(f,!0);break}case"eq":{p=u.find(f)??new Set;break}case"between":{const[w,m]=f;p=u.rangeSearch(w,m);break}default:throw K("INVALID_FILTER_OPERATION",d)}o[a]=Rt(o[a],p)}}return bi(...Object.values(o))}function Ou(r){return r.searchableProperties}function Gu(r){return r.searchablePropertiesWithTypes}function Fu(r,e){const{indexes:n,vectorIndexes:t,searchableProperties:i,searchablePropertiesWithTypes:o,frequencies:a,tokenOccurrences:s,avgFieldLength:u,fieldLengths:c}=e,h={},l={};for(const d of Object.keys(n)){const{node:f,type:p,isArray:w}=n[d];switch(p){case"Radix":h[d]={type:"Radix",node:Nt.fromJSON(f),isArray:w};break;case"Flat":h[d]={type:"Flat",node:xt.fromJSON(f),isArray:w};break;case"AVL":h[d]={type:"AVL",node:kt.fromJSON(f),isArray:w};break;case"BKD":h[d]={type:"BKD",node:Se.fromJSON(f),isArray:w};break;case"Bool":h[d]={type:"Bool",node:Pt.fromJSON(f),isArray:w};break;default:h[d]=n[d]}}for(const d of Object.keys(t))l[d]={type:"Vector",isArray:!1,node:Ot.fromJSON(t[d])};return{sharedInternalDocumentStore:r,indexes:h,vectorIndexes:l,searchableProperties:i,searchablePropertiesWithTypes:o,frequencies:a,tokenOccurrences:s,avgFieldLength:u,fieldLengths:c}}function Mu(r){const{indexes:e,vectorIndexes:n,searchableProperties:t,searchablePropertiesWithTypes:i,frequencies:o,tokenOccurrences:a,avgFieldLength:s,fieldLengths:u}=r,c={};for(const l of Object.keys(n))c[l]=n[l].node.toJSON();const h={};for(const l of Object.keys(e)){const{type:d,node:f,isArray:p}=e[l];d==="Flat"||d==="Radix"||d==="AVL"||d==="BKD"||d==="Bool"?h[l]={type:d,node:f.toJSON(),isArray:p}:(h[l]=e[l],h[l].node=h[l].node.toJSON())}return{indexes:h,vectorIndexes:c,searchableProperties:t,searchablePropertiesWithTypes:i,frequencies:o,tokenOccurrences:a,avgFieldLength:s,fieldLengths:u}}function zu(){return{create:Di,insert:ku,remove:Nu,insertDocumentScoreParameters:Du,insertTokenScoreParameters:Ru,removeDocumentScoreParameters:Cu,removeTokenScoreParameters:Iu,calculateResultScores:Ci,search:Pu,searchByWhereClause:Gt,getSearchableProperties:Ou,getSearchablePropertiesWithTypes:Gu,load:Fu,save:Mu}}function Ii(r,e){r||(r=new Set);const n=e.length;for(let t=0;t<n;t++){const i=e[t].docIDs,o=i.length;for(let a=0;a<o;a++)r.add(i[a])}return r}function Li(r,e,n=!1){const t=n?Se.vincentyDistance:Se.haversineDistance,i=[],o=[];for(const{point:u}of r)o.push(t(e,u));const a=Math.max(...o);let s=0;for(const{docIDs:u}of r){const c=o[s],h=a-c+1;for(const l of u)i.push([l,h]);s++}return i.sort((u,c)=>c[1]-u[1]),i}function Uu(r,e){const n=Object.keys(r);if(n.length!==1)return{isGeoOnly:!1};const t=n[0],i=r[t];if(typeof e.indexes[t]>"u")return{isGeoOnly:!1};const{type:o}=e.indexes[t];return o==="BKD"&&i&&("radius"in i||"polygon"in i)?{isGeoOnly:!0,geoProperty:t,geoOperation:i}:{isGeoOnly:!1}}function $u(r,e){const n=r,t=Uu(e,n);if(!t.isGeoOnly||!t.geoProperty||!t.geoOperation)return null;const{node:i}=n.indexes[t.geoProperty],o=t.geoOperation,a=i;let s;if("radius"in o){const{value:u,coordinates:c,unit:h="m",inside:l=!0,highPrecision:d=!1}=o.radius,f=c,p=mi(u,h);return s=a.searchByRadius(f,p,l,"asc",d),Li(s,f,d)}else if("polygon"in o){const{coordinates:u,inside:c=!0,highPrecision:h=!1}=o.polygon;s=a.searchByPolygon(u,c,"asc",h);const l=Se.calculatePolygonCentroid(u);return Li(s,l,h)}return null}function Bu(r,e){r||(r=new Set);const n=Object.keys(e),t=n.length;for(let i=0;i<t;i++){const o=e[n[i]],a=o.length;for(let s=0;s<a;s++)r.add(o[s])}return r}function ki(r,e,n,t,i){const o={language:r.tokenizer.language,sharedInternalDocumentStore:e,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(const[a,s]of Object.entries(n)){const u=`${i}${i?".":""}${a}`;if(!t.includes(u)){if(typeof s=="object"&&!Array.isArray(s)){const c=ki(r,e,s,t,u);li(o.sortableProperties,c.sortableProperties),o.sorts={...o.sorts,...c.sorts},o.sortablePropertiesWithTypes={...o.sortablePropertiesWithTypes,...c.sortablePropertiesWithTypes};continue}if(!ot(s))switch(s){case"boolean":case"number":case"string":o.sortableProperties.push(u),o.sortablePropertiesWithTypes[u]=s,o.sorts[u]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:s};break;case"geopoint":case"enum":continue;case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw K("INVALID_SORT_SCHEMA_TYPE",Array.isArray(s)?"array":s,u)}}}return o}function Wu(r,e,n,t){return(t==null?void 0:t.enabled)!==!1?ki(r,e,n,(t||{}).unsortableProperties||[],""):{disabled:!0}}function Hu(r,e,n,t){if(!r.enabled)return;r.isSorted=!1;const i=be(r.sharedInternalDocumentStore,n),o=r.sorts[e];o.orderedDocsToRemove.has(i)&&In(r,e),o.docs.set(i,o.orderedDocs.length),o.orderedDocs.push([i,t])}function xi(r){if(r.isSorted||!r.enabled)return;const e=Object.keys(r.sorts);for(const n of e)Yu(r,n);r.isSorted=!0}function ju(r,e,n){return e[1].localeCompare(n[1],$a(r))}function Vu(r,e){return r[1]-e[1]}function qu(r,e){return e[1]?-1:1}function Yu(r,e){const n=r.sorts[e];let t;switch(n.type){case"string":t=ju.bind(null,r.language);break;case"number":t=Vu.bind(null);break;case"boolean":t=qu.bind(null);break}n.orderedDocs.sort(t);const i=n.orderedDocs.length;for(let o=0;o<i;o++){const a=n.orderedDocs[o][0];n.docs.set(a,o)}}function Ku(r){const e=Object.keys(r.sorts);for(const n of e)In(r,n)}function In(r,e){const n=r.sorts[e];n.orderedDocsToRemove.size&&(n.orderedDocs=n.orderedDocs.filter(t=>!n.orderedDocsToRemove.has(t[0])),n.orderedDocsToRemove.clear())}function Xu(r,e,n){if(!r.enabled)return;const t=r.sorts[e],i=be(r.sharedInternalDocumentStore,n);t.docs.get(i)&&(t.docs.delete(i),t.orderedDocsToRemove.set(i,!0))}function Zu(r,e,n){if(!r.enabled)throw K("SORT_DISABLED");const t=n.property,i=n.order==="DESC",o=r.sorts[t];if(!o)throw K("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",t,r.sortableProperties.join(", "));return In(r,t),xi(r),e.sort((a,s)=>{const u=o.docs.get(be(r.sharedInternalDocumentStore,a[0])),c=o.docs.get(be(r.sharedInternalDocumentStore,s[0])),h=typeof u<"u",l=typeof c<"u";return!h&&!l?0:h?l?i?c-u:u-c:-1:1}),e}function Ju(r){return r.enabled?r.sortableProperties:[]}function Qu(r){return r.enabled?r.sortablePropertiesWithTypes:{}}function ec(r,e){const n=e;if(!n.enabled)return{enabled:!1};const t=Object.keys(n.sorts).reduce((i,o)=>{const{docs:a,orderedDocs:s,type:u}=n.sorts[o];return i[o]={docs:new Map(Object.entries(a).map(([c,h])=>[+c,h])),orderedDocsToRemove:new Map,orderedDocs:s,type:u},i},{});return{sharedInternalDocumentStore:r,language:n.language,sortableProperties:n.sortableProperties,sortablePropertiesWithTypes:n.sortablePropertiesWithTypes,sorts:t,enabled:!0,isSorted:n.isSorted}}function tc(r){if(!r.enabled)return{enabled:!1};Ku(r),xi(r);const e=Object.keys(r.sorts).reduce((n,t)=>{const{docs:i,orderedDocs:o,type:a}=r.sorts[t];return n[t]={docs:Object.fromEntries(i.entries()),orderedDocs:o,type:a},n},{});return{language:r.language,sortableProperties:r.sortableProperties,sortablePropertiesWithTypes:r.sortablePropertiesWithTypes,sorts:e,enabled:r.enabled,isSorted:r.isSorted}}function nc(){return{create:Wu,insert:Hu,remove:Xu,save:tc,load:ec,sortBy:Zu,getSortableProperties:Ju,getSortablePropertiesWithTypes:Qu}}const Ni=192,rc=383,ic=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115];function oc(r){return r<Ni||r>rc?r:ic[r-Ni]||r}function sc(r){const e=[];for(let n=0;n<r.length;n++)e[n]=oc(r.charCodeAt(n));return String.fromCharCode(...e)}const ac={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},uc={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},cc="[^aeiou]",Ft="[aeiouy]",Pe=cc+"[^aeiouy]*",mt=Ft+"[aeiou]*",Ln="^("+Pe+")?"+mt+Pe,hc="^("+Pe+")?"+mt+Pe+"("+mt+")?$",Mt="^("+Pe+")?"+mt+Pe+mt+Pe,Pi="^("+Pe+")?"+Ft;function lc(r){let e,n,t,i,o,a;if(r.length<3)return r;const s=r.substring(0,1);if(s=="y"&&(r=s.toUpperCase()+r.substring(1)),t=/^(.+?)(ss|i)es$/,i=/^(.+?)([^s])s$/,t.test(r)?r=r.replace(t,"$1$2"):i.test(r)&&(r=r.replace(i,"$1$2")),t=/^(.+?)eed$/,i=/^(.+?)(ed|ing)$/,t.test(r)){const u=t.exec(r);t=new RegExp(Ln),t.test(u[1])&&(t=/.$/,r=r.replace(t,""))}else i.test(r)&&(e=i.exec(r)[1],i=new RegExp(Pi),i.test(e)&&(r=e,i=/(at|bl|iz)$/,o=new RegExp("([^aeiouylsz])\\1$"),a=new RegExp("^"+Pe+Ft+"[^aeiouwxy]$"),i.test(r)?r=r+"e":o.test(r)?(t=/.$/,r=r.replace(t,"")):a.test(r)&&(r=r+"e")));if(t=/^(.+?)y$/,t.test(r)){const u=t.exec(r);e=u==null?void 0:u[1],t=new RegExp(Pi),e&&t.test(e)&&(r=e+"i")}if(t=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,t.test(r)){const u=t.exec(r);e=u==null?void 0:u[1],n=u==null?void 0:u[2],t=new RegExp(Ln),e&&t.test(e)&&(r=e+ac[n])}if(t=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,t.test(r)){const u=t.exec(r);e=u==null?void 0:u[1],n=u==null?void 0:u[2],t=new RegExp(Ln),e&&t.test(e)&&(r=e+uc[n])}if(t=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,i=/^(.+?)(s|t)(ion)$/,t.test(r)){const u=t.exec(r);e=u==null?void 0:u[1],t=new RegExp(Mt),e&&t.test(e)&&(r=e)}else if(i.test(r)){const u=i.exec(r);e=(u==null?void 0:u[1])??""+(u==null?void 0:u[2])??"",i=new RegExp(Mt),i.test(e)&&(r=e)}if(t=/^(.+?)e$/,t.test(r)){const u=t.exec(r);e=u==null?void 0:u[1],t=new RegExp(Mt),i=new RegExp(hc),o=new RegExp("^"+Pe+Ft+"[^aeiouwxy]$"),e&&(t.test(e)||i.test(e)&&!o.test(e))&&(r=e)}return t=/ll$/,i=new RegExp(Mt),t.test(r)&&i.test(r)&&(t=/.$/,r=r.replace(t,"")),s=="y"&&(r=s.toLowerCase()+r.substring(1)),r}function Oi(r,e,n=!0){var i;const t=`${this.language}:${r}:${e}`;return n&&this.normalizationCache.has(t)?this.normalizationCache.get(t):(i=this.stopWords)!=null&&i.includes(e)?(n&&this.normalizationCache.set(t,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(r)&&(e=this.stemmer(e)),e=sc(e),n&&this.normalizationCache.set(t,e),e)}function dc(r){for(;r[r.length-1]==="";)r.pop();for(;r[0]==="";)r.shift();return r}function Gi(r,e,n,t=!0){if(e&&e!==this.language)throw K("LANGUAGE_NOT_SUPPORTED",e);if(typeof r!="string")return[r];const i=this.normalizeToken.bind(this,n??"");let o;if(n&&this.tokenizeSkipProperties.has(n))o=[i(r,t)];else{const s=Ua[this.language];o=r.toLowerCase().split(s).map(u=>i(u,t)).filter(Boolean)}const a=dc(o);return this.allowDuplicates?a:Array.from(new Set(a))}function Fi(r={}){if(!r.language)r.language="english";else if(!Sn.includes(r.language))throw K("LANGUAGE_NOT_SUPPORTED",r.language);let e;if(r.stemming||r.stemmer&&!("stemming"in r))if(r.stemmer){if(typeof r.stemmer!="function")throw K("INVALID_STEMMER_FUNCTION_TYPE");e=r.stemmer}else if(r.language==="english")e=lc;else throw K("MISSING_STEMMER",r.language);let n;if(r.stopWords!==!1){if(n=[],Array.isArray(r.stopWords))n=r.stopWords;else if(typeof r.stopWords=="function")n=r.stopWords(n);else if(r.stopWords)throw K("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(n))throw K("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(const i of n)if(typeof i!="string")throw K("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}const t={tokenize:Gi,language:r.language,stemmer:e,stemmerSkipProperties:new Set(r.stemmerSkipProperties?[r.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(r.tokenizeSkipProperties?[r.tokenizeSkipProperties].flat():[]),stopWords:n,allowDuplicates:!!r.allowDuplicates,normalizeToken:Oi,normalizationCache:new Map};return t.tokenize=Gi.bind(t),t.normalizeToken=Oi,t}function fc(r){return{sharedInternalDocumentStore:r,rules:new Map}}function gc(r,e){if(r.rules.has(e.id))throw new Error(`PINNING_RULE_ALREADY_EXISTS: A pinning rule with id "${e.id}" already exists. Use updateRule to modify it.`);r.rules.set(e.id,e)}function pc(r,e){if(!r.rules.has(e.id))throw new Error(`PINNING_RULE_NOT_FOUND: Cannot update pinning rule with id "${e.id}" because it does not exist. Use addRule to create it.`);r.rules.set(e.id,e)}function mc(r,e){return r.rules.delete(e)}function vc(r,e){return r.rules.get(e)}function yc(r){return Array.from(r.rules.values())}function bc(r,e){const n=r.toLowerCase().trim(),t=e.pattern.toLowerCase().trim();switch(e.anchoring){case"is":return n===t;case"starts_with":return n.startsWith(t);case"contains":return n.includes(t);default:return!1}}function wc(r,e){return r?e.conditions.every(n=>bc(r,n)):!1}function Mi(r,e){if(!e)return[];const n=[];for(const t of r.rules.values())wc(e,t)&&n.push(t);return n}function Ec(r,e){const n=e;return{sharedInternalDocumentStore:r,rules:new Map((n==null?void 0:n.rules)??[])}}function Sc(r){return{rules:Array.from(r.rules.entries())}}function Tc(){return{create:fc,addRule:gc,updateRule:pc,removeRule:mc,getRule:vc,getAllRules:yc,getMatchingRules:Mi,load:Ec,save:Sc}}function _c(r){const e={formatElapsedTime:Ja,getDocumentIndexId:Qa,getDocumentProperties:pi,validateSchema:wi};for(const n of Ti){const t=n;if(r[t]){if(typeof r[t]!="function")throw K("COMPONENT_MUST_BE_FUNCTION",t)}else r[t]=e[t]}for(const n of Object.keys(r))if(!yu.includes(n)&&!Ti.includes(n))throw K("UNSUPPORTED_COMPONENT",n)}function Ac({schema:r,sort:e,language:n,components:t,id:i,plugins:o}){t||(t={});for(const E of o??[]){if(!("getComponents"in E)||typeof E.getComponents!="function")continue;const v=E.getComponents(r),g=Object.keys(v);for(const A of g)if(t[A])throw K("PLUGIN_COMPONENT_CONFLICT",A,E.name);t={...t,...v}}i||(i=fi());let a=t.tokenizer,s=t.index,u=t.documentsStore,c=t.sorter,h=t.pinning;if(a?a.tokenize?a=a:a=Fi(a):a=Fi({language:n??"english"}),t.tokenizer&&n)throw K("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");const l=ru();s||(s=zu()),c||(c=nc()),u||(u=pu()),h||(h=Tc()),_c(t);const{getDocumentProperties:d,getDocumentIndexId:f,validateSchema:p,formatElapsedTime:w}=t,m={data:{},caches:{},schema:r,tokenizer:a,index:s,sorter:c,documentsStore:u,pinning:h,internalDocumentIDStore:l,getDocumentProperties:d,getDocumentIndexId:f,validateSchema:p,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeUpsert:[],afterUpsert:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],beforeUpdateMultiple:[],afterUpdateMultiple:[],beforeUpsertMultiple:[],afterUpsertMultiple:[],afterCreate:[],formatElapsedTime:w,id:i,plugins:o,version:Dc()};m.data={index:m.index.create(m,l,r),docs:m.documentsStore.create(m,l),sorting:m.sorter.create(m,l,r,e),pinning:m.pinning.create(l)};for(const E of mu)m[E]=(m[E]??[]).concat(vu(m,E));const b=m.afterCreate;return b&&bu(b,m),m}function Dc(){return"{{VERSION}}"}function Rc(r){return r.documentsStore.count(r.data.docs)}function Cc(r,e,n,t,i){const o=r.validateSchema(e,r.schema);if(o)throw K("SCHEMA_VALIDATION_FAILURE",o);return Ne(r.beforeInsert)||Ne(r.afterInsert)||Ne(r.index.beforeInsert)||Ne(r.index.insert)||Ne(r.index.afterInsert)?kc(r,e,n,t,i):xc(r,e,n,t,i)}const Ic=new Set(["enum","enum[]"]),Lc=new Set(["string","number"]);async function kc(r,e,n,t,i){const{index:o,docs:a}=r.data,s=r.getDocumentIndexId(e);if(typeof s!="string")throw K("DOCUMENT_ID_MUST_BE_STRING",typeof s);const u=be(r.internalDocumentIDStore,s);if(await Lt(r.beforeInsert,r,s,e),!r.documentsStore.store(a,s,u,e))throw K("DOCUMENT_ALREADY_EXISTS",s);const c=r.documentsStore.count(a),h=r.index.getSearchableProperties(o),l=r.index.getSearchablePropertiesWithTypes(o),d=r.getDocumentProperties(e,h);for(const[f,p]of Object.entries(d)){if(typeof p>"u")continue;const w=typeof p,m=l[f];zi(w,m,f,p)}return await Nc(r,s,h,d,c,n,e,i),await Lt(r.afterInsert,r,s,e),s}function xc(r,e,n,t,i){const{index:o,docs:a}=r.data,s=r.getDocumentIndexId(e);if(typeof s!="string")throw K("DOCUMENT_ID_MUST_BE_STRING",typeof s);const u=be(r.internalDocumentIDStore,s);if(Lt(r.beforeInsert,r,s,e),!r.documentsStore.store(a,s,u,e))throw K("DOCUMENT_ALREADY_EXISTS",s);const c=r.documentsStore.count(a),h=r.index.getSearchableProperties(o),l=r.index.getSearchablePropertiesWithTypes(o),d=r.getDocumentProperties(e,h);for(const[f,p]of Object.entries(d)){if(typeof p>"u")continue;const w=typeof p,m=l[f];zi(w,m,f,p)}return Pc(r,s,h,d,c,n,e,i),Lt(r.afterInsert,r,s,e),s}function zi(r,e,n,t){if(!(nu(e)&&typeof t=="object"&&typeof t.lon=="number"&&typeof t.lat=="number")&&!(ot(e)&&Array.isArray(t))&&!(Ct(e)&&Array.isArray(t))&&!(Ic.has(e)&&Lc.has(r))&&r!==e)throw K("INVALID_DOCUMENT_PROPERTY",n,e,r)}async function Nc(r,e,n,t,i,o,a,s){var h,l,d,f;for(const p of n){const w=t[p];if(typeof w>"u")continue;const m=r.index.getSearchablePropertiesWithTypes(r.data.index)[p];await((l=(h=r.index).beforeInsert)==null?void 0:l.call(h,r.data.index,p,e,w,m,o,r.tokenizer,i));const b=r.internalDocumentIDStore.idToInternalId.get(e);await r.index.insert(r.index,r.data.index,p,e,b,w,m,o,r.tokenizer,i,s),await((f=(d=r.index).afterInsert)==null?void 0:f.call(d,r.data.index,p,e,w,m,o,r.tokenizer,i))}const u=r.sorter.getSortableProperties(r.data.sorting),c=r.getDocumentProperties(a,u);for(const p of u){const w=c[p];if(typeof w>"u")continue;const m=r.sorter.getSortablePropertiesWithTypes(r.data.sorting)[p];r.sorter.insert(r.data.sorting,p,e,w,m,o)}}function Pc(r,e,n,t,i,o,a,s){var h,l,d,f;for(const p of n){const w=t[p];if(typeof w>"u")continue;const m=r.index.getSearchablePropertiesWithTypes(r.data.index)[p],b=be(r.internalDocumentIDStore,e);(l=(h=r.index).beforeInsert)==null||l.call(h,r.data.index,p,e,w,m,o,r.tokenizer,i),r.index.insert(r.index,r.data.index,p,e,b,w,m,o,r.tokenizer,i,s),(f=(d=r.index).afterInsert)==null||f.call(d,r.data.index,p,e,w,m,o,r.tokenizer,i)}const u=r.sorter.getSortableProperties(r.data.sorting),c=r.getDocumentProperties(a,u);for(const p of u){const w=c[p];if(typeof w>"u")continue;const m=r.sorter.getSortablePropertiesWithTypes(r.data.sorting)[p];r.sorter.insert(r.data.sorting,p,e,w,m,o)}}const Ui="fulltext",Oc="hybrid",Gc="vector";function Fc(r,e){return r[1]-e[1]}function Mc(r,e){return e[1]-r[1]}function zc(r="desc"){return r.toLowerCase()==="asc"?Fc:Mc}function kn(r,e,n){const t={},i=e.map(([c])=>c),o=r.documentsStore.getMultiple(r.data.docs,i),a=Object.keys(n),s=r.index.getSearchablePropertiesWithTypes(r.data.index);for(const c of a){let h;if(s[c]==="number"){const{ranges:l}=n[c],d=l.length,f=Array.from({length:d});for(let p=0;p<d;p++){const w=l[p];f[p]=[`${w.from}-${w.to}`,0]}h=Object.fromEntries(f)}t[c]={count:0,values:h??{}}}const u=o.length;for(let c=0;c<u;c++){const h=o[c];for(const l of a){const d=l.includes(".")?Dn(h,l):h[l],f=s[l],p=t[l].values;switch(f){case"number":{const w=n[l].ranges;$i(w,p)(d);break}case"number[]":{const w=new Set,m=n[l].ranges,b=$i(m,p,w);for(const E of d)b(E);break}case"boolean":case"enum":case"string":{Bi(p,f)(d);break}case"boolean[]":case"enum[]":case"string[]":{const b=Bi(p,f==="boolean[]"?"boolean":"string",new Set);for(const E of d)b(E);break}default:throw K("FACET_NOT_SUPPORTED",f)}}}for(const c of a){const h=t[c];if(h.count=Object.keys(h.values).length,s[c]==="string"){const l=n[c],d=zc(l.sort);h.values=Object.fromEntries(Object.entries(h.values).sort(d).slice(l.offset??0,l.limit??10))}}return t}function $i(r,e,n){return t=>{for(const i of r){const o=`${i.from}-${i.to}`;n!=null&&n.has(o)||t>=i.from&&t<=i.to&&(e[o]===void 0?e[o]=1:(e[o]++,n==null||n.add(o)))}}}function Bi(r,e,n){const t=e==="boolean"?"false":"";return i=>{const o=(i==null?void 0:i.toString())??t;n!=null&&n.has(o)||(r[o]=(r[o]??0)+1,n==null||n.add(o))}}const Uc={reducer:(r,e,n,t)=>(e[t]=n,e),getInitialValue:r=>Array.from({length:r})},Wi=["string","number","boolean"];function xn(r,e,n){const t=n.properties,i=t.length,o=r.index.getSearchablePropertiesWithTypes(r.data.index);for(let b=0;b<i;b++){const E=t[b];if(typeof o[E]>"u")throw K("UNKNOWN_GROUP_BY_PROPERTY",E);if(!Wi.includes(o[E]))throw K("INVALID_GROUP_BY_PROPERTY",E,Wi.join(", "),o[E])}const a=e.map(([b])=>It(r.internalDocumentIDStore,b)),s=r.documentsStore.getMultiple(r.data.docs,a),u=s.length,c=n.maxResult||Number.MAX_SAFE_INTEGER,h=[],l={};for(let b=0;b<i;b++){const E=t[b],v={property:E,perValue:{}},g=new Set;for(let A=0;A<u;A++){const S=s[A],D=Dn(S,E);if(typeof D>"u")continue;const C=typeof D!="boolean"?D:""+D,I=v.perValue[C]??{indexes:[],count:0};I.count>=c||(I.indexes.push(A),I.count++,v.perValue[C]=I,g.add(D))}h.push(Array.from(g)),l[E]=v}const d=Hi(h),f=d.length,p=[];for(let b=0;b<f;b++){const E=d[b],v=E.length,g={values:[],indexes:[]},A=[];for(let S=0;S<v;S++){const D=E[S],C=t[S];A.push(l[C].perValue[typeof D!="boolean"?D:""+D].indexes),g.values.push(D)}g.indexes=qa(A).sort((S,D)=>S-D),g.indexes.length!==0&&p.push(g)}const w=p.length,m=Array.from({length:w});for(let b=0;b<w;b++){const E=p[b],v=n.reduce||Uc,g=E.indexes.map(C=>({id:a[C],score:e[C][1],document:s[C]})),A=v.reducer.bind(null,E.values),S=v.getInitialValue(E.indexes.length),D=g.reduce(A,S);m[b]={values:E.values,result:D}}return m}function Hi(r,e=0){if(e+1===r.length)return r[e].map(o=>[o]);const n=r[e],t=Hi(r,e+1),i=[];for(const o of n)for(const a of t){const s=[o];li(s,a),i.push(s)}return i}function Nn(r,e,n,t){const i=Mi(e,t);if(i.length===0)return n;const o=i.flatMap(m=>m.consequence.promote);o.sort((m,b)=>m.position-b.position);const a=new Set,s=new Map,u=new Set;for(const m of o){const b=be(r.internalDocumentIDStore,m.doc_id);if(b!==void 0){if(s.has(b)){const E=s.get(b);m.position<E&&s.set(b,m.position);continue}u.has(m.position)||(a.add(b),s.set(b,m.position),u.add(m.position))}}if(s.size===0)return n;const c=n.filter(([m])=>!a.has(m)),h=1e6,l=[];for(const[m,b]of s.entries())n.find(([v])=>v===m)?l.push([m,h-b]):r.documentsStore.get(r.data.docs,m)&&l.push([m,0]);l.sort((m,b)=>{const E=s.get(m[0])??1/0,v=s.get(b[0])??1/0;return E-v});const d=[],f=new Map;for(const m of l){const b=s.get(m[0]);f.set(b,m)}let p=0,w=0;for(;w<c.length+l.length;)if(f.has(w))d.push(f.get(w)),w++;else if(p<c.length)d.push(c[p]),p++,w++;else break;for(const[m,b]of f.entries())m>=d.length&&d.push(b);return d}function ji(r,e,n){const{term:t,properties:i}=e,o=r.data.index;let a=r.caches.propertiesToSearch;if(!a){const l=r.index.getSearchablePropertiesWithTypes(o);a=r.index.getSearchableProperties(o),a=a.filter(d=>l[d].startsWith("string")),r.caches.propertiesToSearch=a}if(i&&i!=="*"){for(const l of i)if(!a.includes(l))throw K("UNKNOWN_INDEX",l,a.join(", "));a=a.filter(l=>i.includes(l))}const s=Object.keys(e.where??{}).length>0;let u;s&&(u=r.index.searchByWhereClause(o,r.tokenizer,e.where,n));let c;const h=e.threshold!==void 0&&e.threshold!==null?e.threshold:1;if(t||i){const l=Rc(r);if(c=r.index.search(o,t||"",r.tokenizer,n,a,e.exact||!1,e.tolerance||0,e.boost||{},Hc(e.relevance),l,u,h),e.exact&&t){const d=t.trim().split(/\s+/);c=c.filter(([f])=>{const p=r.documentsStore.get(r.data.docs,f);if(!p)return!1;for(const w of a){const m=Bc(p,w);if(typeof m=="string"&&d.every(E=>new RegExp(`\\b${$c(E)}\\b`).test(m)))return!0}return!1})}}else if(s){const l=$u(o,e.where);l?c=l:c=(u?Array.from(u):[]).map(f=>[+f,0])}else c=Object.keys(r.documentsStore.getAll(r.data.docs)).map(d=>[+d,0]);return c}function $c(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Bc(r,e){const n=e.split(".");let t=r;for(const i of n)if(t&&typeof t=="object"&&i in t)t=t[i];else return;return t}function Wc(r,e,n){var s,u;const t=it();function i(){const c=Object.keys(r.data.index.vectorIndexes),h=e.facets&&Object.keys(e.facets).length>0,{limit:l=10,offset:d=0,distinctOn:f,includeVectors:p=!1}=e,w=e.preflight===!0;let m=ji(r,e,n);if(e.sortBy)if(typeof e.sortBy=="function"){const v=m.map(([S])=>S),A=r.documentsStore.getMultiple(r.data.docs,v).map((S,D)=>[m[D][0],m[D][1],S]);A.sort(e.sortBy),m=A.map(([S,D])=>[S,D])}else m=r.sorter.sortBy(r.data.sorting,m,e.sortBy).map(([v,g])=>[be(r.internalDocumentIDStore,v),g]);else m=m.sort(gi);m=Nn(r,r.data.pinning,m,e.term);let b;w||(b=f?Qc(r,m,d,l,f):Yi(r,m,d,l));const E={elapsed:{formatted:"",raw:0},hits:[],count:m.length};if(typeof b<"u"&&(E.hits=b.filter(Boolean),p||vi(E,c)),h){const v=kn(r,m,e.facets);E.facets=v}return e.groupBy&&(E.groups=xn(r,m,e.groupBy)),E.elapsed=r.formatElapsedTime(it()-t),E}async function o(){r.beforeSearch&&await Cn(r.beforeSearch,r,e,n);const c=i();return r.afterSearch&&await Rn(r.afterSearch,r,e,n,c),c}return((s=r.beforeSearch)==null?void 0:s.length)||((u=r.afterSearch)==null?void 0:u.length)?o():i()}const Pn={k:1.2,b:.75,d:.5};function Hc(r){const e=r??{};return e.k=e.k??Pn.k,e.b=e.b??Pn.b,e.d=e.d??Pn.d,e}function Vi(r,e,n){const t=e.vector;if(t&&(!("value"in t)||!("property"in t)))throw K("INVALID_VECTOR_INPUT",Object.keys(t).join(", "));const i=r.data.index.vectorIndexes[t.property];if(!i)throw K("UNKNOWN_VECTOR_PROPERTY",t.property);const o=i.node.size;if((t==null?void 0:t.value.length)!==o)throw(t==null?void 0:t.property)===void 0||(t==null?void 0:t.value.length)===void 0?K("INVALID_INPUT_VECTOR","undefined",o,"undefined"):K("INVALID_INPUT_VECTOR",t.property,o,t.value.length);const a=r.data.index;let s;return Object.keys(e.where??{}).length>0&&(s=r.index.searchByWhereClause(a,r.tokenizer,e.where,n)),i.node.find(t.value,e.similarity??_u,s)}function jc(r,e,n="english"){var s,u;const t=it();function i(){let c=Vi(r,e,n).sort(gi);c=Nn(r,r.data.pinning,c,void 0);let h=[];e.facets&&Object.keys(e.facets).length>0&&(h=kn(r,c,e.facets));const d=e.vector.property,f=e.includeVectors??!1,p=e.limit??10,w=e.offset??0,m=Array.from({length:p});for(let g=0;g<p;g++){const A=c[g+w];if(!A)break;const S=r.data.docs.docs[A[0]];if(S){f||(S[d]=null);const D={id:It(r.internalDocumentIDStore,A[0]),score:A[1],document:S};m[g]=D}}let b=[];e.groupBy&&(b=xn(r,c,e.groupBy));const v=it()-t;return{count:c.length,hits:m.filter(Boolean),elapsed:{raw:Number(v),formatted:_n(v)},...h?{facets:h}:{},...b?{groups:b}:{}}}async function o(){r.beforeSearch&&await Cn(r.beforeSearch,r,e,n);const c=i();return r.afterSearch&&await Rn(r.afterSearch,r,e,n,c),c}return((s=r.beforeSearch)==null?void 0:s.length)||((u=r.afterSearch)==null?void 0:u.length)?o():i()}function Vc(r,e,n){const t=Yc(ji(r,e,n)),i=Vi(r,e,n),o=e.hybridWeights;return Xc(t,i,e.term??"",o)}function qc(r,e,n){var s,u;const t=it();function i(){let c=Vc(r,e,n);c=Nn(r,r.data.pinning,c,e.term);let h;e.facets&&Object.keys(e.facets).length>0&&(h=kn(r,c,e.facets));let d;e.groupBy&&(d=xn(r,c,e.groupBy));const f=e.offset??0,p=e.limit??10,w=Yi(r,c,f,p).filter(Boolean),m=it(),b={count:c.length,elapsed:{raw:Number(m-t),formatted:_n(m-t)},hits:w,...h?{facets:h}:{},...d?{groups:d}:{}};if(!(e.includeVectors??!1)){const v=Object.keys(r.data.index.vectorIndexes);vi(b,v)}return b}async function o(){r.beforeSearch&&await Cn(r.beforeSearch,r,e,n);const c=i();return r.afterSearch&&await Rn(r.afterSearch,r,e,n,c),c}return((s=r.beforeSearch)==null?void 0:s.length)||((u=r.afterSearch)==null?void 0:u.length)?o():i()}function On(r){return r[1]}function Yc(r){const e=Math.max.apply(Math,r.map(On));return r.map(([n,t])=>[n,t/e])}function qi(r,e){return r/e}function Kc(r,e){return(n,t)=>n*r+t*e}function Xc(r,e,n,t){const i=Math.max.apply(Math,r.map(On)),o=Math.max.apply(Math,e.map(On)),a=t&&t.text&&t.vector,{text:s,vector:u}=a?t:Zc(),c=new Map,h=r.length,l=Kc(s,u);for(let f=0;f<h;f++){const[p,w]=r[f],m=qi(w,i),b=l(m,0);c.set(p,b)}const d=e.length;for(let f=0;f<d;f++){const[p,w]=e[f],m=qi(w,o),b=c.get(p)??0;c.set(p,b+l(0,m))}return[...c].sort((f,p)=>p[1]-f[1])}function Zc(r){return{text:.5,vector:.5}}function Jc(r,e,n){const t=e.mode??Ui;if(t===Ui)return Wc(r,e,n);if(t===Gc)return jc(r,e);if(t===Oc)return qc(r,e);throw K("INVALID_SEARCH_MODE",t)}function Qc(r,e,n,t,i){const o=r.data.docs,a=new Map,s=[],u=new Set,c=e.length;let h=0;for(let l=0;l<c;l++){const d=e[l];if(typeof d>"u")continue;const[f,p]=d;if(u.has(f))continue;const w=r.documentsStore.get(o,f),m=Dn(w,i);if(!(typeof m>"u"||a.has(m))&&(a.set(m,!0),h++,!(h<=n)&&(s.push({id:It(r.internalDocumentIDStore,f),score:p,document:w}),u.add(f),h>=n+t)))break}return s}function Yi(r,e,n,t){const i=r.data.docs,o=Array.from({length:t}),a=new Set;for(let s=n;s<t+n;s++){const u=e[s];if(typeof u>"u")break;const[c,h]=u;if(!a.has(c)){const l=r.documentsStore.get(i,c);o[s]={id:It(r.internalDocumentIDStore,c),score:h,document:l},a.add(c)}}return o}let zt=null,Ke=null;function eh(){return document.documentElement.getAttribute("data-md-color-scheme")==="slate"}function th(r){const e=r.querySelector(".starfield-canvas");e&&e.remove(),Ke&&(cancelAnimationFrame(Ke),Ke=null);const n=document.createElement("canvas");n.className="starfield-canvas",n.style.cssText=`
    position: absolute; inset: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 0;
  `,r.style.position="relative",r.prepend(n);function t(){n.width=r.offsetWidth||800,n.height=r.offsetHeight||600}t();const i=n.getContext("2d"),o=Array.from({length:200},()=>({x:Math.random()*n.width,y:Math.random()*n.height,r:Math.random()*1.2+.2,alpha:Math.random()*.6+.2,dAlpha:(Math.random()*.005+.001)*(Math.random()<.5?1:-1)}));function a(){i.clearRect(0,0,n.width,n.height),o.forEach(u=>{u.alpha+=u.dAlpha,(u.alpha>.85||u.alpha<.1)&&(u.dAlpha*=-1),i.beginPath(),i.arc(u.x,u.y,u.r,0,Math.PI*2),i.fillStyle=`rgba(180, 200, 255, ${u.alpha})`,i.fill()}),Ke=requestAnimationFrame(a)}a();const s=new ResizeObserver(t);s.observe(r),n._ro=s}function nh(r){var n;Ke&&(cancelAnimationFrame(Ke),Ke=null);const e=r==null?void 0:r.querySelector(".starfield-canvas");e&&((n=e._ro)==null||n.disconnect(),e.remove())}function Gn(){var we,B;const r=document.getElementById("sigma-container");if(!r)return;const e=window.__GRAPH_DATA__;if(!e){console.error("graph-viz: __GRAPH_DATA__ not found");return}if(zt){try{zt.kill()}catch{}zt=null}nh(r),r.innerHTML="";const n=eh(),t=n?{category:"#a78bfa",subcategory:"#60a5fa",series:"#fb923c",tag:"#34d399",post:"#f472b6"}:{category:"#7C3AED",subcategory:"#2563EB",series:"#EA580C",tag:"#0D9488",post:"#DC2626"},i=n?{inCategory:"rgba(167,139,250,0.5)",inSubcategory:"rgba(96,165,250,0.4)",inSeries:"rgba(251,146,60,0.55)",hasTag:"rgba(52,211,153,0.4)",related:"rgba(192,132,252,0.55)",dependsOn:"rgba(96,165,250,0.6)",tagCooccurs:"rgba(253,224,71,0.3)"}:{inCategory:"#9333ea",inSubcategory:"#3b82f6",inSeries:"#ea580c",hasTag:"#0d9488",related:"#8b5cf6",dependsOn:"#2563eb",tagCooccurs:"#94a3b8"},o=n?"#e2e8f0":"#1a1a2e",a=n?"rgba(7,11,24,0.7)":"rgba(255,255,255,0)",s=n?"rgba(148,163,184,0.25)":"#94a3b8",u={category:!1,subcategory:!1,series:!1,tag:!1,post:!0},c={category:!0,subcategory:!0,series:!0,tag:!0,post:!1},h={hoveredNode:null,selectedNode:null,searchQuery:"",searchMatches:new Set},l={};e.nodes.forEach(_=>{l[_.id]=0}),e.edges.forEach(_=>{l[_.source]!==void 0&&l[_.source]++,l[_.target]!==void 0&&l[_.target]++});function d(_){const y=l[_.id]||0;switch(_.type){case"category":return 28;case"subcategory":return 16+Math.min(y*.3,7);case"tag":return Math.max(7,Math.min(18,6+y*.8));case"series":return Math.max(10,Math.min(22,10+y*.4));case"post":return Math.max(6,Math.min(16,5+y*1.5));default:return 8}}const f=new se({multi:!1,type:"directed"});e.nodes.forEach(_=>{f.addNode(_.id,{label:_.label,size:d(_),color:t[_.type]||"#a78bfa",nodeType:_.type,url:_.url||null,date:_.date||null,series:_.series||null,difficulty:_.difficulty||null,hidden:u[_.type]??!1,x:Math.random()*100,y:Math.random()*100})});const p=new Set;e.edges.forEach(_=>{const y=`${_.source}--${_.target}`,N=`${_.target}--${_.source}`;if(p.has(y)||p.has(N)||!f.hasNode(_.source)||!f.hasNode(_.target)||_.source===_.target)return;p.add(y);const M=_.type==="dependsOn"||_.type==="related";f.addDirectedEdge(_.source,_.target,{edgeType:_.type,weight:_.weight,color:i[_.type]||s,size:_.type==="tagCooccurs"?Math.min(_.weight*.5,2):1.2,type:M?"arrow":"line"})});const w=new se({multi:!1,type:"undirected"});f.forEachNode((_,y)=>{w.addNode(_,{weight:y.size||1})}),f.forEachEdge((_,y,N,M)=>{N!==M&&!w.hasEdge(N,M)&&w.addEdge(N,M,{weight:y.weight||1})});const m=za(w,{resolution:1.2,getEdgeWeight:"weight"}),b={};Object.entries(m).forEach(([_,y])=>{b[y]||(b[y]=[]),b[y].push(_),f.hasNode(_)&&f.setNodeAttribute(_,"community",y)});const E=Object.keys(b).length,v=300,g={};Object.keys(b).forEach((_,y)=>{const N=y/E*2*Math.PI;g[_]={x:v*Math.cos(N),y:v*Math.sin(N)}});const A=f.nodes().filter(_=>f.getNodeAttribute(_,"nodeType")==="category");f.forEachNode(_=>{var de;const y=m[_],N=g[y]||{x:0,y:0},M=((de=b[y])==null?void 0:de.length)||1,V=Math.min(150,30+Math.sqrt(M)*15),X=Math.random()*2*Math.PI,re=Math.random()*V;f.setNodeAttribute(_,"x",N.x+re*Math.cos(X)),f.setNodeAttribute(_,"y",N.y+re*Math.sin(X))}),A.forEach(_=>{const y=m[_];y!==void 0&&g[y]&&(f.setNodeAttribute(_,"x",g[y].x),f.setNodeAttribute(_,"y",g[y].y))}),ka.assign(f,{iterations:300,settings:{gravity:.05,scalingRatio:10,barnesHutOptimize:!0,barnesHutTheta:.5,strongGravityMode:!0,linLogMode:!1,outboundAttractionDistribution:!0,adjustSizes:!1,edgeWeightInfluence:1,slowDown:1}}),n&&th(r);const S=new Aa(f,r,{renderEdgeLabels:!1,enableEdgeClickEvents:!1,enableEdgeWheelEvents:!1,enableEdgeHoverEvents:!1,defaultNodeColor:t.tag,defaultEdgeColor:s,labelFont:"Pretendard, sans-serif",labelSize:12,labelWeight:"600",labelColor:{color:o},labelBackgroundColor:a,labelRenderedSizeThreshold:10,minCameraRatio:.03,maxCameraRatio:8,defaultEdgeType:"line",defaultArrowHeadLength:10,nodeReducer:(_,y)=>{const N={...y},M=h.selectedNode===_,V=h.hoveredNode===_,X=h.hoveredNode?new Set(f.neighbors(h.hoveredNode)):h.selectedNode?new Set(f.neighbors(h.selectedNode)):null,re=y.nodeType;if((re==="post"||re==="tag")&&(N.borderColor=n?re==="post"?"rgba(244,114,182,0.6)":"rgba(52,211,153,0.5)":re==="post"?"rgba(220,38,38,0.5)":"rgba(13,148,136,0.45)",N.borderSize=1.5),h.searchQuery&&h.searchMatches.size>0){if(!h.searchMatches.has(_))return N.color=n?"#1e293b":"#cbd5e1",N.label="",N.size=y.size*.4,N.borderSize=0,N;N.size=y.size*1.3,N.borderColor=n?"#fbbf24":"#d97706",N.borderSize=2.5}if((h.hoveredNode||h.selectedNode)&&!V&&!M){if(!X||!X.has(_))return y.hidden||(N.color=n?"#374151":"#b0bec5",N.label="",N.size=y.size*.7,N.borderSize=0),N;N.size=y.size*1.1}return V&&(N.borderColor=n?"#f8fafc":"#1e293b",N.borderSize=2),M&&(N.size=y.size*1.6,N.zIndex=10,N.borderColor=n?"#fbbf24":"#b45309",N.borderSize=3),N},edgeReducer:(_,y)=>{const N={...y};if(y.hidden)return N;const[M,V]=f.extremities(_),X=h.hoveredNode||h.selectedNode;return X&&(M!==X&&V!==X?(N.color=n?"#1e293b":"#d1d5db",N.size=.3):(N.size=(y.size||1)*2.5,N.color=i[y.edgeType]||s)),h.searchQuery&&h.searchMatches.size>0&&!h.searchMatches.has(M)&&!h.searchMatches.has(V)&&(N.color=n?"#1e293b":"#d1d5db",N.size=.2),N}}),D=document.getElementById("graph-tooltip");function C(_,y,N){if(!D)return;const M={category:"",subcategory:"",series:"",tag:"",post:""}[y.nodeType]||y.nodeType,V=f.degree(_);let X=`<div class="gt-type gt-type--${y.nodeType}">${M}</div>`;X+=`<div class="gt-label">${y.label}</div>`,y.date&&(X+=`<div class="gt-meta">${y.date}</div>`),X+=`<div class="gt-meta"> ${V}</div>`,X+=`<div class="gt-hint">${y.nodeType==="post"?" ":"  "}</div>`,D.innerHTML=X,D.classList.add("is-visible"),k(N)}function I(){D==null||D.classList.remove("is-visible")}function k(_){var re,de;if(!D||!_)return;const y=r.getBoundingClientRect(),N=(((re=_.original)==null?void 0:re.clientX)??_.clientX??0)-y.left,M=(((de=_.original)==null?void 0:de.clientY)??_.clientY??0)-y.top,V=D.offsetWidth||200,X=D.offsetHeight||80;D.style.left=(N+16+V>y.width?N-V-8:N+16)+"px",D.style.top=(M+16+X>y.height?M-X-8:M+12)+"px"}r.addEventListener("mousemove",_=>{h.hoveredNode&&(D!=null&&D.classList.contains("is-visible"))&&k({clientX:_.clientX,clientY:_.clientY})});const U=document.getElementById("graph-info-panel"),P=document.getElementById("graph-panel-body"),T=document.getElementById("graph-panel-close");function q(_,y){var Xe;if(!U||!P)return;h.selectedNode=_;const N={category:"",subcategory:"",series:"",tag:"",post:""}[y.nodeType]||y.nodeType,M=f.neighbors(_),V=M.filter(J=>f.getNodeAttribute(J,"nodeType")==="post").map(J=>({id:J,label:f.getNodeAttribute(J,"label"),url:f.getNodeAttribute(J,"url"),date:f.getNodeAttribute(J,"date")})).sort((J,ge)=>(ge.date||"").localeCompare(J.date||"")),X=M.filter(J=>f.getNodeAttribute(J,"nodeType")!=="post").map(J=>({id:J,label:f.getNodeAttribute(J,"label"),type:f.getNodeAttribute(J,"nodeType")})),re=((Xe=document.querySelector('meta[name="site-url"]'))==null?void 0:Xe.content)||"/",de=f.degree(_);let me=`<div class="gp-node-header gp-node-header--${y.nodeType}">`;me+='<div class="gp-header-row">',me+=`<div class="gp-type gp-type--${y.nodeType}">${N}</div>`;const Oe=[`${de} `];V.length&&Oe.push(`${V.length} `),X.length&&Oe.push(`${X.length} `),me+=`<span class="gp-inline-stats">${Oe.join("  ")}</span>`,me+="</div>",me+=`<h2 class="gp-title">${y.label}</h2>`;const Ge=[];if(y.series&&Ge.push(`<span class="gp-meta-series">${y.series}</span>`),y.date&&Ge.push(`<span class="gp-meta-date">${y.date}</span>`),y.difficulty){const J={beginner:"",intermediate:"",advanced:""}[y.difficulty]||y.difficulty;Ge.push(`<span class="gp-meta-diff gp-meta-diff--${y.difficulty}">${J}</span>`)}Ge.length&&(me+=`<div class="gp-meta-line">${Ge.join("")}</div>`),me+="</div>";let ce='<div class="gp-scroll-body">';if(y.nodeType==="post"){const J=(Q[_]||"").trim();if(J){const ge=J.slice(0,220);ce+='<div class="gp-section gp-section--teaser">',ce+=`<p class="gp-post-teaser">${ge}${J.length>220?"...":""}</p>`,ce+="</div>"}}if(V.length>0&&(ce+='<div class="gp-section">',ce+=`<div class="gp-section-title"> <span class="gp-section-count">${V.length}</span></div>`,ce+='<ul class="gp-post-list">',V.forEach(J=>{const ge=J.date?`<span class="gp-post-date">${J.date}</span>`:"";ce+='<li class="gp-post-item">',ce+=J.url?`<a href="${re}${J.url}" class="gp-post-link">${J.label}</a>${ge}`:`<span class="gp-post-label">${J.label}</span>${ge}`,ce+="</li>"}),ce+="</ul></div>"),X.length>0){const J=["category","subcategory","series","tag"],ge={category:"",subcategory:"",series:"",tag:""},xe={};X.forEach(Fe=>{xe[Fe.type]||(xe[Fe.type]=[]),xe[Fe.type].push(Fe)}),ce+='<div class="gp-section">',ce+=`<div class="gp-section-title"> <span class="gp-section-count">${X.length}</span></div>`,J.forEach(Fe=>{!xe[Fe]||xe[Fe].length===0||(ce+='<div class="gp-conn-group">',ce+=`<span class="gp-conn-group-label gp-type--${Fe}">${ge[Fe]}</span>`,ce+='<div class="gp-tags">',xe[Fe].forEach(Fn=>{ce+=`<span class="gp-tag gp-tag--${Fn.type}" data-node-id="${Fn.id}">${Fn.label}</span>`}),ce+="</div></div>")}),ce+="</div>"}ce+="</div>";let Ve="";y.nodeType==="post"&&y.url&&(Ve=`<div class="gp-panel-footer"><a class="gp-open-btn" href="${re}${y.url}"> <svg class="gp-open-btn-icon" viewBox="0 0 16 16" fill="none" width="13" height="13"><path d="M3 8h10M9 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a></div>`),P.innerHTML=me+ce+Ve,U.classList.add("is-open"),P.querySelectorAll(".gp-tag[data-node-id]").forEach(J=>{J.addEventListener("click",()=>{const ge=J.dataset.nodeId;f.hasNode(ge)&&(L(ge),q(ge,f.getNodeAttributes(ge)))})}),S.refresh()}function Z(){U==null||U.classList.remove("is-open"),h.selectedNode=null,S.refresh()}T==null||T.addEventListener("click",Z);function L(_){if(!f.hasNode(_))return;const y=f.getNodeAttribute(_,"x"),N=f.getNodeAttribute(_,"y");if(y==null||N==null)return;const{x:M,y:V}=S.graphToViewport({x:y,y:N});S.getCamera().animate(S.viewportToFramedGraph({x:M,y:V}),{duration:500})}S.on("clickNode",({node:_})=>{I(),q(_,f.getNodeAttributes(_))}),S.on("clickStage",()=>{Z(),I(),te()}),S.on("enterNode",({node:_,event:y})=>{h.hoveredNode=_,r.style.cursor="pointer",C(_,f.getNodeAttributes(_),y),S.refresh()}),S.on("leaveNode",()=>{h.hoveredNode=null,r.style.cursor="default",I(),S.refresh()});function R(){f.nodes().forEach(_=>{f.setNodeAttribute(_,"hidden",!c[f.getNodeAttribute(_,"nodeType")])}),f.edges().forEach(_=>{const[y,N]=f.extremities(_),M=f.getNodeAttribute(y,"hidden")||f.getNodeAttribute(N,"hidden");f.setEdgeAttribute(_,"hidden",M)}),S.refresh()}document.querySelectorAll(".graph-filter-cb").forEach(_=>{const y=_.dataset.type;_.checked=c[y]??!1,_.addEventListener("change",N=>{c[y]=N.target.checked,R()})}),R();let z=null,j=!1;const H={};f.nodes().forEach(_=>{if(f.getNodeAttribute(_,"nodeType")==="post"){const y=f.neighbors(_).filter(N=>f.getNodeAttribute(N,"nodeType")==="tag").map(N=>f.getNodeAttribute(N,"label"));H[_]=y.join(" ")}});const Q={},ne=((we=document.querySelector('meta[name="site-url"]'))==null?void 0:we.content)||"/sonblog/";function O(_){return _?_.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim():""}(async function(){try{let y={};try{(await(await fetch(ne+"search/search_index.json")).json()).docs.forEach(V=>{const X=(V.location||"").split("#")[0];X&&(y[X]||(y[X]=""),y[X]+=" "+O(V.text||""))})}catch(N){console.warn("graph-viz: search_index.json  , label  ",N)}f.nodes().forEach(N=>{const M=f.getNodeAttributes(N);if(M.nodeType==="post"&&M.url){const V=(M.url||"").replace(/^\//,"").replace(/^sonblog\//,"");Q[N]=(y[V]||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim()}}),z=Ac({schema:{nodeId:"string",label:"string",nodeType:"string",content:"string",tags:"string",series:"string"}});for(const N of f.nodes()){const M=f.getNodeAttributes(N);let V="";if(M.nodeType==="post"&&M.url){const X=(M.url||"").replace(/^\//,"").replace(/^sonblog\//,"");V=(y[X]||"").trim().slice(0,2e3)}Cc(z,{nodeId:N,label:M.label||"",nodeType:M.nodeType||"",content:V,tags:H[N]||"",series:M.series||""})}j=!0,console.log("graph-viz: Orama BM25    ("+f.order+" nodes)")}catch(y){console.error("graph-viz: Orama   ",y)}})();const ie=document.getElementById("graph-search"),oe=document.getElementById("graph-search-clear");function ae(_){if(h.searchQuery=_,h.searchMatches.clear(),_&&j&&z){const y=Jc(z,{term:_,limit:20,boost:{label:3,tags:2,series:1.5,content:1}});y.hits.forEach(N=>{const M=N.document.nodeId;f.hasNode(M)&&h.searchMatches.add(M)}),Te(y.hits)}else if(_&&!j){const y=_.toLowerCase();f.nodes().forEach(N=>{(f.getNodeAttribute(N,"label")||"").toLowerCase().includes(y)&&h.searchMatches.add(N)}),Te(null)}else te();oe&&(oe.style.display=_?"flex":"none"),S.refresh()}const he={category:"",subcategory:"",series:"",tag:"",post:""};function Te(_){let y=document.getElementById("graph-search-dropdown");if(!y){y=document.createElement("div"),y.id="graph-search-dropdown",y.className="graph-search-dropdown";const N=document.querySelector(".graph-search-wrap");N&&N.appendChild(y)}if(_===null){const N=[...h.searchMatches].slice(0,10);if(N.length===0){y.innerHTML='<div class="gsd-empty"> </div>',y.classList.add("is-visible");return}y.innerHTML=N.map(M=>{const V=f.getNodeAttributes(M);return`<div class="gsd-item" data-node-id="${M}">
          <span class="gsd-type gsd-type--${V.nodeType}">${he[V.nodeType]||V.nodeType}</span>
          <span class="gsd-label">${V.label}</span>
        </div>`}).join(""),y.classList.add("is-visible"),fe(y);return}if(!_||_.length===0){y.innerHTML='<div class="gsd-empty"> </div>',y.classList.add("is-visible");return}y.innerHTML=_.slice(0,10).map(N=>{const M=N.document;N.score.toFixed(2);const V=f.hasNode(M.nodeId)?f.getNodeAttributes(M.nodeId):{},X=f.hasNode(M.nodeId)?f.degree(M.nodeId):0;let re="";if(M.nodeType==="post"){const de=[];if(V.date&&de.push(V.date),V.series&&de.push(V.series),de.length&&(re+=`<span class="gsd-meta">${de.join("  ")}</span>`),M.content){const me=M.content.slice(0,80).replace(/\s+/g," ").trim();re+=`<span class="gsd-teaser">${me}${M.content.length>80?"...":""}</span>`}if(M.tags){const me=M.tags.split(" ").filter(Boolean).slice(0,5);me.length&&(re+=`<span class="gsd-tags">${me.map(Oe=>`<span class="gsd-tag">${Oe}</span>`).join("")}</span>`)}}else re+=`<span class="gsd-meta">${X} </span>`;return`<div class="gsd-item" data-node-id="${M.nodeId}">
        <div class="gsd-item-head">
          <span class="gsd-type gsd-type--${M.nodeType}">${he[M.nodeType]||M.nodeType}</span>
          <span class="gsd-label">${M.label}</span>
        </div>
        ${re?`<div class="gsd-item-body">${re}</div>`:""}
      </div>`}).join(""),y.classList.add("is-visible"),fe(y)}function fe(_){_.querySelectorAll(".gsd-item").forEach(y=>{y.addEventListener("click",()=>{const N=y.dataset.nodeId;f.hasNode(N)&&(L(N),q(N,f.getNodeAttributes(N))),te()})})}function te(){const _=document.getElementById("graph-search-dropdown");_&&_.classList.remove("is-visible")}let Y=null;ie==null||ie.addEventListener("input",_=>{clearTimeout(Y);const y=_.target.value.trim();Y=setTimeout(()=>ae(y),120)}),oe&&(oe.style.display="none",oe.addEventListener("click",()=>{ie.value="",ae(""),te()})),document.addEventListener("click",_=>{_.target.closest(".graph-search-wrap")||te()}),(B=document.getElementById("graph-reset"))==null||B.addEventListener("click",()=>{S.getCamera().animatedReset()});const ee=document.getElementById("graph-stats");if(ee){const _=e.metadata||{};ee.textContent=`${_.total_posts||0} posts  ${_.total_tags||0} tags  ${_.total_categories||0} categories`}zt=S,console.log(`graph-viz: ${f.order} nodes, ${f.size} edges [${n?"dark":"light"}]`)}window.initGraphViz=Gn,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Gn):Gn()})();
