문서 전처리 단계는 RAG 시스템에서 실제 검색에 사용될 문서들을 가공하여, 검색과 생성에 최적화된 형태로 변환하는 과정이다. 효과적인 전처리는 검색 정확도를 높이고, 관련성 있는 정보를 더 잘 추출할 수 있게 도우며, 궁극적으로 생성 모델의 응답 품질을 향상시킨다.

문서 전처리 과정은 여러 단계로 구성되는데, 그 중 핵심적인 단계가 청킹(chunking), 즉 문서 분할 단계이다. 문서 분할은 긴 문서를 더 작고 관리하기 쉬운 단위로 나누는 과정이다.

효과적인 분할 방식은 관련 정보 정보의 검색 정확도를 높이고, 문맥의 일관성을 유지하는 데 도움을 준다. 또한 생성 모델이 처리해야 할 컨텍스트 양을 적절히 조절하여 응답 생성의 품질을 향상 시킬 수 있다.

가장 기본적인 문서 분할 방식은 **문자 수 기반 분할**(character splitting)이다.
이는 문서를 단순히 일정 길이의 문자 단위로 나누는 방식으로, 구현이 간단하고 빠르다는 장점이 있다. 
하지만 문장이나 단락의 의미적 구조를 고려하지 않기 때문에, 중요한 정보가 분할되어 검색 시 누락되거나 문맥이 왜곡될 수 있다는 단점이 있다. 또한 고정된 길이로 분할하기 때문에 문서의 내용과 구조에 따른 최적화가 어려울 수 있다.

## 부모-자식 분할

재귀적 문자 텍스트 분할 방식은 문서의 구조를 고려하여 분할하지만, 의미를 고려하지 않고 기계적인 규칙에 따라 텍스트를 분할하기 때문에 연관된 내용이 분리되어 문맥이 끊길 수 있는 문제가 있다. 

또한 의미 기반 분할은 텍스트의 의미적 연관성을 고려하여 일관된 청크를 생성하는 데 효과적이지만, 긴 문서나 복잡한 주제를 다룰 때 문서의 전체적인 구조와 계층적 관계를 완벽하게 포착하기에는 한계가 있다.

이러한 한계를 보완하고 문서의 구조적 정보를 더 잘 활용하기 위한 방법으로 부모-자식 분할이 있다.
이 방법은 가족 관계에서 부모와 자식이 연결되어 있듯이, 문서의 계층 구조를 유지하면서도 세부적인 내용까지 보존하는 접근 방식이다.

부모-자식 분할은 다음과 같은 핵심 개념으로 바탕으로 한다.

먼저, 문서를 계층적으로 분할하여 원본 문서를 큰 단위의 '부모 문서' 로 나누고, 이를 다시 작은 단위의 '자식 문서'로 세분화 한다. 이렇게 원본 문서 -> 부모 문서 -> 자식 문서의 3단계 구조를 형성하는데, 이는 마치 가계도에서 조부모, 부모, 