var lh=Object.defineProperty;var dh=(Ae,fe,xe)=>fe in Ae?lh(Ae,fe,{enumerable:!0,configurable:!0,writable:!0,value:xe}):Ae[fe]=xe;var ee=(Ae,fe,xe)=>dh(Ae,typeof fe!="symbol"?fe+"":fe,xe);(function(){"use strict";function Ae(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var fe={exports:{}},xe;function Kr(){if(xe)return fe.exports;xe=1;var i=typeof Reflect=="object"?Reflect:null,t=i&&typeof i.apply=="function"?i.apply:function(S,E,_){return Function.prototype.apply.call(S,E,_)},n;i&&typeof i.ownKeys=="function"?n=i.ownKeys:Object.getOwnPropertySymbols?n=function(S){return Object.getOwnPropertyNames(S).concat(Object.getOwnPropertySymbols(S))}:n=function(S){return Object.getOwnPropertyNames(S)};function e(g){console&&console.warn&&console.warn(g)}var r=Number.isNaN||function(S){return S!==S};function o(){o.init.call(this)}fe.exports=o,fe.exports.once=y,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(g){if(typeof g!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof g)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(g){if(typeof g!="number"||g<0||r(g))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+g+".");s=g}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(S){if(typeof S!="number"||S<0||r(S))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+S+".");return this._maxListeners=S,this};function u(g){return g._maxListeners===void 0?o.defaultMaxListeners:g._maxListeners}o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(S){for(var E=[],_=1;_<arguments.length;_++)E.push(arguments[_]);var A=S==="error",R=this._events;if(R!==void 0)A=A&&R.error===void 0;else if(!A)return!1;if(A){var L;if(E.length>0&&(L=E[0]),L instanceof Error)throw L;var z=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw z.context=L,z}var N=R[S];if(N===void 0)return!1;if(typeof N=="function")t(N,this,E);else for(var T=N.length,V=p(N,T),_=0;_<T;++_)t(V[_],this,E);return!0};function c(g,S,E,_){var A,R,L;if(a(E),R=g._events,R===void 0?(R=g._events=Object.create(null),g._eventsCount=0):(R.newListener!==void 0&&(g.emit("newListener",S,E.listener?E.listener:E),R=g._events),L=R[S]),L===void 0)L=R[S]=E,++g._eventsCount;else if(typeof L=="function"?L=R[S]=_?[E,L]:[L,E]:_?L.unshift(E):L.push(E),A=u(g),A>0&&L.length>A&&!L.warned){L.warned=!0;var z=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(S)+" listeners added. Use emitter.setMaxListeners() to increase limit");z.name="MaxListenersExceededWarning",z.emitter=g,z.type=S,z.count=L.length,e(z)}return g}o.prototype.addListener=function(S,E){return c(this,S,E,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(S,E){return c(this,S,E,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(g,S,E){var _={fired:!1,wrapFn:void 0,target:g,type:S,listener:E},A=h.bind(_);return A.listener=E,_.wrapFn=A,A}o.prototype.once=function(S,E){return a(E),this.on(S,l(this,S,E)),this},o.prototype.prependOnceListener=function(S,E){return a(E),this.prependListener(S,l(this,S,E)),this},o.prototype.removeListener=function(S,E){var _,A,R,L,z;if(a(E),A=this._events,A===void 0)return this;if(_=A[S],_===void 0)return this;if(_===E||_.listener===E)--this._eventsCount===0?this._events=Object.create(null):(delete A[S],A.removeListener&&this.emit("removeListener",S,_.listener||E));else if(typeof _!="function"){for(R=-1,L=_.length-1;L>=0;L--)if(_[L]===E||_[L].listener===E){z=_[L].listener,R=L;break}if(R<0)return this;R===0?_.shift():b(_,R),_.length===1&&(A[S]=_[0]),A.removeListener!==void 0&&this.emit("removeListener",S,z||E)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(S){var E,_,A;if(_=this._events,_===void 0)return this;if(_.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):_[S]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete _[S]),this;if(arguments.length===0){var R=Object.keys(_),L;for(A=0;A<R.length;++A)L=R[A],L!=="removeListener"&&this.removeAllListeners(L);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(E=_[S],typeof E=="function")this.removeListener(S,E);else if(E!==void 0)for(A=E.length-1;A>=0;A--)this.removeListener(S,E[A]);return this};function d(g,S,E){var _=g._events;if(_===void 0)return[];var A=_[S];return A===void 0?[]:typeof A=="function"?E?[A.listener||A]:[A]:E?v(A):p(A,A.length)}o.prototype.listeners=function(S){return d(this,S,!0)},o.prototype.rawListeners=function(S){return d(this,S,!1)},o.listenerCount=function(g,S){return typeof g.listenerCount=="function"?g.listenerCount(S):f.call(g,S)},o.prototype.listenerCount=f;function f(g){var S=this._events;if(S!==void 0){var E=S[g];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function p(g,S){for(var E=new Array(S),_=0;_<S;++_)E[_]=g[_];return E}function b(g,S){for(;S+1<g.length;S++)g[S]=g[S+1];g.pop()}function v(g){for(var S=new Array(g.length),E=0;E<S.length;++E)S[E]=g[E].listener||g[E];return S}function y(g,S){return new Promise(function(E,_){function A(L){g.removeListener(S,R),_(L)}function R(){typeof g.removeListener=="function"&&g.removeListener("error",A),E([].slice.call(arguments))}m(g,S,R,{once:!0}),S!=="error"&&w(g,A,{once:!0})})}function w(g,S,E){typeof g.on=="function"&&m(g,"error",S,E)}function m(g,S,E,_){if(typeof g.on=="function")_.once?g.once(S,E):g.on(S,E);else if(typeof g.addEventListener=="function")g.addEventListener(S,function A(R){_.once&&g.removeEventListener(S,A),E(R)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof g)}return fe.exports}var Fn=Kr();function Xr(){const i=arguments[0];for(let t=1,n=arguments.length;t<n;t++)if(arguments[t])for(const e in arguments[t])i[e]=arguments[t][e];return i}let ie=Xr;typeof Object.assign=="function"&&(ie=Object.assign);function ge(i,t,n,e){const r=i._nodes.get(t);let o=null;return r&&(e==="mixed"?o=r.out&&r.out[n]||r.undirected&&r.undirected[n]:e==="directed"?o=r.out&&r.out[n]:o=r.undirected&&r.undirected[n]),o}function oe(i){return typeof i=="object"&&i!==null}function zn(i){let t;for(t in i)return!1;return!0}function pe(i,t,n){Object.defineProperty(i,t,{enumerable:!1,configurable:!1,writable:!0,value:n})}function be(i,t,n){const e={enumerable:!0,configurable:!0};typeof n=="function"?e.get=n:(e.value=n,e.writable=!1),Object.defineProperty(i,t,e)}function Mn(i){return!(!oe(i)||i.attributes&&!Array.isArray(i.attributes))}function Zr(){let i=Math.floor(Math.random()*256)&255;return()=>i++}function De(){const i=arguments;let t=null,n=-1;return{[Symbol.iterator](){return this},next(){let e=null;do{if(t===null){if(n++,n>=i.length)return{done:!0};t=i[n][Symbol.iterator]()}if(e=t.next(),e.done){t=null;continue}break}while(!0);return e}}}function Me(){return{[Symbol.iterator](){return this},next(){return{done:!0}}}}class zt extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class O extends zt{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,O.prototype.constructor)}}class P extends zt{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,P.prototype.constructor)}}class $ extends zt{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,$.prototype.constructor)}}function Un(i,t){this.key=i,this.attributes=t,this.clear()}Un.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function $n(i,t){this.key=i,this.attributes=t,this.clear()}$n.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function Bn(i,t){this.key=i,this.attributes=t,this.clear()}Bn.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function Ue(i,t,n,e,r){this.key=t,this.attributes=r,this.undirected=i,this.source=n,this.target=e}Ue.prototype.attach=function(){let i="out",t="in";this.undirected&&(i=t="undirected");const n=this.source.key,e=this.target.key;this.source[i][e]=this,!(this.undirected&&n===e)&&(this.target[t][n]=this)},Ue.prototype.attachMulti=function(){let i="out",t="in";const n=this.source.key,e=this.target.key;this.undirected&&(i=t="undirected");const r=this.source[i],o=r[e];if(typeof o>"u"){r[e]=this,this.undirected&&n===e||(this.target[t][n]=this);return}o.previous=this,this.next=o,r[e]=this,this.target[t][n]=this},Ue.prototype.detach=function(){const i=this.source.key,t=this.target.key;let n="out",e="in";this.undirected&&(n=e="undirected"),delete this.source[n][t],delete this.target[e][i]},Ue.prototype.detachMulti=function(){const i=this.source.key,t=this.target.key;let n="out",e="in";this.undirected&&(n=e="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[n][t],delete this.target[e][i]):(this.next.previous=void 0,this.source[n][t]=this.next,this.target[e][i]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const Wn=0,Hn=1,Jr=2,jn=3;function Re(i,t,n,e,r,o,s){let a,u,c,h;if(e=""+e,n===Wn){if(a=i._nodes.get(e),!a)throw new P(`Graph.${t}: could not find the "${e}" node in the graph.`);c=r,h=o}else if(n===jn){if(r=""+r,u=i._edges.get(r),!u)throw new P(`Graph.${t}: could not find the "${r}" edge in the graph.`);const l=u.source.key,d=u.target.key;if(e===l)a=u.target;else if(e===d)a=u.source;else throw new P(`Graph.${t}: the "${e}" node is not attached to the "${r}" edge (${l}, ${d}).`);c=o,h=s}else{if(u=i._edges.get(e),!u)throw new P(`Graph.${t}: could not find the "${e}" edge in the graph.`);n===Hn?a=u.source:a=u.target,c=r,h=o}return[a,c,h]}function Qr(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=Re(this,t,n,e,r,o);return s.attributes[a]}}function eo(i,t,n){i.prototype[t]=function(e,r){const[o]=Re(this,t,n,e,r);return o.attributes}}function to(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=Re(this,t,n,e,r,o);return s.attributes.hasOwnProperty(a)}}function no(i,t,n){i.prototype[t]=function(e,r,o,s){const[a,u,c]=Re(this,t,n,e,r,o,s);return a.attributes[u]=c,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:u}),this}}function io(i,t,n){i.prototype[t]=function(e,r,o,s){const[a,u,c]=Re(this,t,n,e,r,o,s);if(typeof c!="function")throw new O(`Graph.${t}: updater should be a function.`);const h=a.attributes,l=c(h[u]);return h[u]=l,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:u}),this}}function ro(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=Re(this,t,n,e,r,o);return delete s.attributes[a],this.emit("nodeAttributesUpdated",{key:s.key,type:"remove",attributes:s.attributes,name:a}),this}}function oo(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=Re(this,t,n,e,r,o);if(!oe(a))throw new O(`Graph.${t}: provided attributes are not a plain object.`);return s.attributes=a,this.emit("nodeAttributesUpdated",{key:s.key,type:"replace",attributes:s.attributes}),this}}function so(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=Re(this,t,n,e,r,o);if(!oe(a))throw new O(`Graph.${t}: provided attributes are not a plain object.`);return ie(s.attributes,a),this.emit("nodeAttributesUpdated",{key:s.key,type:"merge",attributes:s.attributes,data:a}),this}}function ao(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=Re(this,t,n,e,r,o);if(typeof a!="function")throw new O(`Graph.${t}: provided updater is not a function.`);return s.attributes=a(s.attributes),this.emit("nodeAttributesUpdated",{key:s.key,type:"update",attributes:s.attributes}),this}}const uo=[{name:i=>`get${i}Attribute`,attacher:Qr},{name:i=>`get${i}Attributes`,attacher:eo},{name:i=>`has${i}Attribute`,attacher:to},{name:i=>`set${i}Attribute`,attacher:no},{name:i=>`update${i}Attribute`,attacher:io},{name:i=>`remove${i}Attribute`,attacher:ro},{name:i=>`replace${i}Attributes`,attacher:oo},{name:i=>`merge${i}Attributes`,attacher:so},{name:i=>`update${i}Attributes`,attacher:ao}];function co(i){uo.forEach(function({name:t,attacher:n}){n(i,t("Node"),Wn),n(i,t("Source"),Hn),n(i,t("Target"),Jr),n(i,t("Opposite"),jn)})}function ho(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new $(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new $(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=ge(this,s,a,n),!o)throw new P(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new $(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new P(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return o.attributes[r]}}function lo(i,t,n){i.prototype[t]=function(e){let r;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new $(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new $(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+e,s=""+arguments[1];if(r=ge(this,o,s,n),!r)throw new P(`Graph.${t}: could not find an edge for the given path ("${o}" - "${s}").`)}else{if(n!=="mixed")throw new $(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,r=this._edges.get(e),!r)throw new P(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return r.attributes}}function fo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new $(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new $(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=ge(this,s,a,n),!o)throw new P(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new $(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new P(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return o.attributes.hasOwnProperty(r)}}function go(i,t,n){i.prototype[t]=function(e,r,o){let s;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new $(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new $(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+e,u=""+r;if(r=arguments[2],o=arguments[3],s=ge(this,a,u,n),!s)throw new P(`Graph.${t}: could not find an edge for the given path ("${a}" - "${u}").`)}else{if(n!=="mixed")throw new $(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,s=this._edges.get(e),!s)throw new P(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return s.attributes[r]=o,this.emit("edgeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:r}),this}}function po(i,t,n){i.prototype[t]=function(e,r,o){let s;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new $(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new $(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+e,u=""+r;if(r=arguments[2],o=arguments[3],s=ge(this,a,u,n),!s)throw new P(`Graph.${t}: could not find an edge for the given path ("${a}" - "${u}").`)}else{if(n!=="mixed")throw new $(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,s=this._edges.get(e),!s)throw new P(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(typeof o!="function")throw new O(`Graph.${t}: updater should be a function.`);return s.attributes[r]=o(s.attributes[r]),this.emit("edgeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:r}),this}}function mo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new $(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new $(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=ge(this,s,a,n),!o)throw new P(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new $(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new P(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return delete o.attributes[r],this.emit("edgeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:r}),this}}function vo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new $(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new $(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=ge(this,s,a,n),!o)throw new P(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new $(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new P(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(!oe(r))throw new O(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=r,this.emit("edgeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function yo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new $(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new $(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=ge(this,s,a,n),!o)throw new P(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new $(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new P(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(!oe(r))throw new O(`Graph.${t}: provided attributes are not a plain object.`);return ie(o.attributes,r),this.emit("edgeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:r}),this}}function bo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new $(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new $(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=ge(this,s,a,n),!o)throw new P(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new $(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new P(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(typeof r!="function")throw new O(`Graph.${t}: provided updater is not a function.`);return o.attributes=r(o.attributes),this.emit("edgeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const wo=[{name:i=>`get${i}Attribute`,attacher:ho},{name:i=>`get${i}Attributes`,attacher:lo},{name:i=>`has${i}Attribute`,attacher:fo},{name:i=>`set${i}Attribute`,attacher:go},{name:i=>`update${i}Attribute`,attacher:po},{name:i=>`remove${i}Attribute`,attacher:mo},{name:i=>`replace${i}Attributes`,attacher:vo},{name:i=>`merge${i}Attributes`,attacher:yo},{name:i=>`update${i}Attributes`,attacher:bo}];function Eo(i){wo.forEach(function({name:t,attacher:n}){n(i,t("Edge"),"mixed"),n(i,t("DirectedEdge"),"directed"),n(i,t("UndirectedEdge"),"undirected")})}const So=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function To(i,t,n,e){let r=!1;for(const o in t){if(o===e)continue;const s=t[o];if(r=n(s.key,s.attributes,s.source.key,s.target.key,s.source.attributes,s.target.attributes,s.undirected),i&&r)return s.key}}function _o(i,t,n,e){let r,o,s,a=!1;for(const u in t)if(u!==e){r=t[u];do{if(o=r.source,s=r.target,a=n(r.key,r.attributes,o.key,s.key,o.attributes,s.attributes,r.undirected),i&&a)return r.key;r=r.next}while(r!==void 0)}}function Mt(i,t){const n=Object.keys(i),e=n.length;let r,o=0;return{[Symbol.iterator](){return this},next(){do if(r)r=r.next;else{if(o>=e)return{done:!0};const s=n[o++];if(s===t){r=void 0;continue}r=i[s]}while(!r);return{done:!1,value:{edge:r.key,attributes:r.attributes,source:r.source.key,target:r.target.key,sourceAttributes:r.source.attributes,targetAttributes:r.target.attributes,undirected:r.undirected}}}}}function Ao(i,t,n,e){const r=t[n];if(!r)return;const o=r.source,s=r.target;if(e(r.key,r.attributes,o.key,s.key,o.attributes,s.attributes,r.undirected)&&i)return r.key}function Do(i,t,n,e){let r=t[n];if(!r)return;let o=!1;do{if(o=e(r.key,r.attributes,r.source.key,r.target.key,r.source.attributes,r.target.attributes,r.undirected),i&&o)return r.key;r=r.next}while(r!==void 0)}function Ut(i,t){let n=i[t];if(n.next!==void 0)return{[Symbol.iterator](){return this},next(){if(!n)return{done:!0};const r={edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected};return n=n.next,{done:!1,value:r}}};let e=!1;return{[Symbol.iterator](){return this},next(){return e===!0?{done:!0}:(e=!0,{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}})}}}function Ro(i,t){if(i.size===0)return[];if(t==="mixed"||t===i.type)return Array.from(i._edges.keys());const n=t==="undirected"?i.undirectedSize:i.directedSize,e=new Array(n),r=t==="undirected",o=i._edges.values();let s=0,a,u;for(;a=o.next(),a.done!==!0;)u=a.value,u.undirected===r&&(e[s++]=u.key);return e}function Vn(i,t,n,e){if(t.size===0)return;const r=n!=="mixed"&&n!==t.type,o=n==="undirected";let s,a,u=!1;const c=t._edges.values();for(;s=c.next(),s.done!==!0;){if(a=s.value,r&&a.undirected!==o)continue;const{key:h,attributes:l,source:d,target:f}=a;if(u=e(h,l,d.key,f.key,d.attributes,f.attributes,a.undirected),i&&u)return h}}function Co(i,t){if(i.size===0)return Me();const n=t!=="mixed"&&t!==i.type,e=t==="undirected",r=i._edges.values();return{[Symbol.iterator](){return this},next(){let o,s;for(;;){if(o=r.next(),o.done)return o;if(s=o.value,!(n&&s.undirected!==e))break}return{value:{edge:s.key,attributes:s.attributes,source:s.source.key,target:s.target.key,sourceAttributes:s.source.attributes,targetAttributes:s.target.attributes,undirected:s.undirected},done:!1}}}}function $t(i,t,n,e,r,o){const s=t?_o:To;let a;if(n!=="undirected"&&(e!=="out"&&(a=s(i,r.in,o),i&&a)||e!=="in"&&(a=s(i,r.out,o,e?void 0:r.key),i&&a))||n!=="directed"&&(a=s(i,r.undirected,o),i&&a))return a}function Lo(i,t,n,e){const r=[];return $t(!1,i,t,n,e,function(o){r.push(o)}),r}function Io(i,t,n){let e=Me();return i!=="undirected"&&(t!=="out"&&typeof n.in<"u"&&(e=De(e,Mt(n.in))),t!=="in"&&typeof n.out<"u"&&(e=De(e,Mt(n.out,t?void 0:n.key)))),i!=="directed"&&typeof n.undirected<"u"&&(e=De(e,Mt(n.undirected))),e}function Bt(i,t,n,e,r,o,s){const a=n?Do:Ao;let u;if(t!=="undirected"&&(typeof r.in<"u"&&e!=="out"&&(u=a(i,r.in,o,s),i&&u)||typeof r.out<"u"&&e!=="in"&&(e||r.key!==o)&&(u=a(i,r.out,o,s),i&&u))||t!=="directed"&&typeof r.undirected<"u"&&(u=a(i,r.undirected,o,s),i&&u))return u}function ko(i,t,n,e,r){const o=[];return Bt(!1,i,t,n,e,r,function(s){o.push(s)}),o}function No(i,t,n,e){let r=Me();return i!=="undirected"&&(typeof n.in<"u"&&t!=="out"&&e in n.in&&(r=De(r,Ut(n.in,e))),typeof n.out<"u"&&t!=="in"&&e in n.out&&(t||n.key!==e)&&(r=De(r,Ut(n.out,e)))),i!=="directed"&&typeof n.undirected<"u"&&e in n.undirected&&(r=De(r,Ut(n.undirected,e))),r}function xo(i,t){const{name:n,type:e,direction:r}=t;i.prototype[n]=function(o,s){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return[];if(!arguments.length)return Ro(this,e);if(arguments.length===1){o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new P(`Graph.${n}: could not find the "${o}" node in the graph.`);return Lo(this.multi,e==="mixed"?this.type:e,r,a)}if(arguments.length===2){o=""+o,s=""+s;const a=this._nodes.get(o);if(!a)throw new P(`Graph.${n}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(s))throw new P(`Graph.${n}:  could not find the "${s}" target node in the graph.`);return ko(e,this.multi,r,a,s)}throw new O(`Graph.${n}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Po(i,t){const{name:n,type:e,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);i.prototype[o]=function(c,h,l){if(!(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)){if(arguments.length===1)return l=c,Vn(!1,this,e,l);if(arguments.length===2){c=""+c,l=h;const d=this._nodes.get(c);if(typeof d>"u")throw new P(`Graph.${o}: could not find the "${c}" node in the graph.`);return $t(!1,this.multi,e==="mixed"?this.type:e,r,d,l)}if(arguments.length===3){c=""+c,h=""+h;const d=this._nodes.get(c);if(!d)throw new P(`Graph.${o}:  could not find the "${c}" source node in the graph.`);if(!this._nodes.has(h))throw new P(`Graph.${o}:  could not find the "${h}" target node in the graph.`);return Bt(!1,e,this.multi,r,d,h,l)}throw new O(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const s="map"+n[0].toUpperCase()+n.slice(1);i.prototype[s]=function(){const c=Array.prototype.slice.call(arguments),h=c.pop();let l;if(c.length===0){let d=0;e!=="directed"&&(d+=this.undirectedSize),e!=="undirected"&&(d+=this.directedSize),l=new Array(d);let f=0;c.push((p,b,v,y,w,m,g)=>{l[f++]=h(p,b,v,y,w,m,g)})}else l=[],c.push((d,f,p,b,v,y,w)=>{l.push(h(d,f,p,b,v,y,w))});return this[o].apply(this,c),l};const a="filter"+n[0].toUpperCase()+n.slice(1);i.prototype[a]=function(){const c=Array.prototype.slice.call(arguments),h=c.pop(),l=[];return c.push((d,f,p,b,v,y,w)=>{h(d,f,p,b,v,y,w)&&l.push(d)}),this[o].apply(this,c),l};const u="reduce"+n[0].toUpperCase()+n.slice(1);i.prototype[u]=function(){let c=Array.prototype.slice.call(arguments);if(c.length<2||c.length>4)throw new O(`Graph.${u}: invalid number of arguments (expecting 2, 3 or 4 and got ${c.length}).`);if(typeof c[c.length-1]=="function"&&typeof c[c.length-2]!="function")throw new O(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let h,l;c.length===2?(h=c[0],l=c[1],c=[]):c.length===3?(h=c[1],l=c[2],c=[c[0]]):c.length===4&&(h=c[2],l=c[3],c=[c[0],c[1]]);let d=l;return c.push((f,p,b,v,y,w,m)=>{d=h(d,f,p,b,v,y,w,m)}),this[o].apply(this,c),d}}function Oo(i,t){const{name:n,type:e,direction:r}=t,o="find"+n[0].toUpperCase()+n.slice(1,-1);i.prototype[o]=function(u,c,h){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return!1;if(arguments.length===1)return h=u,Vn(!0,this,e,h);if(arguments.length===2){u=""+u,h=c;const l=this._nodes.get(u);if(typeof l>"u")throw new P(`Graph.${o}: could not find the "${u}" node in the graph.`);return $t(!0,this.multi,e==="mixed"?this.type:e,r,l,h)}if(arguments.length===3){u=""+u,c=""+c;const l=this._nodes.get(u);if(!l)throw new P(`Graph.${o}:  could not find the "${u}" source node in the graph.`);if(!this._nodes.has(c))throw new P(`Graph.${o}:  could not find the "${c}" target node in the graph.`);return Bt(!0,e,this.multi,r,l,c,h)}throw new O(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const s="some"+n[0].toUpperCase()+n.slice(1,-1);i.prototype[s]=function(){const u=Array.prototype.slice.call(arguments),c=u.pop();return u.push((l,d,f,p,b,v,y)=>c(l,d,f,p,b,v,y)),!!this[o].apply(this,u)};const a="every"+n[0].toUpperCase()+n.slice(1,-1);i.prototype[a]=function(){const u=Array.prototype.slice.call(arguments),c=u.pop();return u.push((l,d,f,p,b,v,y)=>!c(l,d,f,p,b,v,y)),!this[o].apply(this,u)}}function Go(i,t){const{name:n,type:e,direction:r}=t,o=n.slice(0,-1)+"Entries";i.prototype[o]=function(s,a){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return Me();if(!arguments.length)return Co(this,e);if(arguments.length===1){s=""+s;const u=this._nodes.get(s);if(!u)throw new P(`Graph.${o}: could not find the "${s}" node in the graph.`);return Io(e,r,u)}if(arguments.length===2){s=""+s,a=""+a;const u=this._nodes.get(s);if(!u)throw new P(`Graph.${o}:  could not find the "${s}" source node in the graph.`);if(!this._nodes.has(a))throw new P(`Graph.${o}:  could not find the "${a}" target node in the graph.`);return No(e,r,u,a)}throw new O(`Graph.${o}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Fo(i){So.forEach(t=>{xo(i,t),Po(i,t),Oo(i,t),Go(i,t)})}const zo=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function ct(){this.A=null,this.B=null}ct.prototype.wrap=function(i){this.A===null?this.A=i:this.B===null&&(this.B=i)},ct.prototype.has=function(i){return this.A!==null&&i in this.A||this.B!==null&&i in this.B};function Je(i,t,n,e,r){for(const o in e){const s=e[o],a=s.source,u=s.target,c=a===n?u:a;if(t&&t.has(c.key))continue;const h=r(c.key,c.attributes);if(i&&h)return c.key}}function Wt(i,t,n,e,r){if(t!=="mixed"){if(t==="undirected")return Je(i,null,e,e.undirected,r);if(typeof n=="string")return Je(i,null,e,e[n],r)}const o=new ct;let s;if(t!=="undirected"){if(n!=="out"){if(s=Je(i,null,e,e.in,r),i&&s)return s;o.wrap(e.in)}if(n!=="in"){if(s=Je(i,o,e,e.out,r),i&&s)return s;o.wrap(e.out)}}if(t!=="directed"&&(s=Je(i,o,e,e.undirected,r),i&&s))return s}function Mo(i,t,n){if(i!=="mixed"){if(i==="undirected")return Object.keys(n.undirected);if(typeof t=="string")return Object.keys(n[t])}const e=[];return Wt(!1,i,t,n,function(r){e.push(r)}),e}function Qe(i,t,n){const e=Object.keys(n),r=e.length;let o=0;return{[Symbol.iterator](){return this},next(){let s=null;do{if(o>=r)return i&&i.wrap(n),{done:!0};const a=n[e[o++]],u=a.source,c=a.target;if(s=u===t?c:u,i&&i.has(s.key)){s=null;continue}}while(s===null);return{done:!1,value:{neighbor:s.key,attributes:s.attributes}}}}}function Uo(i,t,n){if(i!=="mixed"){if(i==="undirected")return Qe(null,n,n.undirected);if(typeof t=="string")return Qe(null,n,n[t])}let e=Me();const r=new ct;return i!=="undirected"&&(t!=="out"&&(e=De(e,Qe(r,n,n.in))),t!=="in"&&(e=De(e,Qe(r,n,n.out)))),i!=="directed"&&(e=De(e,Qe(r,n,n.undirected))),e}function $o(i,t){const{name:n,type:e,direction:r}=t;i.prototype[n]=function(o){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return[];o=""+o;const s=this._nodes.get(o);if(typeof s>"u")throw new P(`Graph.${n}: could not find the "${o}" node in the graph.`);return Mo(e==="mixed"?this.type:e,r,s)}}function Bo(i,t){const{name:n,type:e,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);i.prototype[o]=function(c,h){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return;c=""+c;const l=this._nodes.get(c);if(typeof l>"u")throw new P(`Graph.${o}: could not find the "${c}" node in the graph.`);Wt(!1,e==="mixed"?this.type:e,r,l,h)};const s="map"+n[0].toUpperCase()+n.slice(1);i.prototype[s]=function(c,h){const l=[];return this[o](c,(d,f)=>{l.push(h(d,f))}),l};const a="filter"+n[0].toUpperCase()+n.slice(1);i.prototype[a]=function(c,h){const l=[];return this[o](c,(d,f)=>{h(d,f)&&l.push(d)}),l};const u="reduce"+n[0].toUpperCase()+n.slice(1);i.prototype[u]=function(c,h,l){if(arguments.length<3)throw new O(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let d=l;return this[o](c,(f,p)=>{d=h(d,f,p)}),d}}function Wo(i,t){const{name:n,type:e,direction:r}=t,o=n[0].toUpperCase()+n.slice(1,-1),s="find"+o;i.prototype[s]=function(c,h){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return;c=""+c;const l=this._nodes.get(c);if(typeof l>"u")throw new P(`Graph.${s}: could not find the "${c}" node in the graph.`);return Wt(!0,e==="mixed"?this.type:e,r,l,h)};const a="some"+o;i.prototype[a]=function(c,h){return!!this[s](c,h)};const u="every"+o;i.prototype[u]=function(c,h){return!this[s](c,(d,f)=>!h(d,f))}}function Ho(i,t){const{name:n,type:e,direction:r}=t,o=n.slice(0,-1)+"Entries";i.prototype[o]=function(s){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return Me();s=""+s;const a=this._nodes.get(s);if(typeof a>"u")throw new P(`Graph.${o}: could not find the "${s}" node in the graph.`);return Uo(e==="mixed"?this.type:e,r,a)}}function jo(i){zo.forEach(t=>{$o(i,t),Bo(i,t),Wo(i,t),Ho(i,t)})}function ht(i,t,n,e,r){const o=e._nodes.values(),s=e.type;let a,u,c,h,l,d;for(;a=o.next(),a.done!==!0;){let f=!1;if(u=a.value,s!=="undirected"){h=u.out;for(c in h){l=h[c];do d=l.target,f=!0,r(u.key,d.key,u.attributes,d.attributes,l.key,l.attributes,l.undirected),l=l.next;while(l)}}if(s!=="directed"){h=u.undirected;for(c in h)if(!(t&&u.key>c)){l=h[c];do d=l.target,d.key!==c&&(d=l.source),f=!0,r(u.key,d.key,u.attributes,d.attributes,l.key,l.attributes,l.undirected),l=l.next;while(l)}}n&&!f&&r(u.key,null,u.attributes,null,null,null,null)}}function Vo(i,t){const n={key:i};return zn(t.attributes)||(n.attributes=ie({},t.attributes)),n}function qo(i,t,n){const e={key:t,source:n.source.key,target:n.target.key};return zn(n.attributes)||(e.attributes=ie({},n.attributes)),i==="mixed"&&n.undirected&&(e.undirected=!0),e}function Yo(i){if(!oe(i))throw new O('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in i))throw new O("Graph.import: serialized node is missing its key.");if("attributes"in i&&(!oe(i.attributes)||i.attributes===null))throw new O("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function Ko(i){if(!oe(i))throw new O('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in i))throw new O("Graph.import: serialized edge is missing its source.");if(!("target"in i))throw new O("Graph.import: serialized edge is missing its target.");if("attributes"in i&&(!oe(i.attributes)||i.attributes===null))throw new O("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in i&&typeof i.undirected!="boolean")throw new O("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const Xo=Zr(),Zo=new Set(["directed","undirected","mixed"]),qn=new Set(["domain","_events","_eventsCount","_maxListeners"]),Jo=[{name:i=>`${i}Edge`,generateKey:!0},{name:i=>`${i}DirectedEdge`,generateKey:!0,type:"directed"},{name:i=>`${i}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:i=>`${i}EdgeWithKey`},{name:i=>`${i}DirectedEdgeWithKey`,type:"directed"},{name:i=>`${i}UndirectedEdgeWithKey`,type:"undirected"}],Qo={allowSelfLoops:!0,multi:!1,type:"mixed"};function es(i,t,n){if(n&&!oe(n))throw new O(`Graph.addNode: invalid attributes. Expecting an object but got "${n}"`);if(t=""+t,n=n||{},i._nodes.has(t))throw new $(`Graph.addNode: the "${t}" node already exist in the graph.`);const e=new i.NodeDataClass(t,n);return i._nodes.set(t,e),i.emit("nodeAdded",{key:t,attributes:n}),e}function Yn(i,t,n){const e=new i.NodeDataClass(t,n);return i._nodes.set(t,e),i.emit("nodeAdded",{key:t,attributes:n}),e}function Kn(i,t,n,e,r,o,s,a){if(!e&&i.type==="undirected")throw new $(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(e&&i.type==="directed")throw new $(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(a&&!oe(a))throw new O(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`);if(o=""+o,s=""+s,a=a||{},!i.allowSelfLoops&&o===s)throw new $(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const u=i._nodes.get(o),c=i._nodes.get(s);if(!u)throw new P(`Graph.${t}: source node "${o}" not found.`);if(!c)throw new P(`Graph.${t}: target node "${s}" not found.`);const h={key:null,undirected:e,source:o,target:s,attributes:a};if(n)r=i._edgeKeyGenerator();else if(r=""+r,i._edges.has(r))throw new $(`Graph.${t}: the "${r}" edge already exists in the graph.`);if(!i.multi&&(e?typeof u.undirected[s]<"u":typeof u.out[s]<"u"))throw new $(`Graph.${t}: an edge linking "${o}" to "${s}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const l=new Ue(e,r,u,c,a);i._edges.set(r,l);const d=o===s;return e?(u.undirectedDegree++,c.undirectedDegree++,d&&(u.undirectedLoops++,i._undirectedSelfLoopCount++)):(u.outDegree++,c.inDegree++,d&&(u.directedLoops++,i._directedSelfLoopCount++)),i.multi?l.attachMulti():l.attach(),e?i._undirectedSize++:i._directedSize++,h.key=r,i.emit("edgeAdded",h),r}function ts(i,t,n,e,r,o,s,a,u){if(!e&&i.type==="undirected")throw new $(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(e&&i.type==="directed")throw new $(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(a){if(u){if(typeof a!="function")throw new O(`Graph.${t}: invalid updater function. Expecting a function but got "${a}"`)}else if(!oe(a))throw new O(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`)}o=""+o,s=""+s;let c;if(u&&(c=a,a=void 0),!i.allowSelfLoops&&o===s)throw new $(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let h=i._nodes.get(o),l=i._nodes.get(s),d,f;if(!n&&(d=i._edges.get(r),d)){if((d.source.key!==o||d.target.key!==s)&&(!e||d.source.key!==s||d.target.key!==o))throw new $(`Graph.${t}: inconsistency detected when attempting to merge the "${r}" edge with "${o}" source & "${s}" target vs. ("${d.source.key}", "${d.target.key}").`);f=d}if(!f&&!i.multi&&h&&(f=e?h.undirected[s]:h.out[s]),f){const w=[f.key,!1,!1,!1];if(u?!c:!a)return w;if(u){const m=f.attributes;f.attributes=c(m),i.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else ie(f.attributes,a),i.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:a});return w}a=a||{},u&&c&&(a=c(a));const p={key:null,undirected:e,source:o,target:s,attributes:a};if(n)r=i._edgeKeyGenerator();else if(r=""+r,i._edges.has(r))throw new $(`Graph.${t}: the "${r}" edge already exists in the graph.`);let b=!1,v=!1;h||(h=Yn(i,o,{}),b=!0,o===s&&(l=h,v=!0)),l||(l=Yn(i,s,{}),v=!0),d=new Ue(e,r,h,l,a),i._edges.set(r,d);const y=o===s;return e?(h.undirectedDegree++,l.undirectedDegree++,y&&(h.undirectedLoops++,i._undirectedSelfLoopCount++)):(h.outDegree++,l.inDegree++,y&&(h.directedLoops++,i._directedSelfLoopCount++)),i.multi?d.attachMulti():d.attach(),e?i._undirectedSize++:i._directedSize++,p.key=r,i.emit("edgeAdded",p),[r,!0,b,v]}function $e(i,t){i._edges.delete(t.key);const{source:n,target:e,attributes:r}=t,o=t.undirected,s=n===e;o?(n.undirectedDegree--,e.undirectedDegree--,s&&(n.undirectedLoops--,i._undirectedSelfLoopCount--)):(n.outDegree--,e.inDegree--,s&&(n.directedLoops--,i._directedSelfLoopCount--)),i.multi?t.detachMulti():t.detach(),o?i._undirectedSize--:i._directedSize--,i.emit("edgeDropped",{key:t.key,attributes:r,source:n.key,target:e.key,undirected:o})}class J extends Fn.EventEmitter{constructor(t){if(super(),t=ie({},Qo,t),typeof t.multi!="boolean")throw new O(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!Zo.has(t.type))throw new O(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new O(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const n=t.type==="mixed"?Un:t.type==="directed"?$n:Bn;pe(this,"NodeDataClass",n);const e="geid_"+Xo()+"_";let r=0;const o=()=>{let s;do s=e+r++;while(this._edges.has(s));return s};pe(this,"_attributes",{}),pe(this,"_nodes",new Map),pe(this,"_edges",new Map),pe(this,"_directedSize",0),pe(this,"_undirectedSize",0),pe(this,"_directedSelfLoopCount",0),pe(this,"_undirectedSelfLoopCount",0),pe(this,"_edgeKeyGenerator",o),pe(this,"_options",t),qn.forEach(s=>pe(this,s,this[s])),be(this,"order",()=>this._nodes.size),be(this,"size",()=>this._edges.size),be(this,"directedSize",()=>this._directedSize),be(this,"undirectedSize",()=>this._undirectedSize),be(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),be(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),be(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),be(this,"multi",this._options.multi),be(this,"type",this._options.type),be(this,"allowSelfLoops",this._options.allowSelfLoops),be(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,n){if(this.type==="undirected")return!1;if(arguments.length===1){const e=""+t,r=this._edges.get(e);return!!r&&!r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const e=this._nodes.get(t);return e?e.out.hasOwnProperty(n):!1}throw new O(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,n){if(this.type==="directed")return!1;if(arguments.length===1){const e=""+t,r=this._edges.get(e);return!!r&&r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const e=this._nodes.get(t);return e?e.undirected.hasOwnProperty(n):!1}throw new O(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,n){if(arguments.length===1){const e=""+t;return this._edges.has(e)}else if(arguments.length===2){t=""+t,n=""+n;const e=this._nodes.get(t);return e?typeof e.out<"u"&&e.out.hasOwnProperty(n)||typeof e.undirected<"u"&&e.undirected.hasOwnProperty(n):!1}throw new O(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,n){if(this.type==="undirected")return;if(t=""+t,n=""+n,this.multi)throw new $("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const e=this._nodes.get(t);if(!e)throw new P(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new P(`Graph.directedEdge: could not find the "${n}" target node in the graph.`);const r=e.out&&e.out[n]||void 0;if(r)return r.key}undirectedEdge(t,n){if(this.type==="directed")return;if(t=""+t,n=""+n,this.multi)throw new $("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const e=this._nodes.get(t);if(!e)throw new P(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new P(`Graph.undirectedEdge: could not find the "${n}" target node in the graph.`);const r=e.undirected&&e.undirected[n]||void 0;if(r)return r.key}edge(t,n){if(this.multi)throw new $("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new P(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new P(`Graph.edge: could not find the "${n}" target node in the graph.`);const r=e.out&&e.out[n]||e.undirected&&e.undirected[n]||void 0;if(r)return r.key}areDirectedNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new P(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in e.in||n in e.out}areOutNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new P(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in e.out}areInNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new P(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in e.in}areUndirectedNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new P(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:n in e.undirected}areNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new P(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(n in e.in||n in e.out)||this.type!=="directed"&&n in e.undirected}areInboundNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new P(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in e.in||this.type!=="directed"&&n in e.undirected}areOutboundNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new P(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in e.out||this.type!=="directed"&&n in e.undirected}inDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree}outDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree}directedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree}undirectedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree}inboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let e=0;return this.type!=="directed"&&(e+=n.undirectedDegree),this.type!=="undirected"&&(e+=n.inDegree),e}outboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let e=0;return this.type!=="directed"&&(e+=n.undirectedDegree),this.type!=="undirected"&&(e+=n.outDegree),e}degree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.degree: could not find the "${t}" node in the graph.`);let e=0;return this.type!=="directed"&&(e+=n.undirectedDegree),this.type!=="undirected"&&(e+=n.inDegree+n.outDegree),e}inDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree-n.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree-n.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree-n.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree-n.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let e=0,r=0;return this.type!=="directed"&&(e+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(e+=n.inDegree,r+=n.directedLoops),e-r}outboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let e=0,r=0;return this.type!=="directed"&&(e+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(e+=n.outDegree,r+=n.directedLoops),e-r}degreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let e=0,r=0;return this.type!=="directed"&&(e+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(e+=n.inDegree+n.outDegree,r+=n.directedLoops*2),e-r}source(t){t=""+t;const n=this._edges.get(t);if(!n)throw new P(`Graph.source: could not find the "${t}" edge in the graph.`);return n.source.key}target(t){t=""+t;const n=this._edges.get(t);if(!n)throw new P(`Graph.target: could not find the "${t}" edge in the graph.`);return n.target.key}extremities(t){t=""+t;const n=this._edges.get(t);if(!n)throw new P(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[n.source.key,n.target.key]}opposite(t,n){t=""+t,n=""+n;const e=this._edges.get(n);if(!e)throw new P(`Graph.opposite: could not find the "${n}" edge in the graph.`);const r=e.source.key,o=e.target.key;if(t===r)return o;if(t===o)return r;throw new P(`Graph.opposite: the "${t}" node is not attached to the "${n}" edge (${r}, ${o}).`)}hasExtremity(t,n){t=""+t,n=""+n;const e=this._edges.get(t);if(!e)throw new P(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return e.source.key===n||e.target.key===n}isUndirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new P(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return n.undirected}isDirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new P(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!n.undirected}isSelfLoop(t){t=""+t;const n=this._edges.get(t);if(!n)throw new P(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return n.source===n.target}addNode(t,n){return es(this,t,n).key}mergeNode(t,n){if(n&&!oe(n))throw new O(`Graph.mergeNode: invalid attributes. Expecting an object but got "${n}"`);t=""+t,n=n||{};let e=this._nodes.get(t);return e?(n&&(ie(e.attributes,n),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:e.attributes,data:n})),[t,!1]):(e=new this.NodeDataClass(t,n),this._nodes.set(t,e),this.emit("nodeAdded",{key:t,attributes:n}),[t,!0])}updateNode(t,n){if(n&&typeof n!="function")throw new O(`Graph.updateNode: invalid updater function. Expecting a function but got "${n}"`);t=""+t;let e=this._nodes.get(t);if(e){if(n){const o=e.attributes;e.attributes=n(o),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:e.attributes})}return[t,!1]}const r=n?n({}):{};return e=new this.NodeDataClass(t,r),this._nodes.set(t,e),this.emit("nodeAdded",{key:t,attributes:r}),[t,!0]}dropNode(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new P(`Graph.dropNode: could not find the "${t}" node in the graph.`);let e;if(this.type!=="undirected"){for(const r in n.out){e=n.out[r];do $e(this,e),e=e.next;while(e)}for(const r in n.in){e=n.in[r];do $e(this,e),e=e.next;while(e)}}if(this.type!=="directed")for(const r in n.undirected){e=n.undirected[r];do $e(this,e),e=e.next;while(e)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:n.attributes})}dropEdge(t){let n;if(arguments.length>1){const e=""+arguments[0],r=""+arguments[1];if(n=ge(this,e,r,this.type),!n)throw new P(`Graph.dropEdge: could not find the "${e}" -> "${r}" edge in the graph.`)}else if(t=""+t,n=this._edges.get(t),!n)throw new P(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return $e(this,n),this}dropDirectedEdge(t,n){if(arguments.length<2)throw new $("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new $("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,n=""+n;const e=ge(this,t,n,"directed");if(!e)throw new P(`Graph.dropDirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return $e(this,e),this}dropUndirectedEdge(t,n){if(arguments.length<2)throw new $("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new $("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const e=ge(this,t,n,"undirected");if(!e)throw new P(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return $e(this,e),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let n;for(;n=t.next(),n.done!==!0;)n.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,n){return this._attributes[t]=n,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,n){if(typeof n!="function")throw new O("Graph.updateAttribute: updater should be a function.");const e=this._attributes[t];return this._attributes[t]=n(e),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!oe(t))throw new O("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!oe(t))throw new O("Graph.mergeAttributes: provided attributes are not a plain object.");return ie(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new O("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,n){if(typeof t!="function")throw new O("Graph.updateEachNodeAttributes: expecting an updater function.");if(n&&!Mn(n))throw new O("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const e=this._nodes.values();let r,o;for(;r=e.next(),r.done!==!0;)o=r.value,o.attributes=t(o.key,o.attributes);this.emit("eachNodeAttributesUpdated",{hints:n||null})}updateEachEdgeAttributes(t,n){if(typeof t!="function")throw new O("Graph.updateEachEdgeAttributes: expecting an updater function.");if(n&&!Mn(n))throw new O("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const e=this._edges.values();let r,o,s,a;for(;r=e.next(),r.done!==!0;)o=r.value,s=o.source,a=o.target,o.attributes=t(o.key,o.attributes,s.key,a.key,s.attributes,a.attributes,o.undirected);this.emit("eachEdgeAttributesUpdated",{hints:n||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new O("Graph.forEachAdjacencyEntry: expecting a callback.");ht(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new O("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");ht(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new O("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");ht(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new O("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");ht(!1,!0,!0,this,t)}nodes(){return Array.from(this._nodes.keys())}forEachNode(t){if(typeof t!="function")throw new O("Graph.forEachNode: expecting a callback.");const n=this._nodes.values();let e,r;for(;e=n.next(),e.done!==!0;)r=e.value,t(r.key,r.attributes)}findNode(t){if(typeof t!="function")throw new O("Graph.findNode: expecting a callback.");const n=this._nodes.values();let e,r;for(;e=n.next(),e.done!==!0;)if(r=e.value,t(r.key,r.attributes))return r.key}mapNodes(t){if(typeof t!="function")throw new O("Graph.mapNode: expecting a callback.");const n=this._nodes.values();let e,r;const o=new Array(this.order);let s=0;for(;e=n.next(),e.done!==!0;)r=e.value,o[s++]=t(r.key,r.attributes);return o}someNode(t){if(typeof t!="function")throw new O("Graph.someNode: expecting a callback.");const n=this._nodes.values();let e,r;for(;e=n.next(),e.done!==!0;)if(r=e.value,t(r.key,r.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new O("Graph.everyNode: expecting a callback.");const n=this._nodes.values();let e,r;for(;e=n.next(),e.done!==!0;)if(r=e.value,!t(r.key,r.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new O("Graph.filterNodes: expecting a callback.");const n=this._nodes.values();let e,r;const o=[];for(;e=n.next(),e.done!==!0;)r=e.value,t(r.key,r.attributes)&&o.push(r.key);return o}reduceNodes(t,n){if(typeof t!="function")throw new O("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new O("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let e=n;const r=this._nodes.values();let o,s;for(;o=r.next(),o.done!==!0;)s=o.value,e=t(e,s.key,s.attributes);return e}nodeEntries(){const t=this._nodes.values();return{[Symbol.iterator](){return this},next(){const n=t.next();if(n.done)return n;const e=n.value;return{value:{node:e.key,attributes:e.attributes},done:!1}}}}export(){const t=new Array(this._nodes.size);let n=0;this._nodes.forEach((r,o)=>{t[n++]=Vo(o,r)});const e=new Array(this._edges.size);return n=0,this._edges.forEach((r,o)=>{e[n++]=qo(this.type,o,r)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:e}}import(t,n=!1){if(t instanceof J)return t.forEachNode((u,c)=>{n?this.mergeNode(u,c):this.addNode(u,c)}),t.forEachEdge((u,c,h,l,d,f,p)=>{n?p?this.mergeUndirectedEdgeWithKey(u,h,l,c):this.mergeDirectedEdgeWithKey(u,h,l,c):p?this.addUndirectedEdgeWithKey(u,h,l,c):this.addDirectedEdgeWithKey(u,h,l,c)}),this;if(!oe(t))throw new O("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!oe(t.attributes))throw new O("Graph.import: invalid attributes. Expecting a plain object.");n?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let e,r,o,s,a;if(t.nodes){if(o=t.nodes,!Array.isArray(o))throw new O("Graph.import: invalid nodes. Expecting an array.");for(e=0,r=o.length;e<r;e++){s=o[e],Yo(s);const{key:u,attributes:c}=s;n?this.mergeNode(u,c):this.addNode(u,c)}}if(t.edges){let u=!1;if(this.type==="undirected"&&(u=!0),o=t.edges,!Array.isArray(o))throw new O("Graph.import: invalid edges. Expecting an array.");for(e=0,r=o.length;e<r;e++){a=o[e],Ko(a);const{source:c,target:h,attributes:l,undirected:d=u}=a;let f;"key"in a?(f=n?d?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:d?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,a.key,c,h,l)):(f=n?d?this.mergeUndirectedEdge:this.mergeDirectedEdge:d?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,c,h,l))}}return this}nullCopy(t){const n=new J(ie({},this._options,t));return n.replaceAttributes(ie({},this.getAttributes())),n}emptyCopy(t){const n=this.nullCopy(t);return this._nodes.forEach((e,r)=>{const o=ie({},e.attributes);e=new n.NodeDataClass(r,o),n._nodes.set(r,e)}),n}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new $(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new $("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new $("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const n=this.emptyCopy(t),e=this._edges.values();let r,o;for(;r=e.next(),r.done!==!0;)o=r.value,Kn(n,"copy",!1,o.undirected,o.key,o.source.key,o.target.key,ie({},o.attributes));return n}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((o,s)=>{t[s]=o.attributes});const n={},e={};this._edges.forEach((o,s)=>{const a=o.undirected?"--":"->";let u="",c=o.source.key,h=o.target.key,l;o.undirected&&c>h&&(l=c,c=h,h=l);const d=`(${c})${a}(${h})`;s.startsWith("geid_")?this.multi&&(typeof e[d]>"u"?e[d]=0:e[d]++,u+=`${e[d]}. `):u+=`[${s}]: `,u+=d,n[u]=o.attributes});const r={};for(const o in this)this.hasOwnProperty(o)&&!qn.has(o)&&typeof this[o]!="function"&&typeof o!="symbol"&&(r[o]=this[o]);return r.attributes=this._attributes,r.nodes=t,r.edges=n,pe(r,"constructor",this.constructor),r}}typeof Symbol<"u"&&(J.prototype[Symbol.for("nodejs.util.inspect.custom")]=J.prototype.inspect),Jo.forEach(i=>{["add","merge","update"].forEach(t=>{const n=i.name(t),e=t==="add"?Kn:ts;i.generateKey?J.prototype[n]=function(r,o,s){return e(this,n,!0,(i.type||this.type)==="undirected",null,r,o,s,t==="update")}:J.prototype[n]=function(r,o,s,a){return e(this,n,!1,(i.type||this.type)==="undirected",r,o,s,a,t==="update")}})}),co(J),Eo(J),Fo(J),jo(J);class Xn extends J{constructor(t){const n=ie({type:"directed"},t);if("multi"in n&&n.multi!==!1)throw new O("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="directed")throw new O('DirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Zn extends J{constructor(t){const n=ie({type:"undirected"},t);if("multi"in n&&n.multi!==!1)throw new O("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="undirected")throw new O('UndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Jn extends J{constructor(t){const n=ie({multi:!0},t);if("multi"in n&&n.multi!==!0)throw new O("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(n)}}class Qn extends J{constructor(t){const n=ie({type:"directed",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new O("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="directed")throw new O('MultiDirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class ei extends J{constructor(t){const n=ie({type:"undirected",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new O("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="undirected")throw new O('MultiUndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}function Be(i){i.from=function(t,n){const e=ie({},t.options,n),r=new i(e);return r.import(t),r}}Be(J),Be(Xn),Be(Zn),Be(Jn),Be(Qn),Be(ei),J.Graph=J,J.DirectedGraph=Xn,J.UndirectedGraph=Zn,J.MultiGraph=Jn,J.MultiDirectedGraph=Qn,J.MultiUndirectedGraph=ei,J.InvalidArgumentsGraphError=O,J.NotFoundGraphError=P,J.UsageGraphError=$;function ns(i,t){if(typeof i!="object"||!i)return i;var n=i[Symbol.toPrimitive];if(n!==void 0){var e=n.call(i,t);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function et(i){var t=ns(i,"string");return typeof t=="symbol"?t:t+""}function se(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function ti(i,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,et(e.key),e)}}function ae(i,t,n){return t&&ti(i.prototype,t),n&&ti(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function We(i){return We=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},We(i)}function ni(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ni=function(){return!!i})()}function is(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function rs(i,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return is(i)}function me(i,t,n){return t=We(t),rs(i,ni()?Reflect.construct(t,n||[],We(i).constructor):t.apply(i,n))}function Ht(i,t){return Ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},Ht(i,t)}function ve(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),t&&Ht(i,t)}function os(i){if(Array.isArray(i))return i}function ss(i,t){var n=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(n!=null){var e,r,o,s,a=[],u=!0,c=!1;try{if(o=(n=n.call(i)).next,t===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(e=o.call(n)).done)&&(a.push(e.value),a.length!==t);u=!0);}catch(h){c=!0,r=h}finally{try{if(!u&&n.return!=null&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}function jt(i,t){(t==null||t>i.length)&&(t=i.length);for(var n=0,e=Array(t);n<t;n++)e[n]=i[n];return e}function ii(i,t){if(i){if(typeof i=="string")return jt(i,t);var n={}.toString.call(i).slice(8,-1);return n==="Object"&&i.constructor&&(n=i.constructor.name),n==="Map"||n==="Set"?Array.from(i):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jt(i,t):void 0}}function as(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function He(i,t){return os(i)||ss(i,t)||ii(i,t)||as()}var Vt={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"},ri=new Int8Array(4),qt=new Int32Array(ri.buffer,0,1),us=new Float32Array(ri.buffer,0,1),cs=/^\s*rgba?\s*\(/,hs=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function ls(i){var t=0,n=0,e=0,r=1;if(i[0]==="#")i.length===4?(t=parseInt(i.charAt(1)+i.charAt(1),16),n=parseInt(i.charAt(2)+i.charAt(2),16),e=parseInt(i.charAt(3)+i.charAt(3),16)):(t=parseInt(i.charAt(1)+i.charAt(2),16),n=parseInt(i.charAt(3)+i.charAt(4),16),e=parseInt(i.charAt(5)+i.charAt(6),16)),i.length===9&&(r=parseInt(i.charAt(7)+i.charAt(8),16)/255);else if(cs.test(i)){var o=i.match(hs);o&&(t=+o[1],n=+o[2],e=+o[3],o[4]&&(r=+o[4]))}return{r:t,g:n,b:e,a:r}}var je={};for(var lt in Vt)je[lt]=tt(Vt[lt]),je[Vt[lt]]=je[lt];function oi(i,t,n,e,r){return qt[0]=e<<24|n<<16|t<<8|i,qt[0]=qt[0]&4278190079,us[0]}function tt(i){if(i=i.toLowerCase(),typeof je[i]<"u")return je[i];var t=ls(i),n=t.r,e=t.g,r=t.b,o=t.a;o=o*255|0;var s=oi(n,e,r,o);return je[i]=s,s}var Yt={};function si(i){if(typeof Yt[i]<"u")return Yt[i];var t=(i&16711680)>>>16,n=(i&65280)>>>8,e=i&255,r=255,o=oi(t,n,e,r);return Yt[i]=o,o}function ai(i,t,n,e){return n+(t<<8)+(i<<16)}function ui(i,t,n,e,r,o){var s=Math.floor(n/o*r),a=Math.floor(i.drawingBufferHeight/o-e/o*r),u=new Uint8Array(4);i.bindFramebuffer(i.FRAMEBUFFER,t),i.readPixels(s,a,1,1,i.RGBA,i.UNSIGNED_BYTE,u);var c=He(u,4),h=c[0],l=c[1],d=c[2],f=c[3];return[h,l,d,f]}function k(i,t,n){return(t=et(t))in i?Object.defineProperty(i,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[t]=n,i}function ci(i,t){var n=Object.keys(i);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(i);t&&(e=e.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),n.push.apply(n,e)}return n}function G(i){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ci(Object(n),!0).forEach(function(e){k(i,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):ci(Object(n)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(n,e))})}return i}function ds(i,t){for(;!{}.hasOwnProperty.call(i,t)&&(i=We(i))!==null;);return i}function Kt(){return Kt=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(i,t,n){var e=ds(i,t);if(e){var r=Object.getOwnPropertyDescriptor(e,t);return r.get?r.get.call(arguments.length<3?i:n):r.value}},Kt.apply(null,arguments)}function hi(i,t,n,e){var r=Kt(We(i.prototype),t,n);return typeof r=="function"?function(o){return r.apply(n,o)}:r}function fs(i){return i.normalized?1:i.size}function Xt(i){var t=0;return i.forEach(function(n){return t+=fs(n)}),t}function li(i,t,n){var e=i==="VERTEX"?t.VERTEX_SHADER:t.FRAGMENT_SHADER,r=t.createShader(e);if(r===null)throw new Error("loadShader: error while creating the shader");t.shaderSource(r,n),t.compileShader(r);var o=t.getShaderParameter(r,t.COMPILE_STATUS);if(!o){var s=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(`loadShader: error while compiling the shader:
`.concat(s,`
`).concat(n))}return r}function gs(i,t){return li("VERTEX",i,t)}function ps(i,t){return li("FRAGMENT",i,t)}function ms(i,t){var n=i.createProgram();if(n===null)throw new Error("loadProgram: error while creating the program.");var e,r;for(e=0,r=t.length;e<r;e++)i.attachShader(n,t[e]);i.linkProgram(n);var o=i.getProgramParameter(n,i.LINK_STATUS);if(!o)throw i.deleteProgram(n),new Error("loadProgram: error while linking the program.");return n}function di(i){var t=i.gl,n=i.buffer,e=i.program,r=i.vertexShader,o=i.fragmentShader;t.deleteShader(r),t.deleteShader(o),t.deleteProgram(e),t.deleteBuffer(n)}var fi=`#define PICKING_MODE
`,vs=k(k(k(k(k(k(k(k({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4),gi=(function(){function i(t,n,e){se(this,i),k(this,"array",new Float32Array),k(this,"constantArray",new Float32Array),k(this,"capacity",0),k(this,"verticesCount",0);var r=this.getDefinition();if(this.VERTICES=r.VERTICES,this.VERTEX_SHADER_SOURCE=r.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=r.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=r.UNIFORMS,this.ATTRIBUTES=r.ATTRIBUTES,this.METHOD=r.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in r?r.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in r?r.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in r,this.ATTRIBUTES_ITEMS_COUNT=Xt(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=e,this.normalProgram=this.getProgramInfo("normal",t,r.VERTEX_SHADER_SOURCE,r.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=n?this.getProgramInfo("pick",t,fi+r.VERTEX_SHADER_SOURCE,fi+r.FRAGMENT_SHADER_SOURCE,n):null,this.isInstanced){var o=Xt(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*o);for(var s=0;s<this.CONSTANT_DATA.length;s++){var a=this.CONSTANT_DATA[s];if(a.length!==o)throw new Error("Program: error while getting constant data (one vector has ".concat(a.length," items instead of ").concat(o,")"));for(var u=0;u<a.length;u++)this.constantArray[s*o+u]=a[u]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return ae(i,[{key:"kill",value:function(){di(this.normalProgram),this.pickProgram&&(di(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(n,e,r,o,s){var a=this.getDefinition(),u=e.createBuffer();if(u===null)throw new Error("Program: error while creating the WebGL buffer.");var c=gs(e,r),h=ps(e,o),l=ms(e,[c,h]),d={};a.UNIFORMS.forEach(function(b){var v=e.getUniformLocation(l,b);v&&(d[b]=v)});var f={};a.ATTRIBUTES.forEach(function(b){f[b.name]=e.getAttribLocation(l,b.name)});var p;if("CONSTANT_ATTRIBUTES"in a&&(a.CONSTANT_ATTRIBUTES.forEach(function(b){f[b.name]=e.getAttribLocation(l,b.name)}),p=e.createBuffer(),p===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:n,program:l,gl:e,frameBuffer:s,buffer:u,constantBuffer:p||{},uniformLocations:d,attributeLocations:f,isPicking:n==="pick",vertexShader:c,fragmentShader:h}}},{key:"bindProgram",value:function(n){var e=this,r=0,o=n.gl,s=n.buffer;this.isInstanced?(o.bindBuffer(o.ARRAY_BUFFER,n.constantBuffer),r=0,this.CONSTANT_ATTRIBUTES.forEach(function(a){return r+=e.bindAttribute(a,n,r,!1)}),o.bufferData(o.ARRAY_BUFFER,this.constantArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,n.buffer),r=0,this.ATTRIBUTES.forEach(function(a){return r+=e.bindAttribute(a,n,r,!0)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)):(o.bindBuffer(o.ARRAY_BUFFER,s),r=0,this.ATTRIBUTES.forEach(function(a){return r+=e.bindAttribute(a,n,r)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)),o.bindBuffer(o.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(n){var e=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(r){return e.unbindAttribute(r,n,!1)}),this.ATTRIBUTES.forEach(function(r){return e.unbindAttribute(r,n,!0)})):this.ATTRIBUTES.forEach(function(r){return e.unbindAttribute(r,n)})}},{key:"bindAttribute",value:function(n,e,r,o){var s=vs[n.type];if(typeof s!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(n.type,'"'));var a=e.attributeLocations[n.name],u=e.gl;if(a!==-1){u.enableVertexAttribArray(a);var c=this.isInstanced?(o?this.ATTRIBUTES_ITEMS_COUNT:Xt(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(u.vertexAttribPointer(a,n.size,n.type,n.normalized||!1,c,r),this.isInstanced&&o)if(u instanceof WebGL2RenderingContext)u.vertexAttribDivisor(a,1);else{var h=u.getExtension("ANGLE_instanced_arrays");h&&h.vertexAttribDivisorANGLE(a,1)}}return n.size*s}},{key:"unbindAttribute",value:function(n,e,r){var o=e.attributeLocations[n.name],s=e.gl;if(o!==-1&&(s.disableVertexAttribArray(o),this.isInstanced&&r))if(s instanceof WebGL2RenderingContext)s.vertexAttribDivisor(o,0);else{var a=s.getExtension("ANGLE_instanced_arrays");a&&a.vertexAttribDivisorANGLE(o,0)}}},{key:"reallocate",value:function(n){n!==this.capacity&&(this.capacity=n,this.verticesCount=this.VERTICES*n,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(n,e){var r=e.gl,o=e.program;r.enable(r.BLEND),r.useProgram(o),this.setUniforms(n,e),this.drawWebGL(this.METHOD,e)}},{key:"render",value:function(n){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,n.width*n.pixelRatio/n.downSizingRatio,n.height*n.pixelRatio/n.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram(G(G({},n),{},{pixelRatio:n.pixelRatio/n.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,n.width*n.pixelRatio,n.height*n.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(n,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(n,e){var r=e.gl,o=e.frameBuffer;if(r.bindFramebuffer(r.FRAMEBUFFER,o),!this.isInstanced)r.drawArrays(n,0,this.verticesCount);else if(r instanceof WebGL2RenderingContext)r.drawArraysInstanced(n,0,this.VERTICES,this.capacity);else{var s=r.getExtension("ANGLE_instanced_arrays");s&&s.drawArraysInstancedANGLE(n,0,this.VERTICES,this.capacity)}}}])})(),ys=(function(i){function t(){return se(this,t),me(this,t,arguments)}return ve(t,i),ae(t,[{key:"kill",value:function(){hi(t,"kill",this)([])}},{key:"process",value:function(e,r,o){var s=r*this.STRIDE;if(o.hidden){for(var a=s+this.STRIDE;s<a;s++)this.array[s]=0;return}return this.processVisibleItem(si(e),s,o)}}])})(gi),Zt=(function(i){function t(){var n;se(this,t);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return n=me(this,t,[].concat(r)),k(n,"drawLabel",void 0),n}return ve(t,i),ae(t,[{key:"kill",value:function(){hi(t,"kill",this)([])}},{key:"process",value:function(e,r,o,s,a){var u=r*this.STRIDE;if(a.hidden||o.hidden||s.hidden){for(var c=u+this.STRIDE;u<c;u++)this.array[u]=0;return}return this.processVisibleItem(si(e),u,o,s,a)}}])})(gi);function bs(i,t){return(function(){function n(e,r,o){se(this,n),k(this,"drawLabel",t),this.programs=i.map(function(s){return new s(e,r,o)})}return ae(n,[{key:"reallocate",value:function(r){this.programs.forEach(function(o){return o.reallocate(r)})}},{key:"process",value:function(r,o,s,a,u){this.programs.forEach(function(c){return c.process(r,o,s,a,u)})}},{key:"render",value:function(r){this.programs.forEach(function(o){return o.render(r)})}},{key:"kill",value:function(){this.programs.forEach(function(r){return r.kill()})}}])})()}function ws(i,t,n,e,r){var o=r.edgeLabelSize,s=r.edgeLabelFont,a=r.edgeLabelWeight,u=r.edgeLabelColor.attribute?t[r.edgeLabelColor.attribute]||r.edgeLabelColor.color||"#000":r.edgeLabelColor.color,c=t.label;if(c){i.fillStyle=u,i.font="".concat(a," ").concat(o,"px ").concat(s);var h=n.size,l=e.size,d=n.x,f=n.y,p=e.x,b=e.y,v=(d+p)/2,y=(f+b)/2,w=p-d,m=b-f,g=Math.sqrt(w*w+m*m);if(!(g<h+l)){d+=w*h/g,f+=m*h/g,p-=w*l/g,b-=m*l/g,v=(d+p)/2,y=(f+b)/2,w=p-d,m=b-f,g=Math.sqrt(w*w+m*m);var S=i.measureText(c).width;if(S>g){var E="";for(c=c+E,S=i.measureText(c).width;S>g&&c.length>1;)c=c.slice(0,-2)+E,S=i.measureText(c).width;if(c.length<4)return}var _;w>0?m>0?_=Math.acos(w/g):_=Math.asin(m/g):m>0?_=Math.acos(w/g)+Math.PI:_=Math.asin(w/g)+Math.PI/2,i.save(),i.translate(v,y),i.rotate(_),i.fillText(c,-S/2,t.size/2+o),i.restore()}}}function pi(i,t,n){if(t.label){var e=n.labelSize,r=n.labelFont,o=n.labelWeight,s=n.labelColor.attribute?t[n.labelColor.attribute]||n.labelColor.color||"#000":n.labelColor.color;i.fillStyle=s,i.font="".concat(o," ").concat(e,"px ").concat(r),i.fillText(t.label,t.x+t.size+3,t.y+e/3)}}function Es(i,t,n){var e=n.labelSize,r=n.labelFont,o=n.labelWeight;i.font="".concat(o," ").concat(e,"px ").concat(r),i.fillStyle="#FFF",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=8,i.shadowColor="#000";var s=2;if(typeof t.label=="string"){var a=i.measureText(t.label).width,u=Math.round(a+5),c=Math.round(e+2*s),h=Math.max(t.size,e/2)+s,l=Math.asin(c/2/h),d=Math.sqrt(Math.abs(Math.pow(h,2)-Math.pow(c/2,2)));i.beginPath(),i.moveTo(t.x+d,t.y+c/2),i.lineTo(t.x+h+u,t.y+c/2),i.lineTo(t.x+h+u,t.y-c/2),i.lineTo(t.x+d,t.y-c/2),i.arc(t.x,t.y,h,l,-l),i.closePath(),i.fill()}else i.beginPath(),i.arc(t.x,t.y,t.size+s,0,Math.PI*2),i.closePath(),i.fill();i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=0,pi(i,t,n)}var Ss=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Ts=Ss,_s=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,As=_s,mi=WebGLRenderingContext,vi=mi.UNSIGNED_BYTE,Jt=mi.FLOAT,Ds=["u_sizeRatio","u_correctionRatio","u_matrix"],dt=(function(i){function t(){return se(this,t),me(this,t,arguments)}return ve(t,i),ae(t,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:As,FRAGMENT_SHADER_SOURCE:Ts,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Ds,ATTRIBUTES:[{name:"a_position",size:2,type:Jt},{name:"a_size",size:1,type:Jt},{name:"a_color",size:4,type:vi,normalized:!0},{name:"a_id",size:4,type:vi,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:Jt}],CONSTANT_DATA:[[t.ANGLE_1],[t.ANGLE_2],[t.ANGLE_3]]}}},{key:"processVisibleItem",value:function(e,r,o){var s=this.array,a=tt(o.color);s[r++]=o.x,s[r++]=o.y,s[r++]=o.size,s[r++]=a,s[r++]=e}},{key:"setUniforms",value:function(e,r){var o=r.gl,s=r.uniformLocations,a=s.u_sizeRatio,u=s.u_correctionRatio,c=s.u_matrix;o.uniform1f(u,e.correctionRatio),o.uniform1f(a,e.sizeRatio),o.uniformMatrix3fv(c,!1,e.matrix)}}])})(ys);k(dt,"ANGLE_1",0),k(dt,"ANGLE_2",2*Math.PI/3),k(dt,"ANGLE_3",4*Math.PI/3);var Rs=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,Cs=Rs,Ls=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Is=Ls,yi=WebGLRenderingContext,bi=yi.UNSIGNED_BYTE,ft=yi.FLOAT,ks=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],wi={extremity:"target",lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function Ei(i){var t=G(G({},wi),{});return(function(n){function e(){return se(this,e),me(this,e,arguments)}return ve(e,n),ae(e,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Is,FRAGMENT_SHADER_SOURCE:Cs,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:ks,ATTRIBUTES:[{name:"a_position",size:2,type:ft},{name:"a_normal",size:2,type:ft},{name:"a_radius",size:1,type:ft},{name:"a_color",size:4,type:bi,normalized:!0},{name:"a_id",size:4,type:bi,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:ft}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(o,s,a,u,c){if(t.extremity==="source"){var h=[u,a];a=h[0],u=h[1]}var l=c.size||1,d=u.size||1,f=a.x,p=a.y,b=u.x,v=u.y,y=tt(c.color),w=b-f,m=v-p,g=w*w+m*m,S=0,E=0;g&&(g=1/Math.sqrt(g),S=-m*g*l,E=w*g*l);var _=this.array;_[s++]=b,_[s++]=v,_[s++]=-S,_[s++]=-E,_[s++]=d,_[s++]=y,_[s++]=o}},{key:"setUniforms",value:function(o,s){var a=s.gl,u=s.uniformLocations,c=u.u_matrix,h=u.u_sizeRatio,l=u.u_correctionRatio,d=u.u_minEdgeThickness,f=u.u_lengthToThicknessRatio,p=u.u_widenessToThicknessRatio;a.uniformMatrix3fv(c,!1,o.matrix),a.uniform1f(h,o.sizeRatio),a.uniform1f(l,o.correctionRatio),a.uniform1f(d,o.minEdgeThickness),a.uniform1f(f,t.lengthToThicknessRatio),a.uniform1f(p,t.widenessToThicknessRatio)}}])})(Zt)}Ei();var Ns=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Si=Ns,xs=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Ps=xs,Ti=WebGLRenderingContext,_i=Ti.UNSIGNED_BYTE,Pe=Ti.FLOAT,Os=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],Gs={lengthToThicknessRatio:wi.lengthToThicknessRatio};function Ai(i){var t=G(G({},Gs),{});return(function(n){function e(){return se(this,e),me(this,e,arguments)}return ve(e,n),ae(e,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:Ps,FRAGMENT_SHADER_SOURCE:Si,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Os,ATTRIBUTES:[{name:"a_positionStart",size:2,type:Pe},{name:"a_positionEnd",size:2,type:Pe},{name:"a_normal",size:2,type:Pe},{name:"a_color",size:4,type:_i,normalized:!0},{name:"a_id",size:4,type:_i,normalized:!0},{name:"a_radius",size:1,type:Pe}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:Pe},{name:"a_normalCoef",size:1,type:Pe},{name:"a_radiusCoef",size:1,type:Pe}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(o,s,a,u,c){var h=c.size||1,l=a.x,d=a.y,f=u.x,p=u.y,b=tt(c.color),v=f-l,y=p-d,w=u.size||1,m=v*v+y*y,g=0,S=0;m&&(m=1/Math.sqrt(m),g=-y*m*h,S=v*m*h);var E=this.array;E[s++]=l,E[s++]=d,E[s++]=f,E[s++]=p,E[s++]=g,E[s++]=S,E[s++]=b,E[s++]=o,E[s++]=w}},{key:"setUniforms",value:function(o,s){var a=s.gl,u=s.uniformLocations,c=u.u_matrix,h=u.u_zoomRatio,l=u.u_feather,d=u.u_pixelRatio,f=u.u_correctionRatio,p=u.u_sizeRatio,b=u.u_minEdgeThickness,v=u.u_lengthToThicknessRatio;a.uniformMatrix3fv(c,!1,o.matrix),a.uniform1f(h,o.zoomRatio),a.uniform1f(p,o.sizeRatio),a.uniform1f(f,o.correctionRatio),a.uniform1f(d,o.pixelRatio),a.uniform1f(l,o.antiAliasingFeather),a.uniform1f(b,o.minEdgeThickness),a.uniform1f(v,t.lengthToThicknessRatio)}}])})(Zt)}Ai();function Fs(i){return bs([Ai(),Ei()])}var zs=Fs(),Ms=zs,Us=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,$s=Us,Di=WebGLRenderingContext,Ri=Di.UNSIGNED_BYTE,nt=Di.FLOAT,Bs=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],Ws=(function(i){function t(){return se(this,t),me(this,t,arguments)}return ve(t,i),ae(t,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:$s,FRAGMENT_SHADER_SOURCE:Si,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Bs,ATTRIBUTES:[{name:"a_positionStart",size:2,type:nt},{name:"a_positionEnd",size:2,type:nt},{name:"a_normal",size:2,type:nt},{name:"a_color",size:4,type:Ri,normalized:!0},{name:"a_id",size:4,type:Ri,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:nt},{name:"a_normalCoef",size:1,type:nt}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(e,r,o,s,a){var u=a.size||1,c=o.x,h=o.y,l=s.x,d=s.y,f=tt(a.color),p=l-c,b=d-h,v=p*p+b*b,y=0,w=0;v&&(v=1/Math.sqrt(v),y=-b*v*u,w=p*v*u);var m=this.array;m[r++]=c,m[r++]=h,m[r++]=l,m[r++]=d,m[r++]=y,m[r++]=w,m[r++]=f,m[r++]=e}},{key:"setUniforms",value:function(e,r){var o=r.gl,s=r.uniformLocations,a=s.u_matrix,u=s.u_zoomRatio,c=s.u_feather,h=s.u_pixelRatio,l=s.u_correctionRatio,d=s.u_sizeRatio,f=s.u_minEdgeThickness;o.uniformMatrix3fv(a,!1,e.matrix),o.uniform1f(u,e.zoomRatio),o.uniform1f(d,e.sizeRatio),o.uniform1f(l,e.correctionRatio),o.uniform1f(h,e.pixelRatio),o.uniform1f(c,e.antiAliasingFeather),o.uniform1f(f,e.minEdgeThickness)}}])})(Zt),Qt=(function(i){function t(){var n;return se(this,t),n=me(this,t),n.rawEmitter=n,n}return ve(t,i),ae(t)})(Fn.EventEmitter),en,Ci;function gt(){return Ci||(Ci=1,en=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"}),en}var Hs=gt();const js=Ae(Hs);var Vs=function(t){return t},qs=function(t){return t*t},Ys=function(t){return t*(2-t)},Ks=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Xs=function(t){return t*t*t},Zs=function(t){return--t*t*t+1},Js=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},Qs={linear:Vs,quadraticIn:qs,quadraticOut:Ys,quadraticInOut:Ks,cubicIn:Xs,cubicOut:Zs,cubicInOut:Js},ea={easing:"quadraticInOut",duration:150};function we(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function pt(i,t,n){return i[0]=t,i[4]=typeof n=="number"?n:t,i}function Li(i,t){var n=Math.sin(t),e=Math.cos(t);return i[0]=e,i[1]=n,i[3]=-n,i[4]=e,i}function Ii(i,t,n){return i[6]=t,i[7]=n,i}function ke(i,t){var n=i[0],e=i[1],r=i[2],o=i[3],s=i[4],a=i[5],u=i[6],c=i[7],h=i[8],l=t[0],d=t[1],f=t[2],p=t[3],b=t[4],v=t[5],y=t[6],w=t[7],m=t[8];return i[0]=l*n+d*o+f*u,i[1]=l*e+d*s+f*c,i[2]=l*r+d*a+f*h,i[3]=p*n+b*o+v*u,i[4]=p*e+b*s+v*c,i[5]=p*r+b*a+v*h,i[6]=y*n+w*o+m*u,i[7]=y*e+w*s+m*c,i[8]=y*r+w*a+m*h,i}function tn(i,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,e=i[0],r=i[1],o=i[3],s=i[4],a=i[6],u=i[7],c=t.x,h=t.y;return{x:c*e+h*o+a*n,y:c*r+h*s+u*n}}function ta(i,t){var n=i.height/i.width,e=t.height/t.width;return n<1&&e>1||n>1&&e<1?1:Math.min(Math.max(e,1/e),Math.max(1/n,n))}function it(i,t,n,e,r){var o=i.angle,s=i.ratio,a=i.x,u=i.y,c=t.width,h=t.height,l=we(),d=Math.min(c,h)-2*e,f=ta(t,n);return r?(ke(l,Ii(we(),a,u)),ke(l,pt(we(),s)),ke(l,Li(we(),o)),ke(l,pt(we(),c/d/2/f,h/d/2/f))):(ke(l,pt(we(),2*(d/c)*f,2*(d/h)*f)),ke(l,Li(we(),-o)),ke(l,pt(we(),1/s)),ke(l,Ii(we(),-a,-u))),l}function na(i,t,n){var e=tn(i,{x:Math.cos(t.angle),y:Math.sin(t.angle)},0),r=e.x,o=e.y;return 1/Math.sqrt(Math.pow(r,2)+Math.pow(o,2))/n.width}function ia(i){if(!i.order)return{x:[0,1],y:[0,1]};var t=1/0,n=-1/0,e=1/0,r=-1/0;return i.forEachNode(function(o,s){var a=s.x,u=s.y;a<t&&(t=a),a>n&&(n=a),u<e&&(e=u),u>r&&(r=u)}),{x:[t,n],y:[e,r]}}function ra(i){if(!js(i))throw new Error("Sigma: invalid graph instance.");i.forEachNode(function(t,n){if(!Number.isFinite(n.x)||!Number.isFinite(n.y))throw new Error("Sigma: Coordinates of node ".concat(t," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function oa(i,t,n){var e=document.createElement(i);if(t)for(var r in t)e.style[r]=t[r];if(n)for(var o in n)e.setAttribute(o,n[o]);return e}function ki(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function Ni(i,t,n){return n.sort(function(e,r){var o=t(e)||0,s=t(r)||0;return o<s?-1:o>s?1:0})}function xi(i){var t=He(i.x,2),n=t[0],e=t[1],r=He(i.y,2),o=r[0],s=r[1],a=Math.max(e-n,s-o),u=(e+n)/2,c=(s+o)/2;(a===0||Math.abs(a)===1/0||isNaN(a))&&(a=1),isNaN(u)&&(u=0),isNaN(c)&&(c=0);var h=function(d){return{x:.5+(d.x-u)/a,y:.5+(d.y-c)/a}};return h.applyTo=function(l){l.x=.5+(l.x-u)/a,l.y=.5+(l.y-c)/a},h.inverse=function(l){return{x:u+a*(l.x-.5),y:c+a*(l.y-.5)}},h.ratio=a,h}function nn(i){"@babel/helpers - typeof";return nn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nn(i)}function Pi(i,t){var n=t.size;if(n!==0){var e=i.length;i.length+=n;var r=0;t.forEach(function(o){i[e+r]=o,r++})}}function rn(i){i=i||{};for(var t=0,n=arguments.length<=1?0:arguments.length-1;t<n;t++){var e=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];e&&Object.assign(i,e)}return i}var on={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:ws,defaultDrawNodeLabel:pi,defaultDrawNodeHover:Es,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},sa={circle:dt},aa={arrow:Ms,line:Ws};function sn(i){if(typeof i.labelDensity!="number"||i.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var t=i.minCameraRatio,n=i.maxCameraRatio;if(typeof t=="number"&&typeof n=="number"&&n<t)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function ua(i){var t=rn({},on,i);return t.nodeProgramClasses=rn({},sa,t.nodeProgramClasses),t.edgeProgramClasses=rn({},aa,t.edgeProgramClasses),t}var mt=1.5,Oi=(function(i){function t(){var n;return se(this,t),n=me(this,t),k(n,"x",.5),k(n,"y",.5),k(n,"angle",0),k(n,"ratio",1),k(n,"minRatio",null),k(n,"maxRatio",null),k(n,"enabledZooming",!0),k(n,"enabledPanning",!0),k(n,"enabledRotation",!0),k(n,"clean",null),k(n,"nextFrame",null),k(n,"previousState",null),k(n,"enabled",!0),n.previousState=n.getState(),n}return ve(t,i),ae(t,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(e){return this.x===e.x&&this.y===e.y&&this.ratio===e.ratio&&this.angle===e.angle}},{key:"getPreviousState",value:function(){var e=this.previousState;return e?{x:e.x,y:e.y,angle:e.angle,ratio:e.ratio}:null}},{key:"getBoundedRatio",value:function(e){var r=e;return typeof this.minRatio=="number"&&(r=Math.max(r,this.minRatio)),typeof this.maxRatio=="number"&&(r=Math.min(r,this.maxRatio)),r}},{key:"validateState",value:function(e){var r={};return this.enabledPanning&&typeof e.x=="number"&&(r.x=e.x),this.enabledPanning&&typeof e.y=="number"&&(r.y=e.y),this.enabledZooming&&typeof e.ratio=="number"&&(r.ratio=this.getBoundedRatio(e.ratio)),this.enabledRotation&&typeof e.angle=="number"&&(r.angle=e.angle),this.clean?this.clean(G(G({},this.getState()),r)):r}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(e){if(!this.enabled)return this;this.previousState=this.getState();var r=this.validateState(e);return typeof r.x=="number"&&(this.x=r.x),typeof r.y=="number"&&(this.y=r.y),typeof r.ratio=="number"&&(this.ratio=r.ratio),typeof r.angle=="number"&&(this.angle=r.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(e){return this.setState(e(this.getState())),this}},{key:"animate",value:function(e){var r=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;if(!s)return new Promise(function(f){return r.animate(e,o,f)});if(this.enabled){var a=G(G({},ea),o),u=this.validateState(e),c=typeof a.easing=="function"?a.easing:Qs[a.easing],h=Date.now(),l=this.getState(),d=function(){var p=(Date.now()-h)/a.duration;if(p>=1){r.nextFrame=null,r.setState(u),r.animationCallback&&(r.animationCallback.call(null),r.animationCallback=void 0);return}var b=c(p),v={};typeof u.x=="number"&&(v.x=l.x+(u.x-l.x)*b),typeof u.y=="number"&&(v.y=l.y+(u.y-l.y)*b),r.enabledRotation&&typeof u.angle=="number"&&(v.angle=l.angle+(u.angle-l.angle)*b),typeof u.ratio=="number"&&(v.ratio=l.ratio+(u.ratio-l.ratio)*b),r.setState(v),r.nextFrame=requestAnimationFrame(d)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(d)):d(),this.animationCallback=s}}},{key:"animatedZoom",value:function(e){return e?typeof e=="number"?this.animate({ratio:this.ratio/e}):this.animate({ratio:this.ratio/(e.factor||mt)},e):this.animate({ratio:this.ratio/mt})}},{key:"animatedUnzoom",value:function(e){return e?typeof e=="number"?this.animate({ratio:this.ratio*e}):this.animate({ratio:this.ratio*(e.factor||mt)},e):this.animate({ratio:this.ratio*mt})}},{key:"animatedReset",value:function(e){return this.animate({x:.5,y:.5,ratio:1,angle:0},e)}},{key:"copy",value:function(){return t.from(this.getState())}}],[{key:"from",value:function(e){var r=new t;return r.setState(e)}}])})(Qt);function Ee(i,t){var n=t.getBoundingClientRect();return{x:i.clientX-n.left,y:i.clientY-n.top}}function Ce(i,t){var n=G(G({},Ee(i,t)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){n.sigmaDefaultPrevented=!0},original:i});return n}function rt(i){var t="x"in i?i:G(G({},i.touches[0]||i.previousTouches[0]),{},{original:i.original,sigmaDefaultPrevented:i.sigmaDefaultPrevented,preventSigmaDefault:function(){i.sigmaDefaultPrevented=!0,t.sigmaDefaultPrevented=!0}});return t}function ca(i,t){return G(G({},Ce(i,t)),{},{delta:Gi(i)})}var ha=2;function vt(i){for(var t=[],n=0,e=Math.min(i.length,ha);n<e;n++)t.push(i[n]);return t}function ot(i,t,n){var e={touches:vt(i.touches).map(function(r){return Ee(r,n)}),previousTouches:t.map(function(r){return Ee(r,n)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){e.sigmaDefaultPrevented=!0},original:i};return e}function Gi(i){if(typeof i.deltaY<"u")return i.deltaY*-3/360;if(typeof i.detail<"u")return i.detail/-9;throw new Error("Captor: could not extract delta from event.")}var Fi=(function(i){function t(n,e){var r;return se(this,t),r=me(this,t),r.container=n,r.renderer=e,r}return ve(t,i),ae(t)})(Qt),la=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],da=la.reduce(function(i,t){return G(G({},i),{},k({},t,on[t]))},{}),fa=(function(i){function t(n,e){var r;return se(this,t),r=me(this,t,[n,e]),k(r,"enabled",!0),k(r,"draggedEvents",0),k(r,"downStartTime",null),k(r,"lastMouseX",null),k(r,"lastMouseY",null),k(r,"isMouseDown",!1),k(r,"isMoving",!1),k(r,"movingTimeout",null),k(r,"startCameraState",null),k(r,"clicks",0),k(r,"doubleClickTimeout",null),k(r,"currentWheelDirection",0),k(r,"settings",da),r.handleClick=r.handleClick.bind(r),r.handleRightClick=r.handleRightClick.bind(r),r.handleDown=r.handleDown.bind(r),r.handleUp=r.handleUp.bind(r),r.handleMove=r.handleMove.bind(r),r.handleWheel=r.handleWheel.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleEnter=r.handleEnter.bind(r),n.addEventListener("click",r.handleClick,{capture:!1}),n.addEventListener("contextmenu",r.handleRightClick,{capture:!1}),n.addEventListener("mousedown",r.handleDown,{capture:!1}),n.addEventListener("wheel",r.handleWheel,{capture:!1}),n.addEventListener("mouseleave",r.handleLeave,{capture:!1}),n.addEventListener("mouseenter",r.handleEnter,{capture:!1}),document.addEventListener("mousemove",r.handleMove,{capture:!1}),document.addEventListener("mouseup",r.handleUp,{capture:!1}),r}return ve(t,i),ae(t,[{key:"kill",value:function(){var e=this.container;e.removeEventListener("click",this.handleClick),e.removeEventListener("contextmenu",this.handleRightClick),e.removeEventListener("mousedown",this.handleDown),e.removeEventListener("wheel",this.handleWheel),e.removeEventListener("mouseleave",this.handleLeave),e.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(e){var r=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(e);setTimeout(function(){r.clicks=0,r.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",Ce(e,this.container))}}},{key:"handleRightClick",value:function(e){this.enabled&&this.emit("rightClick",Ce(e,this.container))}},{key:"handleDoubleClick",value:function(e){if(this.enabled){e.preventDefault(),e.stopPropagation();var r=Ce(e,this.container);if(this.emit("doubleClick",r),!r.sigmaDefaultPrevented){var o=this.renderer.getCamera(),s=o.getBoundedRatio(o.getState().ratio/this.settings.doubleClickZoomingRatio);o.animate(this.renderer.getViewportZoomedState(Ee(e,this.container),s),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(e){if(this.enabled){if(e.button===0){this.startCameraState=this.renderer.getCamera().getState();var r=Ee(e,this.container),o=r.x,s=r.y;this.lastMouseX=o,this.lastMouseY=s,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",Ce(e,this.container))}}},{key:"handleUp",value:function(e){var r=this;if(!(!this.enabled||!this.isMouseDown)){var o=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var s=Ee(e,this.container),a=s.x,u=s.y,c=o.getState(),h=o.getPreviousState()||{x:0,y:0};this.isMoving?o.animate({x:c.x+this.settings.inertiaRatio*(c.x-h.x),y:c.y+this.settings.inertiaRatio*(c.y-h.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==a||this.lastMouseY!==u)&&o.setState({x:c.x,y:c.y}),this.isMoving=!1,setTimeout(function(){var l=r.draggedEvents>0;r.draggedEvents=0,l&&r.renderer.getSetting("hideEdgesOnMove")&&r.renderer.refresh()},0),this.emit("mouseup",Ce(e,this.container))}}},{key:"handleMove",value:function(e){var r=this;if(this.enabled){var o=Ce(e,this.container);if(this.emit("mousemovebody",o),(e.target===this.container||e.composedPath()[0]===this.container)&&this.emit("mousemove",o),!o.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.movingTimeout=null,r.isMoving=!1},this.settings.dragTimeout);var s=this.renderer.getCamera(),a=Ee(e,this.container),u=a.x,c=a.y,h=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),l=this.renderer.viewportToFramedGraph({x:u,y:c}),d=h.x-l.x,f=h.y-l.y,p=s.getState(),b=p.x+d,v=p.y+f;s.setState({x:b,y:v}),this.lastMouseX=u,this.lastMouseY=c,e.preventDefault(),e.stopPropagation()}}}},{key:"handleLeave",value:function(e){this.emit("mouseleave",Ce(e,this.container))}},{key:"handleEnter",value:function(e){this.emit("mouseenter",Ce(e,this.container))}},{key:"handleWheel",value:function(e){var r=this,o=this.renderer.getCamera();if(!(!this.enabled||!o.enabledZooming)){var s=Gi(e);if(s){var a=ca(e,this.container);if(this.emit("wheel",a),a.sigmaDefaultPrevented){e.preventDefault(),e.stopPropagation();return}var u=o.getState().ratio,c=s>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,h=o.getBoundedRatio(u*c),l=s>0?1:-1,d=Date.now();u!==h&&(e.preventDefault(),e.stopPropagation(),!(this.currentWheelDirection===l&&this.lastWheelTriggerTime&&d-this.lastWheelTriggerTime<this.settings.zoomDuration/5)&&(o.animate(this.renderer.getViewportZoomedState(Ee(e,this.container),h),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){r.currentWheelDirection=0}),this.currentWheelDirection=l,this.lastWheelTriggerTime=d))}}}},{key:"setSettings",value:function(e){this.settings=e}}])})(Fi),ga=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],pa=ga.reduce(function(i,t){return G(G({},i),{},k({},t,on[t]))},{}),ma=(function(i){function t(n,e){var r;return se(this,t),r=me(this,t,[n,e]),k(r,"enabled",!0),k(r,"isMoving",!1),k(r,"hasMoved",!1),k(r,"touchMode",0),k(r,"startTouchesPositions",[]),k(r,"lastTouches",[]),k(r,"lastTap",null),k(r,"settings",pa),r.handleStart=r.handleStart.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleMove=r.handleMove.bind(r),n.addEventListener("touchstart",r.handleStart,{capture:!1}),n.addEventListener("touchcancel",r.handleLeave,{capture:!1}),document.addEventListener("touchend",r.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",r.handleMove,{capture:!1,passive:!1}),r}return ve(t,i),ae(t,[{key:"kill",value:function(){var e=this.container;e.removeEventListener("touchstart",this.handleStart),e.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(e){var r=this;if(this.enabled){e.preventDefault();var o=vt(e.touches);if(this.touchMode=o.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=o.map(function(f){return Ee(f,r.container)}),this.touchMode===2){var s=He(this.startTouchesPositions,2),a=s[0],u=a.x,c=a.y,h=s[1],l=h.x,d=h.y;this.startTouchesAngle=Math.atan2(d-c,l-u),this.startTouchesDistance=Math.sqrt(Math.pow(l-u,2)+Math.pow(d-c,2))}this.emit("touchdown",ot(e,this.lastTouches,this.container)),this.lastTouches=o,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(e){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(e.cancelable&&e.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(e.touches.length===1){this.handleStart(e),e.preventDefault();break}case 1:if(this.isMoving){var r=this.renderer.getCamera(),o=r.getState(),s=r.getPreviousState()||{x:0,y:0};r.animate({x:o.x+this.settings.inertiaRatio*(o.x-s.x),y:o.y+this.settings.inertiaRatio*(o.y-s.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",ot(e,this.lastTouches,this.container)),!e.touches.length){var a=Ee(this.lastTouches[0],this.container),u=this.startTouchesPositions[0],c=Math.pow(a.x-u.x,2)+Math.pow(a.y-u.y,2);if(!e.touches.length&&c<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var h=ot(e,this.lastTouches,this.container);if(this.emit("doubletap",h),this.lastTap=null,!h.sigmaDefaultPrevented){var l=this.renderer.getCamera(),d=l.getBoundedRatio(l.getState().ratio/this.settings.doubleClickZoomingRatio);l.animate(this.renderer.getViewportZoomedState(a,d),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var f=ot(e,this.lastTouches,this.container);this.emit("tap",f),this.lastTap={time:Date.now(),position:f.touches[0]||f.previousTouches[0]}}}this.lastTouches=vt(e.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(e){var r=this;if(!(!this.enabled||!this.startTouchesPositions.length)){e.preventDefault();var o=vt(e.touches),s=o.map(function(Y){return Ee(Y,r.container)}),a=this.lastTouches;this.lastTouches=o,this.lastTouchesPositions=s;var u=ot(e,a,this.container);if(this.emit("touchmove",u),!u.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=s.some(function(Y,X){var x=r.startTouchesPositions[X];return x&&(Y.x!==x.x||Y.y!==x.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.isMoving=!1},this.settings.dragTimeout);var c=this.renderer.getCamera(),h=this.startCameraState,l=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var d=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),f=d.x,p=d.y,b=this.renderer.viewportToFramedGraph(s[0]),v=b.x,y=b.y;c.setState({x:h.x+f-v,y:h.y+p-y});break}case 2:{var w={x:.5,y:.5,angle:0,ratio:1},m=s[0],g=m.x,S=m.y,E=s[1],_=E.x,A=E.y,R=Math.atan2(A-S,_-g)-this.startTouchesAngle,L=Math.hypot(A-S,_-g)/this.startTouchesDistance,z=c.getBoundedRatio(h.ratio/L);w.ratio=z,w.angle=h.angle+R;var N=this.getDimensions(),T=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:h}),V=Math.min(N.width,N.height)-2*l,q=V/N.width,I=V/N.height,D=z/V,F=g-V/2/q,W=S-V/2/I,B=[F*Math.cos(-w.angle)-W*Math.sin(-w.angle),W*Math.cos(-w.angle)+F*Math.sin(-w.angle)];F=B[0],W=B[1],w.x=T.x-F*D,w.y=T.y+W*D,c.setState(w);break}}}}}},{key:"setSettings",value:function(e){this.settings=e}}])})(Fi);function va(i){if(Array.isArray(i))return jt(i)}function ya(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function ba(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zi(i){return va(i)||ya(i)||ii(i)||ba()}function wa(i,t){if(i==null)return{};var n={};for(var e in i)if({}.hasOwnProperty.call(i,e)){if(t.indexOf(e)!==-1)continue;n[e]=i[e]}return n}function an(i,t){if(i==null)return{};var n,e,r=wa(i,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);for(e=0;e<o.length;e++)n=o[e],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(i,n)&&(r[n]=i[n])}return r}var Mi=(function(){function i(t,n){se(this,i),this.key=t,this.size=n}return ae(i,null,[{key:"compare",value:function(n,e){return n.size>e.size?-1:n.size<e.size||n.key>e.key?1:-1}}])})(),Ui=(function(){function i(){se(this,i),k(this,"width",0),k(this,"height",0),k(this,"cellSize",0),k(this,"columns",0),k(this,"rows",0),k(this,"cells",{})}return ae(i,[{key:"resizeAndClear",value:function(n,e){this.width=n.width,this.height=n.height,this.cellSize=e,this.columns=Math.ceil(n.width/e),this.rows=Math.ceil(n.height/e),this.cells={}}},{key:"getIndex",value:function(n){var e=Math.floor(n.x/this.cellSize),r=Math.floor(n.y/this.cellSize);return r*this.columns+e}},{key:"add",value:function(n,e,r){var o=new Mi(n,e),s=this.getIndex(r),a=this.cells[s];a||(a=[],this.cells[s]=a),a.push(o)}},{key:"organize",value:function(){for(var n in this.cells){var e=this.cells[n];e.sort(Mi.compare)}}},{key:"getLabelsToDisplay",value:function(n,e){var r=this.cellSize*this.cellSize,o=r/n/n,s=o*e/r,a=Math.ceil(s),u=[];for(var c in this.cells)for(var h=this.cells[c],l=0;l<Math.min(a,h.length);l++)u.push(h[l].key);return u}}])})();function Ea(i){var t=i.graph,n=i.hoveredNode,e=i.highlightedNodes,r=i.displayedNodeLabels,o=[];return t.forEachEdge(function(s,a,u,c){(u===n||c===n||e.has(u)||e.has(c)||r.has(u)&&r.has(c))&&o.push(s)}),o}var $i=150,Bi=50,Le=Object.prototype.hasOwnProperty;function Sa(i,t,n){if(!Le.call(n,"x")||!Le.call(n,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(t,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return n.color||(n.color=i.defaultNodeColor),!n.label&&n.label!==""&&(n.label=null),n.label!==void 0&&n.label!==null?n.label=""+n.label:n.label=null,n.size||(n.size=2),Le.call(n,"hidden")||(n.hidden=!1),Le.call(n,"highlighted")||(n.highlighted=!1),Le.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=i.defaultNodeType),n.zIndex||(n.zIndex=0),n}function Ta(i,t,n){return n.color||(n.color=i.defaultEdgeColor),n.label||(n.label=""),n.size||(n.size=.5),Le.call(n,"hidden")||(n.hidden=!1),Le.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=i.defaultEdgeType),n.zIndex||(n.zIndex=0),n}var _a=(function(i){function t(n,e){var r,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(se(this,t),r=me(this,t),k(r,"elements",{}),k(r,"canvasContexts",{}),k(r,"webGLContexts",{}),k(r,"pickingLayers",new Set),k(r,"textures",{}),k(r,"frameBuffers",{}),k(r,"activeListeners",{}),k(r,"labelGrid",new Ui),k(r,"nodeDataCache",{}),k(r,"edgeDataCache",{}),k(r,"nodeProgramIndex",{}),k(r,"edgeProgramIndex",{}),k(r,"nodesWithForcedLabels",new Set),k(r,"edgesWithForcedLabels",new Set),k(r,"nodeExtent",{x:[0,1],y:[0,1]}),k(r,"nodeZExtent",[1/0,-1/0]),k(r,"edgeZExtent",[1/0,-1/0]),k(r,"matrix",we()),k(r,"invMatrix",we()),k(r,"correctionRatio",1),k(r,"customBBox",null),k(r,"normalizationFunction",xi({x:[0,1],y:[0,1]})),k(r,"graphToViewportRatio",1),k(r,"itemIDsIndex",{}),k(r,"nodeIndices",{}),k(r,"edgeIndices",{}),k(r,"width",0),k(r,"height",0),k(r,"pixelRatio",ki()),k(r,"pickingDownSizingRatio",2*r.pixelRatio),k(r,"displayedNodeLabels",new Set),k(r,"displayedEdgeLabels",new Set),k(r,"highlightedNodes",new Set),k(r,"hoveredNode",null),k(r,"hoveredEdge",null),k(r,"renderFrame",null),k(r,"renderHighlightedNodesFrame",null),k(r,"needToProcess",!1),k(r,"checkEdgesEventsFrame",null),k(r,"nodePrograms",{}),k(r,"nodeHoverPrograms",{}),k(r,"edgePrograms",{}),r.settings=ua(o),sn(r.settings),ra(n),!(e instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");r.graph=n,r.container=e,r.createWebGLContext("edges",{picking:o.enableEdgeEvents}),r.createCanvasContext("edgeLabels"),r.createWebGLContext("nodes",{picking:!0}),r.createCanvasContext("labels"),r.createCanvasContext("hovers"),r.createWebGLContext("hoverNodes"),r.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),r.resize();for(var s in r.settings.nodeProgramClasses)r.registerNodeProgram(s,r.settings.nodeProgramClasses[s],r.settings.nodeHoverProgramClasses[s]);for(var a in r.settings.edgeProgramClasses)r.registerEdgeProgram(a,r.settings.edgeProgramClasses[a]);return r.camera=new Oi,r.bindCameraHandlers(),r.mouseCaptor=new fa(r.elements.mouse,r),r.mouseCaptor.setSettings(r.settings),r.touchCaptor=new ma(r.elements.mouse,r),r.touchCaptor.setSettings(r.settings),r.bindEventHandlers(),r.bindGraphHandlers(),r.handleSettingsUpdate(),r.refresh(),r}return ve(t,i),ae(t,[{key:"registerNodeProgram",value:function(e,r,o){return this.nodePrograms[e]&&this.nodePrograms[e].kill(),this.nodeHoverPrograms[e]&&this.nodeHoverPrograms[e].kill(),this.nodePrograms[e]=new r(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[e]=new(o||r)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(e,r){return this.edgePrograms[e]&&this.edgePrograms[e].kill(),this.edgePrograms[e]=new r(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(e){if(this.nodePrograms[e]){var r=this.nodePrograms,o=r[e],s=an(r,[e].map(et));o.kill(),this.nodePrograms=s}if(this.nodeHoverPrograms[e]){var a=this.nodeHoverPrograms,u=a[e],c=an(a,[e].map(et));u.kill(),this.nodePrograms=c}return this}},{key:"unregisterEdgeProgram",value:function(e){if(this.edgePrograms[e]){var r=this.edgePrograms,o=r[e],s=an(r,[e].map(et));o.kill(),this.edgePrograms=s}return this}},{key:"resetWebGLTexture",value:function(e){var r=this.webGLContexts[e],o=this.frameBuffers[e],s=this.textures[e];s&&r.deleteTexture(s);var a=r.createTexture();return r.bindFramebuffer(r.FRAMEBUFFER,o),r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),this.textures[e]=a,this}},{key:"bindCameraHandlers",value:function(){var e=this;return this.activeListeners.camera=function(){e.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(e){var r=e.x,o=e.y,s=ui(this.webGLContexts.nodes,this.frameBuffers.nodes,r,o,this.pixelRatio,this.pickingDownSizingRatio),a=ai.apply(void 0,zi(s)),u=this.itemIDsIndex[a];return u&&u.type==="node"?u.id:null}},{key:"bindEventHandlers",value:function(){var e=this;this.activeListeners.handleResize=function(){e.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(o){var s=rt(o),a={event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}},u=e.getNodeAtPosition(s);if(u&&e.hoveredNode!==u&&!e.nodeDataCache[u].hidden){e.hoveredNode&&e.emit("leaveNode",G(G({},a),{},{node:e.hoveredNode})),e.hoveredNode=u,e.emit("enterNode",G(G({},a),{},{node:u})),e.scheduleHighlightedNodesRender();return}if(e.hoveredNode&&e.getNodeAtPosition(s)!==e.hoveredNode){var c=e.hoveredNode;e.hoveredNode=null,e.emit("leaveNode",G(G({},a),{},{node:c})),e.scheduleHighlightedNodesRender();return}if(e.settings.enableEdgeEvents){var h=e.hoveredNode?null:e.getEdgeAtPoint(a.event.x,a.event.y);h!==e.hoveredEdge&&(e.hoveredEdge&&e.emit("leaveEdge",G(G({},a),{},{edge:e.hoveredEdge})),h&&e.emit("enterEdge",G(G({},a),{},{edge:h})),e.hoveredEdge=h)}},this.activeListeners.handleMoveBody=function(o){var s=rt(o);e.emit("moveBody",{event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(o){var s=rt(o),a={event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}};e.hoveredNode&&(e.emit("leaveNode",G(G({},a),{},{node:e.hoveredNode})),e.scheduleHighlightedNodesRender()),e.settings.enableEdgeEvents&&e.hoveredEdge&&(e.emit("leaveEdge",G(G({},a),{},{edge:e.hoveredEdge})),e.scheduleHighlightedNodesRender()),e.emit("leaveStage",G({},a))},this.activeListeners.handleEnter=function(o){var s=rt(o),a={event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}};e.emit("enterStage",G({},a))};var r=function(s){return function(a){var u=rt(a),c={event:u,preventSigmaDefault:function(){u.preventSigmaDefault()}},h=e.getNodeAtPosition(u);if(h)return e.emit("".concat(s,"Node"),G(G({},c),{},{node:h}));if(e.settings.enableEdgeEvents){var l=e.getEdgeAtPoint(u.x,u.y);if(l)return e.emit("".concat(s,"Edge"),G(G({},c),{},{edge:l}))}return e.emit("".concat(s,"Stage"),c)}};return this.activeListeners.handleClick=r("click"),this.activeListeners.handleRightClick=r("rightClick"),this.activeListeners.handleDoubleClick=r("doubleClick"),this.activeListeners.handleWheel=r("wheel"),this.activeListeners.handleDown=r("down"),this.activeListeners.handleUp=r("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var e=this,r=this.graph,o=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(s){var a,u=(a=s.hints)===null||a===void 0?void 0:a.attributes;e.graph.forEachNode(function(h){return e.updateNode(h)});var c=!u||u.some(function(h){return o.has(h)});e.refresh({partialGraph:{nodes:r.nodes()},skipIndexation:!c,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(s){var a,u=(a=s.hints)===null||a===void 0?void 0:a.attributes;e.graph.forEachEdge(function(h){return e.updateEdge(h)});var c=u&&["zIndex","type"].some(function(h){return u==null?void 0:u.includes(h)});e.refresh({partialGraph:{edges:r.edges()},skipIndexation:!c,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(s){var a=s.key;e.addNode(a),e.refresh({partialGraph:{nodes:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(s){var a=s.key;e.refresh({partialGraph:{nodes:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(s){var a=s.key;e.removeNode(a),e.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(s){var a=s.key;e.addEdge(a),e.refresh({partialGraph:{edges:[a]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(s){var a=s.key;e.refresh({partialGraph:{edges:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(s){var a=s.key;e.removeEdge(a),e.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){e.clearEdgeState(),e.clearEdgeIndices(),e.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){e.clearEdgeState(),e.clearNodeState(),e.clearEdgeIndices(),e.clearNodeIndices(),e.refresh({schedule:!0})},r.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),r.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),r.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),r.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),r.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),r.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),r.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),r.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),r.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),r.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var e=this.graph;e.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),e.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),e.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),e.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),e.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),e.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),e.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),e.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),e.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),e.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(e,r){var o=ui(this.webGLContexts.edges,this.frameBuffers.edges,e,r,this.pixelRatio,this.pickingDownSizingRatio),s=ai.apply(void 0,zi(o)),a=this.itemIDsIndex[s];return a&&a.type==="edge"?a.id:null}},{key:"process",value:function(){var e=this;this.emit("beforeProcess");var r=this.graph,o=this.settings,s=this.getDimensions();if(this.nodeExtent=ia(this.graph),!this.settings.autoRescale){var a=s.width,u=s.height,c=this.nodeExtent,h=c.x,l=c.y;this.nodeExtent={x:[(h[0]+h[1])/2-a/2,(h[0]+h[1])/2+a/2],y:[(l[0]+l[1])/2-u/2,(l[0]+l[1])/2+u/2]}}this.normalizationFunction=xi(this.customBBox||this.nodeExtent);var d=new Oi,f=it(d.getState(),s,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(s,o.labelGridCellSize);for(var p={},b={},v={},y={},w=1,m=r.nodes(),g=0,S=m.length;g<S;g++){var E=m[g],_=this.nodeDataCache[E],A=r.getNodeAttributes(E);_.x=A.x,_.y=A.y,this.normalizationFunction.applyTo(_),typeof _.label=="string"&&!_.hidden&&this.labelGrid.add(E,_.size,this.framedGraphToViewport(_,{matrix:f})),p[_.type]=(p[_.type]||0)+1}this.labelGrid.organize();for(var R in this.nodePrograms){if(!Le.call(this.nodePrograms,R))throw new Error('Sigma: could not find a suitable program for node type "'.concat(R,'"!'));this.nodePrograms[R].reallocate(p[R]||0),p[R]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(m=Ni(this.nodeZExtent,function(te){return e.nodeDataCache[te].zIndex},m));for(var L=0,z=m.length;L<z;L++){var N=m[L];b[N]=w,y[b[N]]={type:"node",id:N},w++;var T=this.nodeDataCache[N];this.addNodeToProgram(N,b[N],p[T.type]++)}for(var V={},q=r.edges(),I=0,D=q.length;I<D;I++){var F=q[I],W=this.edgeDataCache[F];V[W.type]=(V[W.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(q=Ni(this.edgeZExtent,function(te){return e.edgeDataCache[te].zIndex},q));for(var B in this.edgePrograms){if(!Le.call(this.edgePrograms,B))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(B,'"!'));this.edgePrograms[B].reallocate(V[B]||0),V[B]=0}for(var Y=0,X=q.length;Y<X;Y++){var x=q[Y];v[x]=w,y[v[x]]={type:"edge",id:x},w++;var Q=this.edgeDataCache[x];this.addEdgeToProgram(x,v[x],V[Q.type]++)}return this.itemIDsIndex=y,this.nodeIndices=b,this.edgeIndices=v,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(e){var r=this,o=this.settings;if(this.camera.minRatio=o.minCameraRatio,this.camera.maxRatio=o.maxCameraRatio,this.camera.enabledZooming=o.enableCameraZooming,this.camera.enabledPanning=o.enableCameraPanning,this.camera.enabledRotation=o.enableCameraRotation,o.cameraPanBoundaries?this.camera.clean=function(h){return r.cleanCameraState(h,o.cameraPanBoundaries&&nn(o.cameraPanBoundaries)==="object"?o.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),e){if(e.edgeProgramClasses!==o.edgeProgramClasses){for(var s in o.edgeProgramClasses)o.edgeProgramClasses[s]!==e.edgeProgramClasses[s]&&this.registerEdgeProgram(s,o.edgeProgramClasses[s]);for(var a in e.edgeProgramClasses)o.edgeProgramClasses[a]||this.unregisterEdgeProgram(a)}if(e.nodeProgramClasses!==o.nodeProgramClasses||e.nodeHoverProgramClasses!==o.nodeHoverProgramClasses){for(var u in o.nodeProgramClasses)(o.nodeProgramClasses[u]!==e.nodeProgramClasses[u]||o.nodeHoverProgramClasses[u]!==e.nodeHoverProgramClasses[u])&&this.registerNodeProgram(u,o.nodeProgramClasses[u],o.nodeHoverProgramClasses[u]);for(var c in e.nodeProgramClasses)o.nodeProgramClasses[c]||this.unregisterNodeProgram(c)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.tolerance,s=o===void 0?0:o,a=r.boundaries,u=G({},e),c=a||this.nodeExtent,h=He(c.x,2),l=h[0],d=h[1],f=He(c.y,2),p=f[0],b=f[1],v=[this.graphToViewport({x:l,y:p},{cameraState:e}),this.graphToViewport({x:d,y:p},{cameraState:e}),this.graphToViewport({x:l,y:b},{cameraState:e}),this.graphToViewport({x:d,y:b},{cameraState:e})],y=1/0,w=-1/0,m=1/0,g=-1/0;v.forEach(function(V){var q=V.x,I=V.y;y=Math.min(y,q),w=Math.max(w,q),m=Math.min(m,I),g=Math.max(g,I)});var S=w-y,E=g-m,_=this.getDimensions(),A=_.width,R=_.height,L=0,z=0;if(S>=A?w<A-s?L=w-(A-s):y>s&&(L=y-s):w>A+s?L=w-(A+s):y<-s&&(L=y+s),E>=R?g<R-s?z=g-(R-s):m>s&&(z=m-s):g>R+s?z=g-(R+s):m<-s&&(z=m+s),L||z){var N=this.viewportToFramedGraph({x:0,y:0},{cameraState:e}),T=this.viewportToFramedGraph({x:L,y:z},{cameraState:e});L=T.x-N.x,z=T.y-N.y,u.x+=L,u.y+=z}return u}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var e=this.camera.getState(),r=this.labelGrid.getLabelsToDisplay(e.ratio,this.settings.labelDensity);Pi(r,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var o=this.canvasContexts.labels,s=0,a=r.length;s<a;s++){var u=r[s],c=this.nodeDataCache[u];if(!this.displayedNodeLabels.has(u)&&!c.hidden){var h=this.framedGraphToViewport(c),l=h.x,d=h.y,f=this.scaleSize(c.size);if(!(!c.forceLabel&&f<this.settings.labelRenderedSizeThreshold)&&!(l<-$i||l>this.width+$i||d<-Bi||d>this.height+Bi)){this.displayedNodeLabels.add(u);var p=this.settings.defaultDrawNodeLabel,b=this.nodePrograms[c.type],v=(b==null?void 0:b.drawLabel)||p;v(o,G(G({key:u},c),{},{size:f,x:l,y:d}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var e=this.canvasContexts.edgeLabels;e.clearRect(0,0,this.width,this.height);var r=Ea({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});Pi(r,this.edgesWithForcedLabels);for(var o=new Set,s=0,a=r.length;s<a;s++){var u=r[s],c=this.graph.extremities(u),h=this.nodeDataCache[c[0]],l=this.nodeDataCache[c[1]],d=this.edgeDataCache[u];if(!o.has(u)&&!(d.hidden||h.hidden||l.hidden)){var f=this.settings.defaultDrawEdgeLabel,p=this.edgePrograms[d.type],b=(p==null?void 0:p.drawLabel)||f;b(e,G(G({key:u},d),{},{size:this.scaleSize(d.size)}),G(G(G({key:c[0]},h),this.framedGraphToViewport(h)),{},{size:this.scaleSize(h.size)}),G(G(G({key:c[1]},l),this.framedGraphToViewport(l)),{},{size:this.scaleSize(l.size)}),this.settings),o.add(u)}}return this.displayedEdgeLabels=o,this}},{key:"renderHighlightedNodes",value:function(){var e=this,r=this.canvasContexts.hovers;r.clearRect(0,0,this.width,this.height);var o=function(f){var p=e.nodeDataCache[f],b=e.framedGraphToViewport(p),v=b.x,y=b.y,w=e.scaleSize(p.size),m=e.settings.defaultDrawNodeHover,g=e.nodePrograms[p.type],S=(g==null?void 0:g.drawHover)||m;S(r,G(G({key:f},p),{},{size:w,x:v,y}),e.settings)},s=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&s.push(this.hoveredNode),this.highlightedNodes.forEach(function(d){d!==e.hoveredNode&&s.push(d)}),s.forEach(function(d){return o(d)});var a={};s.forEach(function(d){var f=e.nodeDataCache[d].type;a[f]=(a[f]||0)+1});for(var u in this.nodeHoverPrograms)this.nodeHoverPrograms[u].reallocate(a[u]||0),a[u]=0;s.forEach(function(d){var f=e.nodeDataCache[d];e.nodeHoverPrograms[f.type].process(0,a[f.type]++,f)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var c=this.getRenderParams();for(var h in this.nodeHoverPrograms){var l=this.nodeHoverPrograms[h];l.render(c)}}},{key:"scheduleHighlightedNodesRender",value:function(){var e=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){e.renderHighlightedNodesFrame=null,e.renderHighlightedNodes(),e.renderEdgeLabels()}))}},{key:"render",value:function(){var e=this;this.emit("beforeRender");var r=function(){return e.emit("afterRender"),e};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(v){return e.resetWebGLTexture(v)}),!this.graph.order)return r();var o=this.mouseCaptor,s=this.camera.isAnimated()||o.isMoving||o.draggedEvents||o.currentWheelDirection,a=this.camera.getState(),u=this.getDimensions(),c=this.getGraphDimensions(),h=this.getStagePadding();this.matrix=it(a,u,c,h),this.invMatrix=it(a,u,c,h,!0),this.correctionRatio=na(this.matrix,a,u),this.graphToViewportRatio=this.getGraphToViewportRatio();var l=this.getRenderParams();for(var d in this.nodePrograms){var f=this.nodePrograms[d];f.render(l)}if(!this.settings.hideEdgesOnMove||!s)for(var p in this.edgePrograms){var b=this.edgePrograms[p];b.render(l)}return this.settings.hideLabelsOnMove&&s||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),r()}},{key:"addNode",value:function(e){var r=Object.assign({},this.graph.getNodeAttributes(e));this.settings.nodeReducer&&(r=this.settings.nodeReducer(e,r));var o=Sa(this.settings,e,r);this.nodeDataCache[e]=o,this.nodesWithForcedLabels.delete(e),o.forceLabel&&!o.hidden&&this.nodesWithForcedLabels.add(e),this.highlightedNodes.delete(e),o.highlighted&&!o.hidden&&this.highlightedNodes.add(e),this.settings.zIndex&&(o.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=o.zIndex),o.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=o.zIndex))}},{key:"updateNode",value:function(e){this.addNode(e);var r=this.nodeDataCache[e];this.normalizationFunction.applyTo(r)}},{key:"removeNode",value:function(e){delete this.nodeDataCache[e],delete this.nodeProgramIndex[e],this.highlightedNodes.delete(e),this.hoveredNode===e&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(e)}},{key:"addEdge",value:function(e){var r=Object.assign({},this.graph.getEdgeAttributes(e));this.settings.edgeReducer&&(r=this.settings.edgeReducer(e,r));var o=Ta(this.settings,e,r);this.edgeDataCache[e]=o,this.edgesWithForcedLabels.delete(e),o.forceLabel&&!o.hidden&&this.edgesWithForcedLabels.add(e),this.settings.zIndex&&(o.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=o.zIndex),o.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=o.zIndex))}},{key:"updateEdge",value:function(e){this.addEdge(e)}},{key:"removeEdge",value:function(e){delete this.edgeDataCache[e],delete this.edgeProgramIndex[e],this.hoveredEdge===e&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(e)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new Ui,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0],this.highlightedNodes=new Set}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(e,r,o){var s=this.nodeDataCache[e],a=this.nodePrograms[s.type];if(!a)throw new Error('Sigma: could not find a suitable program for node type "'.concat(s.type,'"!'));a.process(r,o,s),this.nodeProgramIndex[e]=o}},{key:"addEdgeToProgram",value:function(e,r,o){var s=this.edgeDataCache[e],a=this.edgePrograms[s.type];if(!a)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(s.type,'"!'));var u=this.graph.extremities(e),c=this.nodeDataCache[u[0]],h=this.nodeDataCache[u[1]];a.process(r,o,c,h,s),this.edgeProgramIndex[e]=o}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var e=this.settings,r=e.stagePadding,o=e.autoRescale;return o&&r||0}},{key:"createLayer",value:function(e,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.elements[e])throw new Error('Sigma: a layer named "'.concat(e,'" already exists'));var s=oa(r,{position:"absolute"},{class:"sigma-".concat(e)});return o.style&&Object.assign(s.style,o.style),this.elements[e]=s,"beforeLayer"in o&&o.beforeLayer?this.elements[o.beforeLayer].before(s):"afterLayer"in o&&o.afterLayer?this.elements[o.afterLayer].after(s):this.container.appendChild(s),s}},{key:"createCanvas",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.createLayer(e,"canvas",r)}},{key:"createCanvasContext",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.createCanvas(e,r),s={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[e]=o.getContext("2d",s),this}},{key:"createWebGLContext",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=(r==null?void 0:r.canvas)||this.createCanvas(e,r);r.hidden&&o.remove();var s=G({preserveDrawingBuffer:!1,antialias:!1},r),a;a=o.getContext("webgl2",s),a||(a=o.getContext("webgl",s)),a||(a=o.getContext("experimental-webgl",s));var u=a;if(this.webGLContexts[e]=u,u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA),r.picking){this.pickingLayers.add(e);var c=u.createFramebuffer();if(!c)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(e));this.frameBuffers[e]=c}return u}},{key:"killLayer",value:function(e){var r=this.elements[e];if(!r)throw new Error("Sigma: cannot kill layer ".concat(e,", which does not exist"));if(this.webGLContexts[e]){var o,s=this.webGLContexts[e];(o=s.getExtension("WEBGL_lose_context"))===null||o===void 0||o.loseContext(),delete this.webGLContexts[e]}else this.canvasContexts[e]&&delete this.canvasContexts[e];return r.remove(),delete this.elements[e],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(e){this.unbindCameraHandlers(),this.camera=e,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(e){e!==this.graph&&(this.hoveredNode&&!e.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!e.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=e,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var e=this.customBBox||this.nodeExtent;return{width:e.x[1]-e.x[0]||1,height:e.y[1]-e.y[0]||1}}},{key:"getNodeDisplayData",value:function(e){var r=this.nodeDataCache[e];return r?Object.assign({},r):void 0}},{key:"getEdgeDisplayData",value:function(e){var r=this.edgeDataCache[e];return r?Object.assign({},r):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return G({},this.settings)}},{key:"getSetting",value:function(e){return this.settings[e]}},{key:"setSetting",value:function(e,r){var o=G({},this.settings);return this.settings[e]=r,sn(this.settings),this.handleSettingsUpdate(o),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(e,r){return this.setSetting(e,r(this.settings[e])),this}},{key:"setSettings",value:function(e){var r=G({},this.settings);return this.settings=G(G({},this.settings),e),sn(this.settings),this.handleSettingsUpdate(r),this.scheduleRefresh(),this}},{key:"resize",value:function(e){var r=this.width,o=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=ki(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!e&&r===this.width&&o===this.height)return this;for(var s in this.elements){var a=this.elements[s];a.style.width=this.width+"px",a.style.height=this.height+"px"}for(var u in this.canvasContexts)this.elements[u].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[u].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[u].scale(this.pixelRatio,this.pixelRatio);for(var c in this.webGLContexts){this.elements[c].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[c].setAttribute("height",this.height*this.pixelRatio+"px");var h=this.webGLContexts[c];if(h.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(c)){var l=this.textures[c];l&&h.deleteTexture(l)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(e){var r=this,o=(e==null?void 0:e.skipIndexation)!==void 0?e==null?void 0:e.skipIndexation:!1,s=(e==null?void 0:e.schedule)!==void 0?e.schedule:!1,a=!e||!e.partialGraph;if(a)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(g){return r.addNode(g)}),this.graph.forEachEdge(function(g){return r.addEdge(g)});else{for(var u,c,h=((u=e.partialGraph)===null||u===void 0?void 0:u.nodes)||[],l=0,d=(h==null?void 0:h.length)||0;l<d;l++){var f=h[l];if(this.updateNode(f),o){var p=this.nodeProgramIndex[f];if(p===void 0)throw new Error('Sigma: node "'.concat(f,`" can't be repaint`));this.addNodeToProgram(f,this.nodeIndices[f],p)}}for(var b=(e==null||(c=e.partialGraph)===null||c===void 0?void 0:c.edges)||[],v=0,y=b.length;v<y;v++){var w=b[v];if(this.updateEdge(w),o){var m=this.edgeProgramIndex[w];if(m===void 0)throw new Error('Sigma: edge "'.concat(w,`" can't be repaint`));this.addEdgeToProgram(w,this.edgeIndices[w],m)}}}return(a||!o)&&(this.needToProcess=!0),s?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var e=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){e.render()})),this}},{key:"scheduleRefresh",value:function(e){return this.refresh(G(G({},e),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(e,r){var o=this.camera.getState(),s=o.ratio,a=o.angle,u=o.x,c=o.y,h=this.settings,l=h.minCameraRatio,d=h.maxCameraRatio;typeof d=="number"&&(r=Math.min(r,d)),typeof l=="number"&&(r=Math.max(r,l));var f=r/s,p={x:this.width/2,y:this.height/2},b=this.viewportToFramedGraph(e),v=this.viewportToFramedGraph(p);return{angle:a,x:(b.x-v.x)*(1-f)+u,y:(b.y-v.y)*(1-f)+c,ratio:r}}},{key:"viewRectangle",value:function(){var e=this.viewportToFramedGraph({x:0,y:0}),r=this.viewportToFramedGraph({x:this.width,y:0}),o=this.viewportToFramedGraph({x:0,y:this.height});return{x1:e.x,y1:e.y,x2:r.x,y2:r.y,height:r.y-o.y}}},{key:"framedGraphToViewport",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!!r.graphDimensions,s=r.matrix?r.matrix:o?it(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding()):this.matrix,a=tn(s,e);return{x:(1+a.x)*this.width/2,y:(1-a.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!r.graphDimensions,s=r.matrix?r.matrix:o?it(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding(),!0):this.invMatrix,a=tn(s,{x:e.x/this.width*2-1,y:1-e.y/this.height*2});return isNaN(a.x)&&(a.x=0),isNaN(a.y)&&(a.y=0),a}},{key:"viewportToGraph",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(e,r))}},{key:"graphToViewport",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(e),r)}},{key:"getGraphToViewportRatio",value:function(){var e={x:0,y:0},r={x:1,y:1},o=Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2)),s=this.graphToViewport(e),a=this.graphToViewport(r),u=Math.sqrt(Math.pow(s.x-a.x,2)+Math.pow(s.y-a.y,2));return u/o}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(e){return this.customBBox=e,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var e=this.container;e.firstChild;)e.removeChild(e.firstChild);for(var r in this.nodePrograms)this.nodePrograms[r].kill();for(var o in this.nodeHoverPrograms)this.nodeHoverPrograms[o].kill();for(var s in this.edgePrograms)this.edgePrograms[s].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var a in this.elements)this.killLayer(a);this.canvasContexts={},this.webGLContexts={},this.elements={}}},{key:"scaleSize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return e/this.settings.zoomToSizeRatioFunction(r)*(this.getSetting("itemSizesReference")==="positions"?r*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var e={};for(var r in this.elements)this.elements[r]instanceof HTMLCanvasElement&&(e[r]=this.elements[r]);return e}}])})(Qt),Aa=_a,st={},Wi;function Hi(){if(Wi)return st;Wi=1;function i(e){return typeof e!="number"||isNaN(e)?1:e}function t(e,r){var o={},s=function(c){return typeof c>"u"?r:c};typeof r=="function"&&(s=r);var a=function(c){return s(c[e])},u=function(){return s(void 0)};return typeof e=="string"?(o.fromAttributes=a,o.fromGraph=function(c,h){return a(c.getNodeAttributes(h))},o.fromEntry=function(c,h){return a(h)}):typeof e=="function"?(o.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},o.fromGraph=function(c,h){return s(e(h,c.getNodeAttributes(h)))},o.fromEntry=function(c,h){return s(e(c,h))}):(o.fromAttributes=u,o.fromGraph=u,o.fromEntry=u),o}function n(e,r){var o={},s=function(c){return typeof c>"u"?r:c};typeof r=="function"&&(s=r);var a=function(c){return s(c[e])},u=function(){return s(void 0)};return typeof e=="string"?(o.fromAttributes=a,o.fromGraph=function(c,h){return a(c.getEdgeAttributes(h))},o.fromEntry=function(c,h){return a(h)},o.fromPartialEntry=o.fromEntry,o.fromMinimalEntry=o.fromEntry):typeof e=="function"?(o.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},o.fromGraph=function(c,h){var l=c.extremities(h);return s(e(h,c.getEdgeAttributes(h),l[0],l[1],c.getNodeAttributes(l[0]),c.getNodeAttributes(l[1]),c.isUndirected(h)))},o.fromEntry=function(c,h,l,d,f,p,b){return s(e(c,h,l,d,f,p,b))},o.fromPartialEntry=function(c,h,l,d){return s(e(c,h,l,d))},o.fromMinimalEntry=function(c,h){return s(e(c,h))}):(o.fromAttributes=u,o.fromGraph=u,o.fromEntry=u,o.fromMinimalEntry=u),o}return st.createNodeValueGetter=t,st.createEdgeValueGetter=n,st.createEdgeWeightGetter=function(e){return n(e,i)},st}var un,ji;function Da(){if(ji)return un;ji=1;var i=0,t=1,n=2,e=3,r=4,o=5,s=6,a=7,u=8,c=9,h=0,l=1,d=2,f=0,p=1,b=2,v=3,y=4,w=5,m=6,g=7,S=8,E=3,_=10,A=3,R=9,L=10;return un=function(N,T,V){var q,I,D,F,W,B,Y,X,x,Q,te=T.length,ne=V.length,re=N.adjustSizes,_e=N.barnesHutTheta*N.barnesHutTheta,ce,Z,j,K,de,M,U,C=[];for(D=0;D<te;D+=_)T[D+r]=T[D+n],T[D+o]=T[D+e],T[D+n]=0,T[D+e]=0;if(N.outboundAttractionDistribution){for(ce=0,D=0;D<te;D+=_)ce+=T[D+s];ce/=te/_}if(N.barnesHutOptimize){var Ge=1/0,Ke=-1/0,Fe=1/0,Xe=-1/0,ye,Ze,Gn;for(D=0;D<te;D+=_)Ge=Math.min(Ge,T[D+i]),Ke=Math.max(Ke,T[D+i]),Fe=Math.min(Fe,T[D+t]),Xe=Math.max(Xe,T[D+t]);var Nt=Ke-Ge,xt=Xe-Fe;for(Nt>xt?(Fe-=(Nt-xt)/2,Xe=Fe+Nt):(Ge-=(xt-Nt)/2,Ke=Ge+xt),C[0+f]=-1,C[0+p]=(Ge+Ke)/2,C[0+b]=(Fe+Xe)/2,C[0+v]=Math.max(Ke-Ge,Xe-Fe),C[0+y]=-1,C[0+w]=-1,C[0+m]=0,C[0+g]=0,C[0+S]=0,q=1,D=0;D<te;D+=_)for(I=0,Gn=E;;)if(C[I+w]>=0){T[D+i]<C[I+p]?T[D+t]<C[I+b]?ye=C[I+w]:ye=C[I+w]+R:T[D+t]<C[I+b]?ye=C[I+w]+R*2:ye=C[I+w]+R*3,C[I+g]=(C[I+g]*C[I+m]+T[D+i]*T[D+s])/(C[I+m]+T[D+s]),C[I+S]=(C[I+S]*C[I+m]+T[D+t]*T[D+s])/(C[I+m]+T[D+s]),C[I+m]+=T[D+s],I=ye;continue}else if(C[I+f]<0){C[I+f]=D;break}else{if(C[I+w]=q*R,X=C[I+v]/2,x=C[I+w],C[x+f]=-1,C[x+p]=C[I+p]-X,C[x+b]=C[I+b]-X,C[x+v]=X,C[x+y]=x+R,C[x+w]=-1,C[x+m]=0,C[x+g]=0,C[x+S]=0,x+=R,C[x+f]=-1,C[x+p]=C[I+p]-X,C[x+b]=C[I+b]+X,C[x+v]=X,C[x+y]=x+R,C[x+w]=-1,C[x+m]=0,C[x+g]=0,C[x+S]=0,x+=R,C[x+f]=-1,C[x+p]=C[I+p]+X,C[x+b]=C[I+b]-X,C[x+v]=X,C[x+y]=x+R,C[x+w]=-1,C[x+m]=0,C[x+g]=0,C[x+S]=0,x+=R,C[x+f]=-1,C[x+p]=C[I+p]+X,C[x+b]=C[I+b]+X,C[x+v]=X,C[x+y]=C[I+y],C[x+w]=-1,C[x+m]=0,C[x+g]=0,C[x+S]=0,q+=4,T[C[I+f]+i]<C[I+p]?T[C[I+f]+t]<C[I+b]?ye=C[I+w]:ye=C[I+w]+R:T[C[I+f]+t]<C[I+b]?ye=C[I+w]+R*2:ye=C[I+w]+R*3,C[I+m]=T[C[I+f]+s],C[I+g]=T[C[I+f]+i],C[I+S]=T[C[I+f]+t],C[ye+f]=C[I+f],C[I+f]=-1,T[D+i]<C[I+p]?T[D+t]<C[I+b]?Ze=C[I+w]:Ze=C[I+w]+R:T[D+t]<C[I+b]?Ze=C[I+w]+R*2:Ze=C[I+w]+R*3,ye===Ze)if(Gn--){I=ye;continue}else{Gn=E;break}C[Ze+f]=D;break}}if(N.barnesHutOptimize)for(Z=N.scalingRatio,D=0;D<te;D+=_)for(I=0;;)if(C[I+w]>=0)if(M=Math.pow(T[D+i]-C[I+g],2)+Math.pow(T[D+t]-C[I+S],2),Q=C[I+v],4*Q*Q/M<_e){if(j=T[D+i]-C[I+g],K=T[D+t]-C[I+S],re===!0?M>0?(U=Z*T[D+s]*C[I+m]/M,T[D+n]+=j*U,T[D+e]+=K*U):M<0&&(U=-Z*T[D+s]*C[I+m]/Math.sqrt(M),T[D+n]+=j*U,T[D+e]+=K*U):M>0&&(U=Z*T[D+s]*C[I+m]/M,T[D+n]+=j*U,T[D+e]+=K*U),I=C[I+y],I<0)break;continue}else{I=C[I+w];continue}else{if(B=C[I+f],B>=0&&B!==D&&(j=T[D+i]-T[B+i],K=T[D+t]-T[B+t],M=j*j+K*K,re===!0?M>0?(U=Z*T[D+s]*T[B+s]/M,T[D+n]+=j*U,T[D+e]+=K*U):M<0&&(U=-Z*T[D+s]*T[B+s]/Math.sqrt(M),T[D+n]+=j*U,T[D+e]+=K*U):M>0&&(U=Z*T[D+s]*T[B+s]/M,T[D+n]+=j*U,T[D+e]+=K*U)),I=C[I+y],I<0)break;continue}else for(Z=N.scalingRatio,F=0;F<te;F+=_)for(W=0;W<F;W+=_)j=T[F+i]-T[W+i],K=T[F+t]-T[W+t],re===!0?(M=Math.sqrt(j*j+K*K)-T[F+u]-T[W+u],M>0?(U=Z*T[F+s]*T[W+s]/M/M,T[F+n]+=j*U,T[F+e]+=K*U,T[W+n]-=j*U,T[W+e]-=K*U):M<0&&(U=100*Z*T[F+s]*T[W+s],T[F+n]+=j*U,T[F+e]+=K*U,T[W+n]-=j*U,T[W+e]-=K*U)):(M=Math.sqrt(j*j+K*K),M>0&&(U=Z*T[F+s]*T[W+s]/M/M,T[F+n]+=j*U,T[F+e]+=K*U,T[W+n]-=j*U,T[W+e]-=K*U));for(x=N.gravity/N.scalingRatio,Z=N.scalingRatio,D=0;D<te;D+=_)U=0,j=T[D+i],K=T[D+t],M=Math.sqrt(Math.pow(j,2)+Math.pow(K,2)),N.strongGravityMode?M>0&&(U=Z*T[D+s]*x):M>0&&(U=Z*T[D+s]*x/M),T[D+n]-=j*U,T[D+e]-=K*U;for(Z=1*(N.outboundAttractionDistribution?ce:1),Y=0;Y<ne;Y+=A)F=V[Y+h],W=V[Y+l],X=V[Y+d],de=Math.pow(X,N.edgeWeightInfluence),j=T[F+i]-T[W+i],K=T[F+t]-T[W+t],re===!0?(M=Math.sqrt(j*j+K*K)-T[F+u]-T[W+u],N.linLogMode?N.outboundAttractionDistribution?M>0&&(U=-Z*de*Math.log(1+M)/M/T[F+s]):M>0&&(U=-Z*de*Math.log(1+M)/M):N.outboundAttractionDistribution?M>0&&(U=-Z*de/T[F+s]):M>0&&(U=-Z*de)):(M=Math.sqrt(Math.pow(j,2)+Math.pow(K,2)),N.linLogMode?N.outboundAttractionDistribution?M>0&&(U=-Z*de*Math.log(1+M)/M/T[F+s]):M>0&&(U=-Z*de*Math.log(1+M)/M):N.outboundAttractionDistribution?(M=1,U=-Z*de/T[F+s]):(M=1,U=-Z*de)),M>0&&(T[F+n]+=j*U,T[F+e]+=K*U,T[W+n]-=j*U,T[W+e]-=K*U);var Pt,ut,Ot,ze,Gt,Ft;if(re===!0)for(D=0;D<te;D+=_)T[D+c]!==1&&(Pt=Math.sqrt(Math.pow(T[D+n],2)+Math.pow(T[D+e],2)),Pt>L&&(T[D+n]=T[D+n]*L/Pt,T[D+e]=T[D+e]*L/Pt),ut=T[D+s]*Math.sqrt((T[D+r]-T[D+n])*(T[D+r]-T[D+n])+(T[D+o]-T[D+e])*(T[D+o]-T[D+e])),Ot=Math.sqrt((T[D+r]+T[D+n])*(T[D+r]+T[D+n])+(T[D+o]+T[D+e])*(T[D+o]+T[D+e]))/2,ze=.1*Math.log(1+Ot)/(1+Math.sqrt(ut)),Gt=T[D+i]+T[D+n]*(ze/N.slowDown),T[D+i]=Gt,Ft=T[D+t]+T[D+e]*(ze/N.slowDown),T[D+t]=Ft);else for(D=0;D<te;D+=_)T[D+c]!==1&&(ut=T[D+s]*Math.sqrt((T[D+r]-T[D+n])*(T[D+r]-T[D+n])+(T[D+o]-T[D+e])*(T[D+o]-T[D+e])),Ot=Math.sqrt((T[D+r]+T[D+n])*(T[D+r]+T[D+n])+(T[D+o]+T[D+e])*(T[D+o]+T[D+e]))/2,ze=T[D+a]*Math.log(1+Ot)/(1+Math.sqrt(ut)),T[D+a]=Math.min(1,Math.sqrt(ze*(Math.pow(T[D+n],2)+Math.pow(T[D+e],2))/(1+Math.sqrt(ut)))),Gt=T[D+i]+T[D+n]*(ze/N.slowDown),T[D+i]=Gt,Ft=T[D+t]+T[D+e]*(ze/N.slowDown),T[D+t]=Ft);return{}},un}var Ie={},Vi;function Ra(){if(Vi)return Ie;Vi=1;var i=10,t=3;return Ie.assign=function(n){n=n||{};var e=Array.prototype.slice.call(arguments).slice(1),r,o,s;for(r=0,s=e.length;r<s;r++)if(e[r])for(o in e[r])n[o]=e[r][o];return n},Ie.validateSettings=function(n){return"linLogMode"in n&&typeof n.linLogMode!="boolean"?{message:"the `linLogMode` setting should be a boolean."}:"outboundAttractionDistribution"in n&&typeof n.outboundAttractionDistribution!="boolean"?{message:"the `outboundAttractionDistribution` setting should be a boolean."}:"adjustSizes"in n&&typeof n.adjustSizes!="boolean"?{message:"the `adjustSizes` setting should be a boolean."}:"edgeWeightInfluence"in n&&typeof n.edgeWeightInfluence!="number"?{message:"the `edgeWeightInfluence` setting should be a number."}:"scalingRatio"in n&&!(typeof n.scalingRatio=="number"&&n.scalingRatio>=0)?{message:"the `scalingRatio` setting should be a number >= 0."}:"strongGravityMode"in n&&typeof n.strongGravityMode!="boolean"?{message:"the `strongGravityMode` setting should be a boolean."}:"gravity"in n&&!(typeof n.gravity=="number"&&n.gravity>=0)?{message:"the `gravity` setting should be a number >= 0."}:"slowDown"in n&&!(typeof n.slowDown=="number"||n.slowDown>=0)?{message:"the `slowDown` setting should be a number >= 0."}:"barnesHutOptimize"in n&&typeof n.barnesHutOptimize!="boolean"?{message:"the `barnesHutOptimize` setting should be a boolean."}:"barnesHutTheta"in n&&!(typeof n.barnesHutTheta=="number"&&n.barnesHutTheta>=0)?{message:"the `barnesHutTheta` setting should be a number >= 0."}:null},Ie.graphToByteArrays=function(n,e){var r=n.order,o=n.size,s={},a,u=new Float32Array(r*i),c=new Float32Array(o*t);return a=0,n.forEachNode(function(h,l){s[h]=a,u[a]=l.x,u[a+1]=l.y,u[a+2]=0,u[a+3]=0,u[a+4]=0,u[a+5]=0,u[a+6]=1,u[a+7]=1,u[a+8]=l.size||1,u[a+9]=l.fixed?1:0,a+=i}),a=0,n.forEachEdge(function(h,l,d,f,p,b,v){var y=s[d],w=s[f],m=e(h,l,d,f,p,b,v);u[y+6]+=m,u[w+6]+=m,c[a]=y,c[a+1]=w,c[a+2]=m,a+=t}),{nodes:u,edges:c}},Ie.assignLayoutChanges=function(n,e,r){var o=0;n.updateEachNodeAttributes(function(s,a){return a.x=e[o],a.y=e[o+1],o+=i,r?r(s,a):a})},Ie.readGraphPositions=function(n,e){var r=0;n.forEachNode(function(o,s){e[r]=s.x,e[r+1]=s.y,r+=i})},Ie.collectLayoutChanges=function(n,e,r){for(var o=n.nodes(),s={},a=0,u=0,c=e.length;a<c;a+=i){if(r){var h=Object.assign({},n.getNodeAttributes(o[u]));h.x=e[a],h.y=e[a+1],h=r(o[u],h),s[o[u]]={x:h.x,y:h.y}}else s[o[u]]={x:e[a],y:e[a+1]};u++}return s},Ie.createWorker=function(e){var r=window.URL||window.webkitURL,o=e.toString(),s=r.createObjectURL(new Blob(["("+o+").call(this);"],{type:"text/javascript"})),a=new Worker(s);return r.revokeObjectURL(s),a},Ie}var cn,qi;function Ca(){return qi||(qi=1,cn={linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:1,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5}),cn}var hn,Yi;function La(){if(Yi)return hn;Yi=1;var i=gt(),t=Hi().createEdgeWeightGetter,n=Da(),e=Ra(),r=Ca();function o(u,c,h){if(!i(c))throw new Error("graphology-layout-forceatlas2: the given graph is not a valid graphology instance.");typeof h=="number"&&(h={iterations:h});var l=h.iterations;if(typeof l!="number")throw new Error("graphology-layout-forceatlas2: invalid number of iterations.");if(l<=0)throw new Error("graphology-layout-forceatlas2: you should provide a positive number of iterations.");var d=t("getEdgeWeight"in h?h.getEdgeWeight:"weight").fromEntry,f=typeof h.outputReducer=="function"?h.outputReducer:null,p=e.assign({},r,h.settings),b=e.validateSettings(p);if(b)throw new Error("graphology-layout-forceatlas2: "+b.message);var v=e.graphToByteArrays(c,d),y;for(y=0;y<l;y++)n(p,v.nodes,v.edges);if(u){e.assignLayoutChanges(c,v.nodes,f);return}return e.collectLayoutChanges(c,v.nodes)}function s(u){var c=typeof u=="number"?u:u.order;return{barnesHutOptimize:c>2e3,strongGravityMode:!0,gravity:.05,scalingRatio:10,slowDown:1+Math.log(c)}}var a=o.bind(null,!1);return a.assign=o.bind(null,!0),a.inferSettings=s,hn=a,hn}var Ia=La();const ka=Ae(Ia);var ln,Ki;function Xi(){if(Ki)return ln;Ki=1;function i(n){return!n||typeof n!="object"||typeof n=="function"||Array.isArray(n)||n instanceof Set||n instanceof Map||n instanceof RegExp||n instanceof Date}function t(n,e){n=n||{};var r={};for(var o in e){var s=n[o],a=e[o];if(!i(a)){r[o]=t(s,a);continue}s===void 0?r[o]=a:r[o]=s}return r}return ln=t,ln}var dn,Zi;function Na(){if(Zi)return dn;Zi=1;var i=gt();return dn=function(n){if(!i(n))throw new Error("graphology-utils/infer-type: expecting a valid graphology instance.");var e=n.type;return e!=="mixed"?e:n.directedSize===0&&n.undirectedSize===0||n.directedSize>0&&n.undirectedSize>0?"mixed":n.directedSize>0?"directed":"undirected"},dn}var fn,Ji;function Qi(){if(Ji)return fn;Ji=1;function i(t){if(typeof t!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=t}return typeof Symbol<"u"&&(i.prototype[Symbol.iterator]=function(){return this}),i.of=function(){var t=arguments,n=t.length,e=0;return new i(function(){return e>=n?{done:!0}:{done:!1,value:t[e++]}})},i.empty=function(){var t=new i(function(){return{done:!0}});return t},i.fromSequence=function(t){var n=0,e=t.length;return new i(function(){return n>=e?{done:!0}:{done:!1,value:t[n++]}})},i.is=function(t){return t instanceof i?!0:typeof t=="object"&&t!==null&&typeof t.next=="function"},fn=i,fn}var gn={},er;function pn(){return er||(er=1,(function(i){var t=Math.pow(2,8)-1,n=Math.pow(2,16)-1,e=Math.pow(2,32)-1,r=Math.pow(2,7)-1,o=Math.pow(2,15)-1,s=Math.pow(2,31)-1;i.getPointerArray=function(u){var c=u-1;if(c<=t)return Uint8Array;if(c<=n)return Uint16Array;if(c<=e)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},i.getSignedPointerArray=function(u){var c=u-1;return c<=r?Int8Array:c<=o?Int16Array:c<=s?Int32Array:Float64Array},i.getNumberType=function(u){return u===(u|0)?Math.sign(u)===-1?u<=127&&u>=-128?Int8Array:u<=32767&&u>=-32768?Int16Array:Int32Array:u<=255?Uint8Array:u<=65535?Uint16Array:Uint32Array:Float64Array};var a={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};i.getMinimalRepresentation=function(u,c){var h=null,l=0,d,f,p,b,v;for(b=0,v=u.length;b<v;b++)p=c?c(u[b]):u[b],f=i.getNumberType(p),d=a[f.name],d>l&&(l=d,h=f);return h},i.isTypedArray=function(u){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(u)},i.concat=function(){var u=0,c,h,l;for(c=0,l=arguments.length;c<l;c++)u+=arguments[c].length;var d=new arguments[0].constructor(u);for(c=0,h=0;c<l;c++)d.set(arguments[c],h),h+=arguments[c].length;return d},i.indices=function(u){for(var c=i.getPointerArray(u),h=new c(u),l=0;l<u;l++)h[l]=l;return h}})(gn)),gn}var mn,tr;function xa(){if(tr)return mn;tr=1;var i=Qi(),t=pn().getPointerArray;function n(e,r){arguments.length<2&&(r=e,e=Array);var o=t(r);this.size=0,this.length=r,this.dense=new o(r),this.sparse=new o(r),this.vals=new e(r)}return n.prototype.clear=function(){this.size=0},n.prototype.has=function(e){var r=this.sparse[e];return r<this.size&&this.dense[r]===e},n.prototype.get=function(e){var r=this.sparse[e];if(r<this.size&&this.dense[r]===e)return this.vals[r]},n.prototype.set=function(e,r){var o=this.sparse[e];return o<this.size&&this.dense[o]===e?(this.vals[o]=r,this):(this.dense[this.size]=e,this.sparse[e]=this.size,this.vals[this.size]=r,this.size++,this)},n.prototype.delete=function(e){var r=this.sparse[e];return r>=this.size||this.dense[r]!==e?!1:(r=this.dense[this.size-1],this.dense[this.sparse[e]]=r,this.sparse[r]=this.sparse[e],this.size--,!0)},n.prototype.forEach=function(e,r){r=arguments.length>1?r:this;for(var o=0;o<this.size;o++)e.call(r,this.vals[o],this.dense[o])},n.prototype.keys=function(){var e=this.size,r=this.dense,o=0;return new i(function(){if(o<e){var s=r[o];return o++,{value:s}}return{done:!0}})},n.prototype.values=function(){var e=this.size,r=this.vals,o=0;return new i(function(){if(o<e){var s=r[o];return o++,{value:s}}return{done:!0}})},n.prototype.entries=function(){var e=this.size,r=this.dense,o=this.vals,s=0;return new i(function(){if(s<e){var a=[r[s],o[s]];return s++,{value:a}}return{done:!0}})},typeof Symbol<"u"&&(n.prototype[Symbol.iterator]=n.prototype.entries),n.prototype.inspect=function(){for(var e=new Map,r=0;r<this.size;r++)e.set(this.dense[r],this.vals[r]);return Object.defineProperty(e,"constructor",{value:n,enumerable:!1}),e.length=this.length,this.vals.constructor!==Array&&(e.type=this.vals.constructor.name),e},typeof Symbol<"u"&&(n.prototype[Symbol.for("nodejs.util.inspect.custom")]=n.prototype.inspect),mn=n,mn}var vn,nr;function Pa(){if(nr)return vn;nr=1;var i=Qi(),t=pn().getPointerArray;function n(e){var r=t(e);this.start=0,this.size=0,this.capacity=e,this.dense=new r(e),this.sparse=new r(e)}return n.prototype.clear=function(){this.start=0,this.size=0},n.prototype.has=function(e){if(this.size===0)return!1;var r=this.sparse[e],o=r<this.capacity&&r>=this.start&&r<this.start+this.size||r<(this.start+this.size)%this.capacity;return o&&this.dense[r]===e},n.prototype.enqueue=function(e){var r=this.sparse[e];if(this.size!==0){var o=r<this.capacity&&r>=this.start&&r<this.start+this.size||r<(this.start+this.size)%this.capacity;if(o&&this.dense[r]===e)return this}return r=(this.start+this.size)%this.capacity,this.dense[r]=e,this.sparse[e]=r,this.size++,this},n.prototype.dequeue=function(){if(this.size!==0){var e=this.start;this.size--,this.start++,this.start===this.capacity&&(this.start=0);var r=this.dense[e];return this.sparse[r]=this.capacity,r}},n.prototype.forEach=function(e,r){r=arguments.length>1?r:this;for(var o=this.capacity,s=this.size,a=this.start,u=0;u<s;)e.call(r,this.dense[a],u,this),a++,u++,a===o&&(a=0)},n.prototype.values=function(){var e=this.dense,r=this.capacity,o=this.size,s=this.start,a=0;return new i(function(){if(a>=o)return{done:!0};var u=e[s];return s++,a++,s===r&&(s=0),{value:u,done:!1}})},typeof Symbol<"u"&&(n.prototype[Symbol.iterator]=n.prototype.values),n.prototype.inspect=function(){var e=[];return this.forEach(function(r){e.push(r)}),Object.defineProperty(e,"constructor",{value:n,enumerable:!1}),e.capacity=this.capacity,e},typeof Symbol<"u"&&(n.prototype[Symbol.for("nodejs.util.inspect.custom")]=n.prototype.inspect),vn=n,vn}var yn,ir;function Oa(){if(ir)return yn;ir=1;function i(n){return function(e){return typeof e!="number"&&(e=e.length),Math.floor(n()*e)}}var t=i(Math.random);return t.createRandomIndex=i,yn=t,yn}var yt={},rr;function Ga(){if(rr)return yt;rr=1;var i=pn(),t=Xi(),n=Hi().createEdgeWeightGetter,e=Symbol.for("nodejs.util.inspect.custom"),r={getEdgeWeight:"weight",keepDendrogram:!1,resolution:1};function o(a,u){u=t(u,r);var c=u.resolution,h=n(u.getEdgeWeight).fromEntry,l=(a.size-a.selfLoopCount)*2,d=i.getPointerArray(l),f=i.getPointerArray(a.order+1),p=u.getEdgeWeight?Float64Array:i.getPointerArray(a.size*2);this.C=a.order,this.M=0,this.E=l,this.U=0,this.resolution=c,this.level=0,this.graph=a,this.nodes=new Array(a.order),this.keepDendrogram=u.keepDendrogram,this.neighborhood=new f(l),this.weights=new p(l),this.loops=new p(a.order),this.starts=new d(a.order+1),this.belongings=new f(a.order),this.dendrogram=[],this.mapping=null,this.counts=new f(a.order),this.unused=new f(a.order),this.totalWeights=new p(a.order);var b={},v,y=0,w=0,m=this;a.forEachNode(function(g){m.nodes[y]=g,b[g]=y,w+=a.undirectedDegreeWithoutSelfLoops(g),m.starts[y]=w,m.belongings[y]=y,m.counts[y]=1,y++}),a.forEachEdge(function(g,S,E,_,A,R,L){if(v=h(g,S,E,_,A,R,L),E=b[E],_=b[_],m.M+=v,E===_)m.totalWeights[E]+=v*2,m.loops[E]=v*2;else{m.totalWeights[E]+=v,m.totalWeights[_]+=v;var z=--m.starts[E],N=--m.starts[_];m.neighborhood[z]=_,m.neighborhood[N]=E,m.weights[z]=v,m.weights[N]=v}}),this.starts[y]=this.E,this.keepDendrogram?this.dendrogram.push(this.belongings.slice()):this.mapping=this.belongings.slice()}o.prototype.isolate=function(a,u){var c=this.belongings[a];if(this.counts[c]===1)return c;var h=this.unused[--this.U],l=this.loops[a];return this.totalWeights[c]-=u+l,this.totalWeights[h]+=u+l,this.belongings[a]=h,this.counts[c]--,this.counts[h]++,h},o.prototype.move=function(a,u,c){var h=this.belongings[a],l=this.loops[a];this.totalWeights[h]-=u+l,this.totalWeights[c]+=u+l,this.belongings[a]=c;var d=this.counts[h]--===1;this.counts[c]++,d&&(this.unused[this.U++]=h)},o.prototype.computeNodeDegree=function(a){var u,c,h,l=0;for(u=this.starts[a],c=this.starts[a+1];u<c;u++)h=this.weights[u],l+=h;return l},o.prototype.expensiveIsolate=function(a){var u=this.computeNodeDegree(a);return this.isolate(a,u)},o.prototype.expensiveMove=function(a,u){var c=this.computeNodeDegree(a);this.move(a,c,u)},o.prototype.zoomOut=function(){var a=new Array(this.C-this.U),u={},c=this.nodes.length,h=0,l=0,d,f,p,b,v,y,w,m,g;for(d=0,p=this.C;d<p;d++)y=this.belongings[d],y in u||(u[y]=h,a[h]={adj:{},totalWeights:this.totalWeights[y],internalWeights:0},h++),this.belongings[d]=u[y];var S,E;if(this.keepDendrogram){for(S=this.dendrogram[this.level],E=new(i.getPointerArray(h))(c),d=0;d<c;d++)E[d]=this.belongings[S[d]];this.dendrogram.push(E)}else for(d=0;d<c;d++)this.mapping[d]=this.belongings[this.mapping[d]];for(d=0,p=this.C;d<p;d++)for(y=this.belongings[d],m=a[y],g=m.adj,m.internalWeights+=this.loops[d],f=this.starts[d],b=this.starts[d+1];f<b;f++){if(v=this.neighborhood[f],w=this.belongings[v],y===w){m.internalWeights+=this.weights[f];continue}w in g||(g[w]=0),g[w]+=this.weights[f]}for(this.C=h,v=0,y=0;y<h;y++){m=a[y],g=m.adj,y=+y,this.totalWeights[y]=m.totalWeights,this.loops[y]=m.internalWeights,this.counts[y]=1,this.starts[y]=v,this.belongings[y]=y;for(w in g)this.neighborhood[v]=+w,this.weights[v]=g[w],l++,v++}return this.starts[h]=l,this.E=l,this.U=0,this.level++,u},o.prototype.modularity=function(){var a,u,c,h,l,d=0,f=this.M*2,p=new Float64Array(this.C);for(c=0;c<this.C;c++)for(a=this.belongings[c],p[a]+=this.loops[c],h=this.starts[c],l=this.starts[c+1];h<l;h++)u=this.belongings[this.neighborhood[h]],a===u&&(p[a]+=this.weights[h]);for(c=0;c<this.C;c++)d+=p[c]/f-Math.pow(this.totalWeights[c]/f,2)*this.resolution;return d},o.prototype.delta=function(a,u,c,h){var l=this.M,d=this.totalWeights[h];return u+=this.loops[a],c/l-d*u*this.resolution/(2*l*l)},o.prototype.deltaWithOwnCommunity=function(a,u,c,h){var l=this.M,d=this.totalWeights[h];return u+=this.loops[a],c/l-(d-u)*u*this.resolution/(2*l*l)},o.prototype.fastDelta=function(a,u,c,h){var l=this.M,d=this.totalWeights[h];return u+=this.loops[a],c-u*d*this.resolution/(2*l)},o.prototype.fastDeltaWithOwnCommunity=function(a,u,c,h){var l=this.M,d=this.totalWeights[h];return u+=this.loops[a],c-u*(d-u)*this.resolution/(2*l)},o.prototype.bounds=function(a){return[this.starts[a],this.starts[a+1]]},o.prototype.project=function(){var a=this,u={};return a.nodes.slice(0,this.C).forEach(function(c,h){u[c]=Array.from(a.neighborhood.slice(a.starts[h],a.starts[h+1])).map(function(l){return a.nodes[l]})}),u},o.prototype.collect=function(a){arguments.length<1&&(a=this.level);var u={},c=this.keepDendrogram?this.dendrogram[a]:this.mapping,h,l;for(h=0,l=c.length;h<l;h++)u[this.nodes[h]]=c[h];return u},o.prototype.assign=function(a,u){arguments.length<2&&(u=this.level);var c=this.keepDendrogram?this.dendrogram[u]:this.mapping,h,l;for(h=0,l=c.length;h<l;h++)this.graph.setNodeAttribute(this.nodes[h],a,c[h])},o.prototype[e]=function(){var a={};Object.defineProperty(a,"constructor",{value:o,enumerable:!1}),a.C=this.C,a.M=this.M,a.E=this.E,a.U=this.U,a.resolution=this.resolution,a.level=this.level,a.nodes=this.nodes,a.starts=this.starts.slice(0,a.C+1);var u=["neighborhood","weights"],c=["counts","loops","belongings","totalWeights"],h=this;return u.forEach(function(l){a[l]=h[l].slice(0,a.E)}),c.forEach(function(l){a[l]=h[l].slice(0,a.C)}),a.unused=this.unused.slice(0,this.U),this.keepDendrogram?a.dendrogram=this.dendrogram:a.mapping=this.mapping,a};function s(a,u){u=t(u,r);var c=u.resolution,h=n(u.getEdgeWeight).fromEntry,l=(a.size-a.selfLoopCount)*2,d=i.getPointerArray(l),f=i.getPointerArray(a.order+1),p=u.getEdgeWeight?Float64Array:i.getPointerArray(a.size*2);this.C=a.order,this.M=0,this.E=l,this.U=0,this.resolution=c,this.level=0,this.graph=a,this.nodes=new Array(a.order),this.keepDendrogram=u.keepDendrogram,this.neighborhood=new f(l),this.weights=new p(l),this.loops=new p(a.order),this.starts=new d(a.order+1),this.offsets=new d(a.order),this.belongings=new f(a.order),this.dendrogram=[],this.counts=new f(a.order),this.unused=new f(a.order),this.totalInWeights=new p(a.order),this.totalOutWeights=new p(a.order);var b={},v,y=0,w=0,m=this;a.forEachNode(function(g){m.nodes[y]=g,b[g]=y,w+=a.outDegreeWithoutSelfLoops(g),m.starts[y]=w,w+=a.inDegreeWithoutSelfLoops(g),m.offsets[y]=w,m.belongings[y]=y,m.counts[y]=1,y++}),a.forEachEdge(function(g,S,E,_,A,R,L){if(v=h(g,S,E,_,A,R,L),E=b[E],_=b[_],m.M+=v,E===_)m.loops[E]+=v,m.totalInWeights[E]+=v,m.totalOutWeights[E]+=v;else{m.totalOutWeights[E]+=v,m.totalInWeights[_]+=v;var z=--m.starts[E],N=--m.offsets[_];m.neighborhood[z]=_,m.neighborhood[N]=E,m.weights[z]=v,m.weights[N]=v}}),this.starts[y]=this.E,this.keepDendrogram?this.dendrogram.push(this.belongings.slice()):this.mapping=this.belongings.slice()}return s.prototype.bounds=o.prototype.bounds,s.prototype.inBounds=function(a){return[this.offsets[a],this.starts[a+1]]},s.prototype.outBounds=function(a){return[this.starts[a],this.offsets[a]]},s.prototype.project=o.prototype.project,s.prototype.projectIn=function(){var a=this,u={};return a.nodes.slice(0,this.C).forEach(function(c,h){u[c]=Array.from(a.neighborhood.slice(a.offsets[h],a.starts[h+1])).map(function(l){return a.nodes[l]})}),u},s.prototype.projectOut=function(){var a=this,u={};return a.nodes.slice(0,this.C).forEach(function(c,h){u[c]=Array.from(a.neighborhood.slice(a.starts[h],a.offsets[h])).map(function(l){return a.nodes[l]})}),u},s.prototype.isolate=function(a,u,c){var h=this.belongings[a];if(this.counts[h]===1)return h;var l=this.unused[--this.U],d=this.loops[a];return this.totalInWeights[h]-=u+d,this.totalInWeights[l]+=u+d,this.totalOutWeights[h]-=c+d,this.totalOutWeights[l]+=c+d,this.belongings[a]=l,this.counts[h]--,this.counts[l]++,l},s.prototype.move=function(a,u,c,h){var l=this.belongings[a],d=this.loops[a];this.totalInWeights[l]-=u+d,this.totalInWeights[h]+=u+d,this.totalOutWeights[l]-=c+d,this.totalOutWeights[h]+=c+d,this.belongings[a]=h;var f=this.counts[l]--===1;this.counts[h]++,f&&(this.unused[this.U++]=l)},s.prototype.computeNodeInDegree=function(a){var u,c,h,l=0;for(u=this.offsets[a],c=this.starts[a+1];u<c;u++)h=this.weights[u],l+=h;return l},s.prototype.computeNodeOutDegree=function(a){var u,c,h,l=0;for(u=this.starts[a],c=this.offsets[a];u<c;u++)h=this.weights[u],l+=h;return l},s.prototype.expensiveMove=function(a,u){var c=this.computeNodeInDegree(a),h=this.computeNodeOutDegree(a);this.move(a,c,h,u)},s.prototype.zoomOut=function(){var a=new Array(this.C-this.U),u={},c=this.nodes.length,h=0,l=0,d,f,p,b,v,y,w,m,g,S,E,_,A;for(d=0,p=this.C;d<p;d++)y=this.belongings[d],y in u||(u[y]=h,a[h]={inAdj:{},outAdj:{},totalInWeights:this.totalInWeights[y],totalOutWeights:this.totalOutWeights[y],internalWeights:0},h++),this.belongings[d]=u[y];var R,L;if(this.keepDendrogram){for(R=this.dendrogram[this.level],L=new(i.getPointerArray(h))(c),d=0;d<c;d++)L[d]=this.belongings[R[d]];this.dendrogram.push(L)}else for(d=0;d<c;d++)this.mapping[d]=this.belongings[this.mapping[d]];for(d=0,p=this.C;d<p;d++)for(y=this.belongings[d],g=this.offsets[d],m=a[y],_=m.inAdj,A=m.outAdj,m.internalWeights+=this.loops[d],f=this.starts[d],b=this.starts[d+1];f<b;f++){if(v=this.neighborhood[f],w=this.belongings[v],S=f<g,E=S?A:_,y===w){S&&(m.internalWeights+=this.weights[f]);continue}w in E||(E[w]=0),E[w]+=this.weights[f]}for(this.C=h,v=0,y=0;y<h;y++){m=a[y],_=m.inAdj,A=m.outAdj,y=+y,this.totalInWeights[y]=m.totalInWeights,this.totalOutWeights[y]=m.totalOutWeights,this.loops[y]=m.internalWeights,this.counts[y]=1,this.starts[y]=v,this.belongings[y]=y;for(w in A)this.neighborhood[v]=+w,this.weights[v]=A[w],l++,v++;this.offsets[y]=v;for(w in _)this.neighborhood[v]=+w,this.weights[v]=_[w],l++,v++}return this.starts[h]=l,this.E=l,this.U=0,this.level++,u},s.prototype.modularity=function(){var a,u,c,h,l,d=0,f=this.M,p=new Float64Array(this.C);for(c=0;c<this.C;c++)for(a=this.belongings[c],p[a]+=this.loops[c],h=this.starts[c],l=this.offsets[c];h<l;h++)u=this.belongings[this.neighborhood[h]],a===u&&(p[a]+=this.weights[h]);for(c=0;c<this.C;c++)d+=p[c]/f-this.totalInWeights[c]*this.totalOutWeights[c]/Math.pow(f,2)*this.resolution;return d},s.prototype.delta=function(a,u,c,h,l){var d=this.M,f=this.totalInWeights[l],p=this.totalOutWeights[l],b=this.loops[a];return u+=b,c+=b,h/d-(c*f+u*p)*this.resolution/(d*d)},s.prototype.deltaWithOwnCommunity=function(a,u,c,h,l){var d=this.M,f=this.totalInWeights[l],p=this.totalOutWeights[l],b=this.loops[a];return u+=b,c+=b,h/d-(c*(f-u)+u*(p-c))*this.resolution/(d*d)},s.prototype.collect=o.prototype.collect,s.prototype.assign=o.prototype.assign,s.prototype[e]=function(){var a={};Object.defineProperty(a,"constructor",{value:s,enumerable:!1}),a.C=this.C,a.M=this.M,a.E=this.E,a.U=this.U,a.resolution=this.resolution,a.level=this.level,a.nodes=this.nodes,a.starts=this.starts.slice(0,a.C+1);var u=["neighborhood","weights"],c=["counts","offsets","loops","belongings","totalInWeights","totalOutWeights"],h=this;return u.forEach(function(l){a[l]=h[l].slice(0,a.E)}),c.forEach(function(l){a[l]=h[l].slice(0,a.C)}),a.unused=this.unused.slice(0,this.U),this.keepDendrogram?a.dendrogram=this.dendrogram:a.mapping=this.mapping,a},yt.UndirectedLouvainIndex=o,yt.DirectedLouvainIndex=s,yt}var bn,or;function Fa(){if(or)return bn;or=1;var i=Xi(),t=gt(),n=Na(),e=xa(),r=Pa(),o=Oa().createRandomIndex,s=Ga(),a=s.UndirectedLouvainIndex,u=s.DirectedLouvainIndex,c={nodeCommunityAttribute:"community",getEdgeWeight:"weight",fastLocalMoves:!0,randomWalk:!0,resolution:1,rng:Math.random};function h(y,w,m){var g=y.get(w);typeof g>"u"&&(g=0),g+=m,y.set(w,g)}var l=1e-10;function d(y,w,m,g,S){return Math.abs(g-S)<l?y===w?!1:m>y:g>S}function f(y,w,m){var g=new a(w,{getEdgeWeight:m.getEdgeWeight,keepDendrogram:y,resolution:m.resolution}),S=o(m.rng),E=!0,_=!0,A,R,L=new e(Float64Array,g.C),z,N,T,V,q,I,D,F,W,B,Y,X,x,Q,te,ne,re=0,_e=0,ce=[],Z,j;for(m.fastLocalMoves&&(z=new r(g.C));E;){if(B=g.C,E=!1,_=!0,m.fastLocalMoves){for(j=0,I=m.randomWalk?S(B):0,D=0;D<B;D++,I++)F=I%B,z.enqueue(F);for(;z.size!==0;){for(F=z.dequeue(),_e++,Y=0,L.clear(),A=g.belongings[F],N=g.starts[F],T=g.starts[F+1];N<T;N++)W=g.neighborhood[N],V=g.weights[N],R=g.belongings[W],Y+=V,h(L,R,V);for(Q=g.fastDeltaWithOwnCommunity(F,Y,L.get(A)||0,A),x=A,q=0;q<L.size;q++)R=L.dense[q],R!==A&&(X=L.vals[q],re++,ne=g.fastDelta(F,Y,X,R),te=d(x,A,R,ne,Q),te&&(Q=ne,x=R));if(Q<0){if(x=g.isolate(F,Y),x===A)continue}else{if(x===A)continue;g.move(F,Y,x)}for(E=!0,j++,N=g.starts[F],T=g.starts[F+1];N<T;N++)W=g.neighborhood[N],R=g.belongings[W],R!==x&&z.enqueue(W)}ce.push(j)}else for(Z=[],ce.push(Z);_;){for(_=!1,j=0,I=m.randomWalk?S(B):0,D=0;D<B;D++,I++){for(F=I%B,_e++,Y=0,L.clear(),A=g.belongings[F],N=g.starts[F],T=g.starts[F+1];N<T;N++)W=g.neighborhood[N],V=g.weights[N],R=g.belongings[W],Y+=V,h(L,R,V);for(Q=g.fastDeltaWithOwnCommunity(F,Y,L.get(A)||0,A),x=A,q=0;q<L.size;q++)R=L.dense[q],R!==A&&(X=L.vals[q],re++,ne=g.fastDelta(F,Y,X,R),te=d(x,A,R,ne,Q),te&&(Q=ne,x=R));if(Q<0){if(x=g.isolate(F,Y),x===A)continue}else{if(x===A)continue;g.move(F,Y,x)}_=!0,j++}Z.push(j),E=_||E}E&&g.zoomOut()}var K={index:g,deltaComputations:re,nodesVisited:_e,moves:ce};return K}function p(y,w,m){var g=new u(w,{getEdgeWeight:m.getEdgeWeight,keepDendrogram:y,resolution:m.resolution}),S=o(m.rng),E=!0,_=!0,A,R,L=new e(Float64Array,g.C),z,N,T,V,q,I,D,F,W,B,Y,X,x,Q,te,ne,re,_e,ce,Z=0,j=0,K=[],de,M;for(m.fastLocalMoves&&(z=new r(g.C));E;){if(X=g.C,E=!1,_=!0,m.fastLocalMoves){for(M=0,F=m.randomWalk?S(X):0,W=0;W<X;W++,F++)B=F%X,z.enqueue(B);for(;z.size!==0;){for(B=z.dequeue(),j++,x=0,Q=0,L.clear(),A=g.belongings[B],N=g.starts[B],T=g.starts[B+1],V=g.offsets[B];N<T;N++)q=N<V,Y=g.neighborhood[N],I=g.weights[N],R=g.belongings[Y],q?Q+=I:x+=I,h(L,R,I);for(re=g.deltaWithOwnCommunity(B,x,Q,L.get(A)||0,A),ne=A,D=0;D<L.size;D++)R=L.dense[D],R!==A&&(te=L.vals[D],Z++,ce=g.delta(B,x,Q,te,R),_e=d(ne,A,R,ce,re),_e&&(re=ce,ne=R));if(re<0){if(ne=g.isolate(B,x,Q),ne===A)continue}else{if(ne===A)continue;g.move(B,x,Q,ne)}for(E=!0,M++,N=g.starts[B],T=g.starts[B+1];N<T;N++)Y=g.neighborhood[N],R=g.belongings[Y],R!==ne&&z.enqueue(Y)}K.push(M)}else for(de=[],K.push(de);_;){for(_=!1,M=0,F=m.randomWalk?S(X):0,W=0;W<X;W++,F++){for(B=F%X,j++,x=0,Q=0,L.clear(),A=g.belongings[B],N=g.starts[B],T=g.starts[B+1],V=g.offsets[B];N<T;N++)q=N<V,Y=g.neighborhood[N],I=g.weights[N],R=g.belongings[Y],q?Q+=I:x+=I,h(L,R,I);for(re=g.deltaWithOwnCommunity(B,x,Q,L.get(A)||0,A),ne=A,D=0;D<L.size;D++)R=L.dense[D],R!==A&&(te=L.vals[D],Z++,ce=g.delta(B,x,Q,te,R),_e=d(ne,A,R,ce,re),_e&&(re=ce,ne=R));if(re<0){if(ne=g.isolate(B,x,Q),ne===A)continue}else{if(ne===A)continue;g.move(B,x,Q,ne)}_=!0,M++}de.push(M),E=_||E}E&&g.zoomOut()}var U={index:g,deltaComputations:Z,nodesVisited:j,moves:K};return U}function b(y,w,m,g){if(!t(m))throw new Error("graphology-communities-louvain: the given graph is not a valid graphology instance.");var S=n(m);if(S==="mixed")throw new Error("graphology-communities-louvain: cannot run the algorithm on a true mixed graph.");g=i(g,c);var E=0;if(m.size===0){if(y){m.forEachNode(function(N){m.setNodeAttribute(N,g.nodeCommunityAttribute,E++)});return}var _={};return m.forEachNode(function(N){_[N]=E++}),w?{communities:_,count:m.order,deltaComputations:0,dendrogram:null,level:0,modularity:NaN,moves:null,nodesVisited:0,resolution:g.resolution}:_}var A=S==="undirected"?f:p,R=A(w,m,g),L=R.index;if(!w){if(y){L.assign(g.nodeCommunityAttribute);return}return L.collect()}var z={count:L.C,deltaComputations:R.deltaComputations,dendrogram:L.dendrogram,level:L.level,modularity:L.modularity(),moves:R.moves,nodesVisited:R.nodesVisited,resolution:g.resolution};return y?(L.assign(g.nodeCommunityAttribute),z):(z.communities=L.collect(),z)}var v=b.bind(null,!1,!1);return v.assign=b.bind(null,!0,!1),v.detailed=b.bind(null,!1,!0),v.defaults=c,bn=v,bn}var za=Fa();const Ma=Ae(za),sr={arabic:"ar",armenian:"am",bulgarian:"bg",czech:"cz",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"},Ua={dutch:/[^A-Za-z0-9_'-]+/gim,english:/[^A-Za-z0-9_'-]+/gim,french:/[^a-z0-9-]+/gim,italian:/[^A-Za-z0-9_'-]+/gim,norwegian:/[^a-z0-9_]+/gim,portuguese:/[^a-z0-9--]/gim,russian:/[^a-z0-9--]+/gim,spanish:/[^a-z0-9A-Z--]+/gim,swedish:/[^a-z0-9_-]+/gim,german:/[^a-z0-9A-Z]+/gim,finnish:/[^a-z0-9]+/gim,danish:/[^a-z0-9]+/gim,hungarian:/[^a-z0-9]+/gim,romanian:/[^a-z0-9]+/gim,serbian:/[^a-z0-9]+/gim,turkish:/[^a-z0-9]+/gim,lithuanian:/[^a-z0-9]+/gim,arabic:/[^a-z0-9-]+/gim,nepali:/[^a-z0-9-]+/gim,irish:/[^a-z0-9]+/gim,indian:/[^a-z0-9-]+/gim,armenian:/[^a-z0-9-]+/gim,greek:/[^a-z0-9--]+/gim,indonesian:/[^a-z0-9]+/gim,ukrainian:/[^a-z0-9--]+/gim,slovenian:/[^a-z0-9]+/gim,bulgarian:/[^a-z0-9--]+/gim,tamil:/[^a-z0-9-]+/gim,sanskrit:/[^a-z0-9A-Z]+/gim,czech:/[^A-Z0-9a-z-]+/gim},wn=Object.keys(sr);function $a(i){return i!==void 0&&wn.includes(i)?sr[i]:void 0}const Ba=Date.now().toString().slice(5);let Wa=0;const ar=BigInt(1e3),ur=BigInt(1e6),cr=BigInt(1e9),En=65535;function hr(i,t){if(t.length<En)Array.prototype.push.apply(i,t);else{const n=t.length;for(let e=0;e<n;e+=En)Array.prototype.push.apply(i,t.slice(e,e+En))}}function Ha(i,...t){return i.replace(/%(?:(?<position>\d+)\$)?(?<width>-?\d*\.?\d*)(?<type>[dfs])/g,function(...n){const e=n[n.length-1],{width:r,type:o,position:s}=e,a=s?t[Number.parseInt(s)-1]:t.shift(),u=r===""?0:Number.parseInt(r);switch(o){case"d":return a.toString().padStart(u,"0");case"f":{let c=a;const[h,l]=r.split(".").map(d=>Number.parseFloat(d));return typeof l=="number"&&l>=0&&(c=c.toFixed(l)),typeof h=="number"&&h>=0?c.toString().padStart(u,"0"):c.toString()}case"s":return u<0?a.toString().padEnd(-u," "):a.toString().padStart(u," ");default:return a}})}function ja(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function Va(){return typeof process<"u"&&process.release&&process.release.name==="node"}function lr(){return BigInt(Math.floor(performance.now()*1e6))}function Sn(i){return typeof i=="number"&&(i=BigInt(i)),i<ar?`${i}ns`:i<ur?`${i/ar}s`:i<cr?`${i/ur}ms`:`${i/cr}s`}function Ve(){var i;return ja()?lr():Va()||typeof process<"u"&&typeof((i=process==null?void 0:process.hrtime)==null?void 0:i.bigint)=="function"?process.hrtime.bigint():typeof performance<"u"?lr():BigInt(0)}function dr(){return`${Ba}-${Wa++}`}function Tn(i,t){return Object.hasOwn===void 0?Object.prototype.hasOwnProperty.call(i,t)?i[t]:void 0:Object.hasOwn(i,t)?i[t]:void 0}function fr(i,t){return t[1]===i[1]?i[0]-t[0]:t[1]-i[1]}function qa(i){if(i.length===0)return[];if(i.length===1)return i[0];for(let n=1;n<i.length;n++)if(i[n].length<i[0].length){const e=i[0];i[0]=i[n],i[n]=e}const t=new Map;for(const n of i[0])t.set(n,1);for(let n=1;n<i.length;n++){let e=0;for(const r of i[n]){const o=t.get(r);o===n&&(t.set(r,o+1),e++)}if(e===0)return[]}return i[0].filter(n=>{const e=t.get(n);return e!==void 0&&t.set(n,0),e===i.length})}function gr(i,t){const n={},e=t.length;for(let r=0;r<e;r++){const o=t[r],s=o.split(".");let a=i;const u=s.length;for(let c=0;c<u;c++)if(a=a[s[c]],typeof a=="object"){if(a!==null&&"lat"in a&&"lon"in a&&typeof a.lat=="number"&&typeof a.lon=="number"){a=n[o]=a;break}else if(!Array.isArray(a)&&a!==null&&c===u-1){a=void 0;break}}else if((a===null||typeof a!="object")&&c<u-1){a=void 0;break}typeof a<"u"&&(n[o]=a)}return n}function _n(i,t){return gr(i,[t])[t]}const Ya={cm:.01,m:1,km:1e3,ft:.3048,yd:.9144,mi:1609.344};function pr(i,t){const n=Ya[t];if(n===void 0)throw new Error(H("INVALID_DISTANCE_SUFFIX",i).message);return i*n}function mr(i,t){i.hits=i.hits.map(n=>({...n,document:{...n.document,...t.reduce((e,r)=>{const o=r.split("."),s=o.pop();let a=e;for(const u of o)a[u]=a[u]??{},a=a[u];return a[s]=null,e},n.document)}}))}function Se(i){var t;return Array.isArray(i)?i.some(n=>Se(n)):((t=i==null?void 0:i.constructor)==null?void 0:t.name)==="AsyncFunction"}const vr="intersection"in new Set;function yr(...i){if(i.length===0)return new Set;if(i.length===1)return i[0];if(i.length===2){const e=i[0],r=i[1];if(vr)return e.intersection(r);const o=new Set,s=e.size<r.size?e:r,a=s===e?r:e;for(const u of s)a.has(u)&&o.add(u);return o}const t={index:0,size:i[0].size};for(let e=1;e<i.length;e++)i[e].size<t.size&&(t.index=e,t.size=i[e].size);if(vr){let e=i[t.index];for(let r=0;r<i.length;r++)r!==t.index&&(e=e.intersection(i[r]));return e}const n=i[t.index];for(let e=0;e<i.length;e++){if(e===t.index)continue;const r=i[e];for(const o of n)r.has(o)||n.delete(o)}return n}const Ka="union"in new Set;function bt(i,t){return Ka?i?i.union(t):t:i?new Set([...i,...t]):new Set(t)}function Xa(i,t){const n=new Set;for(const e of i)t.has(e)||n.add(e);return n}const Za={NO_LANGUAGE_WITH_CUSTOM_TOKENIZER:"Do not pass the language option to create when using a custom tokenizer.",LANGUAGE_NOT_SUPPORTED:`Language "%s" is not supported.
Supported languages are:
 - ${wn.join(`
 - `)}`,INVALID_STEMMER_FUNCTION_TYPE:"config.stemmer property must be a function.",MISSING_STEMMER:'As of version 1.0.0 @orama/orama does not ship non English stemmers by default. To solve this, please explicitly import and specify the "%s" stemmer from the package @orama/stemmers. See https://docs.orama.com/docs/orama-js/text-analysis/stemming for more information.',CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY:"Custom stop words array must only contain strings.",UNSUPPORTED_COMPONENT:'Unsupported component "%s".',COMPONENT_MUST_BE_FUNCTION:'The component "%s" must be a function.',COMPONENT_MUST_BE_FUNCTION_OR_ARRAY_FUNCTIONS:'The component "%s" must be a function or an array of functions.',INVALID_SCHEMA_TYPE:'Unsupported schema type "%s" at "%s". Expected "string", "boolean" or "number" or array of them.',DOCUMENT_ID_MUST_BE_STRING:'Document id must be of type "string". Got "%s" instead.',DOCUMENT_ALREADY_EXISTS:'A document with id "%s" already exists.',DOCUMENT_DOES_NOT_EXIST:'A document with id "%s" does not exists.',MISSING_DOCUMENT_PROPERTY:'Missing searchable property "%s".',INVALID_DOCUMENT_PROPERTY:'Invalid document property "%s": expected "%s", got "%s"',UNKNOWN_INDEX:'Invalid property name "%s". Expected a wildcard string ("*") or array containing one of the following properties: %s',INVALID_BOOST_VALUE:"Boost value must be a number greater than, or less than 0.",INVALID_FILTER_OPERATION:"You can only use one operation per filter, you requested %d.",SCHEMA_VALIDATION_FAILURE:'Cannot insert document due schema validation failure on "%s" property.',INVALID_SORT_SCHEMA_TYPE:'Unsupported sort schema type "%s" at "%s". Expected "string" or "number".',CANNOT_SORT_BY_ARRAY:'Cannot configure sort for "%s" because it is an array (%s).',UNABLE_TO_SORT_ON_UNKNOWN_FIELD:'Unable to sort on unknown field "%s". Allowed fields: %s',SORT_DISABLED:"Sort is disabled. Please read the documentation at https://docs.orama.com/docs/orama-js for more information.",UNKNOWN_GROUP_BY_PROPERTY:'Unknown groupBy property "%s".',INVALID_GROUP_BY_PROPERTY:'Invalid groupBy property "%s". Allowed types: "%s", but given "%s".',UNKNOWN_FILTER_PROPERTY:'Unknown filter property "%s".',UNKNOWN_VECTOR_PROPERTY:'Unknown vector property "%s". Make sure the property exists in the schema and is configured as a vector.',INVALID_VECTOR_SIZE:'Vector size must be a number greater than 0. Got "%s" instead.',INVALID_VECTOR_VALUE:'Vector value must be a number greater than 0. Got "%s" instead.',INVALID_INPUT_VECTOR:`Property "%s" was declared as a %s-dimensional vector, but got a %s-dimensional vector instead.
Input vectors must be of the size declared in the schema, as calculating similarity between vectors of different sizes can lead to unexpected results.`,WRONG_SEARCH_PROPERTY_TYPE:'Property "%s" is not searchable. Only "string" properties are searchable.',FACET_NOT_SUPPORTED:`Facet doens't support the type "%s".`,INVALID_DISTANCE_SUFFIX:'Invalid distance suffix "%s". Valid suffixes are: cm, m, km, mi, yd, ft.',INVALID_SEARCH_MODE:'Invalid search mode "%s". Valid modes are: "fulltext", "vector", "hybrid".',MISSING_VECTOR_AND_SECURE_PROXY:"No vector was provided and no secure proxy was configured. Please provide a vector or configure an Orama Secure Proxy to perform hybrid search.",MISSING_TERM:'"term" is a required parameter when performing hybrid search. Please provide a search term.',INVALID_VECTOR_INPUT:'Invalid "vector" property. Expected an object with "value" and "property" properties, but got "%s" instead.',PLUGIN_CRASHED:"A plugin crashed during initialization. Please check the error message for more information:",PLUGIN_SECURE_PROXY_NOT_FOUND:`Could not find '@orama/secure-proxy-plugin' installed in your Orama instance.
Please install it before proceeding with creating an answer session.
Read more at https://docs.orama.com/docs/orama-js/plugins/plugin-secure-proxy#plugin-secure-proxy
`,PLUGIN_SECURE_PROXY_MISSING_CHAT_MODEL:`Could not find a chat model defined in the secure proxy plugin configuration.
Please provide a chat model before proceeding with creating an answer session.
Read more at https://docs.orama.com/docs/orama-js/plugins/plugin-secure-proxy#plugin-secure-proxy
`,ANSWER_SESSION_LAST_MESSAGE_IS_NOT_ASSISTANT:"The last message in the session is not an assistant message. Cannot regenerate non-assistant messages.",PLUGIN_COMPONENT_CONFLICT:'The component "%s" is already defined. The plugin "%s" is trying to redefine it.'};function H(i,...t){const n=new Error(Ha(Za[i]??`Unsupported Orama Error code: ${i}`,...t));return n.code=i,"captureStackTrace"in Error.prototype&&Error.captureStackTrace(n),n}function Ja(i){return{raw:Number(i),formatted:Sn(i)}}function Qa(i){if(i.id){if(typeof i.id!="string")throw H("DOCUMENT_ID_MUST_BE_STRING",typeof i.id);return i.id}return dr()}function br(i,t){for(const[n,e]of Object.entries(t)){const r=i[n];if(!(typeof r>"u")&&!(e==="geopoint"&&typeof r=="object"&&typeof r.lon=="number"&&typeof r.lat=="number")&&!(e==="enum"&&(typeof r=="string"||typeof r=="number"))){if(e==="enum[]"&&Array.isArray(r)){const o=r.length;for(let s=0;s<o;s++)if(typeof r[s]!="string"&&typeof r[s]!="number")return n+"."+s;continue}if(qe(e)){const o=Er(e);if(!Array.isArray(r)||r.length!==o)throw H("INVALID_INPUT_VECTOR",n,o,r.length);continue}if(wt(e)){if(!Array.isArray(r))return n;const o=wr(e),s=r.length;for(let a=0;a<s;a++)if(typeof r[a]!==o)return n+"."+a;continue}if(typeof e=="object"){if(!r||typeof r!="object")return n;const o=br(r,e);if(o)return n+"."+o;continue}if(typeof r!==e)return n}}}const eu={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},tu={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function nu(i){return i==="geopoint"}function qe(i){return typeof i=="string"&&/^vector\[\d+\]$/.test(i)}function wt(i){return typeof i=="string"&&eu[i]}function wr(i){return tu[i]}function Er(i){const t=Number(i.slice(7,-1));switch(!0){case isNaN(t):throw H("INVALID_VECTOR_VALUE",i);case t<=0:throw H("INVALID_VECTOR_SIZE",i);default:return t}}function iu(){return{idToInternalId:new Map,internalIdToId:[],save:ru,load:ou}}function ru(i){return{internalIdToId:i.internalIdToId}}function ou(i,t){const{internalIdToId:n}=t;i.internalDocumentIDStore.idToInternalId.clear(),i.internalDocumentIDStore.internalIdToId=[];const e=n.length;for(let r=0;r<e;r++){const o=n[r];i.internalDocumentIDStore.idToInternalId.set(o,r+1),i.internalDocumentIDStore.internalIdToId.push(o)}}function ue(i,t){if(typeof t=="string"){const n=i.idToInternalId.get(t);if(n)return n;const e=i.idToInternalId.size+1;return i.idToInternalId.set(t,e),i.internalIdToId.push(t),e}return t>i.internalIdToId.length?ue(i,t.toString()):t}function Et(i,t){if(i.internalIdToId.length<t)throw new Error(`Invalid internalId ${t}`);return i.internalIdToId[t-1]}function su(i,t){return{sharedInternalDocumentStore:t,docs:{},count:0}}function au(i,t){const n=ue(i.sharedInternalDocumentStore,t);return i.docs[n]}function uu(i,t){const n=t.length,e=Array.from({length:n});for(let r=0;r<n;r++){const o=ue(i.sharedInternalDocumentStore,t[r]);e[r]=i.docs[o]}return e}function cu(i){return i.docs}function hu(i,t,n,e){return typeof i.docs[n]<"u"?!1:(i.docs[n]=e,i.count++,!0)}function lu(i,t){const n=ue(i.sharedInternalDocumentStore,t);return typeof i.docs[n]>"u"?!1:(delete i.docs[n],i.count--,!0)}function du(i){return i.count}function fu(i,t){const n=t;return{docs:n.docs,count:n.count,sharedInternalDocumentStore:i}}function gu(i){return{docs:i.docs,count:i.count}}function pu(){return{create:su,get:au,getMultiple:uu,getAll:cu,store:hu,remove:lu,count:du,load:fu,save:gu}}const mu=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeUpsert","afterUpsert","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeUpsertMultiple","afterUpsertMultiple","beforeLoad","afterLoad","afterCreate"];function vu(i,t){var r;const n=[],e=(r=i.plugins)==null?void 0:r.length;if(!e)return n;for(let o=0;o<e;o++)try{const s=i.plugins[o];typeof s[t]=="function"&&n.push(s[t])}catch(s){throw console.error("Caught error in getAllPluginsByHook:",s),H("PLUGIN_CRASHED")}return n}const yu=["tokenizer","index","documentsStore","sorter","pinning"],Sr=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];function St(i,t,n,e){if(i.some(Se))return(async()=>{for(const o of i)await o(t,n,e)})();for(const o of i)o(t,n,e)}function An(i,t,n,e,r){if(i.some(Se))return(async()=>{for(const s of i)await s(t,n,e,r)})();for(const s of i)s(t,n,e,r)}function Dn(i,t,n,e){if(i.some(Se))return(async()=>{for(const o of i)await o(t,n,e)})();for(const o of i)o(t,n,e)}function bu(i,t){if(i.some(Se))return(async()=>{for(const e of i)await e(t)})();for(const e of i)e(t)}class he{constructor(t,n){ee(this,"k");ee(this,"v");ee(this,"l",null);ee(this,"r",null);ee(this,"h",1);this.k=t,this.v=new Set(n)}updateHeight(){this.h=Math.max(he.getHeight(this.l),he.getHeight(this.r))+1}static getHeight(t){return t?t.h:0}getBalanceFactor(){return he.getHeight(this.l)-he.getHeight(this.r)}rotateLeft(){const t=this.r;return this.r=t.l,t.l=this,this.updateHeight(),t.updateHeight(),t}rotateRight(){const t=this.l;return this.l=t.r,t.r=this,this.updateHeight(),t.updateHeight(),t}toJSON(){return{k:this.k,v:Array.from(this.v),l:this.l?this.l.toJSON():null,r:this.r?this.r.toJSON():null,h:this.h}}static fromJSON(t){const n=new he(t.k,t.v);return n.l=t.l?he.fromJSON(t.l):null,n.r=t.r?he.fromJSON(t.r):null,n.h=t.h,n}}class Tt{constructor(t,n){ee(this,"root",null);ee(this,"insertCount",0);t!==void 0&&n!==void 0&&(this.root=new he(t,n))}insert(t,n,e=1e3){this.root=this.insertNode(this.root,t,n,e)}insertMultiple(t,n,e=1e3){for(const r of n)this.insert(t,r,e)}rebalance(){this.root&&(this.root=this.rebalanceNode(this.root))}toJSON(){return{root:this.root?this.root.toJSON():null,insertCount:this.insertCount}}static fromJSON(t){const n=new Tt;return n.root=t.root?he.fromJSON(t.root):null,n.insertCount=t.insertCount||0,n}insertNode(t,n,e,r){if(t===null)return new he(n,[e]);const o=[];let s=t,a=null;for(;s!==null;)if(o.push({parent:a,node:s}),n<s.k)if(s.l===null){s.l=new he(n,[e]),o.push({parent:s,node:s.l});break}else a=s,s=s.l;else if(n>s.k)if(s.r===null){s.r=new he(n,[e]),o.push({parent:s,node:s.r});break}else a=s,s=s.r;else return s.v.add(e),t;let u=!1;this.insertCount++%r===0&&(u=!0);for(let c=o.length-1;c>=0;c--){const{parent:h,node:l}=o[c];if(l.updateHeight(),u){const d=this.rebalanceNode(l);h?h.l===l?h.l=d:h.r===l&&(h.r=d):t=d}}return t}rebalanceNode(t){const n=t.getBalanceFactor();if(n>1){if(t.l&&t.l.getBalanceFactor()>=0)return t.rotateRight();if(t.l)return t.l=t.l.rotateLeft(),t.rotateRight()}if(n<-1){if(t.r&&t.r.getBalanceFactor()<=0)return t.rotateLeft();if(t.r)return t.r=t.r.rotateRight(),t.rotateLeft()}return t}find(t){const n=this.findNodeByKey(t);return n?n.v:null}contains(t){return this.find(t)!==null}getSize(){let t=0;const n=[];let e=this.root;for(;e||n.length>0;){for(;e;)n.push(e),e=e.l;e=n.pop(),t++,e=e.r}return t}isBalanced(){if(!this.root)return!0;const t=[this.root];for(;t.length>0;){const n=t.pop(),e=n.getBalanceFactor();if(Math.abs(e)>1)return!1;n.l&&t.push(n.l),n.r&&t.push(n.r)}return!0}remove(t){this.root=this.removeNode(this.root,t)}removeDocument(t,n){const e=this.findNodeByKey(t);e&&(e.v.size===1?this.root=this.removeNode(this.root,t):e.v=new Set([...e.v.values()].filter(r=>r!==n)))}findNodeByKey(t){let n=this.root;for(;n;)if(t<n.k)n=n.l;else if(t>n.k)n=n.r;else return n;return null}removeNode(t,n){if(t===null)return null;const e=[];let r=t;for(;r!==null&&r.k!==n;)e.push(r),n<r.k?r=r.l:r=r.r;if(r===null)return t;if(r.l===null||r.r===null){const o=r.l?r.l:r.r;if(e.length===0)t=o;else{const s=e[e.length-1];s.l===r?s.l=o:s.r=o}}else{let o=r,s=r.r;for(;s.l!==null;)o=s,s=s.l;r.k=s.k,r.v=s.v,o.l===s?o.l=s.r:o.r=s.r,r=o}e.push(r);for(let o=e.length-1;o>=0;o--){const s=e[o];s.updateHeight();const a=this.rebalanceNode(s);if(o>0){const u=e[o-1];u.l===s?u.l=a:u.r===s&&(u.r=a)}else t=a}return t}rangeSearch(t,n){const e=new Set,r=[];let o=this.root;for(;o||r.length>0;){for(;o;)r.push(o),o=o.l;if(o=r.pop(),o.k>=t&&o.k<=n)for(const s of o.v)e.add(s);if(o.k>n)break;o=o.r}return e}greaterThan(t,n=!1){const e=new Set,r=[];let o=this.root;for(;o||r.length>0;){for(;o;)r.push(o),o=o.r;if(o=r.pop(),n&&o.k>=t||!n&&o.k>t)for(const s of o.v)e.add(s);else if(o.k<=t)break;o=o.l}return e}lessThan(t,n=!1){const e=new Set,r=[];let o=this.root;for(;o||r.length>0;){for(;o;)r.push(o),o=o.l;if(o=r.pop(),n&&o.k<=t||!n&&o.k<t)for(const s of o.v)e.add(s);else if(o.k>t)break;o=o.r}return e}}class _t{constructor(){ee(this,"numberToDocumentId");this.numberToDocumentId=new Map}insert(t,n){this.numberToDocumentId.has(t)?this.numberToDocumentId.get(t).add(n):this.numberToDocumentId.set(t,new Set([n]))}find(t){const n=this.numberToDocumentId.get(t);return n?Array.from(n):null}remove(t){this.numberToDocumentId.delete(t)}removeDocument(t,n){const e=this.numberToDocumentId.get(n);e&&(e.delete(t),e.size===0&&this.numberToDocumentId.delete(n))}contains(t){return this.numberToDocumentId.has(t)}getSize(){let t=0;for(const n of this.numberToDocumentId.values())t+=n.size;return t}filter(t){const n=Object.keys(t);if(n.length!==1)throw new Error("Invalid operation");const e=n[0];switch(e){case"eq":{const r=t[e],o=this.numberToDocumentId.get(r);return o?Array.from(o):[]}case"in":{const r=t[e],o=new Set;for(const s of r){const a=this.numberToDocumentId.get(s);if(a)for(const u of a)o.add(u)}return Array.from(o)}case"nin":{const r=new Set(t[e]),o=new Set;for(const[s,a]of this.numberToDocumentId.entries())if(!r.has(s))for(const u of a)o.add(u);return Array.from(o)}default:throw new Error("Invalid operation")}}filterArr(t){const n=Object.keys(t);if(n.length!==1)throw new Error("Invalid operation");const e=n[0];switch(e){case"containsAll":{const o=t[e].map(a=>this.numberToDocumentId.get(a)??new Set);if(o.length===0)return[];const s=o.reduce((a,u)=>new Set([...a].filter(c=>u.has(c))));return Array.from(s)}case"containsAny":{const o=t[e].map(a=>this.numberToDocumentId.get(a)??new Set);if(o.length===0)return[];const s=o.reduce((a,u)=>new Set([...a,...u]));return Array.from(s)}default:throw new Error("Invalid operation")}}static fromJSON(t){if(!t.numberToDocumentId)throw new Error("Invalid Flat Tree JSON");const n=new _t;for(const[e,r]of t.numberToDocumentId)n.numberToDocumentId.set(e,new Set(r));return n}toJSON(){return{numberToDocumentId:Array.from(this.numberToDocumentId.entries()).map(([t,n])=>[t,Array.from(n)])}}}function wu(i,t,n){if(n<0)return-1;if(i===t)return 0;const e=i.length,r=t.length;if(e===0)return r<=n?r:-1;if(r===0)return e<=n?e:-1;const o=Math.abs(e-r);if(i.startsWith(t))return o<=n?o:-1;if(t.startsWith(i))return 0;if(o>n)return-1;const s=[];for(let a=0;a<=e;a++){s[a]=[a];for(let u=1;u<=r;u++)s[a][u]=a===0?u:0}for(let a=1;a<=e;a++){let u=1/0;for(let c=1;c<=r;c++)i[a-1]===t[c-1]?s[a][c]=s[a-1][c-1]:s[a][c]=Math.min(s[a-1][c]+1,s[a][c-1]+1,s[a-1][c-1]+1),u=Math.min(u,s[a][c]);if(u>n)return-1}return s[e][r]<=n?s[e][r]:-1}function Tr(i,t,n){const e=wu(i,t,n);return{distance:e,isBounded:e>=0}}class Ne{constructor(t,n,e){ee(this,"k");ee(this,"s");ee(this,"c",new Map);ee(this,"d",new Set);ee(this,"e");ee(this,"w","");this.k=t,this.s=n,this.e=e}updateParent(t){this.w=t.w+this.s}addDocument(t){this.d.add(t)}removeDocument(t){return this.d.delete(t)}findAllWords(t,n,e,r){const o=[this];for(;o.length>0;){const s=o.pop();if(s.e){const{w:a,d:u}=s;if(e&&a!==n)continue;if(Tn(t,a)!==null)if(r)if(Math.abs(n.length-a.length)<=r&&Tr(n,a,r).isBounded)t[a]=[];else continue;else t[a]=[];if(Tn(t,a)!=null&&u.size>0){const c=t[a];for(const h of u)c.includes(h)||c.push(h)}}s.c.size>0&&o.push(...s.c.values())}return t}insert(t,n){let e=this,r=0;const o=t.length;for(;r<o;){const s=t[r],a=e.c.get(s);if(a){const u=a.s,c=u.length;let h=0;for(;h<c&&r+h<o&&u[h]===t[r+h];)h++;if(h===c){if(e=a,r+=h,r===o){a.e||(a.e=!0),a.addDocument(n);return}continue}const l=u.slice(0,h),d=u.slice(h),f=t.slice(r+h),p=new Ne(l[0],l,!1);if(e.c.set(l[0],p),p.updateParent(e),a.s=d,a.k=d[0],p.c.set(d[0],a),a.updateParent(p),f){const b=new Ne(f[0],f,!0);b.addDocument(n),p.c.set(f[0],b),b.updateParent(p)}else p.e=!0,p.addDocument(n);return}else{const u=new Ne(s,t.slice(r),!0);u.addDocument(n),e.c.set(s,u),u.updateParent(e);return}}e.e||(e.e=!0),e.addDocument(n)}_findLevenshtein(t,n,e,r,o){const s=[{node:this,index:n,tolerance:e}];for(;s.length>0;){const{node:a,index:u,tolerance:c}=s.pop();if(a.w.startsWith(t)){a.findAllWords(o,t,!1,0);continue}if(c<0)continue;if(a.e){const{w:l,d}=a;if(l&&(Tr(t,l,r).isBounded&&(o[l]=[]),Tn(o,l)!==void 0&&d.size>0)){const f=new Set(o[l]);for(const p of d)f.add(p);o[l]=Array.from(f)}}if(u>=t.length)continue;const h=t[u];if(a.c.has(h)){const l=a.c.get(h);s.push({node:l,index:u+1,tolerance:c})}s.push({node:a,index:u+1,tolerance:c-1});for(const[l,d]of a.c)s.push({node:d,index:u,tolerance:c-1}),l!==h&&s.push({node:d,index:u+1,tolerance:c-1})}}find(t){const{term:n,exact:e,tolerance:r}=t;if(r&&!e){const o={};return this._findLevenshtein(n,0,r,r,o),o}else{let o=this,s=0;const a=n.length;for(;s<a;){const c=n[s],h=o.c.get(c);if(h){const l=h.s,d=l.length;let f=0;for(;f<d&&s+f<a&&l[f]===n[s+f];)f++;if(f===d)o=h,s+=f;else if(s+f===a)if(f===a-s){if(e)return{};{const p={};return h.findAllWords(p,n,e,r),p}}else return{};else return{}}else return{}}const u={};return o.findAllWords(u,n,e,r),u}}contains(t){let n=this,e=0;const r=t.length;for(;e<r;){const o=t[e],s=n.c.get(o);if(s){const a=s.s,u=a.length;let c=0;for(;c<u&&e+c<r&&a[c]===t[e+c];)c++;if(c<u)return!1;e+=u,n=s}else return!1}return!0}removeWord(t){if(!t)return!1;let n=this;const e=t.length,r=[];for(let o=0;o<e;o++){const s=t[o];if(n.c.has(s)){const a=n.c.get(s);r.push({parent:n,character:s}),o+=a.s.length-1,n=a}else return!1}for(n.d.clear(),n.e=!1;r.length>0&&n.c.size===0&&!n.e&&n.d.size===0;){const{parent:o,character:s}=r.pop();o.c.delete(s),n=o}return!0}removeDocumentByWord(t,n,e=!0){if(!t)return!0;let r=this;const o=t.length;for(let s=0;s<o;s++){const a=t[s];if(r.c.has(a)){const u=r.c.get(a);s+=u.s.length-1,r=u,e&&r.w!==t||r.removeDocument(n)}else return!1}return!0}static getCommonPrefix(t,n){const e=Math.min(t.length,n.length);let r=0;for(;r<e&&t.charCodeAt(r)===n.charCodeAt(r);)r++;return t.slice(0,r)}toJSON(){var t,n;return{w:this.w,s:this.s,e:this.e,k:this.k,d:Array.from(this.d),c:(n=Array.from((t=this.c)==null?void 0:t.entries()))==null?void 0:n.map(([e,r])=>[e,r.toJSON()])}}static fromJSON(t){var e;const n=new Ne(t.k,t.s,t.e);return n.w=t.w,n.d=new Set(t.d),n.c=new Map(((e=t==null?void 0:t.c)==null?void 0:e.map(([r,o])=>[r,Ne.fromJSON(o)]))||[]),n}}class At extends Ne{constructor(){super("","",!1)}static fromJSON(t){var e;const n=new At;return n.w=t.w,n.s=t.s,n.e=t.e,n.k=t.k,n.d=new Set(t.d),n.c=new Map(((e=t==null?void 0:t.c)==null?void 0:e.map(([r,o])=>[r,Ne.fromJSON(o)]))||[]),n}toJSON(){return super.toJSON()}}const Eu=2,Su=6371e3;class Ye{constructor(t,n){ee(this,"point");ee(this,"docIDs");ee(this,"left");ee(this,"right");ee(this,"parent");this.point=t,this.docIDs=new Set(n),this.left=null,this.right=null,this.parent=null}toJSON(){return{point:this.point,docIDs:Array.from(this.docIDs),left:this.left?this.left.toJSON():null,right:this.right?this.right.toJSON():null}}static fromJSON(t,n=null){const e=new Ye(t.point,t.docIDs);return e.parent=n,t.left&&(e.left=Ye.fromJSON(t.left,e)),t.right&&(e.right=Ye.fromJSON(t.right,e)),e}}class le{constructor(){ee(this,"root");ee(this,"nodeMap");this.root=null,this.nodeMap=new Map}getPointKey(t){return`${t.lon},${t.lat}`}insert(t,n){const e=this.getPointKey(t),r=this.nodeMap.get(e);if(r){n.forEach(u=>r.docIDs.add(u));return}const o=new Ye(t,n);if(this.nodeMap.set(e,o),this.root==null){this.root=o;return}let s=this.root,a=0;for(;;){if(a%Eu===0)if(t.lon<s.point.lon){if(s.left==null){s.left=o,o.parent=s;return}s=s.left}else{if(s.right==null){s.right=o,o.parent=s;return}s=s.right}else if(t.lat<s.point.lat){if(s.left==null){s.left=o,o.parent=s;return}s=s.left}else{if(s.right==null){s.right=o,o.parent=s;return}s=s.right}a++}}contains(t){const n=this.getPointKey(t);return this.nodeMap.has(n)}getDocIDsByCoordinates(t){const n=this.getPointKey(t),e=this.nodeMap.get(n);return e?Array.from(e.docIDs):null}removeDocByID(t,n){const e=this.getPointKey(t),r=this.nodeMap.get(e);r&&(r.docIDs.delete(n),r.docIDs.size===0&&(this.nodeMap.delete(e),this.deleteNode(r)))}deleteNode(t){const n=t.parent,e=t.left?t.left:t.right;e&&(e.parent=n),n?n.left===t?n.left=e:n.right===t&&(n.right=e):(this.root=e,this.root&&(this.root.parent=null))}searchByRadius(t,n,e=!0,r="asc",o=!1){const s=o?le.vincentyDistance:le.haversineDistance,a=[{node:this.root,depth:0}],u=[];for(;a.length>0;){const{node:c,depth:h}=a.pop();if(c==null)continue;const l=s(t,c.point);(e?l<=n:l>n)&&u.push({point:c.point,docIDs:Array.from(c.docIDs)}),c.left!=null&&a.push({node:c.left,depth:h+1}),c.right!=null&&a.push({node:c.right,depth:h+1})}return r&&u.sort((c,h)=>{const l=s(t,c.point),d=s(t,h.point);return r.toLowerCase()==="asc"?l-d:d-l}),u}searchByPolygon(t,n=!0,e=null,r=!1){const o=[{node:this.root,depth:0}],s=[];for(;o.length>0;){const{node:u,depth:c}=o.pop();if(u==null)continue;u.left!=null&&o.push({node:u.left,depth:c+1}),u.right!=null&&o.push({node:u.right,depth:c+1});const h=le.isPointInPolygon(t,u.point);(h&&n||!h&&!n)&&s.push({point:u.point,docIDs:Array.from(u.docIDs)})}const a=le.calculatePolygonCentroid(t);if(e){const u=r?le.vincentyDistance:le.haversineDistance;s.sort((c,h)=>{const l=u(a,c.point),d=u(a,h.point);return e.toLowerCase()==="asc"?l-d:d-l})}return s}toJSON(){return{root:this.root?this.root.toJSON():null}}static fromJSON(t){const n=new le;return t.root&&(n.root=Ye.fromJSON(t.root),n.buildNodeMap(n.root)),n}buildNodeMap(t){if(t==null)return;const n=this.getPointKey(t.point);this.nodeMap.set(n,t),t.left&&this.buildNodeMap(t.left),t.right&&this.buildNodeMap(t.right)}static calculatePolygonCentroid(t){let n=0,e=0,r=0;const o=t.length;for(let a=0,u=o-1;a<o;u=a++){const c=t[a].lon,h=t[a].lat,l=t[u].lon,d=t[u].lat,f=c*d-l*h;n+=f,e+=(c+l)*f,r+=(h+d)*f}n/=2;const s=6*n;return e/=s,r/=s,{lon:e,lat:r}}static isPointInPolygon(t,n){let e=!1;const r=n.lon,o=n.lat,s=t.length;for(let a=0,u=s-1;a<s;u=a++){const c=t[a].lon,h=t[a].lat,l=t[u].lon,d=t[u].lat;h>o!=d>o&&r<(l-c)*(o-h)/(d-h)+c&&(e=!e)}return e}static haversineDistance(t,n){const e=Math.PI/180,r=t.lat*e,o=n.lat*e,s=(n.lat-t.lat)*e,a=(n.lon-t.lon)*e,u=Math.sin(s/2)*Math.sin(s/2)+Math.cos(r)*Math.cos(o)*Math.sin(a/2)*Math.sin(a/2),c=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return Su*c}static vincentyDistance(t,n){const r=.0033528106647474805,o=(1-r)*6378137,s=Math.PI/180,a=t.lat*s,u=n.lat*s,c=(n.lon-t.lon)*s,h=Math.atan((1-r)*Math.tan(a)),l=Math.atan((1-r)*Math.tan(u)),d=Math.sin(h),f=Math.cos(h),p=Math.sin(l),b=Math.cos(l);let v=c,y,w=1e3,m,g,S,E,_,A;do{const V=Math.sin(v),q=Math.cos(v);if(m=Math.sqrt(b*V*(b*V)+(f*p-d*b*q)*(f*p-d*b*q)),m===0)return 0;g=d*p+f*b*q,S=Math.atan2(m,g),E=f*b*V/m,_=1-E*E,A=g-2*d*p/_,isNaN(A)&&(A=0);const I=r/16*_*(4+r*(4-3*_));y=v,v=c+(1-I)*r*E*(S+I*m*(A+I*g*(-1+2*A*A)))}while(Math.abs(v-y)>1e-12&&--w>0);if(w===0)return NaN;const R=_*(6378137*6378137-o*o)/(o*o),L=1+R/16384*(4096+R*(-768+R*(320-175*R))),z=R/1024*(256+R*(-128+R*(74-47*R))),N=z*m*(A+z/4*(g*(-1+2*A*A)-z/6*A*(-3+4*m*m)*(-3+4*A*A)));return o*L*(S-N)}}class Dt{constructor(){ee(this,"true");ee(this,"false");this.true=new Set,this.false=new Set}insert(t,n){n?this.true.add(t):this.false.add(t)}delete(t,n){n?this.true.delete(t):this.false.delete(t)}getSize(){return this.true.size+this.false.size}toJSON(){return{true:Array.from(this.true),false:Array.from(this.false)}}static fromJSON(t){const n=new Dt;return n.true=new Set(t.true),n.false=new Set(t.false),n}}function Tu(i,t,n,e,r,{k:o,b:s,d:a}){return Math.log(1+(n-t+.5)/(t+.5))*(a+i*(o+1))/(i+o*(1-s+s*e/r))}const _u=.8;class Rt{constructor(t){ee(this,"size");ee(this,"vectors",new Map);this.size=t}add(t,n){n instanceof Float32Array||(n=new Float32Array(n));const e=_r(n,this.size);this.vectors.set(t,[e,n])}remove(t){this.vectors.delete(t)}find(t,n,e){return t instanceof Float32Array||(t=new Float32Array(t)),Au(t,e,this.vectors,this.size,n)}toJSON(){const t=[];for(const[n,[e,r]]of this.vectors)t.push([n,[e,Array.from(r)]]);return{size:this.size,vectors:t}}static fromJSON(t){const n=t,e=new Rt(n.size);for(const[r,[o,s]]of n.vectors)e.vectors.set(r,[o,new Float32Array(s)]);return e}}function _r(i,t){let n=0;for(let e=0;e<t;e++)n+=i[e]*i[e];return Math.sqrt(n)}function Au(i,t,n,e,r){const o=_r(i,e),s=[],a=t||n.keys();for(const u of a){const c=n.get(u);if(!c)continue;const h=c[0],l=c[1];let d=0;for(let p=0;p<e;p++)d+=i[p]*l[p];const f=d/(o*h);f>=r&&s.push([u,f])}return s}function Du(i,t,n,e,r){const o=ue(i.sharedInternalDocumentStore,n);i.avgFieldLength[t]=((i.avgFieldLength[t]??0)*(r-1)+e.length)/r,i.fieldLengths[t][o]=e.length,i.frequencies[t][o]={}}function Ru(i,t,n,e,r){let o=0;for(const u of e)u===r&&o++;const s=ue(i.sharedInternalDocumentStore,n),a=o/e.length;i.frequencies[t][s][r]=a,r in i.tokenOccurrences[t]||(i.tokenOccurrences[t][r]=0),i.tokenOccurrences[t][r]=(i.tokenOccurrences[t][r]??0)+1}function Cu(i,t,n,e){const r=ue(i.sharedInternalDocumentStore,n);e>1?i.avgFieldLength[t]=(i.avgFieldLength[t]*e-i.fieldLengths[t][r])/(e-1):i.avgFieldLength[t]=void 0,i.fieldLengths[t][r]=void 0,i.frequencies[t][r]=void 0}function Lu(i,t,n){i.tokenOccurrences[t][n]--}function Ar(i,t,n,e,r=""){e||(e={sharedInternalDocumentStore:t,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}});for(const[o,s]of Object.entries(n)){const a=`${r}${r?".":""}${o}`;if(typeof s=="object"&&!Array.isArray(s)){Ar(i,t,s,e,a);continue}if(qe(s))e.searchableProperties.push(a),e.searchablePropertiesWithTypes[a]=s,e.vectorIndexes[a]={type:"Vector",node:new Rt(Er(s)),isArray:!1};else{const u=/\[/.test(s);switch(s){case"boolean":case"boolean[]":e.indexes[a]={type:"Bool",node:new Dt,isArray:u};break;case"number":case"number[]":e.indexes[a]={type:"AVL",node:new Tt(0,[]),isArray:u};break;case"string":case"string[]":e.indexes[a]={type:"Radix",node:new At,isArray:u},e.avgFieldLength[a]=0,e.frequencies[a]={},e.tokenOccurrences[a]={},e.fieldLengths[a]={};break;case"enum":case"enum[]":e.indexes[a]={type:"Flat",node:new _t,isArray:u};break;case"geopoint":e.indexes[a]={type:"BKD",node:new le,isArray:u};break;default:throw H("INVALID_SCHEMA_TYPE",Array.isArray(s)?"array":s,a)}e.searchableProperties.push(a),e.searchablePropertiesWithTypes[a]=s}}return e}function Iu(i,t,n,e,r,o,s,a){return u=>{const{type:c,node:h}=t.indexes[n];switch(c){case"Bool":{h[u?"true":"false"].add(e);break}case"AVL":{const l=(a==null?void 0:a.avlRebalanceThreshold)??1;h.insert(u,e,l);break}case"Radix":{const l=o.tokenize(u,r,n,!1);i.insertDocumentScoreParameters(t,n,e,l,s);for(const d of l)i.insertTokenScoreParameters(t,n,e,l,d),h.insert(d,e);break}case"Flat":{h.insert(u,e);break}case"BKD":{h.insert(u,[e]);break}}}}function ku(i,t,n,e,r,o,s,a,u,c,h){if(qe(s))return Nu(t,n,o,e,r);const l=Iu(i,t,n,r,a,u,c,h);if(!wt(s))return l(o);const d=o,f=d.length;for(let p=0;p<f;p++)l(d[p])}function Nu(i,t,n,e,r){i.vectorIndexes[t].node.add(r,n)}function Dr(i,t,n,e,r,o,s,a,u,c){if(qe(s))return t.vectorIndexes[n].node.remove(r),!0;const{type:h,node:l}=t.indexes[n];switch(h){case"AVL":return l.removeDocument(o,r),!0;case"Bool":return l[o?"true":"false"].delete(r),!0;case"Radix":{const d=u.tokenize(o,a,n);i.removeDocumentScoreParameters(t,n,e,c);for(const f of d)i.removeTokenScoreParameters(t,n,f),l.removeDocumentByWord(f,r);return!0}case"Flat":return l.removeDocument(r,o),!0;case"BKD":return l.removeDocByID(o,r),!1}}function xu(i,t,n,e,r,o,s,a,u,c){if(!wt(s))return Dr(i,t,n,e,r,o,s,a,u,c);const h=wr(s),l=o,d=l.length;for(let f=0;f<d;f++)Dr(i,t,n,e,r,l[f],h,a,u,c);return!0}function Rr(i,t,n,e,r,o,s,a,u,c){var y;const h=Array.from(e),l=i.avgFieldLength[t],d=i.fieldLengths[t],f=i.tokenOccurrences[t],p=i.frequencies[t],b=typeof f[n]=="number"?f[n]??0:0,v=h.length;for(let w=0;w<v;w++){const m=h[w];if(u&&!u.has(m))continue;c.has(m)||c.set(m,new Map);const g=c.get(m);g.set(t,(g.get(t)||0)+1);const S=((y=p==null?void 0:p[m])==null?void 0:y[n])??0,E=Tu(S,b,r,d[m],l,o);s.has(m)?s.set(m,s.get(m)+E*a):s.set(m,E*a)}}function Pu(i,t,n,e,r,o,s,a,u,c,h,l=0){const d=n.tokenize(t,e),f=d.length||1,p=new Map,b=new Map,v=new Map;for(const m of r){if(!(m in i.indexes))continue;const g=i.indexes[m],{type:S}=g;if(S!=="Radix")throw H("WRONG_SEARCH_PROPERTY_TYPE",m);const E=a[m]??1;if(E<=0)throw H("INVALID_BOOST_VALUE",E);d.length===0&&!t&&d.push("");const _=d.length;for(let A=0;A<_;A++){const R=d[A],L=g.node.find({term:R,exact:o,tolerance:s}),z=Object.keys(L);z.length>0&&b.set(R,!0);const N=z.length;for(let T=0;T<N;T++){const V=z[T],q=L[V];Rr(i,m,V,q,c,u,v,E,h,p)}}}const y=Array.from(v.entries()).map(([m,g])=>[m,g]).sort((m,g)=>g[1]-m[1]);if(y.length===0)return[];if(l===1)return y;if(l===0){if(f===1)return y;for(const g of d)if(!b.get(g))return[];return y.filter(([g])=>{const S=p.get(g);return S?Array.from(S.values()).some(E=>E===f):!1})}const w=y.filter(([m])=>{const g=p.get(m);return g?Array.from(g.values()).some(S=>S===f):!1});if(w.length>0){const m=y.filter(([S])=>!w.some(([E])=>E===S)),g=Math.ceil(m.length*l);return[...w,...m.slice(0,g)]}return y}function Ct(i,t,n,e){if("and"in n&&n.and&&Array.isArray(n.and)){const s=n.and;if(s.length===0)return new Set;const a=s.map(u=>Ct(i,t,u,e));return yr(...a)}if("or"in n&&n.or&&Array.isArray(n.or)){const s=n.or;return s.length===0?new Set:s.map(u=>Ct(i,t,u,e)).reduce((u,c)=>bt(u,c),new Set)}if("not"in n&&n.not){const s=n.not,a=new Set,u=i.sharedInternalDocumentStore;for(let h=1;h<=u.internalIdToId.length;h++)a.add(h);const c=Ct(i,t,s,e);return Xa(a,c)}const r=Object.keys(n),o=r.reduce((s,a)=>({[a]:new Set,...s}),{});for(const s of r){const a=n[s];if(typeof i.indexes[s]>"u")throw H("UNKNOWN_FILTER_PROPERTY",s);const{node:u,type:c,isArray:h}=i.indexes[s];if(c==="Bool"){const d=u,f=a?d.true:d.false;o[s]=bt(o[s],f);continue}if(c==="BKD"){let d;if("radius"in a)d="radius";else if("polygon"in a)d="polygon";else throw new Error(`Invalid operation ${a}`);if(d==="radius"){const{value:f,coordinates:p,unit:b="m",inside:v=!0,highPrecision:y=!1}=a[d],w=pr(f,b),m=u.searchByRadius(p,w,v,void 0,y);o[s]=Cr(o[s],m)}else{const{coordinates:f,inside:p=!0,highPrecision:b=!1}=a[d],v=u.searchByPolygon(f,p,void 0,b);o[s]=Cr(o[s],v)}continue}if(c==="Radix"&&(typeof a=="string"||Array.isArray(a))){for(const d of[a].flat()){const f=t.tokenize(d,e,s);for(const p of f){const b=u.find({term:p,exact:!0});o[s]=Bu(o[s],b)}}continue}const l=Object.keys(a);if(l.length>1)throw H("INVALID_FILTER_OPERATION",l.length);if(c==="Flat"){const d=new Set(h?u.filterArr(a):u.filter(a));o[s]=bt(o[s],d);continue}if(c==="AVL"){const d=l[0],f=a[d];let p;switch(d){case"gt":{p=u.greaterThan(f,!1);break}case"gte":{p=u.greaterThan(f,!0);break}case"lt":{p=u.lessThan(f,!1);break}case"lte":{p=u.lessThan(f,!0);break}case"eq":{p=u.find(f)??new Set;break}case"between":{const[b,v]=f;p=u.rangeSearch(b,v);break}default:throw H("INVALID_FILTER_OPERATION",d)}o[s]=bt(o[s],p)}}return yr(...Object.values(o))}function Ou(i){return i.searchableProperties}function Gu(i){return i.searchablePropertiesWithTypes}function Fu(i,t){const{indexes:n,vectorIndexes:e,searchableProperties:r,searchablePropertiesWithTypes:o,frequencies:s,tokenOccurrences:a,avgFieldLength:u,fieldLengths:c}=t,h={},l={};for(const d of Object.keys(n)){const{node:f,type:p,isArray:b}=n[d];switch(p){case"Radix":h[d]={type:"Radix",node:At.fromJSON(f),isArray:b};break;case"Flat":h[d]={type:"Flat",node:_t.fromJSON(f),isArray:b};break;case"AVL":h[d]={type:"AVL",node:Tt.fromJSON(f),isArray:b};break;case"BKD":h[d]={type:"BKD",node:le.fromJSON(f),isArray:b};break;case"Bool":h[d]={type:"Bool",node:Dt.fromJSON(f),isArray:b};break;default:h[d]=n[d]}}for(const d of Object.keys(e))l[d]={type:"Vector",isArray:!1,node:Rt.fromJSON(e[d])};return{sharedInternalDocumentStore:i,indexes:h,vectorIndexes:l,searchableProperties:r,searchablePropertiesWithTypes:o,frequencies:s,tokenOccurrences:a,avgFieldLength:u,fieldLengths:c}}function zu(i){const{indexes:t,vectorIndexes:n,searchableProperties:e,searchablePropertiesWithTypes:r,frequencies:o,tokenOccurrences:s,avgFieldLength:a,fieldLengths:u}=i,c={};for(const l of Object.keys(n))c[l]=n[l].node.toJSON();const h={};for(const l of Object.keys(t)){const{type:d,node:f,isArray:p}=t[l];d==="Flat"||d==="Radix"||d==="AVL"||d==="BKD"||d==="Bool"?h[l]={type:d,node:f.toJSON(),isArray:p}:(h[l]=t[l],h[l].node=h[l].node.toJSON())}return{indexes:h,vectorIndexes:c,searchableProperties:e,searchablePropertiesWithTypes:r,frequencies:o,tokenOccurrences:s,avgFieldLength:a,fieldLengths:u}}function Mu(){return{create:Ar,insert:ku,remove:xu,insertDocumentScoreParameters:Du,insertTokenScoreParameters:Ru,removeDocumentScoreParameters:Cu,removeTokenScoreParameters:Lu,calculateResultScores:Rr,search:Pu,searchByWhereClause:Ct,getSearchableProperties:Ou,getSearchablePropertiesWithTypes:Gu,load:Fu,save:zu}}function Cr(i,t){i||(i=new Set);const n=t.length;for(let e=0;e<n;e++){const r=t[e].docIDs,o=r.length;for(let s=0;s<o;s++)i.add(r[s])}return i}function Lr(i,t,n=!1){const e=n?le.vincentyDistance:le.haversineDistance,r=[],o=[];for(const{point:u}of i)o.push(e(t,u));const s=Math.max(...o);let a=0;for(const{docIDs:u}of i){const c=o[a],h=s-c+1;for(const l of u)r.push([l,h]);a++}return r.sort((u,c)=>c[1]-u[1]),r}function Uu(i,t){const n=Object.keys(i);if(n.length!==1)return{isGeoOnly:!1};const e=n[0],r=i[e];if(typeof t.indexes[e]>"u")return{isGeoOnly:!1};const{type:o}=t.indexes[e];return o==="BKD"&&r&&("radius"in r||"polygon"in r)?{isGeoOnly:!0,geoProperty:e,geoOperation:r}:{isGeoOnly:!1}}function $u(i,t){const n=i,e=Uu(t,n);if(!e.isGeoOnly||!e.geoProperty||!e.geoOperation)return null;const{node:r}=n.indexes[e.geoProperty],o=e.geoOperation,s=r;let a;if("radius"in o){const{value:u,coordinates:c,unit:h="m",inside:l=!0,highPrecision:d=!1}=o.radius,f=c,p=pr(u,h);return a=s.searchByRadius(f,p,l,"asc",d),Lr(a,f,d)}else if("polygon"in o){const{coordinates:u,inside:c=!0,highPrecision:h=!1}=o.polygon;a=s.searchByPolygon(u,c,"asc",h);const l=le.calculatePolygonCentroid(u);return Lr(a,l,h)}return null}function Bu(i,t){i||(i=new Set);const n=Object.keys(t),e=n.length;for(let r=0;r<e;r++){const o=t[n[r]],s=o.length;for(let a=0;a<s;a++)i.add(o[a])}return i}function Ir(i,t,n,e,r){const o={language:i.tokenizer.language,sharedInternalDocumentStore:t,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(const[s,a]of Object.entries(n)){const u=`${r}${r?".":""}${s}`;if(!e.includes(u)){if(typeof a=="object"&&!Array.isArray(a)){const c=Ir(i,t,a,e,u);hr(o.sortableProperties,c.sortableProperties),o.sorts={...o.sorts,...c.sorts},o.sortablePropertiesWithTypes={...o.sortablePropertiesWithTypes,...c.sortablePropertiesWithTypes};continue}if(!qe(a))switch(a){case"boolean":case"number":case"string":o.sortableProperties.push(u),o.sortablePropertiesWithTypes[u]=a,o.sorts[u]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:a};break;case"geopoint":case"enum":continue;case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw H("INVALID_SORT_SCHEMA_TYPE",Array.isArray(a)?"array":a,u)}}}return o}function Wu(i,t,n,e){return(e==null?void 0:e.enabled)!==!1?Ir(i,t,n,(e||{}).unsortableProperties||[],""):{disabled:!0}}function Hu(i,t,n,e){if(!i.enabled)return;i.isSorted=!1;const r=ue(i.sharedInternalDocumentStore,n),o=i.sorts[t];o.orderedDocsToRemove.has(r)&&Rn(i,t),o.docs.set(r,o.orderedDocs.length),o.orderedDocs.push([r,e])}function kr(i){if(i.isSorted||!i.enabled)return;const t=Object.keys(i.sorts);for(const n of t)Yu(i,n);i.isSorted=!0}function ju(i,t,n){return t[1].localeCompare(n[1],$a(i))}function Vu(i,t){return i[1]-t[1]}function qu(i,t){return t[1]?-1:1}function Yu(i,t){const n=i.sorts[t];let e;switch(n.type){case"string":e=ju.bind(null,i.language);break;case"number":e=Vu.bind(null);break;case"boolean":e=qu.bind(null);break}n.orderedDocs.sort(e);const r=n.orderedDocs.length;for(let o=0;o<r;o++){const s=n.orderedDocs[o][0];n.docs.set(s,o)}}function Ku(i){const t=Object.keys(i.sorts);for(const n of t)Rn(i,n)}function Rn(i,t){const n=i.sorts[t];n.orderedDocsToRemove.size&&(n.orderedDocs=n.orderedDocs.filter(e=>!n.orderedDocsToRemove.has(e[0])),n.orderedDocsToRemove.clear())}function Xu(i,t,n){if(!i.enabled)return;const e=i.sorts[t],r=ue(i.sharedInternalDocumentStore,n);e.docs.get(r)&&(e.docs.delete(r),e.orderedDocsToRemove.set(r,!0))}function Zu(i,t,n){if(!i.enabled)throw H("SORT_DISABLED");const e=n.property,r=n.order==="DESC",o=i.sorts[e];if(!o)throw H("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",e,i.sortableProperties.join(", "));return Rn(i,e),kr(i),t.sort((s,a)=>{const u=o.docs.get(ue(i.sharedInternalDocumentStore,s[0])),c=o.docs.get(ue(i.sharedInternalDocumentStore,a[0])),h=typeof u<"u",l=typeof c<"u";return!h&&!l?0:h?l?r?c-u:u-c:-1:1}),t}function Ju(i){return i.enabled?i.sortableProperties:[]}function Qu(i){return i.enabled?i.sortablePropertiesWithTypes:{}}function ec(i,t){const n=t;if(!n.enabled)return{enabled:!1};const e=Object.keys(n.sorts).reduce((r,o)=>{const{docs:s,orderedDocs:a,type:u}=n.sorts[o];return r[o]={docs:new Map(Object.entries(s).map(([c,h])=>[+c,h])),orderedDocsToRemove:new Map,orderedDocs:a,type:u},r},{});return{sharedInternalDocumentStore:i,language:n.language,sortableProperties:n.sortableProperties,sortablePropertiesWithTypes:n.sortablePropertiesWithTypes,sorts:e,enabled:!0,isSorted:n.isSorted}}function tc(i){if(!i.enabled)return{enabled:!1};Ku(i),kr(i);const t=Object.keys(i.sorts).reduce((n,e)=>{const{docs:r,orderedDocs:o,type:s}=i.sorts[e];return n[e]={docs:Object.fromEntries(r.entries()),orderedDocs:o,type:s},n},{});return{language:i.language,sortableProperties:i.sortableProperties,sortablePropertiesWithTypes:i.sortablePropertiesWithTypes,sorts:t,enabled:i.enabled,isSorted:i.isSorted}}function nc(){return{create:Wu,insert:Hu,remove:Xu,save:tc,load:ec,sortBy:Zu,getSortableProperties:Ju,getSortablePropertiesWithTypes:Qu}}const Nr=192,ic=383,rc=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115];function oc(i){return i<Nr||i>ic?i:rc[i-Nr]||i}function sc(i){const t=[];for(let n=0;n<i.length;n++)t[n]=oc(i.charCodeAt(n));return String.fromCharCode(...t)}const ac={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},uc={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},cc="[^aeiou]",Lt="[aeiouy]",Te=cc+"[^aeiouy]*",at=Lt+"[aeiou]*",Cn="^("+Te+")?"+at+Te,hc="^("+Te+")?"+at+Te+"("+at+")?$",It="^("+Te+")?"+at+Te+at+Te,xr="^("+Te+")?"+Lt;function lc(i){let t,n,e,r,o,s;if(i.length<3)return i;const a=i.substring(0,1);if(a=="y"&&(i=a.toUpperCase()+i.substring(1)),e=/^(.+?)(ss|i)es$/,r=/^(.+?)([^s])s$/,e.test(i)?i=i.replace(e,"$1$2"):r.test(i)&&(i=i.replace(r,"$1$2")),e=/^(.+?)eed$/,r=/^(.+?)(ed|ing)$/,e.test(i)){const u=e.exec(i);e=new RegExp(Cn),e.test(u[1])&&(e=/.$/,i=i.replace(e,""))}else r.test(i)&&(t=r.exec(i)[1],r=new RegExp(xr),r.test(t)&&(i=t,r=/(at|bl|iz)$/,o=new RegExp("([^aeiouylsz])\\1$"),s=new RegExp("^"+Te+Lt+"[^aeiouwxy]$"),r.test(i)?i=i+"e":o.test(i)?(e=/.$/,i=i.replace(e,"")):s.test(i)&&(i=i+"e")));if(e=/^(.+?)y$/,e.test(i)){const u=e.exec(i);t=u==null?void 0:u[1],e=new RegExp(xr),t&&e.test(t)&&(i=t+"i")}if(e=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,e.test(i)){const u=e.exec(i);t=u==null?void 0:u[1],n=u==null?void 0:u[2],e=new RegExp(Cn),t&&e.test(t)&&(i=t+ac[n])}if(e=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,e.test(i)){const u=e.exec(i);t=u==null?void 0:u[1],n=u==null?void 0:u[2],e=new RegExp(Cn),t&&e.test(t)&&(i=t+uc[n])}if(e=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,r=/^(.+?)(s|t)(ion)$/,e.test(i)){const u=e.exec(i);t=u==null?void 0:u[1],e=new RegExp(It),t&&e.test(t)&&(i=t)}else if(r.test(i)){const u=r.exec(i);t=(u==null?void 0:u[1])??""+(u==null?void 0:u[2])??"",r=new RegExp(It),r.test(t)&&(i=t)}if(e=/^(.+?)e$/,e.test(i)){const u=e.exec(i);t=u==null?void 0:u[1],e=new RegExp(It),r=new RegExp(hc),o=new RegExp("^"+Te+Lt+"[^aeiouwxy]$"),t&&(e.test(t)||r.test(t)&&!o.test(t))&&(i=t)}return e=/ll$/,r=new RegExp(It),e.test(i)&&r.test(i)&&(e=/.$/,i=i.replace(e,"")),a=="y"&&(i=a.toLowerCase()+i.substring(1)),i}function Pr(i,t,n=!0){var r;const e=`${this.language}:${i}:${t}`;return n&&this.normalizationCache.has(e)?this.normalizationCache.get(e):(r=this.stopWords)!=null&&r.includes(t)?(n&&this.normalizationCache.set(e,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(i)&&(t=this.stemmer(t)),t=sc(t),n&&this.normalizationCache.set(e,t),t)}function dc(i){for(;i[i.length-1]==="";)i.pop();for(;i[0]==="";)i.shift();return i}function Or(i,t,n,e=!0){if(t&&t!==this.language)throw H("LANGUAGE_NOT_SUPPORTED",t);if(typeof i!="string")return[i];const r=this.normalizeToken.bind(this,n??"");let o;if(n&&this.tokenizeSkipProperties.has(n))o=[r(i,e)];else{const a=Ua[this.language];o=i.toLowerCase().split(a).map(u=>r(u,e)).filter(Boolean)}const s=dc(o);return this.allowDuplicates?s:Array.from(new Set(s))}function Gr(i={}){if(!i.language)i.language="english";else if(!wn.includes(i.language))throw H("LANGUAGE_NOT_SUPPORTED",i.language);let t;if(i.stemming||i.stemmer&&!("stemming"in i))if(i.stemmer){if(typeof i.stemmer!="function")throw H("INVALID_STEMMER_FUNCTION_TYPE");t=i.stemmer}else if(i.language==="english")t=lc;else throw H("MISSING_STEMMER",i.language);let n;if(i.stopWords!==!1){if(n=[],Array.isArray(i.stopWords))n=i.stopWords;else if(typeof i.stopWords=="function")n=i.stopWords(n);else if(i.stopWords)throw H("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(n))throw H("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(const r of n)if(typeof r!="string")throw H("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}const e={tokenize:Or,language:i.language,stemmer:t,stemmerSkipProperties:new Set(i.stemmerSkipProperties?[i.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(i.tokenizeSkipProperties?[i.tokenizeSkipProperties].flat():[]),stopWords:n,allowDuplicates:!!i.allowDuplicates,normalizeToken:Pr,normalizationCache:new Map};return e.tokenize=Or.bind(e),e.normalizeToken=Pr,e}function fc(i){return{sharedInternalDocumentStore:i,rules:new Map}}function gc(i,t){if(i.rules.has(t.id))throw new Error(`PINNING_RULE_ALREADY_EXISTS: A pinning rule with id "${t.id}" already exists. Use updateRule to modify it.`);i.rules.set(t.id,t)}function pc(i,t){if(!i.rules.has(t.id))throw new Error(`PINNING_RULE_NOT_FOUND: Cannot update pinning rule with id "${t.id}" because it does not exist. Use addRule to create it.`);i.rules.set(t.id,t)}function mc(i,t){return i.rules.delete(t)}function vc(i,t){return i.rules.get(t)}function yc(i){return Array.from(i.rules.values())}function bc(i,t){const n=i.toLowerCase().trim(),e=t.pattern.toLowerCase().trim();switch(t.anchoring){case"is":return n===e;case"starts_with":return n.startsWith(e);case"contains":return n.includes(e);default:return!1}}function wc(i,t){return i?t.conditions.every(n=>bc(i,n)):!1}function Fr(i,t){if(!t)return[];const n=[];for(const e of i.rules.values())wc(t,e)&&n.push(e);return n}function Ec(i,t){const n=t;return{sharedInternalDocumentStore:i,rules:new Map((n==null?void 0:n.rules)??[])}}function Sc(i){return{rules:Array.from(i.rules.entries())}}function Tc(){return{create:fc,addRule:gc,updateRule:pc,removeRule:mc,getRule:vc,getAllRules:yc,getMatchingRules:Fr,load:Ec,save:Sc}}function _c(i){const t={formatElapsedTime:Ja,getDocumentIndexId:Qa,getDocumentProperties:gr,validateSchema:br};for(const n of Sr){const e=n;if(i[e]){if(typeof i[e]!="function")throw H("COMPONENT_MUST_BE_FUNCTION",e)}else i[e]=t[e]}for(const n of Object.keys(i))if(!yu.includes(n)&&!Sr.includes(n))throw H("UNSUPPORTED_COMPONENT",n)}function Ac({schema:i,sort:t,language:n,components:e,id:r,plugins:o}){e||(e={});for(const w of o??[]){if(!("getComponents"in w)||typeof w.getComponents!="function")continue;const m=w.getComponents(i),g=Object.keys(m);for(const S of g)if(e[S])throw H("PLUGIN_COMPONENT_CONFLICT",S,w.name);e={...e,...m}}r||(r=dr());let s=e.tokenizer,a=e.index,u=e.documentsStore,c=e.sorter,h=e.pinning;if(s?s.tokenize?s=s:s=Gr(s):s=Gr({language:n??"english"}),e.tokenizer&&n)throw H("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");const l=iu();a||(a=Mu()),c||(c=nc()),u||(u=pu()),h||(h=Tc()),_c(e);const{getDocumentProperties:d,getDocumentIndexId:f,validateSchema:p,formatElapsedTime:b}=e,v={data:{},caches:{},schema:i,tokenizer:s,index:a,sorter:c,documentsStore:u,pinning:h,internalDocumentIDStore:l,getDocumentProperties:d,getDocumentIndexId:f,validateSchema:p,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeUpsert:[],afterUpsert:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],beforeUpdateMultiple:[],afterUpdateMultiple:[],beforeUpsertMultiple:[],afterUpsertMultiple:[],afterCreate:[],formatElapsedTime:b,id:r,plugins:o,version:Dc()};v.data={index:v.index.create(v,l,i),docs:v.documentsStore.create(v,l),sorting:v.sorter.create(v,l,i,t),pinning:v.pinning.create(l)};for(const w of mu)v[w]=(v[w]??[]).concat(vu(v,w));const y=v.afterCreate;return y&&bu(y,v),v}function Dc(){return"{{VERSION}}"}function Rc(i){return i.documentsStore.count(i.data.docs)}function Cc(i,t,n,e,r){const o=i.validateSchema(t,i.schema);if(o)throw H("SCHEMA_VALIDATION_FAILURE",o);return Se(i.beforeInsert)||Se(i.afterInsert)||Se(i.index.beforeInsert)||Se(i.index.insert)||Se(i.index.afterInsert)?kc(i,t,n,e,r):Nc(i,t,n,e,r)}const Lc=new Set(["enum","enum[]"]),Ic=new Set(["string","number"]);async function kc(i,t,n,e,r){const{index:o,docs:s}=i.data,a=i.getDocumentIndexId(t);if(typeof a!="string")throw H("DOCUMENT_ID_MUST_BE_STRING",typeof a);const u=ue(i.internalDocumentIDStore,a);if(await St(i.beforeInsert,i,a,t),!i.documentsStore.store(s,a,u,t))throw H("DOCUMENT_ALREADY_EXISTS",a);const c=i.documentsStore.count(s),h=i.index.getSearchableProperties(o),l=i.index.getSearchablePropertiesWithTypes(o),d=i.getDocumentProperties(t,h);for(const[f,p]of Object.entries(d)){if(typeof p>"u")continue;const b=typeof p,v=l[f];zr(b,v,f,p)}return await xc(i,a,h,d,c,n,t,r),await St(i.afterInsert,i,a,t),a}function Nc(i,t,n,e,r){const{index:o,docs:s}=i.data,a=i.getDocumentIndexId(t);if(typeof a!="string")throw H("DOCUMENT_ID_MUST_BE_STRING",typeof a);const u=ue(i.internalDocumentIDStore,a);if(St(i.beforeInsert,i,a,t),!i.documentsStore.store(s,a,u,t))throw H("DOCUMENT_ALREADY_EXISTS",a);const c=i.documentsStore.count(s),h=i.index.getSearchableProperties(o),l=i.index.getSearchablePropertiesWithTypes(o),d=i.getDocumentProperties(t,h);for(const[f,p]of Object.entries(d)){if(typeof p>"u")continue;const b=typeof p,v=l[f];zr(b,v,f,p)}return Pc(i,a,h,d,c,n,t,r),St(i.afterInsert,i,a,t),a}function zr(i,t,n,e){if(!(nu(t)&&typeof e=="object"&&typeof e.lon=="number"&&typeof e.lat=="number")&&!(qe(t)&&Array.isArray(e))&&!(wt(t)&&Array.isArray(e))&&!(Lc.has(t)&&Ic.has(i))&&i!==t)throw H("INVALID_DOCUMENT_PROPERTY",n,t,i)}async function xc(i,t,n,e,r,o,s,a){var h,l,d,f;for(const p of n){const b=e[p];if(typeof b>"u")continue;const v=i.index.getSearchablePropertiesWithTypes(i.data.index)[p];await((l=(h=i.index).beforeInsert)==null?void 0:l.call(h,i.data.index,p,t,b,v,o,i.tokenizer,r));const y=i.internalDocumentIDStore.idToInternalId.get(t);await i.index.insert(i.index,i.data.index,p,t,y,b,v,o,i.tokenizer,r,a),await((f=(d=i.index).afterInsert)==null?void 0:f.call(d,i.data.index,p,t,b,v,o,i.tokenizer,r))}const u=i.sorter.getSortableProperties(i.data.sorting),c=i.getDocumentProperties(s,u);for(const p of u){const b=c[p];if(typeof b>"u")continue;const v=i.sorter.getSortablePropertiesWithTypes(i.data.sorting)[p];i.sorter.insert(i.data.sorting,p,t,b,v,o)}}function Pc(i,t,n,e,r,o,s,a){var h,l,d,f;for(const p of n){const b=e[p];if(typeof b>"u")continue;const v=i.index.getSearchablePropertiesWithTypes(i.data.index)[p],y=ue(i.internalDocumentIDStore,t);(l=(h=i.index).beforeInsert)==null||l.call(h,i.data.index,p,t,b,v,o,i.tokenizer,r),i.index.insert(i.index,i.data.index,p,t,y,b,v,o,i.tokenizer,r,a),(f=(d=i.index).afterInsert)==null||f.call(d,i.data.index,p,t,b,v,o,i.tokenizer,r)}const u=i.sorter.getSortableProperties(i.data.sorting),c=i.getDocumentProperties(s,u);for(const p of u){const b=c[p];if(typeof b>"u")continue;const v=i.sorter.getSortablePropertiesWithTypes(i.data.sorting)[p];i.sorter.insert(i.data.sorting,p,t,b,v,o)}}const Mr="fulltext",Oc="hybrid",Gc="vector";function Fc(i,t){return i[1]-t[1]}function zc(i,t){return t[1]-i[1]}function Mc(i="desc"){return i.toLowerCase()==="asc"?Fc:zc}function Ln(i,t,n){const e={},r=t.map(([c])=>c),o=i.documentsStore.getMultiple(i.data.docs,r),s=Object.keys(n),a=i.index.getSearchablePropertiesWithTypes(i.data.index);for(const c of s){let h;if(a[c]==="number"){const{ranges:l}=n[c],d=l.length,f=Array.from({length:d});for(let p=0;p<d;p++){const b=l[p];f[p]=[`${b.from}-${b.to}`,0]}h=Object.fromEntries(f)}e[c]={count:0,values:h??{}}}const u=o.length;for(let c=0;c<u;c++){const h=o[c];for(const l of s){const d=l.includes(".")?_n(h,l):h[l],f=a[l],p=e[l].values;switch(f){case"number":{const b=n[l].ranges;Ur(b,p)(d);break}case"number[]":{const b=new Set,v=n[l].ranges,y=Ur(v,p,b);for(const w of d)y(w);break}case"boolean":case"enum":case"string":{$r(p,f)(d);break}case"boolean[]":case"enum[]":case"string[]":{const y=$r(p,f==="boolean[]"?"boolean":"string",new Set);for(const w of d)y(w);break}default:throw H("FACET_NOT_SUPPORTED",f)}}}for(const c of s){const h=e[c];if(h.count=Object.keys(h.values).length,a[c]==="string"){const l=n[c],d=Mc(l.sort);h.values=Object.fromEntries(Object.entries(h.values).sort(d).slice(l.offset??0,l.limit??10))}}return e}function Ur(i,t,n){return e=>{for(const r of i){const o=`${r.from}-${r.to}`;n!=null&&n.has(o)||e>=r.from&&e<=r.to&&(t[o]===void 0?t[o]=1:(t[o]++,n==null||n.add(o)))}}}function $r(i,t,n){const e=t==="boolean"?"false":"";return r=>{const o=(r==null?void 0:r.toString())??e;n!=null&&n.has(o)||(i[o]=(i[o]??0)+1,n==null||n.add(o))}}const Uc={reducer:(i,t,n,e)=>(t[e]=n,t),getInitialValue:i=>Array.from({length:i})},Br=["string","number","boolean"];function In(i,t,n){const e=n.properties,r=e.length,o=i.index.getSearchablePropertiesWithTypes(i.data.index);for(let y=0;y<r;y++){const w=e[y];if(typeof o[w]>"u")throw H("UNKNOWN_GROUP_BY_PROPERTY",w);if(!Br.includes(o[w]))throw H("INVALID_GROUP_BY_PROPERTY",w,Br.join(", "),o[w])}const s=t.map(([y])=>Et(i.internalDocumentIDStore,y)),a=i.documentsStore.getMultiple(i.data.docs,s),u=a.length,c=n.maxResult||Number.MAX_SAFE_INTEGER,h=[],l={};for(let y=0;y<r;y++){const w=e[y],m={property:w,perValue:{}},g=new Set;for(let S=0;S<u;S++){const E=a[S],_=_n(E,w);if(typeof _>"u")continue;const A=typeof _!="boolean"?_:""+_,R=m.perValue[A]??{indexes:[],count:0};R.count>=c||(R.indexes.push(S),R.count++,m.perValue[A]=R,g.add(_))}h.push(Array.from(g)),l[w]=m}const d=Wr(h),f=d.length,p=[];for(let y=0;y<f;y++){const w=d[y],m=w.length,g={values:[],indexes:[]},S=[];for(let E=0;E<m;E++){const _=w[E],A=e[E];S.push(l[A].perValue[typeof _!="boolean"?_:""+_].indexes),g.values.push(_)}g.indexes=qa(S).sort((E,_)=>E-_),g.indexes.length!==0&&p.push(g)}const b=p.length,v=Array.from({length:b});for(let y=0;y<b;y++){const w=p[y],m=n.reduce||Uc,g=w.indexes.map(A=>({id:s[A],score:t[A][1],document:a[A]})),S=m.reducer.bind(null,w.values),E=m.getInitialValue(w.indexes.length),_=g.reduce(S,E);v[y]={values:w.values,result:_}}return v}function Wr(i,t=0){if(t+1===i.length)return i[t].map(o=>[o]);const n=i[t],e=Wr(i,t+1),r=[];for(const o of n)for(const s of e){const a=[o];hr(a,s),r.push(a)}return r}function kn(i,t,n,e){const r=Fr(t,e);if(r.length===0)return n;const o=r.flatMap(v=>v.consequence.promote);o.sort((v,y)=>v.position-y.position);const s=new Set,a=new Map,u=new Set;for(const v of o){const y=ue(i.internalDocumentIDStore,v.doc_id);if(y!==void 0){if(a.has(y)){const w=a.get(y);v.position<w&&a.set(y,v.position);continue}u.has(v.position)||(s.add(y),a.set(y,v.position),u.add(v.position))}}if(a.size===0)return n;const c=n.filter(([v])=>!s.has(v)),h=1e6,l=[];for(const[v,y]of a.entries())n.find(([m])=>m===v)?l.push([v,h-y]):i.documentsStore.get(i.data.docs,v)&&l.push([v,0]);l.sort((v,y)=>{const w=a.get(v[0])??1/0,m=a.get(y[0])??1/0;return w-m});const d=[],f=new Map;for(const v of l){const y=a.get(v[0]);f.set(y,v)}let p=0,b=0;for(;b<c.length+l.length;)if(f.has(b))d.push(f.get(b)),b++;else if(p<c.length)d.push(c[p]),p++,b++;else break;for(const[v,y]of f.entries())v>=d.length&&d.push(y);return d}function Hr(i,t,n){const{term:e,properties:r}=t,o=i.data.index;let s=i.caches.propertiesToSearch;if(!s){const l=i.index.getSearchablePropertiesWithTypes(o);s=i.index.getSearchableProperties(o),s=s.filter(d=>l[d].startsWith("string")),i.caches.propertiesToSearch=s}if(r&&r!=="*"){for(const l of r)if(!s.includes(l))throw H("UNKNOWN_INDEX",l,s.join(", "));s=s.filter(l=>r.includes(l))}const a=Object.keys(t.where??{}).length>0;let u;a&&(u=i.index.searchByWhereClause(o,i.tokenizer,t.where,n));let c;const h=t.threshold!==void 0&&t.threshold!==null?t.threshold:1;if(e||r){const l=Rc(i);if(c=i.index.search(o,e||"",i.tokenizer,n,s,t.exact||!1,t.tolerance||0,t.boost||{},Hc(t.relevance),l,u,h),t.exact&&e){const d=e.trim().split(/\s+/);c=c.filter(([f])=>{const p=i.documentsStore.get(i.data.docs,f);if(!p)return!1;for(const b of s){const v=Bc(p,b);if(typeof v=="string"&&d.every(w=>new RegExp(`\\b${$c(w)}\\b`).test(v)))return!0}return!1})}}else if(a){const l=$u(o,t.where);l?c=l:c=(u?Array.from(u):[]).map(f=>[+f,0])}else c=Object.keys(i.documentsStore.getAll(i.data.docs)).map(d=>[+d,0]);return c}function $c(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Bc(i,t){const n=t.split(".");let e=i;for(const r of n)if(e&&typeof e=="object"&&r in e)e=e[r];else return;return e}function Wc(i,t,n){var a,u;const e=Ve();function r(){const c=Object.keys(i.data.index.vectorIndexes),h=t.facets&&Object.keys(t.facets).length>0,{limit:l=10,offset:d=0,distinctOn:f,includeVectors:p=!1}=t,b=t.preflight===!0;let v=Hr(i,t,n);if(t.sortBy)if(typeof t.sortBy=="function"){const m=v.map(([E])=>E),S=i.documentsStore.getMultiple(i.data.docs,m).map((E,_)=>[v[_][0],v[_][1],E]);S.sort(t.sortBy),v=S.map(([E,_])=>[E,_])}else v=i.sorter.sortBy(i.data.sorting,v,t.sortBy).map(([m,g])=>[ue(i.internalDocumentIDStore,m),g]);else v=v.sort(fr);v=kn(i,i.data.pinning,v,t.term);let y;b||(y=f?Qc(i,v,d,l,f):qr(i,v,d,l));const w={elapsed:{formatted:"",raw:0},hits:[],count:v.length};if(typeof y<"u"&&(w.hits=y.filter(Boolean),p||mr(w,c)),h){const m=Ln(i,v,t.facets);w.facets=m}return t.groupBy&&(w.groups=In(i,v,t.groupBy)),w.elapsed=i.formatElapsedTime(Ve()-e),w}async function o(){i.beforeSearch&&await Dn(i.beforeSearch,i,t,n);const c=r();return i.afterSearch&&await An(i.afterSearch,i,t,n,c),c}return((a=i.beforeSearch)==null?void 0:a.length)||((u=i.afterSearch)==null?void 0:u.length)?o():r()}const Nn={k:1.2,b:.75,d:.5};function Hc(i){const t=i??{};return t.k=t.k??Nn.k,t.b=t.b??Nn.b,t.d=t.d??Nn.d,t}function jr(i,t,n){const e=t.vector;if(e&&(!("value"in e)||!("property"in e)))throw H("INVALID_VECTOR_INPUT",Object.keys(e).join(", "));const r=i.data.index.vectorIndexes[e.property];if(!r)throw H("UNKNOWN_VECTOR_PROPERTY",e.property);const o=r.node.size;if((e==null?void 0:e.value.length)!==o)throw(e==null?void 0:e.property)===void 0||(e==null?void 0:e.value.length)===void 0?H("INVALID_INPUT_VECTOR","undefined",o,"undefined"):H("INVALID_INPUT_VECTOR",e.property,o,e.value.length);const s=i.data.index;let a;return Object.keys(t.where??{}).length>0&&(a=i.index.searchByWhereClause(s,i.tokenizer,t.where,n)),r.node.find(e.value,t.similarity??_u,a)}function jc(i,t,n="english"){var a,u;const e=Ve();function r(){let c=jr(i,t,n).sort(fr);c=kn(i,i.data.pinning,c,void 0);let h=[];t.facets&&Object.keys(t.facets).length>0&&(h=Ln(i,c,t.facets));const d=t.vector.property,f=t.includeVectors??!1,p=t.limit??10,b=t.offset??0,v=Array.from({length:p});for(let g=0;g<p;g++){const S=c[g+b];if(!S)break;const E=i.data.docs.docs[S[0]];if(E){f||(E[d]=null);const _={id:Et(i.internalDocumentIDStore,S[0]),score:S[1],document:E};v[g]=_}}let y=[];t.groupBy&&(y=In(i,c,t.groupBy));const m=Ve()-e;return{count:c.length,hits:v.filter(Boolean),elapsed:{raw:Number(m),formatted:Sn(m)},...h?{facets:h}:{},...y?{groups:y}:{}}}async function o(){i.beforeSearch&&await Dn(i.beforeSearch,i,t,n);const c=r();return i.afterSearch&&await An(i.afterSearch,i,t,n,c),c}return((a=i.beforeSearch)==null?void 0:a.length)||((u=i.afterSearch)==null?void 0:u.length)?o():r()}function Vc(i,t,n){const e=Yc(Hr(i,t,n)),r=jr(i,t,n),o=t.hybridWeights;return Xc(e,r,t.term??"",o)}function qc(i,t,n){var a,u;const e=Ve();function r(){let c=Vc(i,t,n);c=kn(i,i.data.pinning,c,t.term);let h;t.facets&&Object.keys(t.facets).length>0&&(h=Ln(i,c,t.facets));let d;t.groupBy&&(d=In(i,c,t.groupBy));const f=t.offset??0,p=t.limit??10,b=qr(i,c,f,p).filter(Boolean),v=Ve(),y={count:c.length,elapsed:{raw:Number(v-e),formatted:Sn(v-e)},hits:b,...h?{facets:h}:{},...d?{groups:d}:{}};if(!(t.includeVectors??!1)){const m=Object.keys(i.data.index.vectorIndexes);mr(y,m)}return y}async function o(){i.beforeSearch&&await Dn(i.beforeSearch,i,t,n);const c=r();return i.afterSearch&&await An(i.afterSearch,i,t,n,c),c}return((a=i.beforeSearch)==null?void 0:a.length)||((u=i.afterSearch)==null?void 0:u.length)?o():r()}function xn(i){return i[1]}function Yc(i){const t=Math.max.apply(Math,i.map(xn));return i.map(([n,e])=>[n,e/t])}function Vr(i,t){return i/t}function Kc(i,t){return(n,e)=>n*i+e*t}function Xc(i,t,n,e){const r=Math.max.apply(Math,i.map(xn)),o=Math.max.apply(Math,t.map(xn)),s=e&&e.text&&e.vector,{text:a,vector:u}=s?e:Zc(),c=new Map,h=i.length,l=Kc(a,u);for(let f=0;f<h;f++){const[p,b]=i[f],v=Vr(b,r),y=l(v,0);c.set(p,y)}const d=t.length;for(let f=0;f<d;f++){const[p,b]=t[f],v=Vr(b,o),y=c.get(p)??0;c.set(p,y+l(0,v))}return[...c].sort((f,p)=>p[1]-f[1])}function Zc(i){return{text:.5,vector:.5}}function Jc(i,t,n){const e=t.mode??Mr;if(e===Mr)return Wc(i,t,n);if(e===Gc)return jc(i,t);if(e===Oc)return qc(i,t);throw H("INVALID_SEARCH_MODE",e)}function Qc(i,t,n,e,r){const o=i.data.docs,s=new Map,a=[],u=new Set,c=t.length;let h=0;for(let l=0;l<c;l++){const d=t[l];if(typeof d>"u")continue;const[f,p]=d;if(u.has(f))continue;const b=i.documentsStore.get(o,f),v=_n(b,r);if(!(typeof v>"u"||s.has(v))&&(s.set(v,!0),h++,!(h<=n)&&(a.push({id:Et(i.internalDocumentIDStore,f),score:p,document:b}),u.add(f),h>=n+e)))break}return a}function qr(i,t,n,e){const r=i.data.docs,o=Array.from({length:e}),s=new Set;for(let a=n;a<e+n;a++){const u=t[a];if(typeof u>"u")break;const[c,h]=u;if(!s.has(c)){const l=i.documentsStore.get(r,c);o[a]={id:Et(i.internalDocumentIDStore,c),score:h,document:l},s.add(c)}}return o}let kt=null,Oe=null;const Pn={category:"",subcategory:"",series:"",tag:"",post:""},Yr={category:"",subcategory:"",series:"",tag:"",post:""};function eh(i){return{NODE_COLORS:i?{category:"#a78bfa",subcategory:"#60a5fa",series:"#fb923c",tag:"#34d399",post:"#f472b6"}:{category:"#7C3AED",subcategory:"#2563EB",series:"#EA580C",tag:"#0D9488",post:"#DC2626"},EDGE_COLORS:i?{inCategory:"rgba(167,139,250,0.5)",inSubcategory:"rgba(96,165,250,0.4)",inSeries:"rgba(251,146,60,0.55)",hasTag:"rgba(52,211,153,0.4)",related:"rgba(192,132,252,0.55)",dependsOn:"rgba(96,165,250,0.6)",tagCooccurs:"rgba(253,224,71,0.3)"}:{inCategory:"#9333ea",inSubcategory:"#3b82f6",inSeries:"#ea580c",hasTag:"#0d9488",related:"#8b5cf6",dependsOn:"#2563eb",tagCooccurs:"#94a3b8"},LABEL_COLOR:i?"#e2e8f0":"#1a1a2e",LABEL_BG:i?"rgba(7,11,24,0.7)":"rgba(255,255,255,0)",DEFAULT_EDGE:i?"rgba(148,163,184,0.25)":"#94a3b8"}}function th(){return document.documentElement.getAttribute("data-md-color-scheme")==="slate"}function nh(i){const t=i.querySelector(".starfield-canvas");t&&t.remove(),Oe&&(cancelAnimationFrame(Oe),Oe=null);const n=document.createElement("canvas");n.className="starfield-canvas",n.style.cssText=`
    position: absolute; inset: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 0;
  `,i.style.position="relative",i.prepend(n);function e(){n.width=i.offsetWidth||800,n.height=i.offsetHeight||600}e();const r=n.getContext("2d"),o=Array.from({length:200},()=>({x:Math.random()*n.width,y:Math.random()*n.height,r:Math.random()*1.2+.2,alpha:Math.random()*.6+.2,dAlpha:(Math.random()*.005+.001)*(Math.random()<.5?1:-1)}));function s(){r.clearRect(0,0,n.width,n.height),o.forEach(u=>{u.alpha+=u.dAlpha,(u.alpha>.85||u.alpha<.1)&&(u.dAlpha*=-1),r.beginPath(),r.arc(u.x,u.y,u.r,0,Math.PI*2),r.fillStyle=`rgba(180, 200, 255, ${u.alpha})`,r.fill()}),Oe=requestAnimationFrame(s)}s();const a=new ResizeObserver(e);a.observe(i),n._ro=a}function ih(i){var n;Oe&&(cancelAnimationFrame(Oe),Oe=null);const t=i==null?void 0:i.querySelector(".starfield-canvas");t&&((n=t._ro)==null||n.disconnect(),t.remove())}function rh(i,t){const{NODE_COLORS:n,EDGE_COLORS:e,DEFAULT_EDGE:r}=t,o={category:!1,subcategory:!1,series:!1,tag:!1,post:!0},s={};i.nodes.forEach(h=>{s[h.id]=0}),i.edges.forEach(h=>{s[h.source]!==void 0&&s[h.source]++,s[h.target]!==void 0&&s[h.target]++});function a(h){const l=s[h.id]||0;switch(h.type){case"category":return 28;case"subcategory":return 16+Math.min(l*.3,7);case"tag":return Math.max(7,Math.min(18,6+l*.8));case"series":return Math.max(10,Math.min(22,10+l*.4));case"post":return Math.max(6,Math.min(16,5+l*1.5));default:return 8}}const u=new J({multi:!1,type:"directed"});i.nodes.forEach(h=>{u.addNode(h.id,{label:h.label,size:a(h),color:n[h.type]||"#a78bfa",nodeType:h.type,url:h.url||null,date:h.date||null,series:h.series||null,difficulty:h.difficulty||null,hidden:o[h.type]??!1,x:Math.random()*100,y:Math.random()*100})});const c=new Set;return i.edges.forEach(h=>{const l=`${h.source}--${h.target}`,d=`${h.target}--${h.source}`;if(c.has(l)||c.has(d)||!u.hasNode(h.source)||!u.hasNode(h.target)||h.source===h.target)return;c.add(l);const f=h.type==="dependsOn"||h.type==="related";u.addDirectedEdge(h.source,h.target,{edgeType:h.type,weight:h.weight,color:e[h.type]||r,size:h.type==="tagCooccurs"?Math.min(h.weight*.5,2):1.2,type:f?"arrow":"line"})}),u}function oh(i){const t=new J({multi:!1,type:"undirected"});i.forEachNode((u,c)=>{t.addNode(u,{weight:c.size||1})}),i.forEachEdge((u,c,h,l)=>{h!==l&&!t.hasEdge(h,l)&&t.addEdge(h,l,{weight:c.weight||1})});const n=Ma(t,{resolution:1.2,getEdgeWeight:"weight"}),e={};Object.entries(n).forEach(([u,c])=>{e[c]||(e[c]=[]),e[c].push(u),i.hasNode(u)&&i.setNodeAttribute(u,"community",c)});const r=Object.keys(e).length,o=300,s={};Object.keys(e).forEach((u,c)=>{const h=c/r*2*Math.PI;s[u]={x:o*Math.cos(h),y:o*Math.sin(h)}});const a=i.nodes().filter(u=>i.getNodeAttribute(u,"nodeType")==="category");i.forEachNode(u=>{var b;const c=n[u],h=s[c]||{x:0,y:0},l=((b=e[c])==null?void 0:b.length)||1,d=Math.min(150,30+Math.sqrt(l)*15),f=Math.random()*2*Math.PI,p=Math.random()*d;i.setNodeAttribute(u,"x",h.x+p*Math.cos(f)),i.setNodeAttribute(u,"y",h.y+p*Math.sin(f))}),a.forEach(u=>{const c=n[u];c!==void 0&&s[c]&&(i.setNodeAttribute(u,"x",s[c].x),i.setNodeAttribute(u,"y",s[c].y))}),ka.assign(i,{iterations:300,settings:{gravity:.05,scalingRatio:10,barnesHutOptimize:!0,barnesHutTheta:.5,strongGravityMode:!0,linLogMode:!1,outboundAttractionDistribution:!0,adjustSizes:!1,edgeWeightInfluence:1,slowDown:1}})}function sh(i,t,n,e,r){const{NODE_COLORS:o,EDGE_COLORS:s,LABEL_COLOR:a,LABEL_BG:u,DEFAULT_EDGE:c}=n;return new Aa(i,t,{renderEdgeLabels:!1,enableEdgeClickEvents:!1,enableEdgeWheelEvents:!1,enableEdgeHoverEvents:!1,defaultNodeColor:o.tag,defaultEdgeColor:c,labelFont:"Pretendard, sans-serif",labelSize:12,labelWeight:"600",labelColor:{color:a},labelBackgroundColor:u,labelRenderedSizeThreshold:10,minCameraRatio:.03,maxCameraRatio:8,defaultEdgeType:"line",defaultArrowHeadLength:10,nodeReducer:(h,l)=>{const d={...l},f=r.selectedNode===h,p=r.hoveredNode===h,b=r.hoveredNode?new Set(i.neighbors(r.hoveredNode)):r.selectedNode?new Set(i.neighbors(r.selectedNode)):null,v=l.nodeType;if((v==="post"||v==="tag")&&(d.borderColor=e?v==="post"?"rgba(244,114,182,0.6)":"rgba(52,211,153,0.5)":v==="post"?"rgba(220,38,38,0.5)":"rgba(13,148,136,0.45)",d.borderSize=1.5),r.searchQuery&&r.searchMatches.size>0){if(!r.searchMatches.has(h))return d.color=e?"#1e293b":"#cbd5e1",d.label="",d.size=l.size*.4,d.borderSize=0,d;d.size=l.size*1.3,d.borderColor=e?"#fbbf24":"#d97706",d.borderSize=2.5}if((r.hoveredNode||r.selectedNode)&&!p&&!f){if(!b||!b.has(h))return l.hidden||(d.color=e?"#374151":"#b0bec5",d.label="",d.size=l.size*.7,d.borderSize=0),d;d.size=l.size*1.1}return p&&(d.borderColor=e?"#f8fafc":"#1e293b",d.borderSize=2),f&&(d.size=l.size*1.6,d.zIndex=10,d.borderColor=e?"#fbbf24":"#b45309",d.borderSize=3),d},edgeReducer:(h,l)=>{const d={...l};if(l.hidden)return d;const[f,p]=i.extremities(h),b=r.hoveredNode||r.selectedNode;return b&&(f!==b&&p!==b?(d.color=e?"#1e293b":"#d1d5db",d.size=.3):(d.size=(l.size||1)*2.5,d.color=s[l.edgeType]||c)),r.searchQuery&&r.searchMatches.size>0&&!r.searchMatches.has(f)&&!r.searchMatches.has(p)&&(d.color=e?"#1e293b":"#d1d5db",d.size=.2),d}})}function ah(i,t,n){const e=document.getElementById("graph-tooltip");function r(a,u,c){if(!e)return;const h=Pn[u.nodeType]||u.nodeType,l=i.degree(a);let d=`<div class="gt-type gt-type--${u.nodeType}">${h}</div>`;d+=`<div class="gt-label">${u.label}</div>`,u.date&&(d+=`<div class="gt-meta">${u.date}</div>`),d+=`<div class="gt-meta"> ${l}</div>`,d+=`<div class="gt-hint">${u.nodeType==="post"?" ":"  "}</div>`,e.innerHTML=d,e.classList.add("is-visible"),s(c)}function o(){e==null||e.classList.remove("is-visible")}function s(a){var f,p;if(!e||!a)return;const u=t.getBoundingClientRect(),c=(((f=a.original)==null?void 0:f.clientX)??a.clientX??0)-u.left,h=(((p=a.original)==null?void 0:p.clientY)??a.clientY??0)-u.top,l=e.offsetWidth||200,d=e.offsetHeight||80;e.style.left=(c+16+l>u.width?c-l-8:c+16)+"px",e.style.top=(h+16+d>u.height?h-d-8:h+12)+"px"}return t.addEventListener("mousemove",a=>{n.hoveredNode&&(e!=null&&e.classList.contains("is-visible"))&&s({clientX:a.clientX,clientY:a.clientY})}),{showTooltip:r,hideTooltip:o}}function uh(i,t,n,e,r){var l;const o=document.getElementById("graph-info-panel"),s=document.getElementById("graph-panel-body"),a=document.getElementById("graph-panel-close"),u=((l=document.querySelector('meta[name="site-url"]'))==null?void 0:l.content)||"/";function c(d,f){if(!o||!s)return;n.selectedNode=d;const p=Pn[f.nodeType]||f.nodeType,b=i.neighbors(d),v=b.filter(A=>i.getNodeAttribute(A,"nodeType")==="post").map(A=>({id:A,label:i.getNodeAttribute(A,"label"),url:i.getNodeAttribute(A,"url"),date:i.getNodeAttribute(A,"date")})).sort((A,R)=>(R.date||"").localeCompare(A.date||"")),y=b.filter(A=>i.getNodeAttribute(A,"nodeType")!=="post").map(A=>({id:A,label:i.getNodeAttribute(A,"label"),type:i.getNodeAttribute(A,"nodeType")})),w=i.degree(d);let m=`<div class="gp-node-header gp-node-header--${f.nodeType}">`;m+='<div class="gp-header-row">',m+=`<div class="gp-type gp-type--${f.nodeType}">${p}</div>`;const g=[`${w} `];v.length&&g.push(`${v.length} `),y.length&&g.push(`${y.length} `),m+=`<span class="gp-inline-stats">${g.join("  ")}</span>`,m+="</div>",m+=`<h2 class="gp-title">${f.label}</h2>`;const S=[];if(f.series&&S.push(`<span class="gp-meta-series">${f.series}</span>`),f.date&&S.push(`<span class="gp-meta-date">${f.date}</span>`),f.difficulty){const A={beginner:"",intermediate:"",advanced:""}[f.difficulty]||f.difficulty;S.push(`<span class="gp-meta-diff gp-meta-diff--${f.difficulty}">${A}</span>`)}S.length&&(m+=`<div class="gp-meta-line">${S.join("")}</div>`),m+="</div>";let E='<div class="gp-scroll-body">';if(f.nodeType==="post"){const A=(e[d]||"").trim();if(A){const R=A.slice(0,220);E+='<div class="gp-section gp-section--teaser">',E+=`<p class="gp-post-teaser">${R}${A.length>220?"...":""}</p>`,E+="</div>"}}if(v.length>0&&(E+='<div class="gp-section">',E+=`<div class="gp-section-title"> <span class="gp-section-count">${v.length}</span></div>`,E+='<ul class="gp-post-list">',v.forEach(A=>{const R=A.date?`<span class="gp-post-date">${A.date}</span>`:"";E+='<li class="gp-post-item">',E+=A.url?`<a href="${u}${A.url}" class="gp-post-link">${A.label}</a>${R}`:`<span class="gp-post-label">${A.label}</span>${R}`,E+="</li>"}),E+="</ul></div>"),y.length>0){const A=["category","subcategory","series","tag"],R={};y.forEach(L=>{R[L.type]||(R[L.type]=[]),R[L.type].push(L)}),E+='<div class="gp-section">',E+=`<div class="gp-section-title"> <span class="gp-section-count">${y.length}</span></div>`,A.forEach(L=>{!R[L]||R[L].length===0||(E+='<div class="gp-conn-group">',E+=`<span class="gp-conn-group-label gp-type--${L}">${Pn[L]}</span>`,E+='<div class="gp-tags">',R[L].forEach(z=>{E+=`<span class="gp-tag gp-tag--${z.type}" data-node-id="${z.id}">${z.label}</span>`}),E+="</div></div>")}),E+="</div>"}E+="</div>";let _="";f.nodeType==="post"&&f.url&&(_=`<div class="gp-panel-footer"><a class="gp-open-btn" href="${u}${f.url}"> <svg class="gp-open-btn-icon" viewBox="0 0 16 16" fill="none" width="13" height="13"><path d="M3 8h10M9 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a></div>`),s.innerHTML=m+E+_,o.classList.add("is-open"),s.querySelectorAll(".gp-tag[data-node-id]").forEach(A=>{A.addEventListener("click",()=>{const R=A.dataset.nodeId;i.hasNode(R)&&(r(R),c(R,i.getNodeAttributes(R)))})}),t.refresh()}function h(){o==null||o.classList.remove("is-open"),n.selectedNode=null,t.refresh()}return a==null||a.addEventListener("click",h),{openPanel:c,closePanel:h}}function ch(i,t){const n={category:!0,subcategory:!0,series:!0,tag:!0,post:!1};function e(){i.nodes().forEach(r=>{i.setNodeAttribute(r,"hidden",!n[i.getNodeAttribute(r,"nodeType")])}),i.edges().forEach(r=>{const[o,s]=i.extremities(r),a=i.getNodeAttribute(o,"hidden")||i.getNodeAttribute(s,"hidden");i.setEdgeAttribute(r,"hidden",a)}),t.refresh()}document.querySelectorAll(".graph-filter-cb").forEach(r=>{const o=r.dataset.type;r.checked=n[o]??!1,r.addEventListener("change",s=>{n[o]=s.target.checked,e()})}),e()}function hh(i,t,n,e){var v;let r=null,o=!1;const s={};i.nodes().forEach(y=>{if(i.getNodeAttribute(y,"nodeType")==="post"){const w=i.neighbors(y).filter(m=>i.getNodeAttribute(m,"nodeType")==="tag").map(m=>i.getNodeAttribute(m,"label"));s[y]=w.join(" ")}});const a=((v=document.querySelector('meta[name="site-url"]'))==null?void 0:v.content)||"/";function u(y){return y?y.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim():""}(async function(){try{let w={};try{(await(await fetch(a+"search/search_index.json")).json()).docs.forEach(S=>{const E=(S.location||"").split("#")[0];E&&(w[E]||(w[E]=""),w[E]+=" "+u(S.text||""))})}catch(m){console.warn("graph-viz: search_index.json  , label  ",m)}i.nodes().forEach(m=>{const g=i.getNodeAttributes(m);if(g.nodeType==="post"&&g.url){const S=(g.url||"").replace(/^\//,"").replace(/^sonblog\//,"");e[m]=(w[S]||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim()}}),r=Ac({schema:{nodeId:"string",label:"string",nodeType:"string",content:"string",tags:"string",series:"string"}});for(const m of i.nodes()){const g=i.getNodeAttributes(m);let S="";if(g.nodeType==="post"&&g.url){const E=(g.url||"").replace(/^\//,"").replace(/^sonblog\//,"");S=(w[E]||"").trim().slice(0,2e3)}Cc(r,{nodeId:m,label:g.label||"",nodeType:g.nodeType||"",content:S,tags:s[m]||"",series:g.series||""})}o=!0,console.log("graph-viz: Orama BM25    ("+i.order+" nodes)")}catch(w){console.error("graph-viz: Orama   ",w)}})();const c=document.getElementById("graph-search"),h=document.getElementById("graph-search-clear");function l(y){if(n.searchQuery=y,n.searchMatches.clear(),y&&o&&r){const w=Jc(r,{term:y,limit:20,boost:{label:3,tags:2,series:1.5,content:1}});w.hits.forEach(m=>{const g=m.document.nodeId;i.hasNode(g)&&n.searchMatches.add(g)}),d(w.hits)}else if(y&&!o){const w=y.toLowerCase();i.nodes().forEach(m=>{(i.getNodeAttribute(m,"label")||"").toLowerCase().includes(w)&&n.searchMatches.add(m)}),d(null)}else p();h&&(h.style.display=y?"flex":"none"),t.refresh()}function d(y){let w=document.getElementById("graph-search-dropdown");if(!w){w=document.createElement("div"),w.id="graph-search-dropdown",w.className="graph-search-dropdown";const m=document.querySelector(".graph-search-wrap");m&&m.appendChild(w)}if(y===null){const m=[...n.searchMatches].slice(0,10);if(m.length===0){w.innerHTML='<div class="gsd-empty"> </div>',w.classList.add("is-visible");return}w.innerHTML=m.map(g=>{const S=i.getNodeAttributes(g);return`<div class="gsd-item" data-node-id="${g}">
          <span class="gsd-type gsd-type--${S.nodeType}">${Yr[S.nodeType]||S.nodeType}</span>
          <span class="gsd-label">${S.label}</span>
        </div>`}).join(""),w.classList.add("is-visible"),f(w);return}if(!y||y.length===0){w.innerHTML='<div class="gsd-empty"> </div>',w.classList.add("is-visible");return}w.innerHTML=y.slice(0,10).map(m=>{const g=m.document,S=i.hasNode(g.nodeId)?i.getNodeAttributes(g.nodeId):{},E=i.hasNode(g.nodeId)?i.degree(g.nodeId):0;let _="";if(g.nodeType==="post"){const A=[];if(S.date&&A.push(S.date),S.series&&A.push(S.series),A.length&&(_+=`<span class="gsd-meta">${A.join("  ")}</span>`),g.content){const R=g.content.slice(0,80).replace(/\s+/g," ").trim();_+=`<span class="gsd-teaser">${R}${g.content.length>80?"...":""}</span>`}if(g.tags){const R=g.tags.split(" ").filter(Boolean).slice(0,5);R.length&&(_+=`<span class="gsd-tags">${R.map(L=>`<span class="gsd-tag">${L}</span>`).join("")}</span>`)}}else _+=`<span class="gsd-meta">${E} </span>`;return`<div class="gsd-item" data-node-id="${g.nodeId}">
        <div class="gsd-item-head">
          <span class="gsd-type gsd-type--${g.nodeType}">${Yr[g.nodeType]||g.nodeType}</span>
          <span class="gsd-label">${g.label}</span>
        </div>
        ${_?`<div class="gsd-item-body">${_}</div>`:""}
      </div>`}).join(""),w.classList.add("is-visible"),f(w)}function f(y){y.querySelectorAll(".gsd-item").forEach(w=>{w.addEventListener("click",()=>{const m=w.dataset.nodeId;i.hasNode(m)&&(n.zoomToNode(m),n.openPanel(m,i.getNodeAttributes(m))),p()})})}function p(){const y=document.getElementById("graph-search-dropdown");y&&y.classList.remove("is-visible")}let b=null;return c==null||c.addEventListener("input",y=>{clearTimeout(b);const w=y.target.value.trim();b=setTimeout(()=>l(w),120)}),h&&(h.style.display="none",h.addEventListener("click",()=>{c.value="",l(""),p()})),document.addEventListener("click",y=>{y.target.closest(".graph-search-wrap")||p()}),{hideSearchDropdown:p}}function On(){var b;const i=document.getElementById("sigma-container");if(!i)return;const t=window.__GRAPH_DATA__;if(!t){console.error("graph-viz: __GRAPH_DATA__ not found");return}if(kt){try{kt.kill()}catch{}kt=null}ih(i),i.innerHTML="";const n=th(),e=eh(n),r=rh(t,e);oh(r),n&&nh(i);const o={hoveredNode:null,selectedNode:null,searchQuery:"",searchMatches:new Set,zoomToNode:null,openPanel:null},s=sh(r,i,e,n,o);function a(v){if(!r.hasNode(v))return;const y=r.getNodeAttribute(v,"x"),w=r.getNodeAttribute(v,"y");if(y==null||w==null)return;const{x:m,y:g}=s.graphToViewport({x:y,y:w});s.getCamera().animate(s.viewportToFramedGraph({x:m,y:g}),{duration:500})}const u={},{showTooltip:c,hideTooltip:h}=ah(r,i,o),{openPanel:l,closePanel:d}=uh(r,s,o,u,a);o.zoomToNode=a,o.openPanel=l,ch(r,s);const{hideSearchDropdown:f}=hh(r,s,o,u);s.on("clickNode",({node:v})=>{h(),l(v,r.getNodeAttributes(v))}),s.on("clickStage",()=>{d(),h(),f()}),s.on("enterNode",({node:v,event:y})=>{o.hoveredNode=v,i.style.cursor="pointer",c(v,r.getNodeAttributes(v),y),s.refresh()}),s.on("leaveNode",()=>{o.hoveredNode=null,i.style.cursor="default",h(),s.refresh()}),(b=document.getElementById("graph-reset"))==null||b.addEventListener("click",()=>{s.getCamera().animatedReset()});const p=document.getElementById("graph-stats");if(p){const v=t.metadata||{};p.textContent=`${v.total_posts||0} posts  ${v.total_tags||0} tags  ${v.total_categories||0} categories`}kt=s,console.log(`graph-viz: ${r.order} nodes, ${r.size} edges [${n?"dark":"light"}]`)}window.initGraphViz=On,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",On):On()})();
